import{d as xt,r as c,c as O,o as _t,s as Ct,D as $t,a as _,m as R,k as $,i as d,f as w,e as a,w as s,j as i,t as p,x as Et,I as Ot,u as Ne,v as Dt,F as fe,l as ke,G as ht,g as C,z as y,q as zt,h as u,p as Tt,J as St,n as ue,B as Ut}from"./index-WVG0ME_-.js";import{u as Jt,C as qt}from"./CrossSeedPanel-B5BSqspO.js";const Xt={class:"batch-fetch-panel"},jt={class:"search-and-controls"},Ht={key:0,class:"current-filters",style:{"margin-right":"15px",display:"flex","align-items":"center"}},Wt={key:2,class:"pagination-controls"},Kt={class:"table-container"},Gt=["title"],Yt={key:0,style:{color:"#909399"}},Qt={class:"filter-card-header"},Zt={class:"filter-card-body"},es={class:"path-tree-container"},ts={class:"filter-card-footer"},ss={key:2,class:"modal-overlay"},as={class:"modal-header"},ls={class:"batch-fetch-content"},rs={class:"config-section"},ns={class:"batch-fetch-footer"},os={key:3,class:"modal-overlay"},is={class:"modal-header"},ds={class:"priority-settings-content"},us={class:"priority-section"},cs={class:"priority-list"},ps={key:0,style:{color:"#909399","margin-left":"10px"}},gs={class:"available-sites"},fs={key:0,style:{color:"#909399","margin-left":"10px"}},vs={class:"priority-settings-footer"},_s={key:4,class:"modal-overlay"},hs={class:"modal-header"},ms={class:"progress-header-controls"},ys={class:"progress-content"},ws={class:"progress-summary"},bs={class:"results-table-container"},ks={class:"progress-footer"},Ss=3e3,xs=xt({__name:"BatchFetchPanel",emits:["cancel","fetch-completed"],setup(Rt,{emit:Ke}){const Ge=Ke,le=c([]),ve=c(!0),K=c(null),U=c([]),T=c(!1),ce=c(!1),_e=c(!1),P=c(!1),re=c(!1),j=c([]),B=c([]),H=c(null),J=c(null),Me=c([]),he=c([]),ne=c([]),$e=c([]),G=c(1),me=c(20),q=c(0),N=c(""),oe=c(!1),D=c({paths:[],states:[],downloaderIds:[]}),L=c({...D.value}),ye=c(null),S=c({total:0,processed:0,success:0,failed:0,skipped:0,isRunning:!1,results:[]}),Se=c(null),Ye=O(()=>{const r=D.value,l=[];return r.paths&&r.paths.length>0&&l.push(`路径: ${r.paths.length}`),r.states&&r.states.length>0&&l.push(`状态: ${r.states.length}`),r.downloaderIds&&r.downloaderIds.length>0&&l.push(`下载器: ${r.downloaderIds.length}`),l.join(", ")}),Qe=O(()=>{const r=D.value;return r.paths&&r.paths.length>0||r.states&&r.states.length>0||r.downloaderIds&&r.downloaderIds.length>0}),ie=O(()=>j.value.filter(r=>r.is_source&&r.has_cookie).map(r=>r.name).filter(r=>!B.value.includes(r))),x=O(()=>S.value.total===0?0:Math.round(S.value.processed/S.value.total*100)),Y=O(()=>{if(!S.value.isRunning)return S.value.failed>0?"exception":"success"}),Le=r=>{const l=[],h=new Map;return r.sort().forEach(m=>{const b=m.replace(/^\/|\/$/g,"").split("/");let z="",Z=l;b.forEach((we,I)=>{if(z=I===0?`/${we}`:`${z}/${we}`,!h.has(z)){const X={path:I===b.length-1?m:z,label:we,children:[]};h.set(z,X),Z.push(X)}Z=h.get(z).children})}),h.forEach(m=>{m.children&&m.children.length===0&&delete m.children}),l},W=async()=>{ve.value=!0,K.value=null;try{const r=new URLSearchParams({page:G.value.toString(),pageSize:me.value.toString(),nameSearch:N.value,path_filters:JSON.stringify(D.value.paths),state_filters:JSON.stringify(D.value.states),downloader_filters:JSON.stringify(D.value.downloaderIds),exclude_existing:"true"}),h=(await C.get(`/api/data?${r.toString()}`)).data;h.error?(K.value=h.error||"获取数据失败",y.error(h.error||"获取数据失败")):(le.value=h.data.map(m=>({name:m.name,save_path:m.save_path,size:m.size,progress:m.progress,state:m.state,sites:m.sites||{},downloader_ids:m.downloader_ids||[]})),q.value=h.total,(ne.value.length===0||!D.value.states.length)&&(ne.value=[...new Set(le.value.map(m=>m.state))]))}catch(r){K.value=r.message||"网络错误",y.error(r.message||"网络错误")}finally{ve.value=!1}},Ze=async()=>{try{const l=(await C.get("/api/all_downloaders")).data;$e.value=l.filter(h=>h.enabled)}catch(r){K.value=r.message}},de=async()=>{try{const r=new URLSearchParams({page:"1",page_size:"1",path_filters:JSON.stringify([]),state_filters:JSON.stringify([]),downloader_filters:JSON.stringify([])}),h=(await C.get(`/api/data?${r.toString()}`)).data;h.unique_paths&&(he.value=h.unique_paths,Me.value=Le(he.value))}catch(r){console.error("获取路径列表失败:",r)}},A=r=>{me.value=r,G.value=1,W()},E=r=>{G.value=r,W()},et=()=>{D.value={paths:[],states:[],downloaderIds:[]},N.value="",G.value=1,De(),W()},tt=()=>{L.value={...D.value},oe.value=!0,zt(()=>{J.value&&D.value.paths.length>0&&J.value.setCheckedKeys(D.value.paths,!1)})},st=()=>{if(J.value){const r=J.value.getCheckedKeys(!1);L.value.paths=r}D.value={...L.value},oe.value=!1,G.value=1,De(),W()},De=async()=>{try{await C.post("/api/config/batch_fetch_filters",{batch_fetch_filters:D.value,batch_fetch_name_search:N.value})}catch(r){console.error("保存筛选条件失败:",r)}},Ae=async()=>{try{const l=(await C.get("/api/config/batch_fetch_filters")).data;l.success&&l.data&&(D.value=l.data),l.success&&l.name_search!==void 0&&(N.value=l.name_search)}catch(r){console.error("加载筛选条件失败:",r)}},at=r=>{U.value=r},F=r=>{const l={};for(const[h,m]of Object.entries(r||{}))(m.migration===1||m.migration===3)&&(l[h]=m);return l},xe=()=>{if(U.value.length===0){y.warning("请先选择要获取数据的种子");return}T.value=!0},ze=()=>{T.value=!1},lt=async()=>{_e.value=!0,await rt()},Te=()=>{_e.value=!1},rt=async()=>{P.value=!0;try{const r=await C.get("/api/sites/status");j.value=r.data;const h=(await C.get("/api/config/source_priority")).data;h.success&&(B.value=h.data||[])}catch(r){y.error(r.message||"加载配置失败")}finally{P.value=!1}},nt=async()=>{re.value=!0;try{const r=await C.post("/api/config/source_priority",{source_priority:B.value});if(r.data.success)y.success("源站点优先级配置已保存"),Te();else throw new Error(r.data.message||"保存失败")}catch(r){y.error(r.message||"保存配置失败")}finally{re.value=!1}},ot=r=>r===0?"success":r===1?"primary":r===2?"warning":"info",Q=r=>{B.value.includes(r)||B.value.push(r)},it=r=>{const l=B.value.indexOf(r);l>-1&&B.value.splice(l,1)},dt=r=>{H.value=r},ut=r=>{if(H.value===null)return;const l=B.value[H.value];B.value.splice(H.value,1),B.value.splice(r,0,l),H.value=null},ct=async()=>{try{const r=U.value.map(m=>m.name),h=(await C.post("/api/migrate/batch_fetch_seed_data",{torrentNames:r})).data;h.success?(ye.value=h.task_id,y.success("批量获取任务已启动"),ze(),Re()):y.error(h.message||"批量获取任务启动失败")}catch(r){const l=r.response?.data?.message||r.message||"网络错误";y.error(l)}},Re=()=>{ce.value=!0,Oe()},Ee=()=>{ce.value=!1,pe()},Oe=()=>{pe(),Be(),Se.value=setInterval(async()=>{ce.value&&ye.value?(await Be(),S.value&&!S.value.isRunning&&setTimeout(()=>{S.value.isRunning||pe()},3e3)):pe()},Ss)},pe=()=>{Se.value&&(clearInterval(Se.value),Se.value=null)},Be=async()=>{if(ye.value)try{const l=(await C.get(`/api/migrate/batch_fetch_progress?task_id=${ye.value}`)).data;if(l.success){const h=S.value.isRunning;S.value=l.progress,h&&!S.value.isRunning&&Ge("fetch-completed")}else y.error(l.message||"获取进度失败")}catch(r){console.error("获取进度时出错:",r)}},Fe=r=>{switch(r){case"success":return"success";case"failed":return"danger";case"skipped":return"info";default:return"info"}},Ue=r=>{switch(r){case"success":return"成功";case"failed":return"失败";case"skipped":return"跳过";default:return"未知"}},pt=r=>{if(!r||r===0)return"0 B";const l=1024,h=["B","KB","MB","GB","TB","PB"],m=Math.floor(Math.log(r)/Math.log(l));return`${(r/Math.pow(l,m)).toFixed(2)} ${h[m]}`},gt=(r,l=50)=>{if(!r||r.length<=l)return r;const h=Math.floor((l-3)/2);let m=r.substring(0,h),b=r.substring(r.length-h);const z=m.lastIndexOf("/"),Z=b.indexOf("/");return z>0&&Z>=0&&(m=m.substring(0,z),b=b.substring(Z+1)),`${m}...${b}`};return _t(async()=>{await Ze(),await Ae(),await de(),W()}),Ct(()=>{pe()}),$t(N,()=>{G.value=1,W(),De()}),(r,l)=>{const h=w("el-alert"),m=w("el-input"),b=w("el-button"),z=w("el-tag"),Z=w("el-icon"),we=w("el-pagination"),I=w("el-table-column"),Ie=w("el-table"),X=w("el-divider"),ee=w("el-tree"),Je=w("el-checkbox"),Ve=w("el-checkbox-group"),te=w("el-card"),ge=w("el-descriptions-item"),ft=w("el-descriptions"),vt=w("el-progress"),Ce=Dt("loading");return u(),_("div",Xt,[K.value?(u(),R(h,{key:0,title:K.value,type:"error","show-icon":"",closable:!1,center:"",style:{"margin-bottom":"15px"}},null,8,["title"])):$("",!0),d("div",jt,[a(m,{modelValue:N.value,"onUpdate:modelValue":l[0]||(l[0]=v=>N.value=v),placeholder:"搜索名称...",clearable:"",class:"search-input",style:{width:"300px","margin-right":"15px"}},null,8,["modelValue"]),a(b,{type:"primary",onClick:tt,plain:"",style:{"margin-right":"15px"}},{default:s(()=>[...l[9]||(l[9]=[i(" 筛选 ",-1)])]),_:1}),Qe.value?(u(),_("div",Ht,[a(z,{type:"info",size:"default",effect:"plain"},{default:s(()=>[i(p(Ye.value),1)]),_:1}),a(b,{type:"danger",link:"",style:{padding:"0","margin-left":"8px"},onClick:et},{default:s(()=>[...l[10]||(l[10]=[i("清除",-1)])]),_:1})])):$("",!0),a(b,{type:"warning",onClick:lt,plain:"",style:{"margin-right":"15px"}},{default:s(()=>[a(Z,{style:{"margin-right":"5px"}},{default:s(()=>[a(Et(Ot))]),_:1}),l[11]||(l[11]=i(" 设置优先级 ",-1))]),_:1}),a(b,{type:"success",onClick:xe,plain:"",style:{"margin-right":"15px"},disabled:U.value.length===0},{default:s(()=>[i(" 批量获取数据 ("+p(U.value.length)+") ",1)]),_:1},8,["disabled"]),ye.value?(u(),R(b,{key:1,type:"info",onClick:Re,plain:"",style:{"margin-right":"15px"}},{default:s(()=>[...l[12]||(l[12]=[i(" 查看进度 ",-1)])]),_:1})):$("",!0),le.value.length>0?(u(),_("div",Wt,[a(we,{"current-page":G.value,"onUpdate:currentPage":l[1]||(l[1]=v=>G.value=v),"page-size":me.value,"onUpdate:pageSize":l[2]||(l[2]=v=>me.value=v),"page-sizes":[20,50,100],total:q.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:A,onCurrentChange:E,background:""},null,8,["current-page","page-size","total"])])):$("",!0)]),d("div",Kt,[Ne((u(),R(Ie,{data:le.value,border:"",style:{width:"100%"},"empty-text":"暂无种子数据",height:"100%",onSelectionChange:at},{default:s(()=>[a(I,{type:"selection",width:"55",align:"center","header-align":"center"}),a(I,{prop:"name",label:"种子名称","min-width":"400","show-overflow-tooltip":"","header-align":"center"}),a(I,{prop:"size",label:"大小",width:"110",align:"center","header-align":"center"},{default:s(v=>[i(p(pt(v.row.size)),1)]),_:1}),a(I,{prop:"save_path",label:"保存路径",width:"200","header-align":"center"},{default:s(v=>[d("div",{title:v.row.save_path,style:{width:"100%",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}},p(gt(v.row.save_path,30)),9,Gt)]),_:1}),a(I,{prop:"site_count",label:"站点数",width:"100",align:"center","header-align":"center"},{default:s(v=>[i(p(Object.keys(v.row.sites||{}).length),1)]),_:1}),a(I,{prop:"state",label:"状态",width:"120",align:"center","header-align":"center"}),a(I,{label:"已有源站点","min-width":"200","header-align":"center"},{default:s(v=>[(u(!0),_(fe,null,ke(F(v.row.sites),(se,be)=>(u(),R(z,{key:be,size:"small",type:"success",style:{margin:"2px"}},{default:s(()=>[i(p(be),1)]),_:2},1024))),128)),Object.keys(F(v.row.sites)).length===0?(u(),_("span",Yt," 无可用源站点 ")):$("",!0)]),_:1})]),_:1},8,["data"])),[[Ce,ve.value]])]),oe.value?(u(),_("div",{key:1,class:"filter-overlay",onClick:l[7]||(l[7]=ht(v=>oe.value=!1,["self"]))},[a(te,{class:"filter-card"},{header:s(()=>[d("div",Qt,[l[14]||(l[14]=d("span",null,"筛选选项",-1)),a(b,{type:"danger",circle:"",onClick:l[3]||(l[3]=v=>oe.value=!1),plain:""},{default:s(()=>[...l[13]||(l[13]=[i("X",-1)])]),_:1})])]),default:s(()=>[d("div",Zt,[a(X,{"content-position":"left"},{default:s(()=>[...l[15]||(l[15]=[i("保存路径",-1)])]),_:1}),d("div",es,[a(ee,{ref_key:"pathTreeRef",ref:J,data:Me.value,"show-checkbox":"","node-key":"path","default-expand-all":"","expand-on-click-node":!1,"check-on-click-node":"","check-strictly":!0,props:{class:"path-tree-node"}},null,8,["data"])]),a(X,{"content-position":"left"},{default:s(()=>[...l[16]||(l[16]=[i("状态",-1)])]),_:1}),a(Ve,{modelValue:L.value.states,"onUpdate:modelValue":l[4]||(l[4]=v=>L.value.states=v)},{default:s(()=>[(u(!0),_(fe,null,ke(ne.value,v=>(u(),R(Je,{key:v,label:v},{default:s(()=>[i(p(v),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"]),a(X,{"content-position":"left"},{default:s(()=>[...l[17]||(l[17]=[i("下载器",-1)])]),_:1}),a(Ve,{modelValue:L.value.downloaderIds,"onUpdate:modelValue":l[5]||(l[5]=v=>L.value.downloaderIds=v)},{default:s(()=>[(u(!0),_(fe,null,ke($e.value,v=>(u(),R(Je,{key:v.id,label:v.id},{default:s(()=>[i(p(v.name),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),d("div",ts,[a(b,{onClick:l[6]||(l[6]=v=>oe.value=!1)},{default:s(()=>[...l[18]||(l[18]=[i("取消",-1)])]),_:1}),a(b,{type:"primary",onClick:st},{default:s(()=>[...l[19]||(l[19]=[i("确认",-1)])]),_:1})])]),_:1})])):$("",!0),T.value?(u(),_("div",ss,[a(te,{class:"batch-fetch-card",shadow:"always"},{header:s(()=>[d("div",as,[l[21]||(l[21]=d("span",null,"批量获取种子数据",-1)),a(b,{type:"danger",circle:"",onClick:ze,plain:""},{default:s(()=>[...l[20]||(l[20]=[i("X",-1)])]),_:1})])]),default:s(()=>[d("div",ls,[d("div",rs,[d("h3",null,"已选择 "+p(U.value.length)+" 个种子",1),l[22]||(l[22]=d("p",{style:{color:"#909399","font-size":"13px","margin-top":"5px"}}," 系统将按名称聚合，逐个从源站点获取种子数据并存储到数据库 ",-1))])]),d("div",ns,[a(b,{onClick:ze},{default:s(()=>[...l[23]||(l[23]=[i("取消",-1)])]),_:1}),a(b,{type:"primary",onClick:ct},{default:s(()=>[...l[24]||(l[24]=[i(" 开始批量获取 ",-1)])]),_:1})])]),_:1})])):$("",!0),_e.value?(u(),_("div",os,[a(te,{class:"priority-settings-card",shadow:"always"},{header:s(()=>[d("div",is,[l[26]||(l[26]=d("span",null,"源站点优先级设置",-1)),a(b,{type:"danger",circle:"",onClick:Te,plain:""},{default:s(()=>[...l[25]||(l[25]=[i("X",-1)])]),_:1})])]),default:s(()=>[d("div",ds,[a(h,{type:"info","show-icon":"",closable:!1,style:{"margin-bottom":"20px"}},{title:s(()=>[...l[27]||(l[27]=[i(" 设置批量获取种子数据时的源站点优先级顺序，系统将按顺序查找第一个可用的源站点 ",-1)])]),_:1}),d("div",us,[l[28]||(l[28]=d("p",{style:{color:"#606266","font-size":"14px","margin-bottom":"10px","font-weight":"600"}}," 优先级顺序（拖拽调整）： ",-1)),Ne((u(),_("div",cs,[(u(!0),_(fe,null,ke(B.value,(v,se)=>(u(),R(z,{key:v,type:ot(se),size:"large",closable:"",onClose:be=>it(v),draggable:"true",onDragstart:be=>dt(se),onDragover:l[8]||(l[8]=ht(()=>{},["prevent"])),onDrop:be=>ut(se),style:{margin:"5px",cursor:"move","user-select":"none"}},{default:s(()=>[i(p(se+1)+". "+p(v),1)]),_:2},1032,["type","onClose","onDragstart","onDrop"]))),128)),B.value.length===0?(u(),_("span",ps," 暂无源站点，请从下方添加 ")):$("",!0)])),[[Ce,P.value]]),a(X),l[29]||(l[29]=d("p",{style:{color:"#606266","font-size":"14px","margin-bottom":"10px","font-weight":"600"}}," 可用源站点列表（点击添加）： ",-1)),Ne((u(),_("div",gs,[(u(!0),_(fe,null,ke(ie.value,v=>(u(),R(z,{key:v,type:"info",size:"default",onClick:se=>Q(v),style:{margin:"5px",cursor:"pointer"}},{default:s(()=>[i(p(v),1)]),_:2},1032,["onClick"]))),128)),ie.value.length===0?(u(),_("span",fs," 所有源站点已添加 ")):$("",!0)])),[[Ce,P.value]])])]),d("div",vs,[a(b,{onClick:Te},{default:s(()=>[...l[30]||(l[30]=[i("取消",-1)])]),_:1}),a(b,{type:"primary",onClick:nt,loading:re.value},{default:s(()=>[...l[31]||(l[31]=[i(" 保存设置 ",-1)])]),_:1},8,["loading"])])]),_:1})])):$("",!0),ce.value?(u(),_("div",_s,[a(te,{class:"progress-card",shadow:"always"},{header:s(()=>[d("div",hs,[d("span",null,"批量获取进度 "+p(S.value.isRunning?"(进行中...)":"(已完成)"),1),d("div",ms,[S.value.isRunning?(u(),R(b,{key:0,type:"warning",size:"small",onClick:pe},{default:s(()=>[...l[32]||(l[32]=[i(" 停止自动刷新 ",-1)])]),_:1})):(u(),R(b,{key:1,type:"primary",size:"small",onClick:Be},{default:s(()=>[...l[33]||(l[33]=[i(" 刷新 ",-1)])]),_:1})),a(b,{type:"danger",circle:"",onClick:Ee,plain:""},{default:s(()=>[...l[34]||(l[34]=[i("X",-1)])]),_:1})])])]),default:s(()=>[d("div",ys,[d("div",ws,[a(ft,{column:2,border:""},{default:s(()=>[a(ge,{label:"总数"},{default:s(()=>[i(p(S.value.total),1)]),_:1}),a(ge,{label:"已处理"},{default:s(()=>[i(p(S.value.processed),1)]),_:1}),a(ge,{label:"成功"},{default:s(()=>[a(z,{type:"success",size:"small"},{default:s(()=>[i(p(S.value.success),1)]),_:1})]),_:1}),a(ge,{label:"失败"},{default:s(()=>[a(z,{type:"danger",size:"small"},{default:s(()=>[i(p(S.value.failed),1)]),_:1})]),_:1}),a(ge,{label:"跳过"},{default:s(()=>[a(z,{type:"info",size:"small"},{default:s(()=>[i(p(S.value.skipped),1)]),_:1})]),_:1}),a(ge,{label:"状态"},{default:s(()=>[a(z,{type:S.value.isRunning?"warning":"success",size:"small"},{default:s(()=>[i(p(S.value.isRunning?"进行中":"已完成"),1)]),_:1},8,["type"])]),_:1})]),_:1}),a(vt,{percentage:x.value,status:Y.value,style:{"margin-top":"15px"}},null,8,["percentage","status"])]),a(X,{"content-position":"left"},{default:s(()=>[...l[35]||(l[35]=[i("处理详情",-1)])]),_:1}),d("div",bs,[a(Ie,{data:S.value.results,style:{width:"100%"},size:"small",stripe:"","max-height":"400"},{default:s(()=>[a(I,{prop:"name",label:"种子名称","min-width":"300","show-overflow-tooltip":""}),a(I,{prop:"status",label:"状态",width:"100",align:"center"},{default:s(v=>[a(z,{type:Fe(v.row.status),size:"small"},{default:s(()=>[i(p(Ue(v.row.status)),1)]),_:2},1032,["type"])]),_:1}),a(I,{prop:"source_site",label:"源站点",width:"120",align:"center"}),a(I,{prop:"reason",label:"失败原因","min-width":"200","show-overflow-tooltip":""})]),_:1},8,["data"])])]),d("div",ks,[a(b,{onClick:Ee},{default:s(()=>[...l[36]||(l[36]=[i("关闭",-1)])]),_:1})])]),_:1})])):$("",!0)])}}}),Cs=Tt(xs,[["__scopeId","data-v-7ab7dbf6"]]),$s={class:"cross-seed-data-view"},Ds={class:"search-and-controls glass-table"},zs={key:0,class:"current-filters",style:{"margin-right":"15px",display:"flex","align-items":"center"}},Ts={key:1,class:"pagination-controls"},Rs={class:"filter-card-header"},Bs={class:"filter-card-body"},Fs={class:"path-tree-container"},Is={class:"target-sites-container"},Vs={class:"selected-site-display"},Ps={key:0,class:"selected-site-info"},Ns={key:1,class:"selected-site-info"},Ms={class:"target-sites-radio-container"},Ls={class:"filter-card-footer"},As={class:"table-container"},Es={class:"mapped-cell"},Os={class:"title-cell"},Us=["title"],Js=["title"],qs={class:"tags-cell"},Xs={class:"mapped-cell datetime-cell"},js={key:2,class:"modal-overlay"},Hs={class:"modal-header"},Ws={class:"cross-seed-content"},Ks={key:3,class:"modal-overlay"},Gs={class:"modal-header"},Ys={class:"batch-cross-seed-content"},Qs={class:"target-site-selection-body"},Zs={class:"batch-info"},ea={class:"batch-cross-seed-footer"},ta={key:4,class:"modal-overlay"},sa={class:"modal-header"},aa={class:"record-header-controls"},la={class:"record-view-content"},ra={key:0,class:"records-table-container"},na={key:0},oa={key:1},ia={key:0,class:"progress-cell"},da={class:"progress-text"},ua={key:1},ca={key:0},pa={key:1},ga={key:2},fa={key:1},va={class:"mapped-cell datetime-cell"},_a={key:1,class:"no-records"},ha={class:"record-view-footer"},ma={key:5,class:"modal-overlay"},ya={class:"modal-header"},wa={class:"batch-fetch-main-content"},ba=5e3,ka=xt({__name:"CrossSeedDataView",emits:["ready"],setup(Rt,{emit:Ke}){const Ge=Ke;_t(()=>{Ge("ready",F)});const le=c({type:{},medium:{},video_codec:{},audio_codec:{},resolution:{},source:{},team:{},tags:{},site_name:{}}),ve=c([]),K=c(!0),U=c(null),T=c([]),ce=c(!1),_e=c(!1),P=c(!1),re=c(!1),j=c([]),B=c(!1),H=c(new Map),J=c(null),Me=c(0),he=c(!1),ne=c(null),$e=c([]),G=c([]),me=c(window.innerHeight-80),q=c(1),N=c(20),oe=c(0),D=c(""),L=c(""),ye=async t=>{L.value=t,q.value=1;try{await C.post("/api/config/cross_seed_review_filter",{review_filter:t})}catch(e){console.error("保存检查状态筛选失败:",e)}F()},S=O(()=>{const t=x.value,e=[];return t.paths&&t.paths.length>0&&e.push(`路径: ${t.paths.length}`),t.isDeleted==="0"?e.push("未删除"):t.isDeleted==="1"&&e.push("已删除"),t.excludeTargetSites&&t.excludeTargetSites.trim()!==""&&e.push(`不存在于: ${t.excludeTargetSites}`),e.join(", ")}),Se=O(()=>T.value.length>0&&x.value.excludeTargetSites&&x.value.excludeTargetSites.trim()!==""),Ye=O(()=>{const t=T.value.length,e=x.value.excludeTargetSites;return!e||e.trim()===""?`批量转种 (${t}) - 请先在筛选中选择目标站点`:`批量转种到 ${e} (${t})`}),Qe=O(()=>{const t=x.value;return t.paths&&t.paths.length>0||t.isDeleted!==""||t.excludeTargetSites&&t.excludeTargetSites.trim()!==""}),ie=c(!1),x=c({paths:[],isDeleted:"",excludeTargetSites:""}),Y=c({...x.value}),Le=c([]),W=O({get:()=>Y.value.excludeTargetSites||"",set:t=>{Y.value.excludeTargetSites=t}}),Ze=()=>{Y.value.excludeTargetSites=""},de=(t,e)=>{if(!e)return"";const o=le.value[t];return o&&o[e]||e},A=t=>t?/^[^.]+[.][^.]+$/.test(t):!0,E=(t,e)=>{if(!e)return!0;const o=le.value[t];return o?!!o[e]:!1},et=t=>{let e=[];if(typeof t=="string")try{e=JSON.parse(t)}catch{e=t.split(",").map(o=>o.trim()).filter(o=>o)}else Array.isArray(t)&&(e=t);return e.length===0?[]:e.map(o=>le.value.tags[o]||o)},tt=(t,e)=>{let o=[];if(typeof t=="string")try{o=JSON.parse(t)}catch{o=t.split(",").map(g=>g.trim()).filter(g=>g)}else Array.isArray(t)&&(o=t);if(o.length===0||e>=o.length)return"info";const f=o[e];return f==="禁转"||f==="tag.禁转"||!A(f)||!E("tags",f)?"danger":"info"},st=(t,e)=>{let o=[];if(typeof t=="string")try{o=JSON.parse(t)}catch{o=t.split(",").map(g=>g.trim()).filter(g=>g)}else Array.isArray(t)&&(o=t);if(o.length===0||e>=o.length)return"";const f=o[e];return f==="禁转"||f==="tag.禁转"?"restricted-tag":!A(f)||!E("tags",f)?"invalid-tag":""},De=t=>{if(!t)return"";try{const e=new Date(t);if(isNaN(e.getTime()))return t;const o=e.getFullYear(),f=String(e.getMonth()+1).padStart(2,"0"),g=String(e.getDate()).padStart(2,"0"),V=String(e.getHours()).padStart(2,"0"),ae=String(e.getMinutes()).padStart(2,"0"),M=String(e.getSeconds()).padStart(2,"0");return`${o}-${f}-${g}
${V}:${ae}:${M}`}catch{return t}},Ae=t=>{const e=["type","medium","video_codec","audio_codec","resolution","team","source"];for(const f of e){const g=t[f];if(g&&(!A(g)||!E(f,g)))return!0}let o=[];if(typeof t.tags=="string")try{o=JSON.parse(t.tags)}catch{o=t.tags.split(",").map(f=>f.trim()).filter(f=>f)}else Array.isArray(t.tags)&&(o=t.tags);for(const f of o)if(!A(f)||!E("tags",f))return!0;return!!t.unrecognized},at=t=>{const e=[],o=new Map;return t.sort().forEach(f=>{const g=f.replace(/^\/|\/$/g,"").split("/");let V="",ae=e;g.forEach((M,qe)=>{if(V=qe===0?`/${M}`:`${V}/${M}`,!o.has(V)){const je={path:qe===g.length-1?f:V,label:M,children:[]};o.set(V,je),ae.push(je)}ae=o.get(V).children})}),o.forEach(f=>{f.children&&f.children.length===0&&delete f.children}),e},F=async()=>{K.value=!0,U.value=null;try{const t=new URLSearchParams({page:q.value.toString(),page_size:N.value.toString(),search:D.value,path_filters:JSON.stringify(x.value.paths||[]),is_deleted:x.value.isDeleted,exclude_target_sites:x.value.excludeTargetSites,review_status:L.value});x.value.excludeTargetSites&&console.log("发送目标站点排除参数:",x.value.excludeTargetSites);const o=(await C.get(`/api/cross-seed-data?${t.toString()}`)).data;o.success?(ve.value=o.data,oe.value=o.total,o.reverse_mappings&&(le.value=o.reverse_mappings),o.unique_paths&&(G.value=o.unique_paths,$e.value=at(o.unique_paths)),o.target_sites&&(Le.value=o.target_sites)):(U.value=o.error||"获取数据失败",y.error(o.error||"获取数据失败"))}catch(t){U.value=t.message||"网络错误",y.error(t.message||"网络错误")}finally{K.value=!1}},xe=async()=>{try{const t={page_size:N.value,search_query:D.value,active_filters:x.value};await C.post("/api/ui_settings/cross_seed",t)}catch(t){console.error("无法保存UI设置:",t.message)}},ze=async()=>{try{const e=(await C.get("/api/ui_settings/cross_seed")).data;N.value=e.page_size??20,D.value=e.search_query??"",e.active_filters&&Object.assign(x.value,e.active_filters)}catch(t){console.error("加载UI设置时出错:",t)}},lt=t=>{N.value=t,q.value=1,F(),xe()},Te=t=>{q.value=t,F()},rt=()=>{x.value={paths:[],isDeleted:"",excludeTargetSites:""},q.value=1,F(),xe()},nt=()=>{Y.value={...x.value},ie.value=!0,zt(()=>{ne.value&&x.value.paths.length>0&&ne.value.setCheckedKeys(x.value.paths,!1)})},ot=()=>{if(ne.value){const t=ne.value.getCheckedKeys(!1);Y.value.paths=t}x.value={...Y.value},ie.value=!1,q.value=1,F(),xe()},Q=Jt();$t(D,()=>{q.value=1,F(),xe()});const it=O(()=>!!Q.taskId),dt=O(()=>Q.workingParams?.title||""),ut=async t=>{try{Q.reset();const o=(await C.get(`/api/migrate/get_db_seed_info?torrent_id=${t.torrent_id}&site_name=${t.site_name}`)).data;if(o.success){const f={...o.data,name:o.data.name||o.data.title,save_path:o.data.save_path||"",size:0,size_formatted:"0 B",progress:100,state:"completed",total_uploaded:0,total_uploaded_formatted:"0 B",downloaderId:o.data.downloader_id||null,sites:{[o.data.site_name]:{torrentId:o.data.torrent_id,comment:`id=${o.data.torrent_id}`}}};Q.setParams(f);const g={name:o.data.site_name,site:o.data.site_name.toLowerCase(),torrentId:o.data.torrent_id};Q.setSourceInfo(g),Q.setTaskId(`cross_seed_${t.id}_${Date.now()}`)}else y.error(o.error||"获取种子参数失败")}catch(e){y.error(e.message||"网络错误")}},ct=async t=>{try{await St.confirm(`确定要永久删除种子数据 "${t.title}" 吗？此操作无法恢复！`,"确认永久删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e={torrent_id:t.torrent_id,site_name:t.site_name},f=(await C.post("/api/cross-seed-data/delete",e)).data;f.success?(y.success(f.message||"删除成功"),F()):y.error(f.error||"删除失败")}catch(e){e!=="cancel"&&y.error(e.message||"网络错误")}},Re=()=>{Q.reset()},Ee=()=>{y.success("转种操作已完成！"),Q.reset(),F()},Oe=()=>{me.value=window.innerHeight-80};_t(async()=>{await ze(),await pe(),F(),window.addEventListener("resize",Oe)});const pe=async()=>{try{const e=(await C.get("/api/config/cross_seed_review_filter")).data;e.success&&(L.value=e.data||"")}catch(t){console.error("加载检查状态筛选配置失败:",t)}},Be=({row:t})=>t.is_deleted||Fe(t.tags)||t.unrecognized?"deleted-row":t.is_reviewed?Ue(t)?"":"selected-row-disabled":"unreviewed-row",Fe=t=>{let e=[];if(typeof t=="string")try{e=JSON.parse(t)}catch{e=t.split(",").map(o=>o.trim()).filter(o=>o)}else Array.isArray(t)&&(e=t);return e.some(o=>o==="禁转"||o==="tag.禁转")},Ue=t=>P.value?!0:Fe(t.tags)?!1:x.value.isDeleted==="1"?!Ae(t):!(t.is_deleted||Ae(t)||!t.is_reviewed),pt=t=>{T.value=t,P.value},gt=()=>{ce.value=!0},r=async()=>{const t=x.value.excludeTargetSites;if(!t||t.trim()===""){y.warning("请先在筛选中选择目标站点");return}try{l();const e={target_site_name:t,seeds:T.value.map(g=>({hash:g.hash,torrent_id:g.torrent_id,site_name:g.site_name,nickname:g.nickname}))};console.log("批量转种数据:",e),re.value=!0,X();const f=(await C.post("/api/go-api/batch-enhance",e)).data;f.success?y.success(`批量转种请求已发送，成功 ${f.data.seeds_processed} 个，失败 ${f.data.seeds_failed} 个`):(ee(),y.error(f.error||"批量转种失败"))}catch(e){ee(),y.error(e.message||"网络错误")}},l=()=>{ce.value=!1},h=()=>P.value?T.value.length===0?"退出删除模式":`删除选中项 (${T.value.length})`:"批量删除模式",m=async()=>{P.value?(P.value=!1,T.value=[]):(P.value=!0,T.value=[])},b=async()=>{if(T.value.length===0){y.warning("请先选择要删除的行");return}try{await St.confirm(`确定要删除选中的 ${T.value.length} 条种子数据吗？此操作无法恢复！`,"确认批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const t={items:T.value.map(f=>({torrent_id:f.torrent_id,site_name:f.site_name}))},o=(await C.post("/api/cross-seed-data/delete",t)).data;o.success?(y.success(o.message||`成功删除 ${o.deleted_count} 条数据`),T.value=[],P.value=!1,F()):y.error(o.error||"批量删除失败")}catch(t){t!=="cancel"&&y.error(t.message||"网络错误")}},z=()=>{_e.value=!0},Z=()=>{_e.value=!1},we=()=>{y.success("批量获取种子数据已完成，正在刷新列表..."),F()},I=t=>t?t.includes("成功")||t.includes("失败"):!1,Ie=O(()=>{if(j.value.length===0)return!1;const t=j.value[0];return!I(t.downloader_add_result)}),X=()=>{ee(),te(),J.value=setInterval(async()=>{re.value?await te():ee()},ba)},ee=()=>{J.value&&(clearInterval(J.value),J.value=null),Me.value=0},Je=()=>{re.value=!0,te(),X()},Ve=()=>{re.value=!1,ee(),F()},te=async()=>{try{se();const e=(await C.get("/api/go-api/records")).data;j.value=e.records||[]}catch(t){console.error("获取记录时出错:",t),y.error("获取记录失败: "+(t.message||"网络错误"))}},ge=async()=>{try{const t=await C.delete("/api/go-api/records");j.value=[],se(),y.success("记录已清空")}catch{j.value=[],se(),y.success("本地记录已清空")}},ft=t=>{switch(t){case"success":return"success";case"failed":return"danger";case"filtered":return"warning";case"processing":return"primary";case"pending":return"info";default:return"info"}},vt=t=>{switch(t){case"success":return"成功";case"failed":return"失败";case"filtered":return"已过滤";case"processing":return"处理中";case"pending":return"等待中";default:return"未知"}},Ce=t=>t?(H.value.has(t)||H.value.set(t,H.value.size+1),H.value.get(t)):"-",v=t=>{if(typeof t!="number")return"info";const e=["success","primary","warning","info"];return e[(t-1)%e.length]},se=()=>{H.value.clear()},be=t=>t.startsWith("成功")?"success":t.startsWith("失败")?"danger":"info",Bt=t=>t.startsWith("成功")?"#67c23a":t.startsWith("失败")?"#f56c6c":"#909399",mt=t=>t.startsWith("成功:")||t.startsWith("失败:")?t.substring(3):t,Ft=t=>{if(!t)return t;const e=t.indexOf("&uploaded");return e!==-1?t.substring(0,e):t},It=t=>{try{const e=new Date(t);if(isNaN(e.getTime()))return t;const o=e.getFullYear(),f=String(e.getMonth()+1).padStart(2,"0"),g=String(e.getDate()).padStart(2,"0"),V=String(e.getHours()).padStart(2,"0"),ae=String(e.getMinutes()).padStart(2,"0"),M=String(e.getSeconds()).padStart(2,"0");return`${o}-${f}-${g}
${V}:${ae}:${M}`}catch{return t}},yt=t=>{if(!t)return 0;const e=t.match(/(\d+)\/(\d+)/);if(e){const o=parseInt(e[1]),f=parseInt(e[2]);if(f>0)return Math.round(o/f*100)}return 0},Vt=t=>t<30?"#e6a23c":t<70?"#409eff":"#67c23a",Pt=async()=>{he.value=!0;try{const e=(await C.post("/api/go-api/batch-enhance/stop")).data;e.success?(y.success("批量转种已停止"),ee(),await te()):y.error(e.error||"停止批量转种失败")}catch(t){y.error(t.message||"停止批量转种失败")}finally{he.value=!1}};return Ct(()=>{window.removeEventListener("resize",Oe),ee()}),(t,e)=>{const o=w("el-alert"),f=w("el-input"),g=w("el-button"),V=w("el-radio-button"),ae=w("el-radio-group"),M=w("el-tag"),qe=w("el-pagination"),Xe=w("el-divider"),je=w("el-tree"),He=w("el-radio"),Pe=w("el-card"),k=w("el-table-column"),wt=w("el-table"),Nt=w("el-progress"),Mt=w("el-link"),Lt=w("el-tooltip"),At=w("el-empty"),bt=Dt("loading");return u(),_("div",$s,[U.value?(u(),R(o,{key:0,title:U.value,type:"error","show-icon":"",closable:!1,style:{margin:"0","border-radius":"0"}},null,8,["title"])):$("",!0),d("div",Ds,[a(f,{modelValue:D.value,"onUpdate:modelValue":e[0]||(e[0]=n=>D.value=n),placeholder:"搜索标题或种子ID...",clearable:"",class:"search-input",style:{width:"300px","margin-right":"15px"}},null,8,["modelValue"]),a(g,{type:"success",onClick:gt,plain:"",style:{"margin-right":"15px"},disabled:!Se.value||P.value},{default:s(()=>[i(p(Ye.value),1)]),_:1},8,["disabled"]),a(g,{type:"info",onClick:Je,plain:"",style:{"margin-right":"15px"}},{default:s(()=>[...e[10]||(e[10]=[i(" 转种记录 ",-1)])]),_:1}),a(g,{type:"warning",onClick:z,plain:"",style:{"margin-right":"15px"}},{default:s(()=>[...e[11]||(e[11]=[i(" 获取数据 ",-1)])]),_:1}),a(g,{type:"danger",onClick:e[1]||(e[1]=n=>P.value&&T.value.length>0?b():m()),plain:"",style:{"margin-right":"15px"}},{default:s(()=>[i(p(h()),1)]),_:1}),a(g,{type:"primary",onClick:nt,plain:"",style:{"margin-right":"15px"}},{default:s(()=>[...e[12]||(e[12]=[i(" 筛选 ",-1)])]),_:1}),a(ae,{modelValue:L.value,"onUpdate:modelValue":e[2]||(e[2]=n=>L.value=n),onChange:ye,style:{"margin-right":"15px"}},{default:s(()=>[a(V,{label:""},{default:s(()=>[...e[13]||(e[13]=[i("全部",-1)])]),_:1}),a(V,{label:"reviewed"},{default:s(()=>[...e[14]||(e[14]=[i("已检查",-1)])]),_:1}),a(V,{label:"unreviewed"},{default:s(()=>[...e[15]||(e[15]=[i("待检查",-1)])]),_:1}),a(V,{label:"error"},{default:s(()=>[...e[16]||(e[16]=[i("错误",-1)])]),_:1})]),_:1},8,["modelValue"]),Qe.value?(u(),_("div",zs,[a(M,{type:"info",size:"default",effect:"plain"},{default:s(()=>[i(p(S.value),1)]),_:1}),a(g,{type:"danger",link:"",style:{padding:"0","margin-left":"8px"},onClick:rt},{default:s(()=>[...e[17]||(e[17]=[i("清除",-1)])]),_:1})])):$("",!0),ve.value.length>0?(u(),_("div",Ts,[a(qe,{"current-page":q.value,"onUpdate:currentPage":e[3]||(e[3]=n=>q.value=n),"page-size":N.value,"onUpdate:pageSize":e[4]||(e[4]=n=>N.value=n),"page-sizes":[20,50,100],total:oe.value,layout:"total, sizes, prev, pager, next",onSizeChange:lt,onCurrentChange:Te,background:""},null,8,["current-page","page-size","total"])])):$("",!0)]),ie.value?(u(),_("div",{key:1,class:"filter-overlay",onClick:e[9]||(e[9]=ht(n=>ie.value=!1,["self"]))},[a(Pe,{class:"filter-card"},{header:s(()=>[d("div",Rs,[e[19]||(e[19]=d("span",null,"筛选选项",-1)),a(g,{type:"danger",circle:"",onClick:e[5]||(e[5]=n=>ie.value=!1),plain:""},{default:s(()=>[...e[18]||(e[18]=[i("X",-1)])]),_:1})])]),default:s(()=>[d("div",Bs,[a(Xe,{"content-position":"left"},{default:s(()=>[...e[20]||(e[20]=[i("保存路径",-1)])]),_:1}),d("div",Fs,[a(je,{ref_key:"pathTreeRef",ref:ne,data:$e.value,"show-checkbox":"","node-key":"path","default-expand-all":"","expand-on-click-node":!1,"check-on-click-node":"","check-strictly":!0,props:{class:"path-tree-node"}},null,8,["data"])]),a(Xe,{"content-position":"left"},{default:s(()=>[...e[21]||(e[21]=[i("删除状态",-1)])]),_:1}),a(ae,{modelValue:Y.value.isDeleted,"onUpdate:modelValue":e[6]||(e[6]=n=>Y.value.isDeleted=n),style:{width:"100%"}},{default:s(()=>[a(He,{label:""},{default:s(()=>[...e[22]||(e[22]=[i("全部",-1)])]),_:1}),a(He,{label:"0"},{default:s(()=>[...e[23]||(e[23]=[i("未删除",-1)])]),_:1}),a(He,{label:"1"},{default:s(()=>[...e[24]||(e[24]=[i("已删除",-1)])]),_:1})]),_:1},8,["modelValue"]),a(Xe,{"content-position":"left"},{default:s(()=>[...e[25]||(e[25]=[i("不存在种子筛选",-1)])]),_:1}),d("div",Is,[d("div",Vs,[W.value?(u(),_("div",Ps,[a(M,{type:"info",size:"default",effect:"plain"},{default:s(()=>[i("已选择: "+p(W.value),1)]),_:1}),a(g,{type:"danger",link:"",style:{padding:"0","margin-left":"8px"},onClick:Ze},{default:s(()=>[...e[26]||(e[26]=[i("清除",-1)])]),_:1})])):(u(),_("div",Ns,[a(M,{type:"info",size:"default",effect:"plain"},{default:s(()=>[...e[27]||(e[27]=[i("未选择",-1)])]),_:1})]))]),d("div",Ms,[a(ae,{modelValue:W.value,"onUpdate:modelValue":e[7]||(e[7]=n=>W.value=n),class:"target-sites-radio-group"},{default:s(()=>[(u(!0),_(fe,null,ke(Le.value,n=>(u(),R(He,{key:n,label:n,class:"target-site-radio"},{default:s(()=>[i(p(n),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])])])]),d("div",Ls,[a(g,{onClick:e[8]||(e[8]=n=>ie.value=!1)},{default:s(()=>[...e[28]||(e[28]=[i("取消",-1)])]),_:1}),a(g,{type:"primary",onClick:ot},{default:s(()=>[...e[29]||(e[29]=[i("确认",-1)])]),_:1})])]),_:1})])):$("",!0),d("div",As,[Ne((u(),R(wt,{data:ve.value,border:"",style:{width:"100%"},"empty-text":"暂无转种数据","max-height":me.value,height:"100%","row-class-name":Be,onSelectionChange:pt,class:"glass-table"},{default:s(()=>[a(k,{type:"selection",width:"55",align:"center",selectable:Ue}),a(k,{prop:"torrent_id",label:"种子ID",align:"center",width:"80","show-overflow-tooltip":""}),a(k,{prop:"nickname",label:"站点名称",width:"100",align:"center"},{default:s(n=>[d("div",Es,p(n.row.nickname),1)]),_:1}),a(k,{prop:"title",label:"标题",align:"center"},{default:s(n=>[d("div",Os,[d("div",{class:"subtitle-line",title:n.row.subtitle},p(n.row.subtitle||""),9,Us),d("div",{class:"main-title-line",title:n.row.title},p(n.row.title||""),9,Js)])]),_:1}),a(k,{prop:"type",label:"类型",width:"100",align:"center"},{default:s(n=>[d("div",{class:ue(["mapped-cell",{"invalid-value":!A(n.row.type)||!E("type",n.row.type)}])},p(de("type",n.row.type)),3)]),_:1}),a(k,{prop:"medium",label:"媒介",width:"100",align:"center"},{default:s(n=>[d("div",{class:ue(["mapped-cell",{"invalid-value":!A(n.row.medium)||!E("medium",n.row.medium)}])},p(de("medium",n.row.medium)),3)]),_:1}),a(k,{prop:"video_codec",label:"视频编码",width:"120",align:"center"},{default:s(n=>[d("div",{class:ue(["mapped-cell",{"invalid-value":!A(n.row.video_codec)||!E("video_codec",n.row.video_codec)}])},p(de("video_codec",n.row.video_codec)),3)]),_:1}),a(k,{prop:"audio_codec",label:"音频编码",width:"90",align:"center"},{default:s(n=>[d("div",{class:ue(["mapped-cell",{"invalid-value":!A(n.row.audio_codec)||!E("audio_codec",n.row.audio_codec)}])},p(de("audio_codec",n.row.audio_codec)),3)]),_:1}),a(k,{prop:"resolution",label:"分辨率",width:"90",align:"center"},{default:s(n=>[d("div",{class:ue(["mapped-cell",{"invalid-value":!A(n.row.resolution)||!E("resolution",n.row.resolution)}])},p(de("resolution",n.row.resolution)),3)]),_:1}),a(k,{prop:"team",label:"制作组",width:"120",align:"center"},{default:s(n=>[d("div",{class:ue(["mapped-cell",{"invalid-value":!A(n.row.team)||!E("team",n.row.team)}])},p(de("team",n.row.team)),3)]),_:1}),a(k,{prop:"source",label:"产地",width:"100",align:"center"},{default:s(n=>[d("div",{class:ue(["mapped-cell",{"invalid-value":!A(n.row.source)||!E("source",n.row.source)}])},p(de("source",n.row.source)),3)]),_:1}),a(k,{prop:"tags",label:"标签",align:"center",width:"170"},{default:s(n=>[d("div",qs,[(u(!0),_(fe,null,ke(et(n.row.tags),(We,kt)=>(u(),R(M,{key:We,size:"small",type:tt(n.row.tags,kt),class:ue(st(n.row.tags,kt)),style:{margin:"2px"}},{default:s(()=>[i(p(We),1)]),_:2},1032,["type","class"]))),128))])]),_:1}),a(k,{prop:"unrecognized",label:"无法识别",width:"120",align:"center"},{default:s(n=>[d("div",{class:ue(["mapped-cell",{"invalid-value":n.row.unrecognized}])},p(n.row.unrecognized||""),3)]),_:1}),a(k,{prop:"updated_at",label:"更新时间",width:"140",align:"center",sortable:""},{default:s(n=>[d("div",Xs,p(n.row.is_deleted||Fe(n.row.tags)?"已删除/禁转":De(n.row.updated_at)),1)]),_:1}),a(k,{label:"操作",width:"130",align:"center",fixed:"right"},{default:s(n=>[a(g,{size:"small",type:"primary",onClick:We=>ut(n.row)},{default:s(()=>[...e[30]||(e[30]=[i("编辑",-1)])]),_:1},8,["onClick"]),a(g,{size:"small",type:"danger",onClick:We=>ct(n.row),style:{"margin-left":"5px"}},{default:s(()=>[...e[31]||(e[31]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data","max-height"])),[[bt,K.value]])]),it.value?(u(),_("div",js,[a(Pe,{class:"cross-seed-card",shadow:"always"},{header:s(()=>[d("div",Hs,[d("span",null,"转种 - "+p(dt.value),1),a(g,{type:"danger",circle:"",onClick:Re,plain:""},{default:s(()=>[...e[32]||(e[32]=[i("X",-1)])]),_:1})])]),default:s(()=>[d("div",Ws,[a(qt,{"show-complete-button":!0,onComplete:Ee,onCancel:Re})])]),_:1})])):$("",!0),ce.value?(u(),_("div",Ks,[a(Pe,{class:"batch-cross-seed-card",shadow:"always"},{header:s(()=>[d("div",Gs,[e[34]||(e[34]=d("span",null,"批量转种",-1)),a(g,{type:"danger",circle:"",onClick:l,plain:""},{default:s(()=>[...e[33]||(e[33]=[i("X",-1)])]),_:1})])]),default:s(()=>[d("div",Ys,[d("div",Qs,[d("div",Zs,[d("p",null,[e[35]||(e[35]=d("strong",null,"目标站点：",-1)),i(p(x.value.excludeTargetSites),1)]),d("p",null,[e[36]||(e[36]=d("strong",null,"选中种子数量：",-1)),i(p(T.value.length)+" 个",1)]),e[37]||(e[37]=d("p",{style:{color:"#909399","font-size":"13px","margin-top":"10px"}}," 将把选中的种子转种到上述目标站点，请确认无误后点击确定。 ",-1))])])]),d("div",ea,[a(g,{onClick:l},{default:s(()=>[...e[38]||(e[38]=[i("取消",-1)])]),_:1}),a(g,{type:"primary",onClick:r},{default:s(()=>[...e[39]||(e[39]=[i("确定",-1)])]),_:1})])]),_:1})])):$("",!0),re.value?(u(),_("div",ta,[a(Pe,{class:"record-view-card",shadow:"always"},{header:s(()=>[d("div",sa,[d("span",null,"批量转种记录 "+p(J.value?"(自动刷新中...)":""),1),e[44]||(e[44]=d("div",{class:"record-warning-text"},"批量转种需要等待种子文件验证，每个种子大概3s",-1)),d("div",aa,[a(g,{type:"danger",size:"small",onClick:Pt,disabled:he.value},{default:s(()=>[i(p(he.value?"停止中...":"停止转种"),1)]),_:1},8,["disabled"]),a(g,{type:"primary",size:"small",onClick:te,loading:B.value},{default:s(()=>[...e[40]||(e[40]=[i(" 刷新 ",-1)])]),_:1},8,["loading"]),J.value?(u(),R(g,{key:0,type:"warning",size:"small",onClick:ee},{default:s(()=>[...e[41]||(e[41]=[i(" 停止自动刷新 ",-1)])]),_:1})):Ie.value?(u(),R(g,{key:1,type:"success",size:"small",onClick:X},{default:s(()=>[...e[42]||(e[42]=[i(" 开启自动刷新 ",-1)])]),_:1})):$("",!0),a(g,{type:"danger",circle:"",onClick:Ve,plain:""},{default:s(()=>[...e[43]||(e[43]=[i("X",-1)])]),_:1})])])]),default:s(()=>[d("div",la,[j.value.length>0?(u(),_("div",ra,[Ne((u(),R(wt,{data:j.value,style:{width:"100%"},size:"small","element-loading-text":"加载记录中...",stripe:""},{default:s(()=>[a(k,{prop:"batch_id",label:"批次ID",width:"80",align:"center"},{default:s(n=>[a(M,{size:"small",type:v(Ce(n.row.batch_id)),effect:"dark"},{default:s(()=>[i(p(Ce(n.row.batch_id)),1)]),_:2},1032,["type"])]),_:1}),a(k,{prop:"title",label:"种子标题","min-width":"250",align:"center","show-overflow-tooltip":""}),a(k,{prop:"source_site",label:"源站点",width:"80",align:"center"}),a(k,{prop:"target_site",label:"目标站点",width:"80",align:"center"}),a(k,{prop:"video_size_gb",label:"视频大小",width:"80",align:"center"},{default:s(n=>[n.row.video_size_gb?(u(),_("span",na,p(n.row.video_size_gb)+"GB",1)):(u(),_("span",oa,"-"))]),_:1}),a(k,{prop:"status",label:"状态",width:"80",align:"center"},{default:s(n=>[a(M,{type:ft(n.row.status),size:"small"},{default:s(()=>[i(p(vt(n.row.status)),1)]),_:2},1032,["type"])]),_:1}),a(k,{prop:"progress",label:"进度",width:"100",align:"center"},{default:s(n=>[n.row.progress?(u(),_("div",ia,[a(Nt,{percentage:yt(n.row.progress),color:Vt(yt(n.row.progress)),"stroke-width":8,"show-text":!1,class:"progress-bar"},null,8,["percentage","color"]),d("span",da,p(n.row.progress),1)])):(u(),_("span",ua,"-"))]),_:1}),a(k,{prop:"error_detail",label:"详情",width:"110",align:"center","show-overflow-tooltip":""},{default:s(n=>[n.row.status==="success"&&n.row.success_url?(u(),_("span",ca,[a(Mt,{type:"primary",href:Ft(n.row.success_url),target:"_blank"},{default:s(()=>[...e[45]||(e[45]=[i("查看详情页",-1)])]),_:1},8,["href"])])):n.row.error_detail?(u(),_("span",pa,p(n.row.error_detail),1)):(u(),_("span",ga,"-"))]),_:1}),a(k,{prop:"downloader_add_result",label:"下载器状态",width:"150",align:"center"},{default:s(n=>[n.row.downloader_add_result?(u(),_(fe,{key:0},[be(n.row.downloader_add_result)==="danger"?(u(),R(Lt,{key:0,effect:"dark",placement:"top"},{content:s(()=>[i(p(mt(n.row.downloader_add_result)),1)]),default:s(()=>[e[46]||(e[46]=d("span",{style:{color:"#f56c6c"}},"错误",-1))]),_:2},1024)):(u(),_("span",{key:1,style:Ut([{"text-align":"center"},{color:Bt(n.row.downloader_add_result)}])},p(mt(n.row.downloader_add_result)),5))],64)):(u(),_("span",fa,"-"))]),_:1}),a(k,{prop:"processed_at",label:"处理时间",width:"100",align:"center"},{default:s(n=>[d("div",va,p(It(n.row.processed_at)),1)]),_:1})]),_:1},8,["data"])),[[bt,B.value]])])):$("",!0),j.value.length===0&&!B.value?(u(),_("div",_a,[a(At,{description:"暂无批量转种记录"})])):$("",!0)]),d("div",ha,[a(g,{onClick:ge,type:"warning"},{default:s(()=>[...e[47]||(e[47]=[i("清空记录",-1)])]),_:1}),a(g,{onClick:Ve},{default:s(()=>[...e[48]||(e[48]=[i("关闭",-1)])]),_:1})])]),_:1})])):$("",!0),_e.value?(u(),_("div",ma,[a(Pe,{class:"batch-fetch-main-card",shadow:"always"},{header:s(()=>[d("div",ya,[e[50]||(e[50]=d("span",null,"批量获取种子数据",-1)),a(g,{type:"danger",circle:"",onClick:Z,plain:""},{default:s(()=>[...e[49]||(e[49]=[i("X",-1)])]),_:1})])]),default:s(()=>[d("div",wa,[a(Cs,{onCancel:Z,onFetchCompleted:we})])]),_:1})])):$("",!0)])}}}),Ca=Tt(ka,[["__scopeId","data-v-39c01ffa"]]);export{Ca as default};
