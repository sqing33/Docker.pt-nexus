import{K as xs,d as ls,r as S,c as U,D as Be,o as os,s as Rs,a as v,k as w,i as t,e as n,f as x,w as u,F as N,l as L,x as A,L as as,h as c,m as z,M as Us,N as Bs,O as ze,p as ns,q as pe,g as D,E as m,P as ie,j as V,n as T,t as h,T as $e,Q as Os,R as Ue,B as js,y as Fs,S as qs,U as ts}from"./index-g-1vxImM.js";const Hs=xs("crossSeed",{state:()=>({taskId:null,sourceInfo:null,workingParams:null}),actions:{setTaskId(Z){this.taskId=Z},clearTaskId(){this.taskId=null},setSourceInfo(Z){this.sourceInfo=Z},clearSourceInfo(){this.sourceInfo=null},setParams(Z){this.workingParams=Z},clearParams(){this.workingParams=null},reset(){this.clearTaskId(),this.clearSourceInfo(),this.clearParams()}}}),Ks={key:0,class:"log-progress-overlay"},Ws={class:"log-progress-container"},Ys={class:"steps-wrapper"},Gs={key:0,class:"spinner-icon"},Js={key:1,class:"success-icon"},Qs={key:2,class:"error-icon"},Xs={key:3,class:"warning-icon"},Zs={key:0,class:"completion-message"},ea=ls({__name:"LogProgress",props:{visible:{type:Boolean},taskId:{}},emits:["complete","close"],setup(Z,{emit:Ve}){const B=Z,re=Ve,W=S([{name:"数据库查询",message:"正在检查缓存...",status:"pending"},{name:"开始抓取",message:"准备从源站点获取...",status:"pending"},{name:"获取种子信息",message:"",status:"pending"},{name:"解析参数",message:"",status:"pending"},{name:"验证图片链接",message:"",status:"pending"},{name:"提取媒体信息",message:"",status:"pending"},{name:"验证简介格式",message:"",status:"pending"},{name:"检查声明感谢",message:"",status:"pending"},{name:"成功获取参数",message:"",status:"pending"}]),q=S(!1);let Y=null;const y=U(()=>{const k=W.value.findIndex(M=>M.status==="processing");return k!==-1?k:W.value.filter(M=>M.status==="success").length}),R=k=>k.status==="success"?"success":k.status==="error"?"error":k.status==="warning"?"warning":k.status==="processing"?"process":"wait";Be(()=>B.taskId,k=>{k&&B.visible&&de()}),Be(()=>B.visible,k=>{k&&B.taskId?de():k||se()}),os(()=>{B.visible&&B.taskId&&de()}),Rs(()=>{se()});const de=()=>{Y&&Y.close(),q.value=!1,W.value.forEach(k=>{k.status="pending",k.message=k.name==="数据库查询"?"正在检查缓存...":k.name==="开始抓取"?"准备从源站点获取...":""}),Y=new EventSource(`/api/migrate/logs/stream/${B.taskId}`),Y.onmessage=k=>{try{const $=JSON.parse(k.data);$.type==="connected"?console.log("SSE 连接成功",$):$.type==="log"?I($.step,$.message,$.status):$.type==="complete"?(q.value=!0,re("complete"),se(),re("close")):$.type}catch($){console.error("解析 SSE 消息失败:",$)}},Y.onerror=k=>{console.error("SSE 连接错误:",k),se()}},se=()=>{Y&&(Y.close(),Y=null)},I=(k,$,M)=>{const j=W.value.findIndex(ae=>ae.name===k);if(j!==-1){const ae=W.value[j];if(ae.message=$,ae.status=M,M==="success"&&j<W.value.length-1){const F=W.value[j+1];F.status==="pending"&&(F.status="processing")}}};return(k,$)=>{const M=x("el-icon"),j=x("el-step"),ae=x("el-steps");return Z.visible?(c(),v("div",Ks,[t("div",Ws,[t("div",Ys,[n(ae,{direction:"vertical",active:y.value,"finish-status":"success"},{default:u(()=>[(c(!0),v(N,null,L(W.value,(F,ve)=>(c(),z(j,{key:ve,title:F.name,description:F.message,status:R(F)},{icon:u(()=>[F.status==="processing"?(c(),v("div",Gs,[n(M,{class:"is-loading"},{default:u(()=>[n(A(Us))]),_:1})])):F.status==="success"?(c(),v("div",Js,[n(M,null,{default:u(()=>[n(A(as))]),_:1})])):F.status==="error"?(c(),v("div",Qs,[n(M,null,{default:u(()=>[n(A(Bs))]),_:1})])):F.status==="warning"?(c(),v("div",Xs,[n(M,null,{default:u(()=>[n(A(ze))]),_:1})])):w("",!0)]),_:2},1032,["title","description","status"]))),128))]),_:1},8,["active"]),q.value?(c(),v("div",Zs,[n(M,{class:"icon-complete",color:"#67C23A"},{default:u(()=>[n(A(as))]),_:1}),$[0]||($[0]=t("span",null,"所有步骤已完成",-1))])):w("",!0)])])])):w("",!0)}}}),sa=ns(ea,[["__scopeId","data-v-b874a855"]]),aa={class:"cross-seed-panel"},ta={class:"panel-header"},la={class:"custom-steps"},oa={class:"step-icon"},na={key:1},ia={class:"step-title"},ra={key:0,class:"step-connector"},da={class:"panel-content"},ua={key:0,class:"step-container details-container"},ca={class:"main-info-container"},ma={class:"full-width-form-column"},pa={class:"title-section"},va={class:"title-components-grid"},_a={class:"bottom-info-section"},fa={class:"subtitle-unrecognized-grid"},ga={class:"subtitle-section",style:{"grid-column":"span 4"}},ba={class:"standard-params-section"},ha={class:"standard-params-grid"},ya={class:"standard-params-grid second-row"},wa={class:"poster-statement-container"},ka={class:"poster-statement-split"},Sa={class:"left-panel"},Ca={class:"form-label-with-button"},Ia={class:"right-panel"},$a={class:"poster-preview-section"},za={class:"image-preview-container"},Va=["src","onError"],Ta={key:1,class:"preview-placeholder"},Ea={class:"screenshot-container"},Na={class:"form-column screenshot-text-column"},Aa={class:"form-label-with-button"},Ma={class:"preview-column screenshot-preview-column"},La={class:"carousel-container"},Pa={class:"carousel-image-wrapper"},Da=["src","onError"],xa={key:1,class:"preview-placeholder"},Ra={class:"form-label-with-button"},Ua={class:"form-label-with-button"},Ba={class:"filtered-declarations-container"},Oa={class:"filtered-declarations-header"},ja={class:"filtered-declarations-content"},Fa={class:"declaration-header"},qa={class:"declaration-number"},Ha={class:"declaration-content code-font"},Ka={key:1,class:"no-filtered-declarations"},Wa={key:1,class:"step-container publish-preview-container"},Ya={class:"publish-preview-content"},Ga={class:"preview-row main-title-row"},Ja={class:"row-content main-title-content"},Qa={class:"preview-row subtitle-row"},Xa={class:"row-content subtitle-content"},Za={class:"preview-row params-row"},et={class:"row-content"},st={class:"param-row"},at={class:"param-item imdb-item half-width"},tt={style:{display:"flex"}},lt={style:{display:"flex"}},ot={class:"param-item tags-item half-width"},nt={class:"param-value-container"},it={key:0,class:"param-standard-key"},rt={class:"params-content"},dt={class:"param-item inline-param"},ut={class:"param-value-container"},ct={key:0,class:"param-standard-key"},mt={class:"param-item inline-param"},pt={class:"param-value-container"},vt={key:0,class:"param-standard-key"},_t={class:"param-item inline-param"},ft={class:"param-value-container"},gt={key:0,class:"param-standard-key"},bt={class:"param-item inline-param"},ht={class:"param-value-container"},yt={key:0,class:"param-standard-key"},wt={class:"param-item inline-param"},kt={class:"param-value-container"},St={key:0,class:"param-standard-key"},Ct={class:"param-item inline-param"},It={class:"param-value-container"},$t={key:0,class:"param-standard-key"},zt={class:"param-item inline-param"},Vt={class:"param-value-container"},Tt={key:0,class:"param-standard-key"},Et={class:"preview-row mediainfo-row"},Nt={class:"row-content mediainfo-content scrollable-content"},At={class:"mediainfo-pre"},Mt={class:"preview-row description-row"},Lt={class:"row-content description-content"},Pt={class:"description-section"},Dt=["innerHTML"],xt={key:0,class:"description-section"},Rt={class:"image-gallery"},Ut=["src","alt","onError"],Bt={class:"description-section"},Ot=["innerHTML"],jt={key:1,class:"description-section"},Ft={class:"image-gallery"},qt=["src","alt","onError"],Ht={key:2,class:"step-container site-selection-container"},Kt={class:"select-all-container",style:{"margin-top":"16px"}},Wt={class:"site-buttons-group"},Yt={key:3,class:"step-container results-container"},Gt={key:0,class:"progress-section"},Jt={key:0,class:"progress-item"},Qt={class:"progress-text"},Xt={key:1,class:"progress-item"},Zt={class:"progress-text"},el={class:"results-rows-container"},sl={class:"row-sites"},al={class:"card-icon"},tl={class:"card-title"},ll={key:0,class:"existed-tag"},ol={key:1,class:"downloader-status"},nl={class:"status-icon"},il={class:"card-extra"},rl=["href"],dl={class:"row-action"},ul={class:"button-subtitle"},cl={class:"panel-footer"},ml={key:0,class:"button-group"},pl={key:0,class:"validation-hint"},vl={key:1,class:"button-group"},_l={key:0,class:"validation-hint"},fl={key:0,class:"validation-hint"},gl={key:2,class:"button-group"},bl={key:3,class:"button-group"},hl={class:"card-header"},yl={class:"log-content-pre"},wl=ls({__name:"CrossSeedPanel",props:{showCompleteButton:{type:Boolean,default:!1}},emits:["complete","cancel","close-with-refresh"],setup(Z,{emit:Ve}){const B=s=>{if(!s)return"";s=s.replace(/[ \t\f\v]+$/gm,""),s=s.replace(/^\s*\n+/,"").replace(/\n\s*$/,""),s=s.replace(/(\n\s*){2,}/g,`

`),s=s.replace(/([^\n]+。)\s*\n\s*\n(\s*\d+\.)/g,`$1
$2`),s=s.replace(/(\d+\.[\s\S]*?)\n\s*\n(\s*\d+\.)/g,`$1
$2`),s=s.replace(/(\[(?:b|color)[^\]]*\][\s\S]*?)\n\s*\n([\s\S]*?\[\/(?:b|color)\])/gi,`$1
$2`);for(let e=0;e<3;e++)s=s.replace(/(\[(?:quote|b|color|size)[^\]]*\][\s\S]*?)\n\s*\n([\s\S]*?\[\/(?:quote|b|color|size)\])/gi,`$1
$2`);return s=s.replace(/(\n\s*){2,}/g,`

`),s},re=s=>s?(s=B(s),s=s.replace(/\[quote\]([\s\S]*?)\[\/quote\]/gi,"<blockquote>$1</blockquote>"),s=s.replace(/\[b\]([\s\S]*?)\[\/b\]/gi,"<strong>$1</strong>"),s=s.replace(/\[color=(\w+|\#[0-9a-fA-F]{3,6})\]([\s\S]*?)\[\/color\]/gi,'<span style="color: $1;">$2</span>'),s=s.replace(/\[size=(\d+)\]([\s\S]*?)\[\/size\]/gi,(e,o,d)=>`<span style="font-size: ${{1:"12",2:"14",3:"16",4:"18",5:"24",6:"32",7:"48"}[o]||parseInt(o)*4}px;">${d}</span>`),s=s.replace(/\n/g,"<br>"),s):"",W=Z,q=Ve,Y=Hs(),y=U(()=>Y.workingParams),R=U(()=>Y.sourceInfo?.name||""),de=()=>({title_components:[],original_main_title:"",subtitle:"",imdb_link:"",douban_link:"",intro:{statement:"",poster:"",body:"",screenshots:"",removed_ardtudeclarations:[]},mediainfo:"",source_params:{},standardized_params:{type:"",medium:"",video_codec:"",audio_codec:"",resolution:"",team:"",source:"",tags:[]},final_publish_parameters:{},complete_publish_params:{},raw_params_for_preview:{}}),se=s=>{if(!s||typeof s!="string")return[];const e=/\[img\](https?:\/\/[^\s[\]]+)\[\/img\]/gi;return[...s.matchAll(e)].map(d=>d[1])},I=S(0),k=S("main"),$=S(!1),M=S({current:0,total:0}),j=S({current:0,total:0}),F=((s,e)=>{let o;return function(...l){const i=()=>{clearTimeout(o),s(...l)};clearTimeout(o),o=setTimeout(i,e)}})(()=>{const s=document.querySelector(".panel-content");if(s){const{scrollTop:e,scrollHeight:o,clientHeight:d}=s;$.value=e+d>=o-5}},100),ve=()=>{const s=document.querySelector(".panel-content");s&&s.addEventListener("scroll",F)},is=()=>{const s=document.querySelector(".panel-content");s&&s.removeEventListener("scroll",F)};os(()=>{vs(),_s(),pe(()=>{I.value===1&&(ve(),F())})}),Be(I,(s,e)=>{e===1&&is(),s===1&&pe(()=>{ve(),F()})});const Te=[{title:"核对种子详情"},{title:"发布参数预览"},{title:"选择发布站点"},{title:"完成发布"}],te=S([]),G=S([]),O=S(!1),a=S(de()),J=S(null),oe=S([]),Ee=S(!1),_e=S(!1),Ne=S(!1),fe=S(!1),ge=S(!1),Ae=S(!1),ee=S(!0),le=S(""),be=S(!1),Oe=S([]),ue=S(!1),he=S(!1),je=S(""),E=S({type:{},medium:{},video_codec:{},audio_codec:{},resolution:{},source:{},team:{},tags:{}}),ye=U(()=>se(a.value.intro.poster)),ce=U(()=>se(a.value.intro.screenshots)),Fe=U(()=>{const s=a.value.intro.removed_ardtudeclarations;return Array.isArray(s)?s:[]}),qe=U(()=>Fe.value.length),Me=s=>{const e=te.value.find(o=>o.name===s);if(!e||!e.has_cookie||y.value?.sites?.[s])return!1;if(s.toLowerCase()==="ubits"){const o=a.value.standardized_params.team,d=a.value.title_components;if(o&&["cmct","cmctv"].includes(o.toLowerCase()))return!1;const l=d.find(i=>i.key==="制作组");if(l&&l.value){const i=l.value.toLowerCase(),p=["cmct","cmctv","telesto","shadow610"];for(const b of p)if(i.includes(b))return!1}}return!0},rs=s=>G.value.includes(s.name)?"success":s.has_cookie?"default":"danger",ds=async()=>{Ne.value=!0,m.info({title:"正在重新获取",message:"正在从豆瓣/IMDb重新获取简介...",duration:0});const s={type:"intro",source_info:{main_title:a.value.original_main_title,subtitle:a.value.subtitle,source_site:R.value,imdb_link:a.value.imdb_link,douban_link:a.value.douban_link}};try{const e=await D.post("/api/media/validate",s);m.closeAll(),e.data.success&&e.data.intro?(a.value.intro.body=B(e.data.intro),e.data.extracted_imdb_link&&!a.value.imdb_link&&(a.value.imdb_link=e.data.extracted_imdb_link),e.data.extracted_douban_link&&!a.value.douban_link&&(a.value.douban_link=e.data.extracted_douban_link),m.success({title:"重新获取成功",message:"已成功从豆瓣/IMDb获取并更新了简介内容。"})):m.error({title:"重新获取失败",message:e.data.error||"无法从豆瓣/IMDb获取简介。"})}catch(e){m.closeAll();const o=e.response?.data?.error||"未能重新获取简介";m.error({title:"操作失败",message:o})}finally{Ne.value=!1}},us=async()=>{if(!a.value.original_main_title){m.warning("标题为空，无法重新获取截图。");return}if(_e.value){m.info({title:"正在处理中",message:"截图重新生成请求已在处理中，请稍候..."});return}_e.value=!0,m.info({title:"正在重新获取",message:"正在从视频重新生成截图...",duration:0});const s={type:"screenshot",source_info:{main_title:a.value.original_main_title,source_site:R.value,imdb_link:a.value.imdb_link,douban_link:a.value.douban_link},savePath:y.value.save_path,torrentName:y.value.name,downloaderId:y.value.downloaderId};try{const e=await D.post("/api/media/validate",s);m.closeAll(),e.data.success&&e.data.screenshots?(a.value.intro.screenshots=e.data.screenshots,ee.value=!0,m.success({title:"重新获取成功",message:"已成功生成并加载了新的截图。"})):(ee.value=!1,m.error({title:"重新获取失败",message:e.data.error||"无法从后端获取新的截图，请查看后台日志。"}))}catch(e){m.closeAll();const o=e.response?.data?.error||"未能重新获取截图，请查看后台日志。";m.error({title:"操作失败",message:o}),ee.value=!1}finally{_e.value=!1}},cs=async()=>{if(fe.value){m.info({title:"正在处理中",message:"媒体信息重新获取请求已在处理中，请稍候..."});return}fe.value=!0,m.info({title:"正在重新获取",message:"正在从视频重新生成媒体信息...",duration:0});const s={type:"mediainfo",source_info:{main_title:a.value.original_main_title,source_site:R.value,imdb_link:a.value.imdb_link,douban_link:a.value.douban_link},current_mediainfo:a.value.mediainfo,savePath:y.value.save_path,torrentName:y.value.name,downloaderId:y.value.downloaderId};try{const e=await D.post("/api/media/validate",s);m.closeAll(),e.data.success&&e.data.mediainfo?(a.value.mediainfo=e.data.mediainfo,m.success({title:"重新获取成功",message:"已成功生成并加载了新的媒体信息。"})):m.error({title:"重新获取失败",message:e.data.error||"无法从后端获取新的媒体信息，请查看后台日志。"})}catch(e){m.closeAll();const o=e.response?.data?.error||"未能重新获取媒体信息，请查看后台日志。";m.error({title:"操作失败",message:o})}finally{fe.value=!1}},ms=async()=>{if(!a.value.original_main_title){m.warning("标题为空，无法重新获取海报。");return}if(ge.value){m.info({title:"正在处理中",message:"海报重新获取请求已在处理中，请稍候..."});return}ge.value=!0,m.info({title:"正在重新获取",message:"正在重新生成海报...",duration:0});const s={type:"poster",source_info:{main_title:a.value.original_main_title,source_site:R.value,imdb_link:a.value.imdb_link,douban_link:a.value.douban_link},savePath:y.value.save_path,torrentName:y.value.name,downloaderId:y.value.downloaderId};try{const e=await D.post("/api/media/validate",s);m.closeAll(),e.data.success&&e.data.posters?(a.value.intro.poster=e.data.posters,m.success({title:"重新获取成功",message:"已成功生成并加载了新的海报。"})):m.error({title:"重新获取失败",message:e.data.error||"无法从后端获取新的海报，请查看后台日志。"})}catch(e){m.closeAll();const o=e.response?.data?.error||"未能重新获取海报，请查看后台日志。";m.error({title:"操作失败",message:o})}finally{ge.value=!1}},ps=async()=>{if(!a.value.original_main_title){m.warning("标题为空，无法解析。");return}Ee.value=!0;try{const s=await D.post("/api/utils/parse_title",{title:a.value.original_main_title});s.data.success?(a.value.title_components=s.data.components,m.success("标题已重新解析！")):m.error(s.data.message||"解析失败")}catch(s){ke(s,"未能重新解析标题，请查看后台日志。")}finally{Ee.value=!1}},we=async(s,e,o)=>{if(s&&s.includes("pixhost.to")){console.log(`检测到 pixhost.to 图片，跳过有效性检测: ${s}`);return}if(e==="screenshot"&&Ae.value){console.log(`截图错误已正在处理中，跳过重复请求: ${s}`);return}console.error(`图片加载失败: 类型=${e}, URL=${s}, 索引=${o}`),e==="screenshot"?(Ae.value=!0,ee.value=!1,m.warning({title:"截图失效",message:"检测到截图链接失效，正在尝试从视频重新生成..."})):e==="poster"&&m.warning({title:"海报失效",message:"检测到海报链接失效，正在尝试重新获取..."});const d={type:e,source_info:{main_title:a.value.original_main_title,source_site:R.value,imdb_link:a.value.imdb_link,douban_link:a.value.douban_link},savePath:y.value.save_path,torrentName:y.value.name,downloaderId:y.value.downloaderId};try{const l=await D.post("/api/media/validate",d);l.data.success?e==="screenshot"&&l.data.screenshots?(a.value.intro.screenshots=l.data.screenshots,ee.value=!0,m.success({title:"截图已更新",message:"已成功生成并加载了新的截图。"})):e==="poster"&&l.data.posters&&(a.value.intro.poster=l.data.posters,m.success({title:"海报已更新",message:"已成功生成并加载了新的海报。"})):(e==="screenshot"&&(ee.value=!1),m.error({title:"更新失败",message:l.data.error||`无法从后端获取新的${e==="poster"?"海报":"截图"}。`}))}catch(l){const i=l.response?.data?.error||`发送失效${e==="poster"?"海报":"截图"}信息请求时发生错误，请查看后台日志。`;console.error("发送失效图片信息请求时发生错误:",l),m.error({title:"操作失败",message:i})}finally{e==="screenshot"&&(Ae.value=!1)}},Le=async s=>{const e=te.value.find(d=>d.name===s);if(e?.site)return e.site;try{const d=await D.get("/api/sites/status");te.value=d.data;const l=te.value.find(i=>i.name===s);if(l?.site)return l.site}catch(d){console.warn("获取站点状态失败:",d)}return{人人:"audiences",不可说:"ssd",憨憨:"hhanclub",财神:"cspt"}[s]||s.toLowerCase()},vs=async()=>{try{const s=await D.get("/api/sites/status");te.value=s.data;const e=await D.get("/api/downloaders_list");Oe.value=e.data}catch{m.error({title:"错误",message:"无法从服务器获取站点状态列表或下载器列表"})}},_s=async()=>{if(!R.value||!y.value)return;const s=y.value.sites[R.value];let e=s.torrentId||null;if(!e){const l=s.comment?.match(/id=(\d+)/);if(!l||!l[1]){m.error(`无法从源站点 ${R.value} 的链接中提取种子ID。`),q("cancel");return}e=l[1]}O.value=!0;const o=`fetch_${e}_${Date.now()}`;je.value=o,he.value=!0;let d=null;try{const l=await Le(R.value);console.log(`尝试从数据库读取种子信息: ${e} from ${R.value} (${l})`);const i=await D.get("/api/migrate/get_db_seed_info",{params:{torrent_id:e,site_name:l,task_id:o},timeout:12e4});if(i.status===202&&i.data.should_fetch){console.log("数据库中没有缓存，继续使用同一日志流从源站点抓取...");const p=i.data.task_id||o;try{const b=await D.post("/api/migrate/fetch_and_store",{sourceSite:R.value,searchTerm:e,savePath:y.value.save_path,torrentName:y.value.name,downloaderId:y.value.downloaderId,task_id:p},{timeout:12e4});if(!b.data.success){m.closeAll(),m.error({title:"抓取失败",message:b.data.message||"从源站点抓取失败",duration:0,showClose:!0}),q("cancel"),O.value=!1;return}const g=await D.get("/api/migrate/get_db_seed_info",{params:{torrent_id:e,site_name:l},timeout:12e4});if(!g.data.success){m.closeAll(),m.error({title:"读取失败",message:"数据抓取成功但从数据库读取失败",duration:0,showClose:!0}),q("cancel"),O.value=!1;return}m.closeAll(),m.success({title:"抓取成功",message:"种子信息已成功抓取并存储到数据库，请核对。"});const f=g.data.data;g.data.reverse_mappings&&(E.value=g.data.reverse_mappings),a.value={original_main_title:f.title||"",title_components:f.title_components||[],subtitle:f.subtitle,imdb_link:f.imdb_link,douban_link:f.douban_link,intro:{statement:B(f.statement)||"",poster:f.poster||"",body:B(f.body)||"",screenshots:f.screenshots||"",removed_ardtudeclarations:f.removed_ardtudeclarations||[]},mediainfo:f.mediainfo||"",source_params:f.source_params||{},standardized_params:{type:f.type||"",medium:f.medium||"",video_codec:f.video_codec||"",audio_codec:f.audio_codec||"",resolution:f.resolution||"",team:f.team||"",source:f.source||"",tags:f.tags||[]},final_publish_parameters:f.final_publish_parameters||{},complete_publish_params:f.complete_publish_params||{},raw_params_for_preview:f.raw_params_for_preview||{}},J.value=b.data.task_id,ue.value=!0,I.value=0,pe(()=>{xe()}),O.value=!1;return}catch(b){m.closeAll(),ke(b,"从源站点抓取时发生错误，请查看后台日志。"),q("cancel"),O.value=!1;return}}else if(i.data.success){m.closeAll(),m.success({title:"读取成功",message:"种子信息已从数据库成功加载，请核对。"});const p=i.data.data;if(!p||!p.title)throw new Error("数据库返回的种子信息不完整");if(i.data.reverse_mappings?(E.value=i.data.reverse_mappings,console.log("成功加载反向映射表:",E.value),console.log("type映射数量:",Object.keys(E.value.type||{}).length),console.log("当前standardized_params:",p.standardized_params)):console.warn("后端未返回反向映射表，将使用空的默认映射"),a.value={original_main_title:p.title||"",title_components:p.title_components||[],subtitle:p.subtitle,imdb_link:p.imdb_link,douban_link:p.douban_link,intro:{statement:B(p.statement)||"",poster:p.poster||"",body:B(p.body)||"",screenshots:p.screenshots||"",removed_ardtudeclarations:p.removed_ardtudeclarations||[]},mediainfo:p.mediainfo||"",source_params:p.source_params||{},standardized_params:{type:p.type||"",medium:p.medium||"",video_codec:p.video_codec||"",audio_codec:p.audio_codec||"",resolution:p.resolution||"",team:p.team||"",source:p.source||"",tags:p.tags||[]},final_publish_parameters:p.final_publish_parameters||{},complete_publish_params:p.complete_publish_params||{},raw_params_for_preview:p.raw_params_for_preview||{}},(!p.title_components||p.title_components.length===0)&&p.title)try{const b=await D.post("/api/utils/parse_title",{title:p.title});b.data.success&&(a.value.title_components=b.data.components,m.info({title:"标题解析",message:"已自动解析主标题为组件信息。"}))}catch(b){console.warn("自动解析标题失败:",b)}if(console.log("设置torrentData.standardized_params:",a.value.standardized_params),console.log("检查绑定 - type:",a.value.standardized_params.type),console.log("检查绑定 - medium:",a.value.standardized_params.medium),i.data.task_id?(J.value=i.data.task_id,m.success({title:"缓存准备完成",message:"发布任务已准备就绪"})):(J.value=`db_${e}_${l}`,console.warn("后端未返回taskId，使用标识符")),ue.value=!0,(!a.value.imdb_link||!a.value.douban_link)&&a.value.intro.body){let b=!1,g=!1;if(!a.value.imdb_link){const f=/(https?:\/\/www\.imdb\.com\/title\/tt\d+)/,P=a.value.intro.body.match(f);P&&P[1]&&(a.value.imdb_link=P[1],b=!0)}if(!a.value.douban_link){const f=/(https:\/\/movie\.douban\.com\/subject\/\d+)/,P=a.value.intro.body.match(f);P&&P[1]&&(a.value.douban_link=P[1],g=!0)}if(b||g){const f=[];b&&f.push("IMDb链接"),g&&f.push("豆瓣链接"),m.info({title:"自动填充",message:`已从简介正文中自动提取并填充 ${f.join(" 和 ")}。`})}}I.value=0,pe(()=>{xe()}),ue.value=!0,O.value=!1;return}else console.log("数据库中没有找到种子信息，开始抓取数据...")}catch(l){d=l,console.log("从数据库读取失败，开始抓取数据...",l),l.code==="ECONNABORTED"||l.message.includes("timeout")?console.warn("数据库读取超时，将尝试直接抓取数据..."):l.response?.status>=500?console.warn("数据库服务器错误，将尝试直接抓取数据..."):console.warn("数据库读取发生未知错误，将尝试直接抓取数据...")}try{m.closeAll(),m({title:"正在抓取",message:"正在从源站点抓取种子信息并存储到数据库...",type:"info",duration:0}),d&&(console.warn(`由于数据库读取失败（${d.message}），正在直接抓取数据...`),m.warning({title:"数据库读取失败",message:"正在尝试直接抓取数据，请稍候...",duration:3e3}));const l=await D.post("/api/migrate/fetch_and_store",{sourceSite:R.value,searchTerm:e,savePath:y.value.save_path,torrentName:y.value.name,downloaderId:y.value.downloaderId||(y.value.downloaderIds?.length>0?y.value.downloaderIds[0]:null)},{timeout:12e4});if(l.data.success){console.log("数据抓取成功，立即从数据库读取...");let i=0;const p=3;let b=null;for(;i<p;){i++;try{const g=await Le(R.value);if(console.log(`重试从数据库读取种子信息: ${e} from ${R.value} (${g})`),b=await D.get("/api/migrate/get_db_seed_info",{params:{torrent_id:e,site_name:g},timeout:12e4}),b.data.success)break;console.warn(`数据库读取第${i}次失败：${b.data.message}`),i<p&&await new Promise(f=>setTimeout(f,1e3))}catch(g){if(console.warn(`数据库读取第${i}次失败：`,g),i<p)await new Promise(f=>setTimeout(f,1e3));else throw g}}if(b&&b.data.success){m.closeAll();const g=b.data.data;if(!g||!g.title)throw new Error("数据库返回的种子信息不完整");if(b.data.reverse_mappings?(E.value=b.data.reverse_mappings,console.log("成功加载反向映射表:",E.value)):console.warn("后端未返回反向映射表，将使用空的默认映射"),m.success({title:"抓取成功",message:d?"种子信息已成功抓取，请核对。由于数据库读取失败，数据未持久化存储。":"种子信息已成功抓取并存储到数据库，请核对。"}),a.value={original_main_title:g.title||"",title_components:g.title_components||[],subtitle:g.subtitle,imdb_link:g.imdb_link,douban_link:g.douban_link,intro:{statement:B(g.statement)||"",poster:g.poster||"",body:B(g.body)||"",screenshots:g.screenshots||"",removed_ardtudeclarations:g.removed_ardtudeclarations||[]},mediainfo:g.mediainfo||"",source_params:g.source_params||{},standardized_params:{type:g.type||"",medium:g.medium||"",video_codec:g.video_codec||"",audio_codec:g.audio_codec||"",resolution:g.resolution||"",team:g.team||"",source:g.source||"",tags:g.tags||[]},final_publish_parameters:g.final_publish_parameters||{},complete_publish_params:g.complete_publish_params||{},raw_params_for_preview:g.raw_params_for_preview||{}},(!g.title_components||g.title_components.length===0)&&g.title)try{const f=await D.post("/api/utils/parse_title",{title:g.title});f.data.success&&(a.value.title_components=f.data.components,m.info({title:"标题解析",message:"已自动解析主标题为组件信息。"}))}catch(f){console.warn("自动解析标题失败:",f)}if(J.value=l.data.task_id,ue.value=!0,(!a.value.imdb_link||!a.value.douban_link)&&a.value.intro.body){let f=!1,P=!1;if(!a.value.imdb_link){const X=/(https?:\/\/www\.imdb\.com\/title\/tt\d+)/,K=a.value.intro.body.match(X);K&&K[1]&&(a.value.imdb_link=K[1],f=!0)}if(!a.value.douban_link){const X=/(https:\/\/movie\.douban\.com\/subject\/\d+)/,K=a.value.intro.body.match(X);K&&K[1]&&(a.value.douban_link=K[1],P=!0)}if(f||P){const X=[];f&&X.push("IMDb链接"),P&&X.push("豆瓣链接"),m.info({title:"自动填充",message:`已从简介正文中自动提取并填充 ${X.join(" 和 ")}。`})}}I.value=0,pe(()=>{xe()})}else m.closeAll(),m.error({title:"读取失败",message:`数据抓取成功但数据库读取失败，已重试${p}次。请检查数据库连接或稍后重试。`,duration:0,showClose:!0}),q("cancel")}else{m.closeAll();const i=l.data.message||"抓取种子信息失败";i.includes("数据库")||d?m.error({title:"抓取失败",message:`${i}。可能由于数据库连接问题导致，请检查数据库状态。`,duration:0,showClose:!0}):m.error({title:"抓取失败",message:i,duration:0,showClose:!0}),q("cancel")}}catch(l){m.closeAll(),l.code==="ECONNABORTED"||l.message.includes("timeout")?m.error({title:"请求超时",message:"抓取种子信息超时，请检查网络连接或稍后重试。",duration:0,showClose:!0}):l.response?.status===404?m.error({title:"资源未找到",message:"在源站点未找到指定的种子，请检查种子ID是否正确。",duration:0,showClose:!0}):l.response?.status>=500?m.error({title:"服务器错误",message:"后端服务器发生错误，请稍后重试或联系管理员。",duration:0,showClose:!0}):ke(l,"获取种子信息时发生错误，请查看后台日志。"),q("cancel")}finally{O.value=!1}},Q=U(()=>{const s=a.value.standardized_params,e=["type","medium","video_codec","audio_codec","resolution","team","source"],o=[],d=new RegExp(/^[\p{L}\p{N}_-]+\.[\p{L}\p{N}_-]+$/u);for(const l of e){const i=s[l];i&&typeof i=="string"&&i.trim()!==""&&!d.test(i)&&o.push(l)}return Se.value.length>0&&o.push("tags"),o}),fs=async()=>{if(console.log("=== 从store获取的已存在站点信息 ==="),console.log("torrent.value:",y.value),console.log("torrent.value.sites:",y.value?.sites),y.value?.sites){const e=Object.keys(y.value.sites);console.log("已存在的站点列表:",e),console.log("已存在站点详细信息:",y.value.sites)}else console.log("未找到已存在站点信息");console.log("=====================================");const s=Q.value;if(s.length>0){const e={type:"类型",medium:"媒介",video_codec:"视频编码",audio_codec:"音频编码",resolution:"分辨率",team:"制作组",source:"产地",tags:"标签"},o=s.map(d=>e[d]||d);m({title:"参数格式不正确",message:`以下参数格式不正确，请修改为 *.* 的标准格式: ${o.join(", ")}`,type:"warning",duration:0,showClose:!0});return}O.value=!0;try{m({title:"正在处理",message:"正在更新参数并生成预览...",type:"info",duration:0});let e,o;if(ue.value&&J.value&&J.value.startsWith("db_")){const i=J.value.split("_");i.length>=3&&(e=i[1],o=i.slice(2).join("_"))}else if(J.value&&J.value.startsWith("db_")){const i=J.value.split("_");i.length>=3&&(e=i[1],o=i.slice(2).join("_"))}else{const i=y.value.sites[R.value];if(e=i.torrentId||null,o=await Le(R.value),!e){const p=i.comment?.match(/id=(\d+)/);p&&p[1]&&(e=p[1])}}if(!e||!o){m.error({title:"参数错误",message:"无法获取种子ID或站点名称",duration:0,showClose:!0});return}console.log(`更新种子参数: ${e} from ${o}`);const d={title:a.value.original_main_title,subtitle:a.value.subtitle,imdb_link:a.value.imdb_link,douban_link:a.value.douban_link,poster:a.value.intro.poster,screenshots:a.value.intro.screenshots,statement:B(a.value.intro.statement),body:B(a.value.intro.body),mediainfo:a.value.mediainfo,source_params:a.value.source_params,title_components:a.value.title_components,standardized_params:a.value.standardized_params};console.log("发送到后端的标准参数:",a.value.standardized_params);const l=await D.post("/api/migrate/update_db_seed_info",{torrent_id:e,site_name:o,updated_parameters:d});if(console.log("已调用更新接口，is_reviewed 将被设置为 true"),m.closeAll(),l.data.success){m.closeAll();const{standardized_params:i,final_publish_parameters:p,complete_publish_params:b,raw_params_for_preview:g,reverse_mappings:f}=l.data;f&&(E.value=f,console.log("成功更新反向映射表:",E.value)),a.value={...a.value,standardized_params:i||{},final_publish_parameters:p||{},complete_publish_params:b||{},raw_params_for_preview:g||{}},m.success({title:"更新成功",message:"参数已更新并重新标准化，请核对预览内容。"}),I.value=1}else m.error({title:"更新失败",message:l.data.message||"更新参数失败",duration:0,showClose:!0})}catch(e){m.closeAll(),ke(e,"更新预览数据时发生错误，请查看后台日志。")}finally{O.value=!1}},gs=U(()=>{const s=Object.keys(E.value.tags||{}),e=a.value.standardized_params.tags||[];return[...new Set([...s,...e])].filter(l=>!Ce(l)).map(l=>({value:l,label:E.value.tags[l]||l}))}),bs=s=>s==="禁转"||s==="tag.禁转"?"danger":(console.log(`[getTagType] 检查标签: "${s}", 是否无效: ${Se.value.includes(s)}`),Se.value.includes(s)?"danger":"info"),hs=async()=>{const s=y.value?.sites?Object.keys(y.value.sites).length:0;if(s<2){console.log(`已存在站点数量不足(${s}个)，正在重新获取种子数据...`);try{m.info({title:"正在更新数据",message:"正在重新获取种子站点信息...",duration:0});const e=new URLSearchParams({page:"1",pageSize:"1",nameSearch:y.value.name}),d=(await D.get(`/api/data?${e.toString()}`)).data;if(d.error)throw new Error(d.error);if(d.data&&d.data.length>0){const l=d.data[0];console.log("重新获取到的种子数据:",l),console.log("重新获取到的站点信息:",l.sites),console.log(`站点数量从 ${s} 更新到 ${Object.keys(l.sites).length}`),Y.setParams(l),m.success({title:"数据更新成功",message:`已重新获取种子站点信息，发现 ${Object.keys(l.sites).length} 个站点`})}else m.warning({title:"未找到种子",message:"未能找到匹配的种子数据"})}catch(e){console.error("重新获取种子数据时出错:",e),m.error({title:"数据更新失败",message:e.message||"重新获取种子数据时发生错误"})}}else console.log(`已存在站点数量充足(${s}个)，跳过重新获取`);I.value=2},ys=s=>{const e=G.value.indexOf(s);e>-1?G.value.splice(e,1):G.value.push(s)},ws=()=>{const s=te.value.filter(e=>e.is_target&&Me(e.name)).map(e=>e.name);G.value=s},ks=()=>{G.value=[]},Ss=async()=>{I.value=3,O.value=!0,oe.value=[],M.value={current:0,total:G.value.length},j.value={current:0,total:0},m({title:"正在发布",message:`准备向 ${G.value.length} 个站点发布种子...`,type:"info",duration:0});const s=[];for(const l of G.value){try{const i=await D.post("/api/migrate/publish",{task_id:J.value,upload_data:{...a.value,save_path:y.value.save_path},targetSite:l,sourceSite:R.value,downloaderId:y.value.downloaderId,auto_add_to_downloader:!0}),p={siteName:l,message:Is(i.data.logs||"发布成功"),...i.data};if(i.data.logs&&i.data.logs.includes("种子已存在")&&(p.isExisted=!0),p.auto_add_result){let b="自动检测";if(p.auto_add_result.downloader_id){const g=Oe.value.find(f=>f.id===p.auto_add_result.downloader_id);g&&(b=g.name)}p.downloaderStatus={success:p.auto_add_result.success,message:p.auto_add_result.message,downloaderName:b},p.auto_add_result.success&&j.value.current++}s.push(p),oe.value=[...s],p.success&&m.success({title:`发布成功 - ${l}`,message:"种子已成功发布到该站点"})}catch(i){const p={siteName:l,success:!1,logs:i.response?.data?.logs||i.message,url:null,message:`发布到 ${l} 时发生错误，请查看日志。`,downloaderStatus:{success:!1,message:"发布失败，无法添加到下载器",downloaderName:"错误"}};s.push(p),oe.value=[...s],m.error({title:`发布失败 - ${l}`,message:p.message})}M.value.current++,await new Promise(i=>setTimeout(i,1e3))}m.closeAll();const e=s.filter(l=>l.success).length;m.success({title:"发布完成",message:`成功发布到 ${e} / ${G.value.length} 个站点。`}),le.value+=`

--- [自动添加任务结果] ---`;const o={};s.forEach(l=>{if(l.auto_add_result){const i=l.downloaderStatus?.downloaderName||"自动检测";o[l.siteName]={success:l.auto_add_result.success,message:l.auto_add_result.message,downloaderName:i};const p=l.auto_add_result.success?"✅":"❌",b=l.auto_add_result.success?"成功":"失败";le.value+=`
[${l.siteName}] ${p} ${b}: ${l.auto_add_result.message}`}else l.success&&l.url&&(le.value+=`
[${l.siteName}] ⚠️  未执行自动添加`)}),le.value+=`
--- [自动添加任务结束] ---`;const d=s.map(l=>{let i=`--- Log for ${l.siteName} ---
${l.logs||"No logs available."}`;if(o[l.siteName]){const p=o[l.siteName];i+=`

--- Downloader Status for ${l.siteName} ---`,p.success?i+=`
✅ 成功: ${p.message}`:i+=`
❌ 失败: ${p.message}`}return i});le.value=d.join(`

`),oe.value=s.map(l=>({...l,downloaderStatus:o[l.siteName]}));try{await D.post("/api/refresh_data"),m.success({title:"数据刷新",message:"种子数据已刷新"})}catch(l){console.warn("刷新种子数据失败:",l)}O.value=!1},Cs=()=>{I.value>0&&I.value--},He=()=>{I.value===3?q("close-with-refresh"):q("cancel")},Ke=()=>{q("complete")},Is=s=>s==="发布成功"?"发布成功":s.includes("种子已存在")?"种子已存在，发布成功":s.split(`
`).filter(d=>d&&!d.includes("--- [步骤")&&!d.includes("INFO - ---")).map(d=>d.replace(/^\d{2}:\d{2}:\d{2} - \w+ - /,"")).filter(Boolean).pop()||"发布成功",ke=(s,e)=>{const o=s.response?.data?.logs||s.message||e;m.error({title:"操作失败",message:o,duration:0,showClose:!0})},H=s=>{const e=a.value.standardized_params;if(!e||!E.value)return"N/A";const o=e[s];if(!o)return"N/A";const d=E.value[s];return d&&d[o]||o},Pe=()=>!ne.value||!E.value.tags?[]:ne.value.map(s=>E.value.tags[s]||s),We=U(()=>a.value.title_components.filter(s=>s.key!=="无法识别")),ne=U(()=>a.value.standardized_params.tags?.filter(e=>e&&typeof e=="string"&&e.trim()!=="")||[]),Se=U(()=>{const s=new RegExp(/^[\p{L}\p{N}_-]+\.[\p{L}\p{N}_-]+$/u);return ne.value.filter(e=>!s.test(e))}),$s=U(()=>["主标题","季集","年份","剧集状态","发布版本","分辨率","片源平台","媒介","视频编码","视频格式","HDR格式","色深","帧率","音频编码","制作组"].map(e=>({key:e,value:""}))),Ce=s=>s==="禁转"||s==="tag.禁转",Ye=U(()=>(a.value.standardized_params.tags||[]).some(e=>Ce(e))),zs=s=>{if(Ce(s)){m.warning({title:"无法删除",message:"禁转标签不允许删除",duration:2e3});return}const e=a.value.standardized_params.tags.indexOf(s);e>-1&&a.value.standardized_params.tags.splice(e,1)},De=U({get(){const s=a.value.title_components.find(e=>e.key==="无法识别");return s?s.value:""},set(s){const e=a.value.title_components.findIndex(o=>o.key==="无法识别");s===""||s===null?e!==-1&&a.value.title_components.splice(e,1):e!==-1?a.value.title_components[e].value=s:a.value.title_components.push({key:"无法识别",value:s})}}),Vs=U(()=>{const s=a.value.standardized_params.team,e=a.value.title_components;if(s&&["cmct","cmctv"].includes(s.toLowerCase()))return!0;const o=e.find(d=>d.key==="制作组");if(o&&o.value){const d=o.value.toLowerCase(),l=["cmct","cmctv","telesto","shadow610"];for(const i of l)if(d.includes(i))return!0}return!1}),Ge=U(()=>{const s=a.value.title_components.find(me=>me.key==="无法识别"),e=s&&s.value!=="";if(Ye.value)return!0;const o=a.value.intro,d=!o.poster||o.poster.trim()==="",l=!o.screenshots||o.screenshots.trim()==="",i=!o.body||o.body.trim()==="";if(d||l||i)return!0;const p=a.value.standardized_params,b=!p.type||p.type.trim()==="",g=!p.medium||p.medium.trim()==="",f=!p.video_codec||p.video_codec.trim()==="",P=!p.audio_codec||p.audio_codec.trim()==="",X=!p.resolution||p.resolution.trim()==="";if(b||g||f||P||X)return!0;const K=a.value.mediainfo||"";if(!K||K.trim()==="")return!0;{const me=Je(K),Ie=Qe(K);if(!me&&!Ie)return!0}if(Q.value.length>0)return!0;const Re=!ee.value;return!!(e||Re)}),Ts=U(()=>{if(Ye.value)return"检测到禁转标签，不允许继续发布";const s=a.value.title_components.find(i=>i.key==="无法识别");if(s&&s.value!=="")return"存在无法识别的标题内容，请手动修正或删除";const e=a.value.standardized_params,o=a.value.intro,d=[];if((!o.poster||o.poster.trim()==="")&&d.push("海报"),(!o.screenshots||o.screenshots.trim()==="")&&d.push("截图"),(!o.body||o.body.trim()==="")&&d.push("简介正文"),(!a.value.mediainfo||a.value.mediainfo.trim()==="")&&d.push("Mediainfo"),(!e.type||e.type.trim()==="")&&d.push("类型"),(!e.medium||e.medium.trim()==="")&&d.push("媒介"),(!e.video_codec||e.video_codec.trim()==="")&&d.push("视频编码"),(!e.audio_codec||e.audio_codec.trim()==="")&&d.push("音频编码"),(!e.resolution||e.resolution.trim()==="")&&d.push("分辨率"),d.length>0)return`请补充必填项：${d.join("、")}`;if(Q.value.length>0){const i={type:"类型",medium:"媒介",video_codec:"视频编码",audio_codec:"音频编码",resolution:"分辨率",team:"制作组",source:"产地",tags:"标签"};return`参数格式不正确 (${Q.value.map(b=>i[b]||b).join("、")})`}const l=a.value.mediainfo||"";return!Je(l)&&!Qe(l)?"MediaInfo 或 BDInfo 格式无效":ee.value?"准备就绪":"截图链接失效，请等待重新获取或手动修复"}),Je=s=>["General","Video","Audio","Complete name","File size","Duration","Width","Height"].filter(d=>s.includes(d)).length>=3,Qe=s=>{const e=["DISC INFO","PLAYLIST REPORT"],o=["VIDEO:","AUDIO:","SUBTITLES:","FILES:","Disc Label","Disc Size","BDInfo:","Protection:","Codec","Bitrate","Language","Description"],d=e.filter(i=>s.includes(i)).length,l=o.filter(i=>s.includes(i)).length;return d===e.length||d>=1&&l>=2},xe=async()=>{const s=ce.value;if(s.length===0){ee.value=!0;return}let e=!0;for(const o of s)try{await new Promise((d,l)=>{const i=new Image;i.onload=()=>{d(!0)},i.onerror=()=>{l(new Error("Image load failed"))},i.src=o})}catch{e=!1;break}ee.value=e},Xe=()=>{be.value=!1},Es=(s,e)=>{let o=`--- Log for ${s} ---
${e||"No logs available."}`;const d=oe.value.find(l=>l.siteName===s);if(d&&d.downloaderStatus){const l=d.downloaderStatus;o+=`

--- Downloader Status for ${s} ---`,l.success?o+=`
✅ 成功: ${l.message}`:o+=`
❌ 失败: ${l.message}`}le.value=o,be.value=!0},Ns=U(()=>{const s=oe.value,e=[];for(let o=0;o<s.length;o+=5)e.push(s.slice(o,o+5));return e}),As=s=>s.some(e=>e.success&&e.url),Ms=s=>s.filter(e=>e.success&&e.url).length,Ls=s=>{const e=s.filter(o=>o.success&&o.url);if(e.length===0){m.warning({title:"无法打开",message:"该行没有可用的种子链接"});return}e.forEach(o=>{const d=Ze(o.url);window.open(d,"_blank","noopener,noreferrer")}),m.success({title:"批量打开成功",message:`已打开 ${e.length} 个种子页面`})},Ps=()=>{console.log("日志进度处理完成"),setTimeout(()=>{he.value=!1},1e3)},Ze=s=>{if(!s)return s;try{const e=new URL(s);return e.searchParams.delete("uploaded"),e.toString()}catch(e){return console.warn("Invalid URL format:",s,e),s}};return(s,e)=>{const o=x("el-icon"),d=x("el-button"),l=x("el-input"),i=x("el-form-item"),p=x("el-option"),b=x("el-select"),g=x("el-tag"),f=x("el-form"),P=x("el-tab-pane"),X=x("el-carousel-item"),K=x("el-carousel"),es=x("el-empty"),ss=x("el-tabs"),Re=x("el-alert"),me=x("el-button-group"),Ie=x("el-progress"),Ds=x("el-card");return c(),v(N,null,[t("div",aa,[t("header",ta,[t("div",la,[(c(),v(N,null,L(Te,(r,_)=>t("div",{key:_,class:T(["custom-step",{active:_===I.value,completed:_<I.value,last:_===Te.length-1}])},[t("div",oa,[_<I.value?(c(),z(o,{key:0},{default:u(()=>[n(A(Ue))]),_:1})):(c(),v("span",na,h(_+1),1))]),t("div",ia,h(r.title),1),_<Te.length-1?(c(),v("div",ra)):w("",!0)],2)),64))])]),t("main",da,[I.value===0?(c(),v("div",ua,[n(ss,{modelValue:k.value,"onUpdate:modelValue":e[18]||(e[18]=r=>k.value=r),type:"border-card",class:"details-tabs"},{default:u(()=>[n(P,{label:"主要信息",name:"main"},{default:u(()=>[t("div",ca,[t("div",ma,[n(f,{"label-position":"top",class:"fill-height-form"},{default:u(()=>[t("div",pa,[n(i,{label:"原始/待解析标题"},{default:u(()=>[n(l,{modelValue:a.value.original_main_title,"onUpdate:modelValue":e[0]||(e[0]=r=>a.value.original_main_title=r)},{append:u(()=>[n(d,{icon:A(ie),onClick:ps,loading:Ee.value},{default:u(()=>[...e[20]||(e[20]=[V(" 重新解析 ",-1)])]),_:1},8,["icon","loading"])]),_:1},8,["modelValue"])]),_:1}),t("div",va,[We.value.length>0?(c(!0),v(N,{key:0},L(We.value,r=>(c(),z(i,{key:r.key,label:r.key},{default:u(()=>[n(l,{modelValue:r.value,"onUpdate:modelValue":_=>r.value=_},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128)):(c(!0),v(N,{key:1},L($s.value,(r,_)=>(c(),z(i,{key:"init-"+_,label:r.key},{default:u(()=>[n(l,{modelValue:r.value,"onUpdate:modelValue":C=>r.value=C},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))])]),t("div",_a,[t("div",fa,[t("div",ga,[n(i,{label:"副标题"},{default:u(()=>[n(l,{modelValue:a.value.subtitle,"onUpdate:modelValue":e[1]||(e[1]=r=>a.value.subtitle=r)},null,8,["modelValue"])]),_:1})]),t("div",{class:T({"unrecognized-section":De.value}),style:{"grid-column":"span 1"}},[n(i,{label:"无法识别"},{default:u(()=>[n(l,{modelValue:De.value,"onUpdate:modelValue":e[2]||(e[2]=r=>De.value=r)},null,8,["modelValue"])]),_:1})],2)]),t("div",ba,[t("div",ha,[n(i,{label:"类型 (type)"},{default:u(()=>[n(b,{modelValue:a.value.standardized_params.type,"onUpdate:modelValue":e[3]||(e[3]=r=>a.value.standardized_params.type=r),placeholder:"请选择类型",clearable:"",class:T({"is-invalid":Q.value.includes("type"),"is-empty":!a.value.standardized_params.type}),"data-tag-style":""},{default:u(()=>[(c(!0),v(N,null,L(E.value.type,(r,_)=>(c(),z(p,{key:_,label:r,value:_},null,8,["label","value"]))),128))]),_:1},8,["modelValue","class"])]),_:1}),n(i,{label:"媒介 (medium)"},{default:u(()=>[n(b,{modelValue:a.value.standardized_params.medium,"onUpdate:modelValue":e[4]||(e[4]=r=>a.value.standardized_params.medium=r),placeholder:"请选择媒介",clearable:"",class:T({"is-invalid":Q.value.includes("medium"),"is-empty":!a.value.standardized_params.medium}),"data-tag-style":""},{default:u(()=>[(c(!0),v(N,null,L(E.value.medium,(r,_)=>(c(),z(p,{key:_,label:r,value:_},null,8,["label","value"]))),128))]),_:1},8,["modelValue","class"])]),_:1}),n(i,{label:"视频编码 (video_codec)"},{default:u(()=>[n(b,{modelValue:a.value.standardized_params.video_codec,"onUpdate:modelValue":e[5]||(e[5]=r=>a.value.standardized_params.video_codec=r),placeholder:"请选择视频编码",clearable:"",class:T({"is-invalid":Q.value.includes("video_codec"),"is-empty":!a.value.standardized_params.video_codec}),"data-tag-style":""},{default:u(()=>[(c(!0),v(N,null,L(E.value.video_codec,(r,_)=>(c(),z(p,{key:_,label:r,value:_},null,8,["label","value"]))),128))]),_:1},8,["modelValue","class"])]),_:1}),n(i,{label:"音频编码 (audio_codec)"},{default:u(()=>[n(b,{modelValue:a.value.standardized_params.audio_codec,"onUpdate:modelValue":e[6]||(e[6]=r=>a.value.standardized_params.audio_codec=r),placeholder:"请选择音频编码",clearable:"",class:T({"is-invalid":Q.value.includes("audio_codec"),"is-empty":!a.value.standardized_params.audio_codec}),"data-tag-style":""},{default:u(()=>[(c(!0),v(N,null,L(E.value.audio_codec,(r,_)=>(c(),z(p,{key:_,label:r,value:_},null,8,["label","value"]))),128))]),_:1},8,["modelValue","class"])]),_:1}),n(i,{label:"分辨率 (resolution)"},{default:u(()=>[n(b,{modelValue:a.value.standardized_params.resolution,"onUpdate:modelValue":e[7]||(e[7]=r=>a.value.standardized_params.resolution=r),placeholder:"请选择分辨率",clearable:"",class:T({"is-invalid":Q.value.includes("resolution"),"is-empty":!a.value.standardized_params.resolution}),"data-tag-style":""},{default:u(()=>[(c(!0),v(N,null,L(E.value.resolution,(r,_)=>(c(),z(p,{key:_,label:r,value:_},null,8,["label","value"]))),128))]),_:1},8,["modelValue","class"])]),_:1})]),t("div",ya,[n(i,{label:"制作组 (team)"},{default:u(()=>[n(b,{modelValue:a.value.standardized_params.team,"onUpdate:modelValue":e[8]||(e[8]=r=>a.value.standardized_params.team=r),placeholder:"请选择制作组",clearable:"",filterable:"","allow-create":"","default-first-option":"",class:T(["team-select",{"is-invalid":Q.value.includes("team")}])},{default:u(()=>[(c(!0),v(N,null,L(E.value.team,(r,_)=>(c(),z(p,{key:_,label:r,value:_},null,8,["label","value"]))),128))]),_:1},8,["modelValue","class"])]),_:1}),n(i,{label:"产地 (source)"},{default:u(()=>[n(b,{modelValue:a.value.standardized_params.source,"onUpdate:modelValue":e[9]||(e[9]=r=>a.value.standardized_params.source=r),placeholder:"请选择产地",clearable:"",class:T({"is-invalid":Q.value.includes("source")}),"data-tag-style":""},{default:u(()=>[(c(!0),v(N,null,L(E.value.source,(r,_)=>(c(),z(p,{key:_,label:r,value:_},null,8,["label","value"]))),128))]),_:1},8,["modelValue","class"])]),_:1}),n(i,{label:"标签 (tags)",class:"tags-wide-item"},{default:u(()=>[n(b,{modelValue:a.value.standardized_params.tags,"onUpdate:modelValue":e[10]||(e[10]=r=>a.value.standardized_params.tags=r),multiple:"",filterable:"","allow-create":"","default-first-option":"",placeholder:"请选择或输入标签",style:{width:"100%"}},{tag:u(({data:r})=>[(c(!0),v(N,null,L(r,_=>(c(),z(g,{key:_.value,type:bs(_.value),closable:!Ce(_.value),"disable-transitions":"",onClose:C=>zs(_.value),style:{margin:"2px"}},{default:u(()=>[t("span",null,h(E.value.tags[_.value]||_.currentLabel),1)]),_:2},1032,["type","closable","onClose"]))),128))]),default:u(()=>[(c(!0),v(N,null,L(gs.value,r=>(c(),z(p,{key:r.value,label:r.label,value:r.value},{default:u(()=>[t("span",{style:js({color:Se.value.includes(r.value)?"#F56C6C":""})},h(r.label),5)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e[21]||(e[21]=t("div",{class:"placeholder-item"},null,-1)),e[22]||(e[22]=t("div",{class:"placeholder-item"},null,-1))])])])]),_:1})])])]),_:1}),n(P,{label:"海报与声明",name:"poster-statement"},{default:u(()=>[t("div",wa,[n(f,{"label-position":"top",class:"fill-height-form"},{default:u(()=>[t("div",ka,[t("div",Sa,[n(i,{label:"声明",class:"statement-item"},{default:u(()=>[n(l,{type:"textarea",modelValue:a.value.intro.statement,"onUpdate:modelValue":e[11]||(e[11]=r=>a.value.intro.statement=r),rows:18},null,8,["modelValue"])]),_:1}),n(i,null,{label:u(()=>[t("div",Ca,[e[24]||(e[24]=t("span",null,"海报链接",-1)),n(d,{icon:A(ie),onClick:ms,loading:ge.value,size:"small",type:"text"},{default:u(()=>[...e[23]||(e[23]=[V(" 重新获取 ",-1)])]),_:1},8,["icon","loading"])])]),default:u(()=>[n(l,{type:"textarea",modelValue:a.value.intro.poster,"onUpdate:modelValue":e[12]||(e[12]=r=>a.value.intro.poster=r),rows:2},null,8,["modelValue"])]),_:1})]),t("div",Ia,[t("div",$a,[e[25]||(e[25]=t("div",{class:"preview-header"},"海报预览",-1)),t("div",za,[ye.value.length?(c(!0),v(N,{key:0},L(ye.value,(r,_)=>(c(),v("img",{key:"poster-"+_,src:r,alt:"海报预览",class:"preview-image",onError:C=>we(r,"poster",_)},null,40,Va))),128)):(c(),v("div",Ta,"暂无海报预览"))])])])])]),_:1})])]),_:1}),n(P,{label:"视频截图",name:"images"},{default:u(()=>[t("div",Ea,[t("div",Na,[n(f,{"label-position":"top",class:"fill-height-form"},{default:u(()=>[n(i,{class:"is-flexible"},{label:u(()=>[t("div",Aa,[e[27]||(e[27]=t("span",null,"截图",-1)),n(d,{icon:A(ie),onClick:us,loading:_e.value,size:"small",type:"text"},{default:u(()=>[...e[26]||(e[26]=[V(" 重新获取 ",-1)])]),_:1},8,["icon","loading"])])]),default:u(()=>[n(l,{type:"textarea",modelValue:a.value.intro.screenshots,"onUpdate:modelValue":e[13]||(e[13]=r=>a.value.intro.screenshots=r),rows:20},null,8,["modelValue"])]),_:1})]),_:1})]),t("div",Ma,[t("div",La,[ce.value.length?(c(),z(K,{key:0,interval:5e3,height:"500px","indicator-position":"outside"},{default:u(()=>[(c(!0),v(N,null,L(ce.value,(r,_)=>(c(),z(X,{key:"ss-"+_},{default:u(()=>[t("div",Pa,[t("img",{src:r,alt:"截图预览",class:"carousel-image",onError:C=>we(r,"screenshot",_)},null,40,Da)])]),_:2},1024))),128))]),_:1})):(c(),v("div",xa,"截图预览"))])])])]),_:1}),n(P,{label:"简介详情",name:"intro"},{default:u(()=>[n(f,{"label-position":"top",class:"fill-height-form"},{default:u(()=>[n(i,{class:"is-flexible"},{label:u(()=>[t("div",Ra,[e[29]||(e[29]=t("span",null,"正文",-1)),n(d,{icon:A(ie),onClick:ds,loading:Ne.value,size:"small",type:"text"},{default:u(()=>[...e[28]||(e[28]=[V(" 重新获取 ",-1)])]),_:1},8,["icon","loading"])])]),default:u(()=>[n(l,{type:"textarea",modelValue:a.value.intro.body,"onUpdate:modelValue":e[14]||(e[14]=r=>a.value.intro.body=r),rows:18},null,8,["modelValue"])]),_:1}),n(i,{label:"豆瓣链接"},{default:u(()=>[n(l,{modelValue:a.value.douban_link,"onUpdate:modelValue":e[15]||(e[15]=r=>a.value.douban_link=r),placeholder:"请输入豆瓣电影链接"},null,8,["modelValue"])]),_:1}),n(i,{label:"IMDb链接"},{default:u(()=>[n(l,{modelValue:a.value.imdb_link,"onUpdate:modelValue":e[16]||(e[16]=r=>a.value.imdb_link=r),placeholder:"请输入IMDb电影链接"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),n(P,{label:"媒体信息",name:"mediainfo"},{default:u(()=>[n(f,{"label-position":"top",class:"fill-height-form"},{default:u(()=>[n(i,{class:"is-flexible"},{label:u(()=>[t("div",Ua,[e[31]||(e[31]=t("span",null,"Mediainfo",-1)),n(d,{icon:A(ie),onClick:cs,loading:fe.value,size:"small",type:"text"},{default:u(()=>[...e[30]||(e[30]=[V(" 重新获取 ",-1)])]),_:1},8,["icon","loading"])])]),default:u(()=>[n(l,{type:"textarea",class:"code-font",modelValue:a.value.mediainfo,"onUpdate:modelValue":e[17]||(e[17]=r=>a.value.mediainfo=r),rows:26},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),n(P,{label:"已过滤声明",name:"filtered-declarations",class:"filtered-declarations-pane"},{default:u(()=>[t("div",Ba,[t("div",Oa,[e[32]||(e[32]=t("h3",null,"已自动过滤的声明内容",-1)),n(g,{type:"warning",size:"small"},{default:u(()=>[V("共 "+h(qe.value)+" 条",1)]),_:1})]),t("div",ja,[qe.value>0?(c(!0),v(N,{key:0},L(Fe.value,(r,_)=>(c(),v("div",{key:_,class:"declaration-item"},[t("div",Fa,[t("span",qa,"#"+h(_+1),1),n(g,{type:"danger",size:"small"},{default:u(()=>[...e[33]||(e[33]=[V("已过滤",-1)])]),_:1})]),t("pre",Ha,h(r),1)]))),128)):(c(),v("div",Ka,[n(es,{description:"未检测到需要过滤的 ARDTU 声明内容"})]))])])]),_:1})]),_:1},8,["modelValue"])])):w("",!0),I.value===1?(c(),v("div",Wa,[t("div",Ya,[t("div",Ga,[e[34]||(e[34]=t("div",{class:"row-label"},"主标题：",-1)),t("div",Ja,h(a.value.final_publish_parameters?.["主标题 (预览)"]||a.value.original_main_title||"暂无数据"),1)]),t("div",Qa,[e[35]||(e[35]=t("div",{class:"row-label"},"副标题：",-1)),t("div",Xa,h(a.value.subtitle||"暂无数据"),1)]),t("div",Za,[e[47]||(e[47]=t("div",{class:"row-label"},"参数信息：",-1)),t("div",et,[t("div",st,[t("div",at,[t("div",tt,[e[36]||(e[36]=t("span",{class:"param-label"},"IMDb链接：",-1)),t("span",{class:T(["param-value",{empty:!a.value.imdb_link||a.value.imdb_link==="N/A"}])},h(a.value.imdb_link||"N/A"),3)]),t("div",lt,[e[37]||(e[37]=t("span",{style:{"letter-spacing":"2.6px"},class:"param-label"},"豆瓣链接",-1)),e[38]||(e[38]=t("span",{style:{"font-size":"13px"}},"：",-1)),t("span",{class:T(["param-value",{empty:!a.value.douban_link||a.value.douban_link==="N/A"}])},h(a.value.douban_link||"N/A"),3)])]),t("div",ot,[e[39]||(e[39]=t("span",{class:"param-label"},"标签：",-1)),t("div",nt,[t("span",{class:T(["param-value",{empty:!Pe()||Pe().length===0}])},h(Pe().join(", ")||"N/A"),3),ne.value&&ne.value.length>0?(c(),v("span",it,h(ne.value.join(", ")),1)):w("",!0)])])]),t("div",rt,[t("div",dt,[e[40]||(e[40]=t("span",{class:"param-label"},"类型：",-1)),t("div",ut,[t("span",{class:T(["param-value",{empty:!H("type")}])},h(H("type")||"N/A"),3),a.value.standardized_params.type?(c(),v("span",ct,h(a.value.standardized_params.type),1)):w("",!0)])]),t("div",mt,[e[41]||(e[41]=t("span",{class:"param-label"},"媒介：",-1)),t("div",pt,[t("span",{class:T(["param-value",{empty:!H("medium")}])},h(H("medium")||"N/A"),3),a.value.standardized_params.medium?(c(),v("span",vt,h(a.value.standardized_params.medium),1)):w("",!0)])]),t("div",_t,[e[42]||(e[42]=t("span",{class:"param-label"},"视频编码：",-1)),t("div",ft,[t("span",{class:T(["param-value",{empty:!H("video_codec")}])},h(H("video_codec")||"N/A"),3),a.value.standardized_params.video_codec?(c(),v("span",gt,h(a.value.standardized_params.video_codec),1)):w("",!0)])]),t("div",bt,[e[43]||(e[43]=t("span",{class:"param-label"},"音频编码：",-1)),t("div",ht,[t("span",{class:T(["param-value",{empty:!H("audio_codec")}])},h(H("audio_codec")||"N/A"),3),a.value.standardized_params.audio_codec?(c(),v("span",yt,h(a.value.standardized_params.audio_codec),1)):w("",!0)])]),t("div",wt,[e[44]||(e[44]=t("span",{class:"param-label"},"分辨率：",-1)),t("div",kt,[t("span",{class:T(["param-value",{empty:!H("resolution")}])},h(H("resolution")||"N/A"),3),a.value.standardized_params.resolution?(c(),v("span",St,h(a.value.standardized_params.resolution),1)):w("",!0)])]),t("div",Ct,[e[45]||(e[45]=t("span",{class:"param-label"},"制作组：",-1)),t("div",It,[t("span",{class:T(["param-value",{empty:!H("team")}])},h(H("team")||"N/A"),3),a.value.standardized_params.team?(c(),v("span",$t,h(a.value.standardized_params.team),1)):w("",!0)])]),t("div",zt,[e[46]||(e[46]=t("span",{class:"param-label"},"产地/来源：",-1)),t("div",Vt,[t("span",{class:T(["param-value",{empty:!H("source")}])},h(H("source")||"N/A"),3),a.value.standardized_params.source?(c(),v("span",Tt,h(a.value.standardized_params.source),1)):w("",!0)])])])])]),t("div",Et,[e[48]||(e[48]=t("div",{class:"row-label"},"Mediainfo：",-1)),t("div",Nt,[t("pre",At,h(a.value.mediainfo||"暂无数据"),1)])]),t("div",Mt,[e[50]||(e[50]=t("div",{class:"row-label"},"简介内容：",-1)),t("div",Lt,[t("div",Pt,[t("div",{class:"section-content",innerHTML:re(a.value.intro?.statement)||"暂无声明"},null,8,Dt)]),ye.value.length>0?(c(),v("div",xt,[t("div",Rt,[(c(!0),v(N,null,L(ye.value,(r,_)=>(c(),v("img",{key:"poster-preview-"+_,src:r,alt:"海报 "+(_+1),class:"preview-image-inline",style:{width:"300px"},onError:C=>we(r,"poster",_)},null,40,Ut))),128))])])):w("",!0),t("div",Bt,[e[49]||(e[49]=t("br",null,null,-1)),t("div",{class:"section-content",innerHTML:re(a.value.intro?.body)||"暂无正文"},null,8,Ot)]),ce.value.length>0?(c(),v("div",jt,[t("div",Ft,[(c(!0),v(N,null,L(ce.value,(r,_)=>(c(),v("img",{key:"screenshot-preview-"+_,src:r,alt:"截图 "+(_+1),class:"preview-image-inline",onError:C=>we(r,"screenshot",_)},null,40,qt))),128))])])):w("",!0)])])])])):w("",!0),I.value===2?(c(),v("div",Ht,[e[55]||(e[55]=t("h3",{class:"selection-title"},"请选择要发布的目标站点",-1)),e[56]||(e[56]=t("p",{class:"selection-subtitle"},"已存在的站点已被自动禁用。红色站点表示未配置Cookie。",-1)),Vs.value?(c(),z(Re,{key:0,type:"error",closable:!1,style:{width:"410px",margin:"0 auto"}},{title:u(()=>[...e[51]||(e[51]=[t("span",{style:{"font-weight":"600"}},"禁止转载",-1)])]),default:u(()=>[e[52]||(e[52]=t("div",null,[V(" 检测到制作组包含禁止转载的内容，已自动禁用 UBits 站点。"),t("br"),V(" 禁止转载的制作组：CMCT、CMCTV ")],-1))]),_:1})):w("",!0),t("div",Kt,[n(me,null,{default:u(()=>[n(d,{type:"primary",onClick:ws},{default:u(()=>[...e[53]||(e[53]=[V("全选",-1)])]),_:1}),n(d,{type:"info",onClick:ks},{default:u(()=>[...e[54]||(e[54]=[V("清空",-1)])]),_:1})]),_:1})]),t("div",Wt,[(c(!0),v(N,null,L(te.value.filter(r=>r.is_target),r=>(c(),z(d,{key:r.name,class:"site-button",type:rs(r),plain:!r.has_cookie,disabled:!Me(r.name),onClick:_=>ys(r.name)},{default:u(()=>[V(h(r.name)+" ",1),r.name==="ubits"&&!Me(r.name)?(c(),z(A(Fs),{key:0,content:"该制作组禁止转载到 uBits 站点",placement:"top"},{default:u(()=>[n(o,{style:{"margin-left":"4px",color:"#f56c6c"}},{default:u(()=>[n(A(qs))]),_:1})]),_:1})):w("",!0)]),_:2},1032,["type","plain","disabled","onClick"]))),128))])])):w("",!0),I.value===3?(c(),v("div",Yt,[M.value.total>0||j.value.total>0?(c(),v("div",Gt,[M.value.total>0?(c(),v("div",Jt,[e[57]||(e[57]=t("div",{class:"progress-label"},"发布进度:",-1)),n(Ie,{percentage:Math.round(M.value.current/M.value.total*100),"show-text":!0},null,8,["percentage"]),t("div",Qt,h(M.value.current)+" / "+h(M.value.total),1)])):w("",!0),j.value.total>0?(c(),v("div",Xt,[e[58]||(e[58]=t("div",{class:"progress-label"},"下载器添加进度:",-1)),n(Ie,{percentage:Math.round(j.value.current/j.value.total*100),"show-text":!0},null,8,["percentage"]),t("div",Zt,h(j.value.current)+" / "+h(j.value.total),1)])):w("",!0)])):w("",!0),t("div",el,[(c(!0),v(N,null,L(Ns.value,(r,_)=>(c(),v("div",{key:_,class:"results-row"},[t("div",sl,[(c(!0),v(N,null,L(r,C=>(c(),v("div",{key:C.siteName,class:T(["result-card",{"is-success":C.success,"is-error":!C.success}])},[t("div",al,[C.success?(c(),z(o,{key:0,color:"#67C23A",size:32},{default:u(()=>[n(A(Ue))]),_:1})):(c(),z(o,{key:1,color:"#F56C6C",size:32},{default:u(()=>[n(A(ts))]),_:1}))]),t("h4",tl,h(C.siteName),1),C.isExisted?(c(),v("div",ll,[n(g,{type:"warning",size:"small"},{default:u(()=>[...e[59]||(e[59]=[V("已存在",-1)])]),_:1})])):w("",!0),C.downloaderStatus?(c(),v("div",ol,[t("div",nl,[C.downloaderStatus.success?(c(),z(o,{key:0,color:"#67C23A",size:16},{default:u(()=>[n(A(Ue))]),_:1})):(c(),z(o,{key:1,color:"#F56C6C",size:16},{default:u(()=>[n(A(ts))]),_:1}))]),t("span",{class:T(["status-text",{success:C.downloaderStatus.success,error:!C.downloaderStatus.success}])},h(C.downloaderStatus.success?`种子已添加到'${C.downloaderStatus.downloaderName}'`:"添加失败"),3)])):w("",!0),t("div",il,[n(d,{type:"primary",size:"small",onClick:kl=>Es(C.siteName,C.logs)},{default:u(()=>[...e[60]||(e[60]=[V(" 查看日志 ",-1)])]),_:1},8,["onClick"]),C.success&&C.url?(c(),v("a",{key:0,href:Ze(C.url),target:"_blank",rel:"noopener noreferrer",style:{transform:"translateY(-3px)"}},[n(d,{type:"success",size:"small"},{default:u(()=>[...e[61]||(e[61]=[V(" 查看种子 ",-1)])]),_:1})],8,rl)):w("",!0)])],2))),128))]),t("div",dl,[n(d,{type:"warning",icon:A(ie),size:"large",onClick:C=>Ls(r),disabled:!As(r),class:"open-all-button"},{default:u(()=>[t("div",ul,"打开"+h(Ms(r))+"个站点",1)]),_:2},1032,["icon","onClick","disabled"])])]))),128))])])):w("",!0)]),t("footer",cl,[I.value===0?(c(),v("div",ml,[n($e,{name:"el-fade-in-linear"},{default:u(()=>[...e[62]||(e[62]=[t("div",{class:"check-hint"},"修改完成后请预览一遍种子信息确保无误后完成修改！",-1)])]),_:1}),n(d,{onClick:He},{default:u(()=>[...e[63]||(e[63]=[V("取消",-1)])]),_:1}),n(d,{type:"primary",onClick:fs,disabled:Ge.value},{default:u(()=>[...e[64]||(e[64]=[V(" 下一步：发布参数预览 ",-1)])]),_:1},8,["disabled"]),n($e,{name:"el-fade-in-linear"},{default:u(()=>[Ge.value?(c(),v("div",pl,[n(o,{class:"hint-icon"},{default:u(()=>[n(A(ze))]),_:1}),t("span",null,h(Ts.value),1)])):w("",!0)]),_:1})])):w("",!0),I.value===1?(c(),v("div",vl,[n(d,{onClick:Cs,disabled:O.value},{default:u(()=>[...e[65]||(e[65]=[V("上一步",-1)])]),_:1},8,["disabled"]),W.showCompleteButton?(c(),z(d,{key:0,type:"primary",onClick:Ke,disabled:O.value||!$.value,class:T({"scrolled-to-bottom":$.value})},{default:u(()=>[...e[66]||(e[66]=[V(" 修改完成 ",-1)])]),_:1},8,["disabled","class"])):w("",!0),n(d,{type:"primary",onClick:hs,disabled:O.value||!$.value,class:T({"scrolled-to-bottom":$.value})},{default:u(()=>[...e[67]||(e[67]=[V(" 下一步：选择发布站点 ",-1)])]),_:1},8,["disabled","class"]),n($e,{name:"el-fade-in-linear"},{default:u(()=>[W.showCompleteButton&&!$.value?(c(),v("div",_l,[n(o,{class:"hint-icon"},{default:u(()=>[n(A(ze))]),_:1}),e[68]||(e[68]=t("span",null,"请滚动到页面底部检查完种子信息无误再发布！",-1))])):w("",!0)]),_:1}),n($e,{name:"el-fade-in-linear"},{default:u(()=>[!W.showCompleteButton&&!$.value?(c(),v("div",fl,[n(o,{class:"hint-icon"},{default:u(()=>[n(A(ze))]),_:1}),e[69]||(e[69]=t("span",null,"请先滚动到页面底部检查完种子信息再发布！",-1))])):w("",!0)]),_:1})])):w("",!0),I.value===2?(c(),v("div",gl,[n(d,{onClick:He,disabled:O.value},{default:u(()=>[...e[70]||(e[70]=[V("取消",-1)])]),_:1},8,["disabled"]),n(d,{type:"primary",onClick:Ss,loading:O.value,disabled:G.value.length===0},{default:u(()=>[...e[71]||(e[71]=[V(" 立即发布 ",-1)])]),_:1},8,["loading","disabled"])])):w("",!0),I.value===3?(c(),v("div",bl,[n(d,{type:"primary",onClick:Ke},{default:u(()=>[...e[72]||(e[72]=[V("完成",-1)])]),_:1})])):w("",!0)])]),be.value?(c(),v("div",{key:0,class:"log-card-overlay",onClick:Xe})):w("",!0),be.value?(c(),z(Ds,{key:1,class:"log-card",shadow:"xl"},{header:u(()=>[t("div",hl,[e[73]||(e[73]=t("span",null,"操作日志",-1)),n(d,{type:"danger",icon:A(Os),circle:"",onClick:Xe},null,8,["icon"])])]),default:u(()=>[t("pre",yl,h(le.value),1)]),_:1})):w("",!0),n(sa,{visible:he.value,taskId:je.value,onComplete:Ps,onClose:e[19]||(e[19]=r=>he.value=!1)},null,8,["visible","taskId"])],64)}}}),Cl=ns(wl,[["__scopeId","data-v-f4e008a5"]]);export{Cl as C,Hs as u};
