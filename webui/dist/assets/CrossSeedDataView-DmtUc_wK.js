import{d as kt,r as c,c as H,o as vt,s as xt,O as Ct,a as y,m as I,k as D,i as d,f as S,e as a,w as s,j as o,t as f,x as Lt,Q as Et,u as Ke,v as $t,F as we,l as De,L as _t,g as $,z as b,q as Dt,h as u,p as zt,R as St,n as de,B as Ut}from"./index-BMpCW-ko.js";import{u as Jt,C as qt}from"./CrossSeedPanel-BuPwbpOK.js";const Xt={class:"batch-fetch-panel"},jt={class:"search-and-controls"},Ht={key:0,class:"current-filters",style:{"margin-right":"15px",display:"flex","align-items":"center"}},Wt={key:2,class:"pagination-controls"},Kt={class:"table-container"},Gt=["title"],Qt={key:0,style:{color:"#909399"}},Yt={class:"filter-card-header"},Zt={class:"filter-card-body"},es={class:"path-tree-container"},ts={class:"filter-card-footer"},ss={key:2,class:"modal-overlay"},as={class:"modal-header"},ls={class:"batch-fetch-content"},ns={class:"config-section"},rs={class:"batch-fetch-footer"},os={key:3,class:"modal-overlay"},is={class:"modal-header"},ds={class:"priority-settings-content"},us={class:"priority-section"},cs={class:"priority-list"},ps={key:0,style:{color:"#909399","margin-left":"10px"}},fs={class:"priority-settings-footer"},gs={key:4,class:"modal-overlay"},vs={class:"modal-header"},_s={class:"progress-header-controls"},hs={class:"progress-content"},ms={class:"progress-summary"},ys={key:0,class:"bdinfo-stats"},ws={class:"results-table-container"},bs={class:"progress-footer"},Ss=3e3,ks=kt({__name:"BatchFetchPanel",emits:["cancel","fetch-completed"],setup(Tt,{emit:Ge}){const Qe=Ge,le=c([]),me=c(!0),ee=c(null),q=c([]),T=c(!1),ue=c(!1),ye=c(!1),L=c(!1),ne=c(!1),F=c([]),re=c(null),W=c(null),oe=c([]),Ne=c([]),ce=c([]),pe=c([]),K=c(1),be=c(20),ze=c(0),B=c(""),E=c(!1),R=c({paths:[],states:[],downloaderIds:[],sourceSiteAvailability:[]}),V=c({...R.value}),G=c(null),w=c({total:0,processed:0,success:0,failed:0,skipped:0,isRunning:!1,results:[]}),Se=c(null),Ye=H(()=>{const n=R.value,l=[];return n.sourceSiteAvailability&&n.sourceSiteAvailability.length>0&&l.push(`源站点: ${n.sourceSiteAvailability.length}`),n.paths&&n.paths.length>0&&l.push(`路径: ${n.paths.length}`),n.states&&n.states.length>0&&l.push(`状态: ${n.states.length}`),n.downloaderIds&&n.downloaderIds.length>0&&l.push(`下载器: ${n.downloaderIds.length}`),l.join(", ")}),Ze=H(()=>{const n=R.value;return n.sourceSiteAvailability&&n.sourceSiteAvailability.length>0||n.paths&&n.paths.length>0||n.states&&n.states.length>0||n.downloaderIds&&n.downloaderIds.length>0}),Pe=c([]),fe=async()=>{try{const n=await $.get("/api/sites/status");Pe.value=n.data}catch(n){console.error("加载站点状态失败:",n)}},C=H(()=>w.value.total===0?0:Math.round(w.value.processed/w.value.total*100)),te=H(()=>{if(!w.value.isRunning)return w.value.failed>0?"exception":"success"}),Ae=n=>{const l=[],h=new Map;return n.sort().forEach(v=>{const _=v.replace(/^\/|\/$/g,"").split("/");let k="",Y=l;_.forEach((Z,z)=>{if(k=z===0?`/${Z}`:`${k}/${Z}`,!h.has(k)){const A={path:z===_.length-1?v:k,label:Z,children:[]};h.set(k,A),Y.push(A)}Y=h.get(k).children})}),h.forEach(v=>{v.children&&v.children.length===0&&delete v.children}),l},Q=async()=>{me.value=!0,ee.value=null;try{const n=new URLSearchParams({page:K.value.toString(),pageSize:be.value.toString(),nameSearch:B.value,path_filters:JSON.stringify(R.value.paths),state_filters:JSON.stringify(R.value.states),downloader_filters:JSON.stringify(R.value.downloaderIds),source_availability_filters:JSON.stringify(R.value.sourceSiteAvailability),exclude_existing:"true"}),h=(await $.get(`/api/data?${n.toString()}`)).data;h.error?(ee.value=h.error||"获取数据失败",b.error(h.error||"获取数据失败")):(le.value=h.data.map(v=>({name:v.name,save_path:v.save_path,size:v.size,progress:v.progress,state:v.state,sites:v.sites||{},downloader_ids:v.downloader_ids||[]})),ze.value=h.total,(ce.value.length===0||!R.value.states.length)&&(ce.value=[...new Set(le.value.map(v=>v.state))]))}catch(n){ee.value=n.message||"网络错误",b.error(n.message||"网络错误")}finally{me.value=!1}},et=async()=>{try{const l=(await $.get("/api/all_downloaders")).data;pe.value=l.filter(h=>h.enabled)}catch(n){ee.value=n.message}},ie=async()=>{try{const n=new URLSearchParams({page:"1",page_size:"1",path_filters:JSON.stringify([]),state_filters:JSON.stringify([]),downloader_filters:JSON.stringify([]),source_availability_filters:JSON.stringify([])}),h=(await $.get(`/api/data?${n.toString()}`)).data;h.unique_paths&&(Ne.value=h.unique_paths,oe.value=Ae(Ne.value))}catch(n){console.error("获取路径列表失败:",n)}},U=n=>{be.value=n,K.value=1,Q()},J=n=>{K.value=n,Q()},tt=()=>{R.value={paths:[],states:[],downloaderIds:[],sourceSiteAvailability:[]},B.value="",K.value=1,Te(),Q()},st=()=>{V.value={...R.value},E.value=!0,Dt(()=>{W.value&&R.value.paths.length>0&&W.value.setCheckedKeys(R.value.paths,!1)})},at=()=>{if(W.value){const n=W.value.getCheckedKeys(!1);V.value.paths=n}R.value={...V.value},E.value=!1,K.value=1,Te(),Q()},Te=async()=>{try{await $.post("/api/config/batch_fetch_filters",{batch_fetch_filters:R.value,batch_fetch_name_search:B.value})}catch(n){console.error("保存筛选条件失败:",n)}},Me=async()=>{try{const l=(await $.get("/api/config/batch_fetch_filters")).data;if(l.success&&l.data){const h={paths:[],states:[],downloaderIds:[],sourceSiteAvailability:[]};R.value={...h,...l.data}}l.success&&l.name_search!==void 0&&(B.value=l.name_search)}catch(n){console.error("加载筛选条件失败:",n)}},lt=n=>{q.value=n},N=n=>{const l={},h=new Set(["我堡","OurBits"]);for(const[v,_]of Object.entries(n||{}))h.has(v)||(_.migration===1||_.migration===3)&&Pe.value.find(k=>k.name===v)?.has_cookie&&(l[v]=_);return l},ke=()=>{if(q.value.length===0){b.warning("请先选择要获取数据的种子");return}T.value=!0},Re=()=>{T.value=!1},nt=async()=>{ye.value=!0,await rt()},Be=()=>{ye.value=!1},rt=async()=>{L.value=!0;try{const l=(await $.get("/api/sites/status")).data,h=new Set(["我堡","OurBits"]),v=l.filter(P=>P.is_source&&P.has_cookie&&!h.has(P.name)),k=(await $.get("/api/config/source_priority")).data,Y=k.success?k.data||[]:[],Z=[],z=new Set;Y.forEach(P=>{if(h.has(P))return;const A=v.find(Fe=>Fe.name===P);A&&!z.has(A.name)&&(Z.push(A),z.add(A.name))}),v.forEach(P=>{z.has(P.name)||Z.push(P)}),F.value=Z}catch(n){b.error(n.message||"加载配置失败")}finally{L.value=!1}},ot=async()=>{ne.value=!0;try{const n=new Set(["我堡","OurBits"]),l=F.value.map(v=>v.name).filter(v=>!n.has(v)),h=await $.post("/api/config/source_priority",{source_priority:l});if(h.data.success)b.success("源站点优先级配置已保存"),Be();else throw new Error(h.data.message||"保存失败")}catch(n){b.error(n.message||"保存配置失败")}finally{ne.value=!1}},it=n=>n===0?"success":n===1?"primary":n===2?"warning":"info",se=n=>{re.value=n},dt=n=>{if(re.value===null)return;const l=F.value[re.value];F.value.splice(re.value,1),F.value.splice(n,0,l),re.value=null},ut=async()=>{try{const n=q.value.map(v=>v.name),h=(await $.post("/api/migrate/batch_fetch_seed_data",{torrentNames:n})).data;h.success?(G.value=h.task_id,b.success("批量获取任务已启动"),Re(),Oe()):b.error(h.message||"批量获取任务启动失败")}catch(n){const l=n.response?.data?.message||n.message||"网络错误";b.error(l)}},Oe=()=>{ue.value=!0,Ee()},Le=()=>{ue.value=!1,ge()},Ee=()=>{ge(),xe(),Se.value=setInterval(async()=>{ue.value&&G.value?(await xe(),w.value&&!w.value.isRunning&&setTimeout(()=>{w.value.isRunning||ge()},3e3)):ge()},Ss)},ge=()=>{Se.value&&(clearInterval(Se.value),Se.value=null)},xe=async()=>{if(G.value)try{const l=(await $.get(`/api/migrate/batch_fetch_progress?task_id=${G.value}`)).data;if(l.success){const h=w.value.isRunning;if(w.value=l.progress,w.value.results&&w.value.results.length>0){const v={processing:w.value.results.filter(_=>_.bdinfo_status==="processing_bdinfo"||_.mediainfo&&_.mediainfo.includes("正在处理 BDInfo")).length,completed:w.value.results.filter(_=>_.bdinfo_status==="completed"||_.mediainfo&&_.mediainfo.includes("DISC INFO")).length,failed:w.value.results.filter(_=>_.bdinfo_status==="failed"||_.mediainfo&&_.mediainfo.includes("bdinfo提取失败")).length};w.value.bdinfo_stats=v}h&&!w.value.isRunning&&Qe("fetch-completed")}else b.error(l.message||"获取进度失败")}catch(n){console.error("获取进度时出错:",n)}},ct=n=>{switch(n){case"success":return"success";case"failed":return"danger";case"skipped":return"info";default:return"info"}},pt=n=>{switch(n){case"success":return"成功";case"failed":return"失败";case"skipped":return"跳过";default:return"未知"}},Ie=n=>{if(!n||n===0)return"0 B";const l=1024,h=["B","KB","MB","GB","TB","PB"],v=Math.floor(Math.log(n)/Math.log(l));return`${(n/Math.pow(l,v)).toFixed(2)} ${h[v]}`},Ue=(n,l=50)=>{if(!n||n.length<=l)return n;const h=Math.floor((l-3)/2);let v=n.substring(0,h),_=n.substring(n.length-h);const k=v.lastIndexOf("/"),Y=_.indexOf("/");return k>0&&Y>=0&&(v=v.substring(0,k),_=_.substring(Y+1)),`${v}...${_}`};return vt(async()=>{await et(),await Me(),await fe(),await ie(),Q()}),xt(()=>{ge()}),Ct(B,()=>{K.value=1,Q(),Te()}),(n,l)=>{const h=S("el-alert"),v=S("el-input"),_=S("el-button"),k=S("el-tag"),Y=S("el-icon"),Z=S("el-pagination"),z=S("el-table-column"),P=S("el-table"),A=S("el-divider"),Fe=S("el-tree"),ve=S("el-checkbox"),X=S("el-checkbox-group"),Ce=S("el-card"),j=S("el-descriptions-item"),_e=S("el-descriptions"),ft=S("el-progress"),Je=$t("loading");return u(),y("div",Xt,[ee.value?(u(),I(h,{key:0,title:ee.value,type:"error","show-icon":"",closable:!1,center:"",style:{"margin-bottom":"15px"}},null,8,["title"])):D("",!0),d("div",jt,[a(v,{modelValue:B.value,"onUpdate:modelValue":l[0]||(l[0]=m=>B.value=m),placeholder:"搜索名称...",clearable:"",class:"search-input",style:{width:"300px","margin-right":"15px"}},null,8,["modelValue"]),a(_,{type:"primary",onClick:st,plain:"",style:{"margin-right":"15px"}},{default:s(()=>[...l[10]||(l[10]=[o(" 筛选 ",-1)])]),_:1}),Ze.value?(u(),y("div",Ht,[a(k,{type:"info",size:"default",effect:"plain"},{default:s(()=>[o(f(Ye.value),1)]),_:1}),a(_,{type:"danger",link:"",style:{padding:"0","margin-left":"8px"},onClick:tt},{default:s(()=>[...l[11]||(l[11]=[o("清除",-1)])]),_:1})])):D("",!0),a(_,{type:"warning",onClick:nt,plain:"",style:{"margin-right":"15px"}},{default:s(()=>[a(Y,{style:{"margin-right":"5px"}},{default:s(()=>[a(Lt(Et))]),_:1}),l[12]||(l[12]=o(" 设置优先级 ",-1))]),_:1}),a(_,{type:"success",onClick:ke,plain:"",style:{"margin-right":"15px"},disabled:q.value.length===0},{default:s(()=>[o(" 批量获取数据 ("+f(q.value.length)+") ",1)]),_:1},8,["disabled"]),G.value?(u(),I(_,{key:1,type:"info",onClick:Oe,plain:"",style:{"margin-right":"15px"}},{default:s(()=>[...l[13]||(l[13]=[o(" 查看进度 ",-1)])]),_:1})):D("",!0),le.value.length>0?(u(),y("div",Wt,[a(Z,{"current-page":K.value,"onUpdate:currentPage":l[1]||(l[1]=m=>K.value=m),"page-size":be.value,"onUpdate:pageSize":l[2]||(l[2]=m=>be.value=m),"page-sizes":[20,50,100],total:ze.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:U,onCurrentChange:J,background:""},null,8,["current-page","page-size","total"])])):D("",!0)]),d("div",Kt,[Ke((u(),I(P,{data:le.value,border:"",style:{width:"100%"},"empty-text":"暂无种子数据",height:"100%",onSelectionChange:lt},{default:s(()=>[a(z,{type:"selection",width:"55",align:"center","header-align":"center"}),a(z,{prop:"name",label:"种子名称","min-width":"400","show-overflow-tooltip":"","header-align":"center"}),a(z,{prop:"size",label:"大小",width:"110",align:"center","header-align":"center"},{default:s(m=>[o(f(Ie(m.row.size)),1)]),_:1}),a(z,{prop:"save_path",label:"保存路径",width:"200","header-align":"center"},{default:s(m=>[d("div",{title:m.row.save_path,style:{width:"100%",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}},f(Ue(m.row.save_path,30)),9,Gt)]),_:1}),a(z,{prop:"site_count",label:"站点数",width:"100",align:"center","header-align":"center"},{default:s(m=>[o(f(Object.keys(m.row.sites||{}).length),1)]),_:1}),a(z,{prop:"state",label:"状态",width:"120",align:"center","header-align":"center"}),a(z,{label:"已有源站点","min-width":"200","header-align":"center"},{default:s(m=>[(u(!0),y(we,null,De(N(m.row.sites),(he,$e)=>(u(),I(k,{key:$e,size:"small",type:"success",style:{margin:"2px"}},{default:s(()=>[o(f($e),1)]),_:2},1024))),128)),Object.keys(N(m.row.sites)).length===0?(u(),y("span",Qt," 无可用源站点 ")):D("",!0)]),_:1})]),_:1},8,["data"])),[[Je,me.value]])]),E.value?(u(),y("div",{key:1,class:"filter-overlay",onClick:l[8]||(l[8]=_t(m=>E.value=!1,["self"]))},[a(Ce,{class:"filter-card"},{header:s(()=>[d("div",Yt,[l[15]||(l[15]=d("span",null,"筛选选项",-1)),a(_,{type:"danger",circle:"",onClick:l[3]||(l[3]=m=>E.value=!1),plain:""},{default:s(()=>[...l[14]||(l[14]=[o("X",-1)])]),_:1})])]),default:s(()=>[d("div",Zt,[a(A,{"content-position":"left"},{default:s(()=>[...l[16]||(l[16]=[o("保存路径",-1)])]),_:1}),d("div",es,[a(Fe,{ref_key:"pathTreeRef",ref:W,data:oe.value,"show-checkbox":"","node-key":"path","default-expand-all":"","expand-on-click-node":!1,"check-on-click-node":"","check-strictly":!0,props:{class:"path-tree-node"}},null,8,["data"])]),a(A,{"content-position":"left"},{default:s(()=>[...l[17]||(l[17]=[o("源站点",-1)])]),_:1}),a(X,{modelValue:V.value.sourceSiteAvailability,"onUpdate:modelValue":l[4]||(l[4]=m=>V.value.sourceSiteAvailability=m)},{default:s(()=>[a(ve,{label:"存在源站点"},{default:s(()=>[...l[18]||(l[18]=[o("存在源站点",-1)])]),_:1}),a(ve,{label:"无可用源站点"},{default:s(()=>[...l[19]||(l[19]=[o("无可用源站点",-1)])]),_:1})]),_:1},8,["modelValue"]),a(A,{"content-position":"left"},{default:s(()=>[...l[20]||(l[20]=[o("状态",-1)])]),_:1}),a(X,{modelValue:V.value.states,"onUpdate:modelValue":l[5]||(l[5]=m=>V.value.states=m)},{default:s(()=>[(u(!0),y(we,null,De(ce.value,m=>(u(),I(ve,{key:m,label:m},{default:s(()=>[o(f(m),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"]),a(A,{"content-position":"left"},{default:s(()=>[...l[21]||(l[21]=[o("下载器",-1)])]),_:1}),a(X,{modelValue:V.value.downloaderIds,"onUpdate:modelValue":l[6]||(l[6]=m=>V.value.downloaderIds=m)},{default:s(()=>[(u(!0),y(we,null,De(pe.value,m=>(u(),I(ve,{key:m.id,label:m.id},{default:s(()=>[o(f(m.name),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),d("div",ts,[a(_,{onClick:l[7]||(l[7]=m=>E.value=!1)},{default:s(()=>[...l[22]||(l[22]=[o("取消",-1)])]),_:1}),a(_,{type:"primary",onClick:at},{default:s(()=>[...l[23]||(l[23]=[o("确认",-1)])]),_:1})])]),_:1})])):D("",!0),T.value?(u(),y("div",ss,[a(Ce,{class:"batch-fetch-card",shadow:"always"},{header:s(()=>[d("div",as,[l[25]||(l[25]=d("span",null,"批量获取种子数据",-1)),a(_,{type:"danger",circle:"",onClick:Re,plain:""},{default:s(()=>[...l[24]||(l[24]=[o("X",-1)])]),_:1})])]),default:s(()=>[d("div",ls,[d("div",ns,[d("h3",null,"已选择 "+f(q.value.length)+" 个种子",1),l[26]||(l[26]=d("p",{style:{color:"#909399","font-size":"13px","margin-top":"5px"}}," 系统将按名称聚合，逐个从源站点获取种子数据并存储到数据库 ",-1))])]),d("div",rs,[a(_,{onClick:Re},{default:s(()=>[...l[27]||(l[27]=[o("取消",-1)])]),_:1}),a(_,{type:"primary",onClick:ut},{default:s(()=>[...l[28]||(l[28]=[o(" 开始批量获取 ",-1)])]),_:1})])]),_:1})])):D("",!0),ye.value?(u(),y("div",os,[a(Ce,{class:"priority-settings-card",shadow:"always"},{header:s(()=>[d("div",is,[l[30]||(l[30]=d("span",null,"源站点优先级设置",-1)),a(_,{type:"danger",circle:"",onClick:Be,plain:""},{default:s(()=>[...l[29]||(l[29]=[o("X",-1)])]),_:1})])]),default:s(()=>[d("div",ds,[a(h,{type:"info","show-icon":"",closable:!1,style:{"margin-bottom":"20px"}},{title:s(()=>[...l[31]||(l[31]=[o(" 设置批量获取种子数据时的源站点优先级顺序，系统将按顺序查找第一个可用的源站点",-1),d("br",null,null,-1),o(" 如果第一个源站点无法获取会按顺序自动切换源站点 ",-1)])]),_:1}),d("div",us,[l[32]||(l[32]=d("p",{style:{color:"#606266","font-size":"14px","margin-bottom":"10px","font-weight":"600"}}," 源站点优先级顺序： ",-1)),Ke((u(),y("div",cs,[(u(!0),y(we,null,De(F.value,(m,he)=>(u(),I(k,{key:m.name,type:it(he),size:"large",draggable:"true",onDragstart:$e=>se(he),onDragover:l[9]||(l[9]=_t(()=>{},["prevent"])),onDrop:$e=>dt(he),style:{margin:"5px",cursor:"move","user-select":"none"}},{default:s(()=>[o(f(he+1)+". "+f(m.name),1)]),_:2},1032,["type","onDragstart","onDrop"]))),128)),F.value.length===0?(u(),y("span",ps," 未配置源站点优先级 ")):D("",!0)])),[[Je,L.value]]),l[33]||(l[33]=d("div",{class:"priority-tip",style:{"margin-top":"10px","font-size":"12px",color:"#909399"}}," 拖拽调整优先级顺序，系统将按此顺序查找可用的源站点。 ",-1))])]),d("div",fs,[a(_,{onClick:Be},{default:s(()=>[...l[34]||(l[34]=[o("取消",-1)])]),_:1}),a(_,{type:"primary",onClick:ot,loading:ne.value},{default:s(()=>[...l[35]||(l[35]=[o(" 保存设置 ",-1)])]),_:1},8,["loading"])])]),_:1})])):D("",!0),ue.value?(u(),y("div",gs,[a(Ce,{class:"progress-card",shadow:"always"},{header:s(()=>[d("div",vs,[d("span",null,"批量获取进度 "+f(w.value.isRunning?"(进行中...)":"(已完成)"),1),d("div",_s,[w.value.isRunning?(u(),I(_,{key:0,type:"warning",size:"small",onClick:ge},{default:s(()=>[...l[36]||(l[36]=[o(" 停止自动刷新 ",-1)])]),_:1})):(u(),I(_,{key:1,type:"primary",size:"small",onClick:xe},{default:s(()=>[...l[37]||(l[37]=[o(" 刷新 ",-1)])]),_:1})),a(_,{type:"danger",circle:"",onClick:Le,plain:""},{default:s(()=>[...l[38]||(l[38]=[o("X",-1)])]),_:1})])])]),default:s(()=>[d("div",hs,[d("div",ms,[a(_e,{column:2,border:""},{default:s(()=>[a(j,{label:"总数"},{default:s(()=>[o(f(w.value.total),1)]),_:1}),a(j,{label:"已处理"},{default:s(()=>[o(f(w.value.processed),1)]),_:1}),a(j,{label:"成功"},{default:s(()=>[a(k,{type:"success",size:"small"},{default:s(()=>[o(f(w.value.success),1)]),_:1})]),_:1}),a(j,{label:"失败"},{default:s(()=>[a(k,{type:"danger",size:"small"},{default:s(()=>[o(f(w.value.failed),1)]),_:1})]),_:1}),a(j,{label:"跳过"},{default:s(()=>[a(k,{type:"info",size:"small"},{default:s(()=>[o(f(w.value.skipped),1)]),_:1})]),_:1}),a(j,{label:"状态"},{default:s(()=>[a(k,{type:w.value.isRunning?"warning":"success",size:"small"},{default:s(()=>[o(f(w.value.isRunning?"进行中":"已完成"),1)]),_:1},8,["type"])]),_:1})]),_:1}),w.value.bdinfo_stats?(u(),y("div",ys,[l[39]||(l[39]=d("h4",{style:{margin:"15px 0 10px 0","font-size":"14px",color:"#606266"}},"BDInfo 处理状态",-1)),a(_e,{column:3,border:"",size:"small"},{default:s(()=>[a(j,{label:"处理中"},{default:s(()=>[a(k,{type:"warning",size:"small"},{default:s(()=>[o(f(w.value.bdinfo_stats.processing),1)]),_:1})]),_:1}),a(j,{label:"已完成"},{default:s(()=>[a(k,{type:"success",size:"small"},{default:s(()=>[o(f(w.value.bdinfo_stats.completed),1)]),_:1})]),_:1}),a(j,{label:"失败"},{default:s(()=>[a(k,{type:"danger",size:"small"},{default:s(()=>[o(f(w.value.bdinfo_stats.failed),1)]),_:1})]),_:1})]),_:1})])):D("",!0),a(ft,{percentage:C.value,status:te.value,style:{"margin-top":"15px"}},null,8,["percentage","status"])]),a(A,{"content-position":"left"},{default:s(()=>[...l[40]||(l[40]=[o("处理详情",-1)])]),_:1}),d("div",ws,[a(P,{data:w.value.results,style:{width:"100%"},size:"small",stripe:"","max-height":"400"},{default:s(()=>[a(z,{prop:"name",label:"种子名称","min-width":"300","show-overflow-tooltip":""}),a(z,{prop:"status",label:"状态",width:"100",align:"center"},{default:s(m=>[a(k,{type:ct(m.row.status),size:"small"},{default:s(()=>[o(f(pt(m.row.status)),1)]),_:2},1032,["type"])]),_:1}),a(z,{prop:"source_site",label:"源站点",width:"120",align:"center"}),a(z,{prop:"reason",label:"失败原因","min-width":"200","show-overflow-tooltip":""})]),_:1},8,["data"])])]),d("div",bs,[a(_,{onClick:Le},{default:s(()=>[...l[41]||(l[41]=[o("关闭",-1)])]),_:1})])]),_:1})])):D("",!0)])}}}),xs=zt(ks,[["__scopeId","data-v-800168e6"]]),Cs={class:"cross-seed-data-view"},$s={class:"search-and-controls glass-table"},Ds={key:0,class:"current-filters",style:{"margin-right":"15px",display:"flex","align-items":"center"}},zs={key:1,class:"pagination-controls"},Ts={class:"filter-card-header"},Rs={class:"filter-card-body"},Bs={class:"path-tree-container"},Is={class:"target-sites-container"},Fs={class:"selected-site-display"},Vs={key:0,class:"selected-site-info"},Ns={key:1,class:"selected-site-info"},Ps={class:"target-sites-radio-container"},As={class:"filter-card-footer"},Ms={class:"table-container"},Os={class:"mapped-cell"},Ls={class:"title-cell"},Es=["title"],Us=["title"],Js={class:"tags-cell"},qs={class:"mapped-cell datetime-cell"},Xs={key:2,class:"modal-overlay"},js={class:"modal-header"},Hs={class:"cross-seed-content"},Ws={key:3,class:"modal-overlay"},Ks={class:"modal-header"},Gs={class:"batch-cross-seed-content"},Qs={class:"target-site-selection-body"},Ys={class:"batch-info"},Zs={class:"batch-cross-seed-footer"},ea={key:4,class:"modal-overlay"},ta={class:"modal-header"},sa={class:"record-header-controls"},aa={class:"record-view-content"},la={key:0,class:"records-table-container"},na={key:0},ra={key:1},oa={key:0,class:"progress-cell"},ia={class:"progress-text"},da={key:1},ua={key:0},ca={key:1},pa={key:2},fa={key:1},ga={class:"mapped-cell datetime-cell"},va={key:1,class:"no-records"},_a={class:"record-view-footer"},ha={key:5,class:"modal-overlay"},ma={class:"modal-header"},ya={class:"batch-fetch-main-content"},wa=5e3,ba=kt({__name:"CrossSeedDataView",emits:["ready"],setup(Tt,{emit:Ge}){const Qe=Ge;vt(()=>{Qe("ready",N)});const le=c({type:{},medium:{},video_codec:{},audio_codec:{},resolution:{},source:{},team:{},tags:{},site_name:{}}),me=c([]),ee=c(!0),q=c(null),T=c([]),ue=c(!1),ye=c(!1),L=c(!1),ne=c(!1),F=c([]),re=c(!1),W=c(new Map),oe=c(null),Ne=c(0),ce=c(!1),pe=c(null),K=c([]),be=c([]),ze=c(window.innerHeight-80),B=c(1),E=c(20),R=c(0),V=c(""),G=c(""),w=async t=>{G.value=t,B.value=1;try{await $.post("/api/config/cross_seed_review_filter",{review_filter:t})}catch(e){console.error("保存检查状态筛选失败:",e)}N()},Se=H(()=>{const t=C.value,e=[];return t.paths&&t.paths.length>0&&e.push(`路径: ${t.paths.length}`),t.isDeleted==="0"?e.push("未删除"):t.isDeleted==="1"&&e.push("已删除"),t.excludeTargetSites&&t.excludeTargetSites.trim()!==""&&e.push(`不存在于: ${t.excludeTargetSites}`),e.join(", ")}),Ye=H(()=>T.value.length>0&&C.value.excludeTargetSites&&C.value.excludeTargetSites.trim()!==""),Ze=H(()=>{const t=T.value.length,e=C.value.excludeTargetSites;return!e||e.trim()===""?`批量转种 (${t}) - 请先在筛选中选择目标站点`:`批量转种到 ${e} (${t})`}),Pe=H(()=>{const t=C.value;return t.paths&&t.paths.length>0||t.isDeleted!==""||t.excludeTargetSites&&t.excludeTargetSites.trim()!==""}),fe=c(!1),C=c({paths:[],isDeleted:"",excludeTargetSites:""}),te=c({...C.value}),Ae=c([]),Q=H({get:()=>te.value.excludeTargetSites||"",set:t=>{te.value.excludeTargetSites=t}}),et=()=>{te.value.excludeTargetSites=""},ie=(t,e)=>{if(!e)return"";const i=le.value[t];return i&&i[e]||e},U=t=>t?/^[^.]+[.][^.]+$/.test(t):!0,J=(t,e)=>{if(!e)return!0;const i=le.value[t];return i?!!i[e]:!1},tt=t=>{let e=[];if(typeof t=="string")try{e=JSON.parse(t)}catch{e=t.split(",").map(i=>i.trim()).filter(i=>i)}else Array.isArray(t)&&(e=t);return e.length===0?[]:e.map(i=>le.value.tags[i]||i)},st=(t,e)=>{let i=[];if(typeof t=="string")try{i=JSON.parse(t)}catch{i=t.split(",").map(g=>g.trim()).filter(g=>g)}else Array.isArray(t)&&(i=t);if(i.length===0||e>=i.length)return"info";const p=i[e];return p==="禁转"||p==="tag.禁转"||p==="限转"||p==="tag.限转"||!U(p)||!J("tags",p)?"danger":"info"},at=(t,e)=>{let i=[];if(typeof t=="string")try{i=JSON.parse(t)}catch{i=t.split(",").map(g=>g.trim()).filter(g=>g)}else Array.isArray(t)&&(i=t);if(i.length===0||e>=i.length)return"";const p=i[e];return p==="禁转"||p==="tag.禁转"||p==="限转"||p==="tag.限转"?"restricted-tag":!U(p)||!J("tags",p)?"invalid-tag":""},Te=t=>{if(!t)return"";try{const e=new Date(t);if(isNaN(e.getTime()))return t;const i=e.getFullYear(),p=String(e.getMonth()+1).padStart(2,"0"),g=String(e.getDate()).padStart(2,"0"),M=String(e.getHours()).padStart(2,"0"),ae=String(e.getMinutes()).padStart(2,"0"),O=String(e.getSeconds()).padStart(2,"0");return`${i}-${p}-${g}
${M}:${ae}:${O}`}catch{return t}},Me=t=>{const e=["type","medium","video_codec","audio_codec","resolution","team","source"];for(const p of e){const g=t[p];if(g&&(!U(g)||!J(p,g)))return!0}let i=[];if(typeof t.tags=="string")try{i=JSON.parse(t.tags)}catch{i=t.tags.split(",").map(p=>p.trim()).filter(p=>p)}else Array.isArray(t.tags)&&(i=t.tags);for(const p of i)if(!U(p)||!J("tags",p))return!0;return!!t.unrecognized},lt=t=>{const e=[],i=new Map;return t.sort().forEach(p=>{const g=p.replace(/^\/|\/$/g,"").split("/");let M="",ae=e;g.forEach((O,qe)=>{if(M=qe===0?`/${O}`:`${M}/${O}`,!i.has(M)){const je={path:qe===g.length-1?p:M,label:O,children:[]};i.set(M,je),ae.push(je)}ae=i.get(M).children})}),i.forEach(p=>{p.children&&p.children.length===0&&delete p.children}),e},N=async()=>{ee.value=!0,q.value=null;try{const t=new URLSearchParams({page:B.value.toString(),page_size:E.value.toString(),search:V.value,path_filters:JSON.stringify(C.value.paths||[]),is_deleted:C.value.isDeleted,exclude_target_sites:C.value.excludeTargetSites,review_status:G.value});C.value.excludeTargetSites&&console.log("发送目标站点排除参数:",C.value.excludeTargetSites);const i=(await $.get(`/api/cross-seed-data?${t.toString()}`)).data;i.success?(me.value=i.data,R.value=i.total,i.reverse_mappings&&(le.value=i.reverse_mappings),i.unique_paths&&(be.value=i.unique_paths,K.value=lt(i.unique_paths)),i.target_sites&&(Ae.value=i.target_sites)):(q.value=i.error||"获取数据失败",b.error(i.error||"获取数据失败"))}catch(t){q.value=t.message||"网络错误",b.error(t.message||"网络错误")}finally{ee.value=!1}},ke=async()=>{try{const t={page_size:E.value,search_query:V.value,active_filters:C.value};await $.post("/api/ui_settings/cross_seed",t)}catch(t){console.error("无法保存UI设置:",t.message)}},Re=async()=>{try{const e=(await $.get("/api/ui_settings/cross_seed")).data;E.value=e.page_size??20,V.value=e.search_query??"",e.active_filters&&Object.assign(C.value,e.active_filters)}catch(t){console.error("加载UI设置时出错:",t)}},nt=t=>{E.value=t,B.value=1,N(),ke()},Be=t=>{B.value=t,N()},rt=()=>{C.value={paths:[],isDeleted:"",excludeTargetSites:""},B.value=1,N(),ke()},ot=()=>{te.value={...C.value},fe.value=!0,Dt(()=>{pe.value&&C.value.paths.length>0&&pe.value.setCheckedKeys(C.value.paths,!1)})},it=()=>{if(pe.value){const t=pe.value.getCheckedKeys(!1);te.value.paths=t}C.value={...te.value},fe.value=!1,B.value=1,N(),ke()},se=Jt();Ct(V,()=>{B.value=1,N(),ke()});const dt=H(()=>!!se.taskId),ut=H(()=>se.workingParams?.title||""),Oe=async t=>{try{se.reset();const i=(await $.get(`/api/migrate/get_db_seed_info?torrent_id=${t.torrent_id}&site_name=${t.site_name}`)).data;if(i.success){const p={...i.data,name:i.data.name||i.data.title,save_path:i.data.save_path||"",size:0,size_formatted:"0 B",progress:100,state:"completed",total_uploaded:0,total_uploaded_formatted:"0 B",downloaderId:i.data.downloader_id||null,sites:{[i.data.site_name]:{torrentId:i.data.torrent_id,comment:`id=${i.data.torrent_id}`}}};se.setParams(p);const g={name:i.data.site_name,site:i.data.site_name.toLowerCase(),torrentId:i.data.torrent_id};se.setSourceInfo(g),se.setTaskId(`cross_seed_${t.id}_${Date.now()}`)}else b.error(i.error||"获取种子参数失败")}catch(e){b.error(e.message||"网络错误")}},Le=async t=>{try{await St.confirm(`确定要永久删除种子数据 "${t.title}" 吗？此操作无法恢复！`,"确认永久删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e={torrent_id:t.torrent_id,site_name:t.site_name},p=(await $.post("/api/cross-seed-data/delete",e)).data;p.success?(b.success(p.message||"删除成功"),N()):b.error(p.error||"删除失败")}catch(e){e!=="cancel"&&b.error(e.message||"网络错误")}},Ee=()=>{se.reset()},ge=()=>{b.success("转种操作已完成！"),se.reset(),N()},xe=()=>{ze.value=window.innerHeight-80};vt(async()=>{await Re(),await ct(),N(),window.addEventListener("resize",xe)});const ct=async()=>{try{const e=(await $.get("/api/config/cross_seed_review_filter")).data;e.success&&(G.value=e.data||"")}catch(t){console.error("加载检查状态筛选配置失败:",t)}},pt=({row:t})=>t.is_deleted||Ie(t.tags)||t.unrecognized?"deleted-row":t.is_reviewed?Ue(t)?"":"selected-row-disabled":"unreviewed-row",Ie=t=>{let e=[];if(typeof t=="string")try{e=JSON.parse(t)}catch{e=t.split(",").map(i=>i.trim()).filter(i=>i)}else Array.isArray(t)&&(e=t);return e.some(i=>i==="禁转"||i==="tag.禁转"||i==="限转"||i==="tag.限转")},Ue=t=>L.value?!0:Ie(t.tags)?!1:C.value.isDeleted==="1"?!Me(t):!(t.is_deleted||Me(t)||!t.is_reviewed),n=t=>{T.value=t,L.value},l=()=>{ue.value=!0},h=async()=>{const t=C.value.excludeTargetSites;if(!t||t.trim()===""){b.warning("请先在筛选中选择目标站点");return}try{v();const e={target_site_name:t,seeds:T.value.map(g=>({hash:g.hash,torrent_id:g.torrent_id,site_name:g.site_name,nickname:g.nickname}))};console.log("批量转种数据:",e),ne.value=!0,ve();const p=(await $.post("/api/go-api/batch-enhance",e)).data;p.success?b.success(`批量转种请求已发送，成功 ${p.data.seeds_processed} 个，失败 ${p.data.seeds_failed} 个`):(X(),b.error(p.error||"批量转种失败"))}catch(e){X(),b.error(e.message||"网络错误")}},v=()=>{ue.value=!1},_=()=>L.value?T.value.length===0?"退出删除模式":`删除选中项 (${T.value.length})`:"批量删除模式",k=async()=>{L.value?(L.value=!1,T.value=[]):(L.value=!0,T.value=[])},Y=async()=>{if(T.value.length===0){b.warning("请先选择要删除的行");return}try{await St.confirm(`确定要删除选中的 ${T.value.length} 条种子数据吗？此操作无法恢复！`,"确认批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const t={items:T.value.map(p=>({torrent_id:p.torrent_id,site_name:p.site_name}))},i=(await $.post("/api/cross-seed-data/delete",t)).data;i.success?(b.success(i.message||`成功删除 ${i.deleted_count} 条数据`),T.value=[],L.value=!1,N()):b.error(i.error||"批量删除失败")}catch(t){t!=="cancel"&&b.error(t.message||"网络错误")}},Z=()=>{ye.value=!0},z=()=>{ye.value=!1},P=()=>{b.success("批量获取种子数据已完成，正在刷新列表..."),N()},A=t=>t?t.includes("成功")||t.includes("失败"):!1,Fe=H(()=>{if(F.value.length===0)return!1;const t=F.value[0];return!A(t.downloader_add_result)}),ve=()=>{X(),_e(),oe.value=setInterval(async()=>{ne.value?await _e():X()},wa)},X=()=>{oe.value&&(clearInterval(oe.value),oe.value=null),Ne.value=0},Ce=()=>{ne.value=!0,_e(),ve()},j=()=>{ne.value=!1,X(),N()},_e=async()=>{try{gt();const e=(await $.get("/api/go-api/records")).data;F.value=e.records||[]}catch(t){console.error("获取记录时出错:",t),b.error("获取记录失败: "+(t.message||"网络错误"))}},ft=async()=>{try{const t=await $.delete("/api/go-api/records");F.value=[],gt(),b.success("记录已清空")}catch{F.value=[],gt(),b.success("本地记录已清空")}},Je=t=>{switch(t){case"success":return"success";case"failed":return"danger";case"filtered":return"warning";case"processing":return"primary";case"pending":return"info";default:return"info"}},m=t=>{switch(t){case"success":return"成功";case"failed":return"失败";case"filtered":return"已过滤";case"processing":return"处理中";case"pending":return"等待中";default:return"未知"}},he=t=>t?(W.value.has(t)||W.value.set(t,W.value.size+1),W.value.get(t)):"-",$e=t=>{if(typeof t!="number")return"info";const e=["success","primary","warning","info"];return e[(t-1)%e.length]},gt=()=>{W.value.clear()},Rt=t=>t.startsWith("成功")?"success":t.startsWith("失败")?"danger":"info",Bt=t=>t.startsWith("成功")?"#67c23a":t.startsWith("失败")?"#f56c6c":"#909399",ht=t=>t.startsWith("成功:")||t.startsWith("失败:")?t.substring(3):t,It=t=>{if(!t)return t;const e=t.indexOf("&uploaded");return e!==-1?t.substring(0,e):t},Ft=t=>{try{const e=new Date(t);if(isNaN(e.getTime()))return t;const i=e.getFullYear(),p=String(e.getMonth()+1).padStart(2,"0"),g=String(e.getDate()).padStart(2,"0"),M=String(e.getHours()).padStart(2,"0"),ae=String(e.getMinutes()).padStart(2,"0"),O=String(e.getSeconds()).padStart(2,"0");return`${i}-${p}-${g}
${M}:${ae}:${O}`}catch{return t}},mt=t=>{if(!t)return 0;const e=t.match(/(\d+)\/(\d+)/);if(e){const i=parseInt(e[1]),p=parseInt(e[2]);if(p>0)return Math.round(i/p*100)}return 0},Vt=t=>t<30?"#e6a23c":t<70?"#409eff":"#67c23a",Nt=async()=>{ce.value=!0;try{const e=(await $.post("/api/go-api/batch-enhance/stop")).data;e.success?(b.success("批量转种已停止"),X(),await _e()):b.error(e.error||"停止批量转种失败")}catch(t){b.error(t.message||"停止批量转种失败")}finally{ce.value=!1}};return xt(()=>{window.removeEventListener("resize",xe),X()}),(t,e)=>{const i=S("el-alert"),p=S("el-input"),g=S("el-button"),M=S("el-radio-button"),ae=S("el-radio-group"),O=S("el-tag"),qe=S("el-pagination"),Xe=S("el-divider"),je=S("el-tree"),He=S("el-radio"),Ve=S("el-card"),x=S("el-table-column"),yt=S("el-table"),Pt=S("el-progress"),At=S("el-link"),Mt=S("el-tooltip"),Ot=S("el-empty"),wt=$t("loading");return u(),y("div",Cs,[q.value?(u(),I(i,{key:0,title:q.value,type:"error","show-icon":"",closable:!1,style:{margin:"0","border-radius":"0"}},null,8,["title"])):D("",!0),d("div",$s,[a(p,{modelValue:V.value,"onUpdate:modelValue":e[0]||(e[0]=r=>V.value=r),placeholder:"搜索标题或种子ID...",clearable:"",class:"search-input",style:{width:"300px","margin-right":"15px"}},null,8,["modelValue"]),a(g,{type:"success",onClick:l,plain:"",style:{"margin-right":"15px"},disabled:!Ye.value||L.value},{default:s(()=>[o(f(Ze.value),1)]),_:1},8,["disabled"]),a(g,{type:"info",onClick:Ce,plain:"",style:{"margin-right":"15px"}},{default:s(()=>[...e[10]||(e[10]=[o(" 转种记录 ",-1)])]),_:1}),a(g,{type:"warning",onClick:Z,plain:"",style:{"margin-right":"15px"}},{default:s(()=>[...e[11]||(e[11]=[o(" 获取数据 ",-1)])]),_:1}),a(g,{type:"danger",onClick:e[1]||(e[1]=r=>L.value&&T.value.length>0?Y():k()),plain:"",style:{"margin-right":"15px"}},{default:s(()=>[o(f(_()),1)]),_:1}),a(g,{type:"primary",onClick:ot,plain:"",style:{"margin-right":"15px"}},{default:s(()=>[...e[12]||(e[12]=[o(" 筛选 ",-1)])]),_:1}),a(ae,{modelValue:G.value,"onUpdate:modelValue":e[2]||(e[2]=r=>G.value=r),onChange:w,style:{"margin-right":"15px"}},{default:s(()=>[a(M,{label:""},{default:s(()=>[...e[13]||(e[13]=[o("全部",-1)])]),_:1}),a(M,{label:"reviewed"},{default:s(()=>[...e[14]||(e[14]=[o("已检查",-1)])]),_:1}),a(M,{label:"unreviewed"},{default:s(()=>[...e[15]||(e[15]=[o("待检查",-1)])]),_:1}),a(M,{label:"error"},{default:s(()=>[...e[16]||(e[16]=[o("错误",-1)])]),_:1})]),_:1},8,["modelValue"]),Pe.value?(u(),y("div",Ds,[a(O,{type:"info",size:"default",effect:"plain"},{default:s(()=>[o(f(Se.value),1)]),_:1}),a(g,{type:"danger",link:"",style:{padding:"0","margin-left":"8px"},onClick:rt},{default:s(()=>[...e[17]||(e[17]=[o("清除",-1)])]),_:1})])):D("",!0),me.value.length>0?(u(),y("div",zs,[a(qe,{"current-page":B.value,"onUpdate:currentPage":e[3]||(e[3]=r=>B.value=r),"page-size":E.value,"onUpdate:pageSize":e[4]||(e[4]=r=>E.value=r),"page-sizes":[20,50,100],total:R.value,layout:"total, sizes, prev, pager, next",onSizeChange:nt,onCurrentChange:Be,background:""},null,8,["current-page","page-size","total"])])):D("",!0)]),fe.value?(u(),y("div",{key:1,class:"filter-overlay",onClick:e[9]||(e[9]=_t(r=>fe.value=!1,["self"]))},[a(Ve,{class:"filter-card"},{header:s(()=>[d("div",Ts,[e[19]||(e[19]=d("span",null,"筛选选项",-1)),a(g,{type:"danger",circle:"",onClick:e[5]||(e[5]=r=>fe.value=!1),plain:""},{default:s(()=>[...e[18]||(e[18]=[o("X",-1)])]),_:1})])]),default:s(()=>[d("div",Rs,[a(Xe,{"content-position":"left"},{default:s(()=>[...e[20]||(e[20]=[o("保存路径",-1)])]),_:1}),d("div",Bs,[a(je,{ref_key:"pathTreeRef",ref:pe,data:K.value,"show-checkbox":"","node-key":"path","default-expand-all":"","expand-on-click-node":!1,"check-on-click-node":"","check-strictly":!0,props:{class:"path-tree-node"}},null,8,["data"])]),a(Xe,{"content-position":"left"},{default:s(()=>[...e[21]||(e[21]=[o("删除状态",-1)])]),_:1}),a(ae,{modelValue:te.value.isDeleted,"onUpdate:modelValue":e[6]||(e[6]=r=>te.value.isDeleted=r),style:{width:"100%"}},{default:s(()=>[a(He,{label:""},{default:s(()=>[...e[22]||(e[22]=[o("全部",-1)])]),_:1}),a(He,{label:"0"},{default:s(()=>[...e[23]||(e[23]=[o("未删除",-1)])]),_:1}),a(He,{label:"1"},{default:s(()=>[...e[24]||(e[24]=[o("已删除",-1)])]),_:1})]),_:1},8,["modelValue"]),a(Xe,{"content-position":"left"},{default:s(()=>[...e[25]||(e[25]=[o("不存在种子筛选",-1)])]),_:1}),d("div",Is,[d("div",Fs,[Q.value?(u(),y("div",Vs,[a(O,{type:"info",size:"default",effect:"plain"},{default:s(()=>[o("已选择: "+f(Q.value),1)]),_:1}),a(g,{type:"danger",link:"",style:{padding:"0","margin-left":"8px"},onClick:et},{default:s(()=>[...e[26]||(e[26]=[o("清除",-1)])]),_:1})])):(u(),y("div",Ns,[a(O,{type:"info",size:"default",effect:"plain"},{default:s(()=>[...e[27]||(e[27]=[o("未选择",-1)])]),_:1})]))]),d("div",Ps,[a(ae,{modelValue:Q.value,"onUpdate:modelValue":e[7]||(e[7]=r=>Q.value=r),class:"target-sites-radio-group"},{default:s(()=>[(u(!0),y(we,null,De(Ae.value,r=>(u(),I(He,{key:r,label:r,class:"target-site-radio"},{default:s(()=>[o(f(r),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])])])]),d("div",As,[a(g,{onClick:e[8]||(e[8]=r=>fe.value=!1)},{default:s(()=>[...e[28]||(e[28]=[o("取消",-1)])]),_:1}),a(g,{type:"primary",onClick:it},{default:s(()=>[...e[29]||(e[29]=[o("确认",-1)])]),_:1})])]),_:1})])):D("",!0),d("div",Ms,[Ke((u(),I(yt,{data:me.value,border:"",style:{width:"100%"},"empty-text":"暂无转种数据","max-height":ze.value,height:"100%","row-class-name":pt,onSelectionChange:n,class:"glass-table"},{default:s(()=>[a(x,{type:"selection",width:"55",align:"center",selectable:Ue}),a(x,{prop:"torrent_id",label:"种子ID",align:"center",width:"80","show-overflow-tooltip":""}),a(x,{prop:"nickname",label:"站点名称",width:"100",align:"center"},{default:s(r=>[d("div",Os,f(r.row.nickname),1)]),_:1}),a(x,{prop:"title",label:"标题",align:"center"},{default:s(r=>[d("div",Ls,[d("div",{class:"subtitle-line",title:r.row.subtitle},f(r.row.subtitle||""),9,Es),d("div",{class:"main-title-line",title:r.row.title},f(r.row.title||""),9,Us)])]),_:1}),a(x,{prop:"type",label:"类型",width:"100",align:"center"},{default:s(r=>[d("div",{class:de(["mapped-cell",{"invalid-value":!U(r.row.type)||!J("type",r.row.type)}])},f(ie("type",r.row.type)),3)]),_:1}),a(x,{prop:"medium",label:"媒介",width:"100",align:"center"},{default:s(r=>[d("div",{class:de(["mapped-cell",{"invalid-value":!U(r.row.medium)||!J("medium",r.row.medium)}])},f(ie("medium",r.row.medium)),3)]),_:1}),a(x,{prop:"video_codec",label:"视频编码",width:"120",align:"center"},{default:s(r=>[d("div",{class:de(["mapped-cell",{"invalid-value":!U(r.row.video_codec)||!J("video_codec",r.row.video_codec)}])},f(ie("video_codec",r.row.video_codec)),3)]),_:1}),a(x,{prop:"audio_codec",label:"音频编码",width:"90",align:"center"},{default:s(r=>[d("div",{class:de(["mapped-cell",{"invalid-value":!U(r.row.audio_codec)||!J("audio_codec",r.row.audio_codec)}])},f(ie("audio_codec",r.row.audio_codec)),3)]),_:1}),a(x,{prop:"resolution",label:"分辨率",width:"90",align:"center"},{default:s(r=>[d("div",{class:de(["mapped-cell",{"invalid-value":!U(r.row.resolution)||!J("resolution",r.row.resolution)}])},f(ie("resolution",r.row.resolution)),3)]),_:1}),a(x,{prop:"team",label:"制作组",width:"120",align:"center"},{default:s(r=>[d("div",{class:de(["mapped-cell",{"invalid-value":!U(r.row.team)||!J("team",r.row.team)}])},f(ie("team",r.row.team)),3)]),_:1}),a(x,{prop:"source",label:"产地",width:"100",align:"center"},{default:s(r=>[d("div",{class:de(["mapped-cell",{"invalid-value":!U(r.row.source)||!J("source",r.row.source)}])},f(ie("source",r.row.source)),3)]),_:1}),a(x,{prop:"tags",label:"标签",align:"center",width:"170"},{default:s(r=>[d("div",Js,[(u(!0),y(we,null,De(tt(r.row.tags),(We,bt)=>(u(),I(O,{key:We,size:"small",type:st(r.row.tags,bt),class:de(at(r.row.tags,bt)),style:{margin:"2px"}},{default:s(()=>[o(f(We),1)]),_:2},1032,["type","class"]))),128))])]),_:1}),a(x,{prop:"unrecognized",label:"无法识别",width:"120",align:"center"},{default:s(r=>[d("div",{class:de(["mapped-cell",{"invalid-value":r.row.unrecognized}])},f(r.row.unrecognized||""),3)]),_:1}),a(x,{prop:"updated_at",label:"更新时间",width:"140",align:"center",sortable:""},{default:s(r=>[d("div",qs,f(r.row.is_deleted||Ie(r.row.tags)?"已删除/禁转":Te(r.row.updated_at)),1)]),_:1}),a(x,{label:"操作",width:"130",align:"center",fixed:"right"},{default:s(r=>[a(g,{size:"small",type:"primary",onClick:We=>Oe(r.row)},{default:s(()=>[...e[30]||(e[30]=[o("编辑",-1)])]),_:1},8,["onClick"]),a(g,{size:"small",type:"danger",onClick:We=>Le(r.row),style:{"margin-left":"5px"}},{default:s(()=>[...e[31]||(e[31]=[o("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data","max-height"])),[[wt,ee.value]])]),dt.value?(u(),y("div",Xs,[a(Ve,{class:"cross-seed-card",shadow:"always"},{header:s(()=>[d("div",js,[d("span",null,"转种 - "+f(ut.value),1),a(g,{type:"danger",circle:"",onClick:Ee,plain:""},{default:s(()=>[...e[32]||(e[32]=[o("X",-1)])]),_:1})])]),default:s(()=>[d("div",Hs,[a(qt,{"show-complete-button":!0,onComplete:ge,onCancel:Ee})])]),_:1})])):D("",!0),ue.value?(u(),y("div",Ws,[a(Ve,{class:"batch-cross-seed-card",shadow:"always"},{header:s(()=>[d("div",Ks,[e[34]||(e[34]=d("span",null,"批量转种",-1)),a(g,{type:"danger",circle:"",onClick:v,plain:""},{default:s(()=>[...e[33]||(e[33]=[o("X",-1)])]),_:1})])]),default:s(()=>[d("div",Gs,[d("div",Qs,[d("div",Ys,[d("p",null,[e[35]||(e[35]=d("strong",null,"目标站点：",-1)),o(f(C.value.excludeTargetSites),1)]),d("p",null,[e[36]||(e[36]=d("strong",null,"选中种子数量：",-1)),o(f(T.value.length)+" 个",1)]),e[37]||(e[37]=d("p",{style:{color:"#909399","font-size":"13px","margin-top":"10px"}}," 将把选中的种子转种到上述目标站点，请确认无误后点击确定。 ",-1))])])]),d("div",Zs,[a(g,{onClick:v},{default:s(()=>[...e[38]||(e[38]=[o("取消",-1)])]),_:1}),a(g,{type:"primary",onClick:h},{default:s(()=>[...e[39]||(e[39]=[o("确定",-1)])]),_:1})])]),_:1})])):D("",!0),ne.value?(u(),y("div",ea,[a(Ve,{class:"record-view-card",shadow:"always"},{header:s(()=>[d("div",ta,[d("span",null,"批量转种记录 "+f(oe.value?"(自动刷新中...)":""),1),e[44]||(e[44]=d("div",{class:"record-warning-text"},"批量转种需要等待种子文件验证，每个种子大概3s",-1)),d("div",sa,[a(g,{type:"danger",size:"small",onClick:Nt,disabled:ce.value},{default:s(()=>[o(f(ce.value?"停止中...":"停止转种"),1)]),_:1},8,["disabled"]),a(g,{type:"primary",size:"small",onClick:_e,loading:re.value},{default:s(()=>[...e[40]||(e[40]=[o(" 刷新 ",-1)])]),_:1},8,["loading"]),oe.value?(u(),I(g,{key:0,type:"warning",size:"small",onClick:X},{default:s(()=>[...e[41]||(e[41]=[o(" 停止自动刷新 ",-1)])]),_:1})):Fe.value?(u(),I(g,{key:1,type:"success",size:"small",onClick:ve},{default:s(()=>[...e[42]||(e[42]=[o(" 开启自动刷新 ",-1)])]),_:1})):D("",!0),a(g,{type:"danger",circle:"",onClick:j,plain:""},{default:s(()=>[...e[43]||(e[43]=[o("X",-1)])]),_:1})])])]),default:s(()=>[d("div",aa,[F.value.length>0?(u(),y("div",la,[Ke((u(),I(yt,{data:F.value,style:{width:"100%"},size:"small","element-loading-text":"加载记录中...",stripe:""},{default:s(()=>[a(x,{prop:"batch_id",label:"批次ID",width:"80",align:"center"},{default:s(r=>[a(O,{size:"small",type:$e(he(r.row.batch_id)),effect:"dark"},{default:s(()=>[o(f(he(r.row.batch_id)),1)]),_:2},1032,["type"])]),_:1}),a(x,{prop:"title",label:"种子标题","min-width":"250",align:"center","show-overflow-tooltip":""}),a(x,{prop:"source_site",label:"源站点",width:"80",align:"center"}),a(x,{prop:"target_site",label:"目标站点",width:"80",align:"center"}),a(x,{prop:"video_size_gb",label:"视频大小",width:"80",align:"center"},{default:s(r=>[r.row.video_size_gb?(u(),y("span",na,f(r.row.video_size_gb)+"GB",1)):(u(),y("span",ra,"-"))]),_:1}),a(x,{prop:"status",label:"状态",width:"80",align:"center"},{default:s(r=>[a(O,{type:Je(r.row.status),size:"small"},{default:s(()=>[o(f(m(r.row.status)),1)]),_:2},1032,["type"])]),_:1}),a(x,{prop:"progress",label:"进度",width:"100",align:"center"},{default:s(r=>[r.row.progress?(u(),y("div",oa,[a(Pt,{percentage:mt(r.row.progress),color:Vt(mt(r.row.progress)),"stroke-width":8,"show-text":!1,class:"progress-bar"},null,8,["percentage","color"]),d("span",ia,f(r.row.progress),1)])):(u(),y("span",da,"-"))]),_:1}),a(x,{prop:"error_detail",label:"详情",width:"110",align:"center","show-overflow-tooltip":""},{default:s(r=>[r.row.status==="success"&&r.row.success_url?(u(),y("span",ua,[a(At,{type:"primary",href:It(r.row.success_url),target:"_blank"},{default:s(()=>[...e[45]||(e[45]=[o("查看详情页",-1)])]),_:1},8,["href"])])):r.row.error_detail?(u(),y("span",ca,f(r.row.error_detail),1)):(u(),y("span",pa,"-"))]),_:1}),a(x,{prop:"downloader_add_result",label:"下载器状态",width:"150",align:"center"},{default:s(r=>[r.row.downloader_add_result?(u(),y(we,{key:0},[Rt(r.row.downloader_add_result)==="danger"?(u(),I(Mt,{key:0,effect:"dark",placement:"top"},{content:s(()=>[o(f(ht(r.row.downloader_add_result)),1)]),default:s(()=>[e[46]||(e[46]=d("span",{style:{color:"#f56c6c"}},"错误",-1))]),_:2},1024)):(u(),y("span",{key:1,style:Ut([{"text-align":"center"},{color:Bt(r.row.downloader_add_result)}])},f(ht(r.row.downloader_add_result)),5))],64)):(u(),y("span",fa,"-"))]),_:1}),a(x,{prop:"processed_at",label:"处理时间",width:"100",align:"center"},{default:s(r=>[d("div",ga,f(Ft(r.row.processed_at)),1)]),_:1})]),_:1},8,["data"])),[[wt,re.value]])])):D("",!0),F.value.length===0&&!re.value?(u(),y("div",va,[a(Ot,{description:"暂无批量转种记录"})])):D("",!0)]),d("div",_a,[a(g,{onClick:ft,type:"warning"},{default:s(()=>[...e[47]||(e[47]=[o("清空记录",-1)])]),_:1}),a(g,{onClick:j},{default:s(()=>[...e[48]||(e[48]=[o("关闭",-1)])]),_:1})])]),_:1})])):D("",!0),ye.value?(u(),y("div",ha,[a(Ve,{class:"batch-fetch-main-card",shadow:"always"},{header:s(()=>[d("div",ma,[e[50]||(e[50]=d("span",null,"批量获取种子数据",-1)),a(g,{type:"danger",circle:"",onClick:z,plain:""},{default:s(()=>[...e[49]||(e[49]=[o("X",-1)])]),_:1})])]),default:s(()=>[d("div",ya,[a(xs,{onCancel:z,onFetchCompleted:P})])]),_:1})])):D("",!0)])}}}),xa=zt(ba,[["__scopeId","data-v-13725d15"]]);export{xa as default};
