import{C as qt,d as at,p as T,r as _,c as v,j as I,b as n,e as D,w as l,h as s,x as ne,D as Kt,t as c,G as Ht,H as Xt,I as Gt,J as Qt,K as Zt,F as K,k as te,i as r,n as se,g as p,l as R,L as ee,M as es,m as lt,N as et,s as ts,o as ss,f as Y,O as as,u as Ae,v as ls,P as ns,z as C,Q as os,q as is,B as rs}from"./index-Bw59G8V8.js";import{u as ds,C as us}from"./CrossSeedPanel-BMT-yxLA.js";const nt=qt("siteData",{state:()=>({dialogVisible:!1,currentTorrent:null,downloadersMap:new Map,allDownloaders:[]}),actions:{openDialog(oe,ie){this.currentTorrent=oe,this.dialogVisible=!0,this.allDownloaders=ie||[],this.downloadersMap.clear(),ie&&ie.forEach(re=>{this.downloadersMap.set(re.id,re.name)})},closeDialog(){this.dialogVisible=!1,this.currentTorrent=null,this.downloadersMap.clear(),this.allDownloaders=[]},setCurrentTorrent(oe){this.currentTorrent=oe},getDownloaderName(oe){return this.downloadersMap.get(oe)||"未知下载器"},getAllDownloaders(){return this.allDownloaders}}}),cs={key:0,class:"modal-overlay"},ps={class:"modal-header"},fs={key:0,class:"site-data-content"},vs={class:"torrent-info"},ms={class:"torrent-name"},_s={class:"name-text"},gs={class:"torrent-stats"},hs={class:"stat-item stat-item--fixed"},ys={class:"stat-value"},ws={class:"stat-item stat-item--fixed"},xs={class:"stat-value"},ks={class:"stat-item stat-item--path"},Ss=["title"],bs={class:"stat-item stat-item--fixed"},$s={class:"stat-value"},Cs={class:"stat-item stat-item--fixed"},Is={class:"stat-value"},Ds={class:"content-area"},Ns={class:"sites-container"},zs={key:0,class:"sites-grid"},Ts=["onClick"],Us={class:"site-tile"},Vs={class:"site-content"},Es={class:"site-name-wrapper"},Ms={class:"site-name-with-link"},Rs={class:"site-name-text"},Bs={class:"seeders-info"},Ps={class:"right-panel"},Os={class:"downloaders-section"},Ls={class:"downloaders-list"},As=["onClick"],Fs={class:"flow-section"},js={class:"flow-cards"},Ys={class:"flow-card"},Js={class:"card-content"},Ws={key:0,class:"empty-state"},qs={key:1,class:"site-info"},Ks={class:"site-name"},Hs={class:"flow-card"},Xs={class:"card-content"},Gs={class:"downloader-info current"},Qs={class:"flow-card"},Zs={class:"card-content"},ea={class:"progress-section"},ta={class:"progress-bar-container"},sa={class:"progress-percentage"},aa={class:"progress-steps-info"},la={key:0,class:"current-status"},na={class:"modal-footer"},oa=at({__name:"SiteDataViewer",props:{torrent:{}},emits:["refresh"],setup(oe,{emit:ie}){const re=ie,P=nt(),he=T(()=>P.dialogVisible),f=T(()=>P.currentTorrent),U=_(null),B=_(null),J=T(()=>!f.value||!f.value.sites?[]:Object.entries(f.value.sites).map(([d,u])=>({siteName:d,...u})).sort((d,u)=>(u.seeders||0)-(d.seeders||0))),F=()=>{b(),P.closeDialog()},y=d=>{if(d==null||d<=0)return"0 B";const u=["B","KB","MB","GB","TB","PB"],$=Math.floor(Math.log(d)/Math.log(1024));return`${(d/Math.pow(1024,$)).toFixed(2)} ${u[$]}`},g=d=>!!(d&&(d.startsWith("http")||/^\d+$/.test(d))),j=d=>(d.startsWith("http"),d),be=d=>d.downloaderIds&&d.downloaderIds.length>0?d.downloaderIds.length===1?P.getDownloaderName(d.downloaderIds[0]):`${P.getDownloaderName(d.downloaderIds[0])} +${d.downloaderIds.length-1}`:d.downloaderId?P.getDownloaderName(d.downloaderId):"未知",ae=d=>{U.value=d},W=d=>U.value===d,O=T(()=>{if(!U.value||!f.value||!f.value.sites)return null;const d=f.value.sites[U.value];return{siteName:U.value,seeders:d?.seeders||0,state:d?.state||"未知"}}),pe=d=>{B.value=d},ze=T(()=>P.getAllDownloaders()),$e=T(()=>{if(!f.value)return null;const d=f.value.downloaderIds||[],u=f.value.downloaderId;return d.length>0?{id:d[0],name:P.getDownloaderName(d[0])}:u?{id:u,name:P.getDownloaderName(u)}:null}),N=_(0),ye=T(()=>{switch(N.value){case 0:return 0;case 1:return 33;case 2:return 66;case 3:return 100;default:return 0}}),Ce=T(()=>{if(N.value!==0&&N.value===3)return"success"}),fe=d=>({"step-info--pending":N.value<d,"step-info--active":N.value===d,"step-info--completed":N.value>d}),ve=()=>{switch(N.value){case 1:return"正在暂停种子...";case 2:return"正在导出种子文件并添加...";case 3:return"转种完成！";default:return""}},b=()=>{N.value=0},Ie=async()=>{if(!U.value||!B.value||!f.value)return;const d=f.value.downloaderId||(f.value.downloaderIds&&f.value.downloaderIds.length>0?f.value.downloaderIds[0]:null);if(!d){alert("无法获取当前下载器信息");return}b();try{N.value=1;const $=await(await fetch("/api/torrent/transfer/prepare",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({source_downloader_id:d,target_downloader_id:B.value,site_name:U.value,torrent_name:f.value.name,torrent_size:f.value.size,save_path:f.value.save_path})})).json();if(!$.success){if($.suggestions&&$.suggestions.length>0){const ue=$.suggestions.map((S,E)=>`${E+1}. ${S.name}
   站点: ${S.sites}
   大小: ${(S.size/1073741824).toFixed(2)} GB
   路径: ${S.save_path}`).join(`

`);if(confirm(`准备转移失败: ${$.message}

找到 ${$.suggestion_count} 个相似的种子:

${ue}

是否要使用第一个相似种子继续转移？`)&&$.suggestions.length>0){const S=$.suggestions[0];f.value&&(f.value.sites={[S.sites]:f.value.sites[U.value]||{}}),await de(S)}else b()}else alert(`准备转移失败: ${$.message}`),b();return}console.log(`找到 ${$.found_count} 个匹配的种子`),N.value=2;const w=await(await fetch("/api/torrent/transfer/execute",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({source_downloader_id:d,target_downloader_id:B.value,site_name:U.value,torrent_name:f.value.name,torrent_size:f.value.size,save_path:f.value.save_path})})).json();if(!w.success){alert(`转移失败: ${w.message}`),b();return}N.value=3,console.log("转移完成:",w);const G=w.method==="torrent_file"?"种子文件":"未知方式";console.log(`转移方式: ${G}`),re("refresh")}catch(u){console.error("转移过程中发生错误:",u),alert(`转移过程中发生错误: ${u?.message||"未知错误"}`),b()}},de=async d=>{if(!B.value||!f.value)return;const u=f.value.downloaderId||(f.value.downloaderIds&&f.value.downloaderIds.length>0?f.value.downloaderIds[0]:null);if(!u){alert("无法获取当前下载器信息"),b();return}try{console.log("使用相似种子重试转移:",d),N.value=2;const V=await(await fetch("/api/torrent/transfer/execute",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({source_downloader_id:u,target_downloader_id:B.value,site_name:d.sites,torrent_name:d.name,torrent_size:d.size,save_path:d.save_path})})).json();if(!V.success){alert(`转移失败: ${V.message}`),b();return}N.value=3,console.log("转移完成:",V);const w=V.method==="torrent_file"?"种子文件":"未知方式";console.log(`转移方式: ${w}`),re("refresh")}catch($){console.error("重试转移过程中发生错误:",$),alert(`重试转移过程中发生错误: ${$?.message||"未知错误"}`),b()}};return(d,u)=>{const $=D("el-button"),V=D("el-icon"),w=D("el-link"),G=D("el-tag"),ue=D("el-progress"),q=D("el-card");return he.value?(p(),v("div",cs,[n(q,{class:"site-data-card",shadow:"always"},{header:l(()=>[s("div",ps,[s("span",null,"站点数据查看 - "+c(f.value?.name),1),n($,{type:"danger",circle:"",onClick:F,plain:""},{default:l(()=>[...u[1]||(u[1]=[r("X",-1)])]),_:1})])]),default:l(()=>[f.value?(p(),v("div",fs,[s("div",vs,[s("div",ms,[n(V,{class:"torrent-icon"},{default:l(()=>[n(ne(Kt))]),_:1}),s("span",_s,c(f.value.name),1)]),s("div",gs,[s("div",hs,[n(V,{class:"stat-icon"},{default:l(()=>[n(ne(Ht))]),_:1}),u[2]||(u[2]=s("span",{class:"stat-label"},"大小",-1)),s("span",ys,c(y(f.value.size)),1)]),s("div",ws,[n(V,{class:"stat-icon"},{default:l(()=>[n(ne(Xt))]),_:1}),u[3]||(u[3]=s("span",{class:"stat-label"},"上传",-1)),s("span",xs,c(f.value.total_uploaded_formatted||y(f.value.total_uploaded)),1)]),s("div",ks,[n(V,{class:"stat-icon"},{default:l(()=>[n(ne(Gt))]),_:1}),u[4]||(u[4]=s("span",{class:"stat-label"},"路径",-1)),s("span",{class:"stat-value",title:f.value.save_path},c(f.value.save_path),9,Ss)]),s("div",bs,[n(V,{class:"stat-icon"},{default:l(()=>[n(ne(Qt))]),_:1}),u[5]||(u[5]=s("span",{class:"stat-label"},"下载器",-1)),s("span",$s,c(be(f.value)),1)]),s("div",Cs,[n(V,{class:"stat-icon"},{default:l(()=>[n(ne(Zt))]),_:1}),u[6]||(u[6]=s("span",{class:"stat-label"},"可转种",-1)),s("span",Is,c(f.value.target_sites_count||0)+"个",1)])])]),s("div",Ds,[s("div",Ns,[J.value.length>0?(p(),v("div",zs,[(p(!0),v(K,null,te(J.value,S=>(p(),v("div",{key:S.siteName,class:se(["site-card",{"site-card--selected":W(S.siteName)}]),onClick:E=>ae(S.siteName)},[s("div",Us,[s("div",Vs,[s("div",Es,[s("div",Ms,[s("span",Rs,c(S.siteName),1),g(S.comment)?(p(),R(w,{key:0,href:j(S.comment),target:"_blank",underline:!1,class:"site-link-icon",onClick:u[0]||(u[0]=ee(()=>{},["stop"]))},{default:l(()=>[n(V,{size:"10"},{default:l(()=>[n(ne(es))]),_:1})]),_:1},8,["href"])):I("",!0)])]),s("div",Bs,[n(G,{type:S.seeders>0?"warning":"info",size:"small"},{default:l(()=>[r(c(S.seeders||0)+"人做种 ",1)]),_:2},1032,["type"])])])])],10,Ts))),128))])):I("",!0)]),s("div",Ps,[s("div",Os,[u[7]||(u[7]=s("div",{class:"section-title"},"下载器",-1)),s("div",Ls,[(p(!0),v(K,null,te(ze.value,S=>(p(),v("div",{key:S.id,class:se(["downloader-item",{"downloader-item--selected":B.value===S.id}]),onClick:E=>pe(S.id)},c(S.name),11,As))),128))])]),s("div",Fs,[s("div",js,[s("div",Ys,[u[8]||(u[8]=s("div",{class:"card-title"},"选中站点",-1)),s("div",Js,[O.value?(p(),v("div",qs,[s("div",Ks,c(O.value.siteName),1),n(G,{type:O.value.seeders>0?"warning":"info",size:"small"},{default:l(()=>[r(c(O.value.seeders)+"人做种 ",1)]),_:1},8,["type"])])):(p(),v("div",Ws,"未选择"))])]),u[11]||(u[11]=s("div",{class:"flow-divider"},[s("span",null,"→")],-1)),s("div",Hs,[u[9]||(u[9]=s("div",{class:"card-title"},"当前下载器",-1)),s("div",Xs,[s("div",Gs,c($e.value?.name||"未知"),1)])]),u[12]||(u[12]=s("div",{class:"flow-divider"},[s("span",null,"→")],-1)),s("div",Qs,[u[10]||(u[10]=s("div",{class:"card-title"},"目标下载器",-1)),s("div",Zs,[s("div",{class:se(["downloader-info target",{selected:B.value}])},c(B.value?ne(P).getDownloaderName(B.value):"未选择"),3)])])])]),s("div",ea,[u[16]||(u[16]=s("div",{class:"progress-title"},"转种流程",-1)),s("div",ta,[n(ue,{percentage:ye.value,status:Ce.value,"stroke-width":8,"show-text":!0},{default:l(({percentage:S})=>[s("span",sa,c(S)+"%",1)]),_:1},8,["percentage","status"]),s("div",aa,[s("div",{class:se(["step-info",fe(1)])},[...u[13]||(u[13]=[s("div",{class:"step-indicator"},null,-1),s("div",{class:"step-details"},[s("div",{class:"step-name"},"暂停种子"),s("div",{class:"step-desc"},"暂停下载器中选择的站点种子")],-1)])],2),s("div",{class:se(["step-info",fe(2)])},[...u[14]||(u[14]=[s("div",{class:"step-indicator"},null,-1),s("div",{class:"step-details"},[s("div",{class:"step-name"},"导出种子"),s("div",{class:"step-desc"},"导出种子文件并添加到目标下载器")],-1)])],2),s("div",{class:se(["step-info",fe(3)])},[...u[15]||(u[15]=[s("div",{class:"step-indicator"},null,-1),s("div",{class:"step-details"},[s("div",{class:"step-name"},"转移完成"),s("div",{class:"step-desc"},"种子已成功转移到目标下载器")],-1)])],2)]),N.value>0&&N.value<=3?(p(),v("div",la,c(ve()),1)):I("",!0)])])])])])):I("",!0),s("div",na,[n($,{type:"success",onClick:Ie,disabled:!U.value||!B.value||N.value>0},{default:l(()=>[...u[17]||(u[17]=[r(" 执行转种 ",-1)])]),_:1},8,["disabled"]),n($,{type:"primary",onClick:F},{default:l(()=>[...u[18]||(u[18]=[r("关闭",-1)])]),_:1})])]),_:1})])):I("",!0)}}}),ia=lt(oa,[["__scopeId","data-v-6ee24ce4"]]),ra={class:"torrents-view"},da={class:"expand-content"},ua=["onClick"],ca=["href"],pa=["onClick"],fa={class:"name-header-container"},va={key:0,class:"current-filters",style:{"margin-right":"15px",display:"flex","align-items":"center"}},ma={style:{"white-space":"normal"}},_a={style:{display:"inline-block",width:"100%","text-align":"center"}},ga=["title"],ha={style:{display:"flex","justify-content":"center","align-items":"center",width:"100%",height:"100%"}},ya={key:0},wa={style:{padding:"1px 0",width:"100%"}},xa={style:{"text-align":"center","font-size":"12px","margin-top":"5px","line-height":"1"}},ka={style:{display:"flex","justify-content":"center","align-items":"center",width:"100%",height:"100%"}},Sa={style:{display:"flex","justify-content":"center","align-items":"center",width:"100%",height:"100%"}},ba={key:0},$a={key:1},Ca={style:{display:"flex","justify-content":"center","align-items":"center",width:"100%",height:"100%"}},Ia={key:3,class:"modal-overlay"},Da={class:"modal-header"},Na={key:0,class:"cross-seed-content"},za={class:"filter-card-header"},Ta={class:"filter-card-body"},Ua={class:"site-filter-container"},Va={style:{display:"flex","align-items":"center",gap:"15px","margin-bottom":"5px"}},Ea={style:{display:"flex","align-items":"center",gap:"10px"}},Ma={key:0,style:{display:"flex","align-items":"center"}},Ra={key:1,style:{display:"flex","align-items":"center"}},Ba={class:"site-checkbox-container"},Pa={style:{"margin-bottom":"10px"}},Oa={key:0,style:{display:"flex","align-items":"center"}},La={style:{"margin-bottom":"10px"}},Aa={key:0,style:{display:"flex","align-items":"center"}},Fa={class:"path-tree-container"},ja={style:{"margin-bottom":"10px"}},Ya={key:0,style:{display:"flex","align-items":"center"}},Ja={class:"filter-card-footer"},Wa={class:"filter-card-header"},qa={class:"site-operation-body"},Ka={class:"torrent-name-container"},Ha={class:"torrent-name"},Xa={key:0,class:"site-operation-link"},Ga={key:1,class:"site-operation-input"},Qa={class:"site-operation-buttons"},Za={key:6,class:"filter-overlay"},el={class:"filter-card-header"},tl={class:"source-site-selection-body"},sl={class:"source-site-tip"},al={key:0,class:"cached-sites-section"},ll={class:"cached-sites-label"},nl={class:"site-list-box glass-site-box cached-sites-box"},ol={key:1,class:"uncached-sites-section"},il={class:"site-list-box glass-site-box"},rl={class:"filter-card-footer"},dl={class:"filter-card-header"},ul={class:"filter-card-body"},cl={style:{color:"#606266","margin-bottom":"10px"}},pl={class:"filter-card-footer"},fl=220,vl=90,tt=30,Se=200,ml=2e3,st="torrents_view_first_load",_l=at({__name:"TorrentsView",emits:["ready"],setup(oe,{emit:ie}){const re=ie,P=_(null),he=_(!0),f=_([]),U=_(null),B=_(!1),J=_(""),F=_({prop:"name",order:"ascending"}),y=et({paths:[],states:[],existSiteNames:[],notExistSiteNames:[],downloaderIds:[]}),g=et({...y}),j=_("exist"),be=T({get:()=>j.value==="exist"?g.existSiteNames:g.notExistSiteNames,set:t=>{j.value==="exist"?g.existSiteNames=t:g.notExistSiteNames=t}}),ae=_(!1),W=_(1),O=_(50),pe=_(0),ze=_([]),$e=_([]),N=_([]),ye=_({}),Ce=_([]),fe=_([]),ve=_([]),b=_(null),Ie=_([]),de=_(!1),d=_([]),u=_(!1),$=_(!1),V=_(null),w=_(null),G=_(null),ue=_(!1),q=_([]),S=_(!1),E=ds(),ot=nt(),it=T(()=>!!E.taskId),L=T(()=>E.workingParams);T(()=>E.sourceInfo?.name||"");const ce=_(!1),me=_(""),z=_(null),Q=_(""),De=_({}),Te=T(()=>{const t=new Intl.Collator("zh-CN",{numeric:!0});return[...N.value].sort(t.compare)}),_e=_(""),Fe=T(()=>{if(!_e.value)return Te.value;const t=_e.value.toLowerCase();return Te.value.filter(e=>e.toLowerCase().includes(t))}),rt=t=>{let e=0;for(const o of t)e+=o.charCodeAt(0)>255?14:8;return e},dt=T(()=>{const t=f.value||[];let e=0;for(const i of t){const h=String(i?.save_path||""),x=Xe(h,tt)||"";e=Math.max(e,rt(x))}const o=e+40;return Math.min(fl,Math.max(vl,Math.round(o)))}),ut=T(()=>{const t=y,e=[];return t.paths&&t.paths.length>0&&e.push(`路径: ${t.paths.length}`),t.states&&t.states.length>0&&e.push(`状态: ${t.states.length}`),t.existSiteNames&&t.existSiteNames.length>0&&e.push(`存在于: ${t.existSiteNames.length}`),t.notExistSiteNames&&t.notExistSiteNames.length>0&&e.push(`不存在于: ${t.notExistSiteNames.length}`),t.downloaderIds&&t.downloaderIds.length>0&&e.push(`下载器: ${t.downloaderIds.length}`),e.join(", ")}),ct=T(()=>{const t=y;return t.paths&&t.paths.length>0||t.states&&t.states.length>0||t.existSiteNames&&t.existSiteNames.length>0||t.notExistSiteNames&&t.notExistSiteNames.length>0||t.downloaderIds&&t.downloaderIds.length>0});T(()=>{const t=Fe.value;return j.value==="exist"?t.filter(e=>!g.notExistSiteNames.includes(e)):t.filter(e=>!g.existSiteNames.includes(e))});const je=t=>j.value==="exist"?!g.notExistSiteNames.includes(t):!g.existSiteNames.includes(t),pt=[{color:"#f56c6c",percentage:80},{color:"#e6a23c",percentage:99},{color:"#67c23a",percentage:100}],we=async()=>{try{const t={page_size:O.value,sort_prop:F.value.prop,sort_order:F.value.order,name_search:J.value,active_filters:y};await Y.post("/api/ui_settings",t)}catch(t){console.error("无法保存UI设置:",t.message)}},ft=async()=>{try{const e=(await Y.get("/api/ui_settings")).data;if(O.value=e.page_size??50,F.value={prop:e.sort_prop||"name",order:"sort_order"in e?e.sort_order:"ascending"},J.value=e.name_search??"",e.active_filters){Object.assign(y,e.active_filters),y.existSiteNames||(y.existSiteNames=[]),y.notExistSiteNames||(y.notExistSiteNames=[]);const o=y;o.siteExistence&&delete o.siteExistence,o.siteNames&&delete o.siteNames}}catch(t){console.error("加载UI设置时出错:",t)}finally{B.value=!0}},vt=t=>{const e=[],o=new Map;return t.sort().forEach(i=>{const h=i.replace(/^\/|\/$/g,"").split("/");let x="",m=e;h.forEach((le,H)=>{if(x=H===0?`/${le}`:`${x}/${le}`,!o.has(x)){const A={path:H===h.length-1?i:x,label:le,children:[]};o.set(x,A),m.push(A)}m=o.get(x).children})}),o.forEach(i=>{i.children&&i.children.length===0&&delete i.children}),e},mt=async()=>{try{const e=(await Y.get("/api/all_downloaders")).data;fe.value=e.filter(o=>o.enabled),ve.value=e}catch(t){U.value=t.message}},_t=async()=>{try{const e=(await Y.get("/api/sites/status")).data;d.value=e.filter(o=>o.is_source)}catch(t){U.value=t.message}},M=async()=>{he.value=!0,U.value=null;try{const t=new URLSearchParams({page:W.value.toString(),pageSize:O.value.toString(),nameSearch:J.value,sortProp:F.value.prop||"name",sortOrder:F.value.order||"ascending",existSiteNames:JSON.stringify(y.existSiteNames),notExistSiteNames:JSON.stringify(y.notExistSiteNames),path_filters:JSON.stringify(y.paths||[]),state_filters:JSON.stringify(y.states),downloader_filters:JSON.stringify(y.downloaderIds)}),o=(await Y.get(`/api/data?${t.toString()}`)).data;if(o.error)throw new Error(o.error);f.value=o.data,pe.value=o.total,O.value!==o.pageSize&&(O.value=o.pageSize),ze.value=o.unique_paths,$e.value=o.unique_states,N.value=o.all_discovered_sites,ye.value=o.site_link_rules,y.paths=o.active_path_filters,Ie.value=vt(o.unique_paths)}catch(t){U.value=t.message}finally{he.value=!1}},gt=async t=>{E.reset();const e=Object.entries(t.sites).map(([o,i])=>({siteName:o,...i})).filter(o=>{if(!(o.migration===1||o.migration===3))return!1;const h=o.comment&&o.comment.includes("details.php?id="),x=o.comment&&/^\d+$/.test(o.comment.trim());return h||x});E.setParams(t),await wt(t),e.length===0&&C.warning("该种子暂无可用的源站点，您可以使用 IYUU 查询来发现更多站点。"),de.value=!0},ht=t=>{ot.openDialog(t,ve.value)},yt=()=>{console.log("触发种子数据刷新"),M()},wt=async t=>{S.value=!0,q.value=[];try{const o=(await Y.get(`/api/cached_sites?name=${encodeURIComponent(t.name)}&size=${t.size}`)).data;o.success?(q.value=o.cached_sites||[],console.log("缓存站点查询结果:",q.value)):console.warn("查询缓存站点失败:",o.error)}catch(e){console.error("查询缓存站点时出错:",e)}finally{S.value=!1}},Ye=async t=>{const e=L.value;if(!e||!t){C.error("发生内部错误：未找到选中的种子或站点信息。");return}const o=e.sites[t.siteName],i=t.siteName;if(!o){C.error(`未找到站点 [${i}] 的数据。`);return}if(!xe(o,i)){C.info(`站点 [${i}] 缺少详情链接，正在触发 IYUU 查询...`),De.value[i]=!0,await He(),De.value[i]=!1;return}let h=null;const x=o?.comment?.match(/id=(\d+)/);if(x&&x[1])h=x[1];else if(o?.comment&&/^\d+$/.test(o.comment.trim()))h=o.comment.trim();else{C.error(`无法从源站点 ${i} 的详情页链接中提取种子ID。请尝试使用IYUU查询更新链接。`);return}o&&(o.torrentId=h);const m=d.value.find(H=>H.name===i)?.site||i.toLowerCase();C.success(`准备从站点 [${i}] 开始迁移种子...`);const le={name:i,site:m,torrentId:h};E.setSourceInfo(le),E.setTaskId(e.name+"_"+Date.now()),de.value=!1},ge=t=>{if(!!!(L.value&&L.value.sites[t]))return!1;const o=d.value.find(i=>i.name===t);return!o||!o.has_cookie?!1:t==="杜比"||t==="HDtime"||t==="肉丝"?!!o.has_passkey:!0},Je=()=>{E.reset()},We=(t,e)=>{me.value=t,z.value=e,Q.value="",ce.value=!0},qe=async()=>{if(!me.value||!z.value){C.error("缺少必要的参数");return}if(!Q.value||Q.value.trim()===""){C.error("请输入详情页链接或ID");return}try{const e=(await Y.post("/api/sites/update_comment",{torrent_name:me.value,site_name:z.value.name,comment:Q.value.trim()})).data;e.success?(C.success("详情页链接已成功添加"),ce.value=!1,Q.value="",await M()):C.error(e.error||"添加详情页链接失败")}catch(t){console.error("添加详情页链接时出错:",t),C.error("添加详情页链接时发生网络错误")}},xt=async()=>{if(!me.value||!z.value){C.error("缺少必要的参数");return}try{const t=await Y.post("/api/sites/set_not_exist",{torrent_name:me.value,site_name:z.value.name});C.success("站点状态已成功设置为不存在"),ce.value=!1,M()}catch(t){console.error("设置站点状态时出错:",t),C.error(t.response?.data?.error||"设置站点状态时发生错误")}},kt=()=>{C.success("转种操作已完成！"),E.reset(),M()},St=()=>{C.success("转种操作已完成！"),E.reset(),M()},Ke=t=>{if(!L.value)return null;const e=L.value.sites[t];return e?{siteName:t,...e}:null},Ne=()=>{G.value&&(clearInterval(G.value),G.value=null)},Ue=async()=>{if(V.value)try{const t=await Y.get(`/api/iyuu_query_batch_progress?task_id=${encodeURIComponent(V.value)}`);if(t.data?.success){if(w.value=t.data.task,w.value&&!w.value.isRunning&&(Ne(),!ue.value))if(ue.value=!0,w.value.success){C.success(w.value.message||"IYUU批量查询已完成"),await M();const e=L.value;if(e){const o=f.value.find(i=>i.name===e.name&&i.size===e.size);o&&E.setParams(o)}}else C.error(w.value.message||"IYUU批量查询失败")}else C.error(t.data?.message||"获取IYUU批量查询进度失败")}catch(t){C.error(t.response?.data?.message||"获取IYUU批量查询进度时发生网络错误")}},bt=()=>{Ne(),Ue(),G.value=setInterval(async()=>{await Ue()},ml)},Ve=()=>{$.value=!1,Ne()},He=async()=>{const t=L.value,e=pe.value||0;if(e<=0){C.warning("当前筛选条件下无可查询的种子");return}const o=Math.min(e,Se);try{await os.confirm(`将对当前筛选结果的前 ${o} 个种子组执行 IYUU 查询（当前筛选共 ${e} 个）。继续？`,"IYUU 批量查询",{confirmButtonText:"开始查询",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1})}catch{return}u.value=!0;try{const i=new URLSearchParams({page:"1",pageSize:o.toString(),nameSearch:J.value,sortProp:F.value.prop||"name",sortOrder:F.value.order||"ascending",existSiteNames:JSON.stringify(y.existSiteNames),notExistSiteNames:JSON.stringify(y.notExistSiteNames),path_filters:JSON.stringify(y.paths||[]),state_filters:JSON.stringify(y.states),downloader_filters:JSON.stringify(y.downloaderIds)}),x=(await Y.get(`/api/data?${i.toString()}`)).data;if(x.error)throw new Error(x.error);const m=(x.data||[]).slice(0,Se).map(X=>({name:X.name,size:X.size,save_path:X.save_path})).filter(X=>X.name&&X.size);if(t&&t.name&&t.size&&!m.some(A=>A.name===t.name&&A.size===t.size)){const A={name:t.name,size:t.size,save_path:t.save_path};m.length>=Se&&m.pop(),m.unshift(A)}if(m.length===0){C.warning("当前筛选结果中未找到可查询的种子组");return}(x.total||0)>Se&&C.info(`筛选结果共 ${x.total} 个，本次仅查询前 ${m.length} 个`);const H=(await Y.post("/api/iyuu_query_batch",{torrents:m,max_groups:Se,force_query:!0})).data;if(!H?.success){C.error(H?.message||"启动批量IYUU查询失败");return}V.value=H.task_id,w.value=null,ue.value=!1,$.value=!0,bt()}catch(i){console.error("触发筛选结果 IYUU 批量查询时出错:",i),C.error(i.response?.data?.message||i.message||"触发IYUU批量查询失败")}finally{u.value=!1}};ts(()=>{Ne()});const $t=t=>{O.value=t,W.value=1,M(),we()},Ct=t=>{W.value=t,M()},It=t=>{F.value=t,W.value=1,M(),we()},Dt=()=>{Object.assign(g,y),ae.value=!0,is(()=>{b.value&&b.value.setCheckedKeys(y.paths,!1)})},Nt=async()=>{if(b.value){const t=b.value.getCheckedKeys(!1);g.paths=t}Object.assign(y,g),ae.value=!1,W.value=1,await M(),we()},zt=()=>{g.paths=[],g.states=[],g.existSiteNames=[],g.notExistSiteNames=[],g.downloaderIds=[],j.value="exist",_e.value="",b.value&&b.value.setCheckedKeys([],!1)},Tt=()=>{if(g.existSiteNames=[],j.value==="exist"&&b.value){const t=b.value.getCheckedKeys(!0);g.paths=t}},Ut=()=>{if(g.notExistSiteNames=[],j.value==="not-exist"&&b.value){const t=b.value.getCheckedKeys(!0);g.paths=t}},Vt=()=>{g.paths=[],b.value&&b.value.setCheckedKeys([],!1)},Et=()=>{g.states=[]},Mt=()=>{g.downloaderIds=[]},Rt=async()=>{y.paths=[],y.states=[],y.existSiteNames=[],y.notExistSiteNames=[],y.downloaderIds=[],J.value="",j.value="exist",_e.value="",b.value&&b.value.setCheckedKeys([],!1),W.value=1,await M(),we()},Ee=t=>{if(t==null||t<=0)return"0 B";const e=["B","KB","MB","GB","TB","PB"],o=Math.floor(Math.log(t)/Math.log(1024));return`${(t/Math.pow(1024,o)).toFixed(2)} ${e[o]}`},xe=(t,e)=>{const{comment:o}=t;return!!(o&&(o.startsWith("http")||/^\d+$/.test(o)&&ye.value[e]))},Me=(t,e)=>{const{comment:o}=t;if(o.startsWith("http"))return o;const i=ye.value[e];return i&&/^\d+$/.test(o)?`${(i.base_url.startsWith("http")?i.base_url:`https://${i.base_url}`).replace(/\/$/,"")}/details.php?id=${o}`:null},Re=t=>t.state==="未做种"?"danger":t.state==="不存在"?"info":t.comment?"success":t.state==="做种中"?"primary":"info",Be=t=>{if(!t)return"未知下载器";const e=ve.value.find(o=>o.id===t);return e?e.name:"未知下载器"},Bt=t=>{if(!t||!ve.value.find(h=>h.id===t))return"info";let o=0;for(let h=0;h<t.length;h++)o=t.charCodeAt(h)+((o<<5)-o);const i=["primary","success","warning","danger","info"];return i[Math.abs(o)%i.length]},Pt=t=>[...t].sort((o,i)=>{const h=Be(o),x=Be(i);return h.localeCompare(x,"zh-CN")}),Xe=(t,e=50)=>{if(!t||t.length<=e)return t;const o=Math.floor((e-3)/2);let i=t.substring(0,o),h=t.substring(t.length-o);const x=i.lastIndexOf("/"),m=h.indexOf("/");return x>0&&m>=0&&(i=i.substring(0,x),h=h.substring(m+1)),`${i}...${h}`},Ge=(t,e)=>{if(!!!(L.value&&L.value.sites[t.name]))return"info";const i=L.value.sites[t.name];return!t.has_cookie||(t.name==="杜比"||t.name==="肉丝")&&!t.has_passkey?"error":t.has_cookie&&i.comment?"success":"primary"},Ot=t=>t.includes("下载")?"primary":t.includes("做种")?"success":t.includes("暂停")?"warning":t.includes("错误")||t.includes("丢失")?"danger":"info",Lt=t=>P.value?.toggleRowExpansion(t),At=(t,e)=>{Ce.value=e.map(o=>o.unique_id)},Ft=({row:t})=>Ce.value.includes(t.unique_id)?"expanded-row":"";return ss(async()=>{const t=!sessionStorage.getItem(st);if(await ft(),M(),t){try{console.log("首次加载页面，触发种子数据刷新..."),await Y.post("/api/refresh_data"),console.log("种子数据刷新完成，重新获取数据..."),await M()}catch(e){console.warn("页面加载时种子数据刷新失败:",e)}sessionStorage.setItem(st,"loaded")}else console.log("页面已加载过，跳过种子数据刷新");mt(),_t(),re("ready",M)}),as(J,()=>{W.value=1,M(),we()}),(t,e)=>{const o=D("el-alert"),i=D("el-tag"),h=D("el-table-column"),x=D("el-input"),m=D("el-button"),le=D("el-progress"),H=D("el-table"),X=D("el-pagination"),A=D("el-card"),ke=D("el-divider"),Qe=D("el-radio-button"),jt=D("el-radio-group"),Pe=D("el-checkbox"),Oe=D("el-checkbox-group"),Yt=D("el-tree"),Jt=D("el-link"),Z=D("el-descriptions-item"),Ze=D("el-descriptions"),Le=ls("loading");return p(),v("div",ra,[U.value?(p(),R(o,{key:0,title:U.value,type:"error","show-icon":"",closable:!1,center:"",style:{"margin-bottom":"15px"}},null,8,["title"])):I("",!0),B.value?Ae((p(),R(H,{key:1,data:f.value,border:"",height:"100%",ref_key:"tableRef",ref:P,"row-key":"unique_id","row-class-name":Ft,onRowClick:Lt,onExpandChange:At,onSortChange:It,"default-sort":F.value,"empty-text":"无数据或当前筛选条件下无结果",class:"glass-table"},{default:l(()=>[n(h,{type:"expand",width:"1"},{default:l(a=>[s("div",da,[(p(!0),v(K,null,te(Te.value,k=>(p(),v(K,{key:k},[a.row.sites[k]?(p(),v(K,{key:0},[a.row.sites[k].state==="未做种"?(p(),v("div",{key:0,style:{cursor:"pointer",display:"inline-block",width:"100%","text-align":"center"},onClick:ee(Wt=>We(a.row.name,{name:k,data:a.row.sites[k]}),["stop"])},[n(i,{effect:"dark",type:Re(a.row.sites[k]),style:{"text-align":"center",width:"100%"}},{default:l(()=>[r(c(k)+" ",1),s("div",null,"("+c(Ee(a.row.sites[k].uploaded))+")",1)]),_:2},1032,["type"])],8,ua)):a.row.sites[k]&&xe(a.row.sites[k],k)?(p(),v("a",{key:1,href:Me(a.row.sites[k],k),target:"_blank",style:{"text-decoration":"none"}},[n(i,{effect:"dark",type:Re(a.row.sites[k]),style:{"text-align":"center"}},{default:l(()=>[r(c(k)+" ",1),s("div",null,"("+c(Ee(a.row.sites[k].uploaded))+")",1)]),_:2},1032,["type"])],8,ca)):(p(),v("div",{key:2,style:{cursor:"pointer",display:"inline-block",width:"100%","text-align":"center"},onClick:ee(Wt=>We(a.row.name,{name:k,data:a.row.sites[k]}),["stop"])},[n(i,{effect:"dark",type:Re(a.row.sites[k]),style:{"text-align":"center",width:"100%"}},{default:l(()=>[r(c(k)+" ",1),s("div",null,"("+c(Ee(a.row.sites[k].uploaded))+")",1)]),_:2},1032,["type"])],8,pa))],64)):(p(),R(i,{key:1,type:"info",effect:"plain"},{default:l(()=>[r(c(k),1)]),_:2},1024))],64))),128))])]),_:1}),n(h,{prop:"name","min-width":"450",sortable:"custom"},{header:l(()=>[s("div",fa,[e[22]||(e[22]=s("div",null,"种子",-1)),n(x,{modelValue:J.value,"onUpdate:modelValue":e[0]||(e[0]=a=>J.value=a),placeholder:"搜索名称...",clearable:"",class:"search-input",onClick:e[1]||(e[1]=ee(()=>{},["stop"]))},null,8,["modelValue"]),s("span",{onClick:e[2]||(e[2]=ee(()=>{},["stop"])),style:{display:"flex","align-items":"center"}},[ct.value?(p(),v("div",va,[n(i,{type:"info",size:"default",effect:"plain"},{default:l(()=>[r(c(ut.value),1)]),_:1}),n(m,{type:"danger",link:"",style:{padding:"0","margin-left":"8px"},onClick:Rt},{default:l(()=>[...e[20]||(e[20]=[r("清除",-1)])]),_:1})])):I("",!0),n(m,{type:"primary",onClick:Dt,plain:""},{default:l(()=>[...e[21]||(e[21]=[r("筛选",-1)])]),_:1})])])]),default:l(a=>[s("span",ma,c(a.row.name),1)]),_:1}),n(h,{prop:"site_count",label:"做种数",sortable:"custom",width:"95",align:"center","header-align":"center"},{default:l(a=>[s("span",_a,c(a.row.site_count)+" / "+c(a.row.total_site_count),1)]),_:1}),n(h,{prop:"save_path",label:"保存路径",width:dt.value,"header-align":"center"},{default:l(a=>[s("div",{title:a.row.save_path,style:{width:"100%",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}},c(Xe(a.row.save_path,tt)),9,ga)]),_:1},8,["width"]),n(h,{label:"下载器",width:"130",align:"center","header-align":"center"},{default:l(a=>[s("div",ha,[a.row.downloaderIds&&a.row.downloaderIds.length>0?(p(),v("div",ya,[(p(!0),v(K,null,te(Pt(a.row.downloaderIds),k=>(p(),R(i,{key:k,size:"small",type:Bt(k),style:{margin:"2px"}},{default:l(()=>[r(c(Be(k)),1)]),_:2},1032,["type"]))),128))])):(p(),R(i,{key:1,type:"info",size:"small"},{default:l(()=>[...e[23]||(e[23]=[r(" 未知下载器 ",-1)])]),_:1}))])]),_:1}),n(h,{label:"大小",prop:"size_formatted",width:"100",align:"center",sortable:"custom"}),n(h,{label:"总上传量",prop:"total_uploaded_formatted",width:"110",align:"center",sortable:"custom"}),n(h,{label:"进度",prop:"progress",width:"90",align:"center",sortable:"custom"},{default:l(a=>[s("div",wa,[n(le,{percentage:a.row.progress,"stroke-width":10,color:pt,"show-text":!1,style:{width:"100%"}},null,8,["percentage"]),s("div",xa,c(a.row.progress)+"% ",1)])]),_:1}),n(h,{label:"状态",prop:"state",width:"120",align:"center","header-align":"center"},{default:l(a=>[s("div",ka,[n(i,{type:Ot(a.row.state),size:"large"},{default:l(()=>[r(c(a.row.state),1)]),_:2},1032,["type"])])]),_:1}),n(h,{label:"可转种",width:"100",align:"center","header-align":"center",prop:"target_sites_count",sortable:"custom"},{default:l(a=>[s("div",Sa,[a.row.target_sites_count!==void 0?(p(),v("span",ba,c(a.row.target_sites_count),1)):(p(),v("span",$a,"-"))])]),_:1}),n(h,{label:"操作",width:"100",align:"center","header-align":"center"},{default:l(a=>[s("div",Ca,[n(m,{type:"primary",size:"small",onClick:ee(k=>gt(a.row),["stop"])},{default:l(()=>[...e[24]||(e[24]=[r(" 转种 ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data","default-sort"])),[[Le,he.value]]):I("",!0),pe.value>0?(p(),R(X,{key:2,class:"glass-pagination",style:{"justify-content":"flex-end"},"current-page":W.value,"onUpdate:currentPage":e[3]||(e[3]=a=>W.value=a),"page-size":O.value,"onUpdate:pageSize":e[4]||(e[4]=a=>O.value=a),"page-sizes":[20,50,100],total:pe.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:$t,onCurrentChange:Ct,background:""},null,8,["current-page","page-size","total"])):I("",!0),it.value?(p(),v("div",Ia,[n(A,{class:"cross-seed-card",shadow:"always"},{header:l(()=>[s("div",Da,[s("span",null,"转种 - "+c(L.value?.name),1),n(m,{type:"danger",circle:"",onClick:Je,plain:""},{default:l(()=>[...e[25]||(e[25]=[r("X",-1)])]),_:1})])]),default:l(()=>[L.value?(p(),v("div",Na,[n(us,{onComplete:kt,onCancel:Je,onCloseWithRefresh:St})])):I("",!0)]),_:1})])):I("",!0),ae.value?(p(),v("div",{key:4,class:"filter-overlay",onClick:e[12]||(e[12]=ee(a=>ae.value=!1,["self"]))},[n(A,{class:"filter-card"},{header:l(()=>[s("div",za,[e[27]||(e[27]=s("span",null,"筛选选项",-1)),n(m,{type:"danger",circle:"",onClick:e[5]||(e[5]=a=>ae.value=!1),plain:""},{default:l(()=>[...e[26]||(e[26]=[r("X",-1)])]),_:1})])]),default:l(()=>[s("div",Ta,[n(ke,{"content-position":"left"},{default:l(()=>[...e[28]||(e[28]=[r("站点筛选",-1)])]),_:1}),s("div",Ua,[s("div",Va,[n(jt,{modelValue:j.value,"onUpdate:modelValue":e[6]||(e[6]=a=>j.value=a),size:"default"},{default:l(()=>[n(Qe,{label:"exist",class:"compact-radio-button"},{default:l(()=>[...e[29]||(e[29]=[r("存在于",-1)])]),_:1}),n(Qe,{label:"not-exist",class:"compact-radio-button"},{default:l(()=>[...e[30]||(e[30]=[r("不存在于",-1)])]),_:1})]),_:1},8,["modelValue"]),n(x,{modelValue:_e.value,"onUpdate:modelValue":e[7]||(e[7]=a=>_e.value=a),placeholder:"搜索站点",clearable:"",style:{width:"280px","font-size":"14px"},size:"default"},null,8,["modelValue"]),s("div",Ea,[g.existSiteNames.length>0?(p(),v("div",Ma,[n(i,{type:"info",size:"default",effect:"plain"},{default:l(()=>[r("存在于: "+c(g.existSiteNames.length),1)]),_:1}),n(m,{type:"danger",link:"",style:{padding:"0","margin-left":"5px"},onClick:Tt},{default:l(()=>[...e[31]||(e[31]=[r("清除",-1)])]),_:1})])):I("",!0),g.notExistSiteNames.length>0?(p(),v("div",Ra,[n(i,{type:"info",size:"default",effect:"plain"},{default:l(()=>[r("不存在于: "+c(g.notExistSiteNames.length),1)]),_:1}),n(m,{type:"danger",link:"",style:{padding:"0","margin-left":"5px"},onClick:Ut},{default:l(()=>[...e[32]||(e[32]=[r("清除",-1)])]),_:1})])):I("",!0)])]),s("div",Ba,[n(Oe,{modelValue:be.value,"onUpdate:modelValue":e[8]||(e[8]=a=>be.value=a)},{default:l(()=>[(p(!0),v(K,null,te(Fe.value,a=>(p(),R(Pe,{key:a,label:a,disabled:!je(a),class:se({"disabled-site":!je(a)})},{default:l(()=>[r(c(a),1)]),_:2},1032,["label","disabled","class"]))),128))]),_:1},8,["modelValue"])])]),n(ke,{"content-position":"left"},{default:l(()=>[...e[33]||(e[33]=[r("下载器",-1)])]),_:1}),s("div",Pa,[g.downloaderIds.length>0?(p(),v("div",Oa,[n(i,{type:"info",size:"default",effect:"plain"},{default:l(()=>[r("下载器: "+c(g.downloaderIds.length),1)]),_:1}),n(m,{type:"danger",link:"",style:{padding:"0","margin-left":"5px"},onClick:Mt},{default:l(()=>[...e[34]||(e[34]=[r("清除",-1)])]),_:1})])):I("",!0)]),n(Oe,{modelValue:g.downloaderIds,"onUpdate:modelValue":e[9]||(e[9]=a=>g.downloaderIds=a)},{default:l(()=>[(p(!0),v(K,null,te(fe.value,a=>(p(),R(Pe,{key:a.id,label:a.id},{default:l(()=>[r(c(a.name),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"]),n(ke,{"content-position":"left"},{default:l(()=>[...e[35]||(e[35]=[r("保存路径",-1)])]),_:1}),s("div",La,[g.paths.length>0?(p(),v("div",Aa,[n(i,{type:"info",size:"default",effect:"plain"},{default:l(()=>[r("路径: "+c(g.paths.length),1)]),_:1}),n(m,{type:"danger",link:"",style:{padding:"0","margin-left":"5px"},onClick:Vt},{default:l(()=>[...e[36]||(e[36]=[r("清除",-1)])]),_:1})])):I("",!0)]),s("div",Fa,[n(Yt,{ref_key:"pathTreeRef",ref:b,data:Ie.value,"show-checkbox":"","node-key":"path","default-expand-all":"","expand-on-click-node":!1,"check-on-click-node":"","check-strictly":!0,props:{class:"path-tree-node"}},null,8,["data"])]),n(ke,{"content-position":"left"},{default:l(()=>[...e[37]||(e[37]=[r("状态",-1)])]),_:1}),s("div",ja,[g.states.length>0?(p(),v("div",Ya,[n(i,{type:"info",size:"default",effect:"plain"},{default:l(()=>[r("状态: "+c(g.states.length),1)]),_:1}),n(m,{type:"danger",link:"",style:{padding:"0","margin-left":"5px"},onClick:Et},{default:l(()=>[...e[38]||(e[38]=[r("清除",-1)])]),_:1})])):I("",!0)]),n(Oe,{modelValue:g.states,"onUpdate:modelValue":e[10]||(e[10]=a=>g.states=a)},{default:l(()=>[(p(!0),v(K,null,te($e.value,a=>(p(),R(Pe,{key:a,label:a},{default:l(()=>[r(c(a),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),s("div",Ja,[n(m,{onClick:zt},{default:l(()=>[...e[39]||(e[39]=[r("清除筛选",-1)])]),_:1}),n(m,{onClick:e[11]||(e[11]=a=>ae.value=!1)},{default:l(()=>[...e[40]||(e[40]=[r("取消",-1)])]),_:1}),n(m,{type:"primary",onClick:Nt},{default:l(()=>[...e[41]||(e[41]=[r("确认",-1)])]),_:1})])]),_:1})])):I("",!0),ce.value?(p(),v("div",{key:5,class:"filter-overlay",onClick:e[16]||(e[16]=ee(a=>ce.value=!1,["self"]))},[n(A,{class:"filter-card",style:{"max-width":"500px"}},{header:l(()=>[s("div",Wa,[e[43]||(e[43]=s("span",null,"站点操作",-1)),n(m,{type:"danger",circle:"",onClick:e[13]||(e[13]=a=>ce.value=!1),plain:""},{default:l(()=>[...e[42]||(e[42]=[r("X",-1)])]),_:1})])]),default:l(()=>[s("div",qa,[s("div",Ka,[e[44]||(e[44]=s("p",{class:"label"},"种子名称:",-1)),s("p",Ha,c(me.value),1)]),s("p",null,"站点名称: "+c(z.value?.name),1),s("p",null,"当前状态: "+c(z.value?.data.state),1),z.value&&z.value.data&&xe(z.value.data,z.value.name)?(p(),v("div",Xa,[e[45]||(e[45]=s("p",{class:"label"},"详情页链接:",-1)),n(Jt,{href:Me(z.value.data,z.value.name),target:"_blank",type:"primary",underline:!1},{default:l(()=>[r(c(Me(z.value.data,z.value.name)),1)]),_:1},8,["href"])])):(p(),v("div",Ga,[e[46]||(e[46]=s("p",{class:"label"},"添加详情页链接或种子ID:",-1)),n(x,{modelValue:Q.value,"onUpdate:modelValue":e[14]||(e[14]=a=>Q.value=a),placeholder:"请输入完整的详情页链接或种子ID",clearable:"",onKeyup:ns(qe,["enter"])},null,8,["modelValue"]),e[47]||(e[47]=s("p",{class:"input-hint"}," 支持输入完整链接（如：https://example.com/details.php?id=123）或仅输入数字ID（如：9999999996） ",-1))])),s("div",Qa,[n(m,{onClick:e[15]||(e[15]=a=>ce.value=!1)},{default:l(()=>[...e[48]||(e[48]=[r("取消",-1)])]),_:1}),xe(z.value?.data,z.value?.name)?I("",!0):(p(),R(m,{key:0,type:"success",onClick:qe,disabled:!Q.value||Q.value.trim()===""},{default:l(()=>[...e[49]||(e[49]=[r(" 添加链接 ",-1)])]),_:1},8,["disabled"])),xe(z.value?.data,z.value?.name)?(p(),R(m,{key:1,type:"primary",onClick:xt},{default:l(()=>[...e[50]||(e[50]=[r(" 设为不存在 ",-1)])]),_:1})):I("",!0)])])]),_:1})])):I("",!0),de.value?(p(),v("div",Za,[n(A,{class:"filter-card",style:{"max-width":"600px"}},{header:l(()=>[s("div",el,[e[52]||(e[52]=s("span",null,"请选择转种的源站点",-1)),n(m,{type:"danger",circle:"",onClick:e[17]||(e[17]=a=>de.value=!1),plain:""},{default:l(()=>[...e[51]||(e[51]=[r("X",-1)])]),_:1})])]),default:l(()=>[s("div",tl,[s("p",sl,[n(i,{type:"success",size:"large",style:{"margin-right":"5px"}},{default:l(()=>[...e[53]||(e[53]=[r("可获取数据",-1)])]),_:1}),n(i,{type:"primary",size:"large",style:{"margin-right":"5px"}},{default:l(()=>[...e[54]||(e[54]=[r("点击尝试使用iyuu获取链接",-1)])]),_:1}),n(i,{type:"error",size:"large",style:{"margin-right":"5px",opacity:"0.5"}},{default:l(()=>[...e[55]||(e[55]=[r("缺少配置参数",-1)])]),_:1})]),q.value.length>0?(p(),v("div",al,[s("p",ll,"已缓存的站点 ("+c(q.value.length)+")",1),s("div",nl,[(p(!0),v(K,null,te(d.value.filter(a=>q.value.includes(a.name)),a=>Ae((p(),R(i,{key:a.name,type:Ge(a,ge(a.name)),class:se([{"is-selectable":ge(a.name),"cached-site-tag":!0},"site-tag"]),onClick:k=>ge(a.name)&&Ye(Ke(a.name)),"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.5)"},{default:l(()=>[r(c(a.name)+" ✓ ",1)]),_:2},1032,["type","class","onClick"])),[[Le,De.value[a.name]]])),128))])])):I("",!0),d.value.some(a=>!q.value.includes(a.name))?(p(),v("div",ol,[e[56]||(e[56]=s("p",{class:"uncached-sites-label"},"未缓存的站点",-1)),s("div",il,[(p(!0),v(K,null,te(d.value.filter(a=>!q.value.includes(a.name)),a=>Ae((p(),R(i,{key:a.name,type:Ge(a,ge(a.name)),class:se([{"is-selectable":ge(a.name)},"site-tag"]),style:rs(!a.has_cookie||(a.name==="杜比"||a.name==="HDtime"||a.name==="肉丝")&&!a.has_passkey?"opacity: 0.5":""),size:"large",onClick:k=>ge(a.name)&&Ye(Ke(a.name)),"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.5)"},{default:l(()=>[r(c(a.name),1)]),_:2},1032,["type","class","style","onClick"])),[[Le,De.value[a.name]]])),128))])])):I("",!0)]),s("div",rl,[n(m,{type:"warning",onClick:He,loading:u.value,plain:""},{default:l(()=>[...e[57]||(e[57]=[r(" IYUU查询 ",-1)])]),_:1},8,["loading"]),n(m,{type:"success",onClick:e[18]||(e[18]=a=>ht(L.value)),plain:""},{default:l(()=>[...e[58]||(e[58]=[r("上盒",-1)])]),_:1}),n(m,{onClick:e[19]||(e[19]=a=>de.value=!1)},{default:l(()=>[...e[59]||(e[59]=[r("取消",-1)])]),_:1})])]),_:1})])):I("",!0),n(ia,{onRefresh:yt}),$.value?(p(),v("div",{key:7,class:"filter-overlay",onClick:ee(Ve,["self"])},[n(A,{class:"filter-card",style:{"max-width":"720px"}},{header:l(()=>[s("div",dl,[e[61]||(e[61]=s("span",null,"IYUU 批量查询进度",-1)),n(m,{type:"danger",circle:"",onClick:Ve,plain:""},{default:l(()=>[...e[60]||(e[60]=[r("X",-1)])]),_:1})])]),default:l(()=>[s("div",ul,[n(Ze,{column:2,border:"",size:"small"},{default:l(()=>[n(Z,{label:"任务ID"},{default:l(()=>[r(c(w.value?.task_id||"-"),1)]),_:1}),n(Z,{label:"状态"},{default:l(()=>[n(i,{type:w.value?.isRunning?"warning":w.value?.success?"success":"danger",size:"small"},{default:l(()=>[r(c(w.value?.isRunning?"进行中":w.value?.success?"已完成":"失败"),1)]),_:1},8,["type"])]),_:1}),n(Z,{label:"总数"},{default:l(()=>[r(c(w.value?.total??0),1)]),_:1}),n(Z,{label:"已处理"},{default:l(()=>[r(c(w.value?.processed??0),1)]),_:1}),n(Z,{label:"开始时间"},{default:l(()=>[r(c(w.value?.created_at||"-"),1)]),_:1}),n(Z,{label:"完成时间"},{default:l(()=>[r(c(w.value?.finished_at||"-"),1)]),_:1})]),_:1}),n(ke,{"content-position":"left"},{default:l(()=>[...e[62]||(e[62]=[r("结果",-1)])]),_:1}),s("div",cl,c(w.value?.message||"等待任务更新..."),1),w.value?.stats?(p(),R(Ze,{key:0,column:3,border:"",size:"small"},{default:l(()=>[n(Z,{label:"找到"},{default:l(()=>[r(c(w.value.stats.total_found??0),1)]),_:1}),n(Z,{label:"新增"},{default:l(()=>[r(c(w.value.stats.new_records??0),1)]),_:1}),n(Z,{label:"更新"},{default:l(()=>[r(c(w.value.stats.updated_records??0),1)]),_:1})]),_:1})):I("",!0)]),s("div",pl,[n(m,{type:"primary",onClick:Ue,plain:""},{default:l(()=>[...e[63]||(e[63]=[r("刷新",-1)])]),_:1}),n(m,{onClick:Ve},{default:l(()=>[...e[64]||(e[64]=[r("关闭",-1)])]),_:1})])]),_:1})])):I("",!0)])}}}),yl=lt(_l,[["__scopeId","data-v-ed1e9ca1"]]);export{yl as default};
