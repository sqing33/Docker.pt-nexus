import{d as St,r as p,c as J,o as vt,s as Ct,D as xt,a as h,m as z,k as x,i,f as w,e as a,w as s,j as o,t as f,x as jt,I as Mt,u as Fe,v as Tt,F as fe,l as be,G as ht,z as _,q as $t,h as c,p as Dt,J as kt,n as de,B as Jt}from"./index-DKGo2H6i.js";import{u as Lt,C as At}from"./CrossSeedPanel-bK3Sfm3w.js";const Ut={class:"batch-fetch-panel"},Ht={class:"search-and-controls"},qt={key:0,class:"current-filters",style:{"margin-right":"15px",display:"flex","align-items":"center"}},Wt={key:2,class:"pagination-controls"},Xt={class:"table-container"},Kt=["title"],Gt={key:0,style:{color:"#909399"}},Yt={class:"filter-card-header"},Qt={class:"filter-card-body"},Zt={class:"path-tree-container"},es={class:"filter-card-footer"},ts={key:2,class:"modal-overlay"},ss={class:"modal-header"},as={class:"batch-fetch-content"},ls={class:"config-section"},rs={class:"batch-fetch-footer"},ns={key:3,class:"modal-overlay"},os={class:"modal-header"},is={class:"priority-settings-content"},ds={class:"priority-section"},us={class:"priority-list"},cs={key:0,style:{color:"#909399","margin-left":"10px"}},ps={class:"available-sites"},fs={key:0,style:{color:"#909399","margin-left":"10px"}},gs={class:"priority-settings-footer"},vs={key:4,class:"modal-overlay"},hs={class:"modal-header"},_s={class:"progress-header-controls"},ms={class:"progress-content"},ys={class:"progress-summary"},ws={class:"results-table-container"},bs={class:"progress-footer"},ks=3e3,Ss=St({__name:"BatchFetchPanel",emits:["cancel","fetch-completed"],setup(zt,{emit:Xe}){const Ke=Xe,ae=p([]),ge=p(!0),G=p(null),L=p([]),D=p(!1),ue=p(!1),ve=p(!1),O=p(!1),le=p(!1),E=p([]),R=p([]),q=p(null),A=p(null),Ie=p([]),he=p([]),re=p([]),xe=p([]),Y=p(1),_e=p(20),U=p(0),F=p(""),ne=p(!1),T=p({paths:[],states:[],downloaderIds:[]}),V=p({...T.value}),me=p(null),S=p({total:0,processed:0,success:0,failed:0,skipped:0,isRunning:!1,results:[]}),ke=p(null),Ge=J(()=>{const r=T.value,l=[];return r.paths&&r.paths.length>0&&l.push(`路径: ${r.paths.length}`),r.states&&r.states.length>0&&l.push(`状态: ${r.states.length}`),r.downloaderIds&&r.downloaderIds.length>0&&l.push(`下载器: ${r.downloaderIds.length}`),l.join(", ")}),Ye=J(()=>{const r=T.value;return r.paths&&r.paths.length>0||r.states&&r.states.length>0||r.downloaderIds&&r.downloaderIds.length>0}),oe=J(()=>E.value.filter(r=>r.is_source&&r.has_cookie).map(r=>r.name).filter(r=>!R.value.includes(r))),C=J(()=>S.value.total===0?0:Math.round(S.value.processed/S.value.total*100)),Q=J(()=>{if(!S.value.isRunning)return S.value.failed>0?"exception":"success"}),Ee=r=>{const l=[],m=new Map;return r.sort().forEach(y=>{const b=y.replace(/^\/|\/$/g,"").split("/");let $="",ee=l;b.forEach((ye,B)=>{if($=B===0?`/${ye}`:`${$}/${ye}`,!m.has($)){const H={path:B===b.length-1?y:$,label:ye,children:[]};m.set($,H),ee.push(H)}ee=m.get($).children})}),m.forEach(y=>{y.children&&y.children.length===0&&delete y.children}),l},W=async()=>{ge.value=!0,G.value=null;try{const r=new URLSearchParams({page:Y.value.toString(),pageSize:_e.value.toString(),nameSearch:F.value,path_filters:JSON.stringify(T.value.paths),state_filters:JSON.stringify(T.value.states),downloader_filters:JSON.stringify(T.value.downloaderIds),exclude_existing:"true"}),l=await fetch(`/api/data?${r.toString()}`);if(!l.ok)throw new Error(`网络错误: ${l.status}`);const m=await l.json();m.error?(G.value=m.error||"获取数据失败",_.error(m.error||"获取数据失败")):(ae.value=m.data.map(y=>({name:y.name,save_path:y.save_path,size:y.size,progress:y.progress,state:y.state,sites:y.sites||{},downloader_ids:y.downloader_ids||[]})),U.value=m.total,(re.value.length===0||!T.value.states.length)&&(re.value=[...new Set(ae.value.map(y=>y.state))]))}catch(r){G.value=r.message||"网络错误",_.error(r.message||"网络错误")}finally{ge.value=!1}},Qe=async()=>{try{const r=await fetch("/api/all_downloaders");if(!r.ok)throw new Error("无法获取下载器列表");const l=await r.json();xe.value=l.filter(m=>m.enabled)}catch(r){G.value=r.message}},ie=async()=>{try{const r=new URLSearchParams({page:"1",page_size:"1",path_filters:JSON.stringify([]),state_filters:JSON.stringify([]),downloader_filters:JSON.stringify([])}),l=await fetch(`/api/data?${r.toString()}`);if(!l.ok)throw new Error("无法获取路径列表");const m=await l.json();m.unique_paths&&(he.value=m.unique_paths,Ie.value=Ee(he.value))}catch(r){console.error("获取路径列表失败:",r)}},j=r=>{_e.value=r,Y.value=1,W()},M=r=>{Y.value=r,W()},Ze=()=>{T.value={paths:[],states:[],downloaderIds:[]},F.value="",Y.value=1,Te(),W()},et=()=>{V.value={...T.value},ne.value=!0,$t(()=>{A.value&&T.value.paths.length>0&&A.value.setCheckedKeys(T.value.paths,!1)})},tt=()=>{if(A.value){const r=A.value.getCheckedKeys(!1);V.value.paths=r}T.value={...V.value},ne.value=!1,Y.value=1,Te(),W()},Te=async()=>{try{await fetch("/api/config/batch_fetch_filters",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({batch_fetch_filters:T.value,batch_fetch_name_search:F.value})})}catch(r){console.error("保存筛选条件失败:",r)}},Ve=async()=>{try{const r=await fetch("/api/config/batch_fetch_filters");if(r.ok){const l=await r.json();l.success&&l.data&&(T.value=l.data),l.success&&l.name_search!==void 0&&(F.value=l.name_search)}}catch(r){console.error("加载筛选条件失败:",r)}},st=r=>{L.value=r},N=r=>{const l={};for(const[m,y]of Object.entries(r||{}))(y.migration===1||y.migration===3)&&(l[m]=y);return l},Se=()=>{if(L.value.length===0){_.warning("请先选择要获取数据的种子");return}D.value=!0},$e=()=>{D.value=!1},at=async()=>{ve.value=!0,await lt()},De=()=>{ve.value=!1},lt=async()=>{O.value=!0;try{const r=await fetch("/api/sites/status");if(!r.ok)throw new Error("无法获取站点状态列表");E.value=await r.json();const l=await fetch("/api/config/source_priority");if(!l.ok)throw new Error("无法获取配置");const m=await l.json();m.success&&(R.value=m.data||[])}catch(r){_.error(r.message||"加载配置失败")}finally{O.value=!1}},rt=async()=>{le.value=!0;try{const r=await fetch("/api/config/source_priority",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({source_priority:R.value})});if(!r.ok)throw new Error("保存失败");const l=await r.json();if(l.success)_.success("源站点优先级配置已保存"),De();else throw new Error(l.message||"保存失败")}catch(r){_.error(r.message||"保存配置失败")}finally{le.value=!1}},nt=r=>r===0?"success":r===1?"primary":r===2?"warning":"info",Z=r=>{R.value.includes(r)||R.value.push(r)},ot=r=>{const l=R.value.indexOf(r);l>-1&&R.value.splice(l,1)},it=r=>{q.value=r},dt=r=>{if(q.value===null)return;const l=R.value[q.value];R.value.splice(q.value,1),R.value.splice(r,0,l),q.value=null},ut=async()=>{try{const r=L.value.map(y=>y.name),l=await fetch("/api/migrate/batch_fetch_seed_data",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({torrentNames:r})}),m=await l.json();if(!l.ok){const y=m.message||`HTTP error! status: ${l.status}`;_.error(y);return}m.success?(me.value=m.task_id,_.success("批量获取任务已启动"),$e(),ze()):_.error(m.message||"批量获取任务启动失败")}catch(r){_.error(r.message||"网络错误")}},ze=()=>{ue.value=!0,Me()},je=()=>{ue.value=!1,ce()},Me=()=>{ce(),Pe(),ke.value=setInterval(async()=>{ue.value&&me.value?(await Pe(),S.value&&!S.value.isRunning&&setTimeout(()=>{S.value.isRunning||ce()},3e3)):ce()},ks)},ce=()=>{ke.value&&(clearInterval(ke.value),ke.value=null)},Pe=async()=>{if(me.value)try{const r=await fetch(`/api/migrate/batch_fetch_progress?task_id=${me.value}`);if(r.ok){const l=await r.json();if(l.success){const m=S.value.isRunning;S.value=l.progress,m&&!S.value.isRunning&&Ke("fetch-completed")}else _.error(l.message||"获取进度失败")}}catch(r){console.error("获取进度时出错:",r)}},Re=r=>{switch(r){case"success":return"success";case"failed":return"danger";case"skipped":return"info";default:return"info"}},Je=r=>{switch(r){case"success":return"成功";case"failed":return"失败";case"skipped":return"跳过";default:return"未知"}},ct=r=>{if(!r||r===0)return"0 B";const l=1024,m=["B","KB","MB","GB","TB","PB"],y=Math.floor(Math.log(r)/Math.log(l));return`${(r/Math.pow(l,y)).toFixed(2)} ${m[y]}`},pt=(r,l=50)=>{if(!r||r.length<=l)return r;const m=Math.floor((l-3)/2);let y=r.substring(0,m),b=r.substring(r.length-m);const $=y.lastIndexOf("/"),ee=b.indexOf("/");return $>0&&ee>=0&&(y=y.substring(0,$),b=b.substring(ee+1)),`${y}...${b}`};return vt(async()=>{await Qe(),await Ve(),await ie(),W()}),Ct(()=>{ce()}),xt(F,()=>{Y.value=1,W(),Te()}),(r,l)=>{const m=w("el-alert"),y=w("el-input"),b=w("el-button"),$=w("el-tag"),ee=w("el-icon"),ye=w("el-pagination"),B=w("el-table-column"),Ne=w("el-table"),H=w("el-divider"),X=w("el-tree"),Le=w("el-checkbox"),Be=w("el-checkbox-group"),te=w("el-card"),pe=w("el-descriptions-item"),ft=w("el-descriptions"),gt=w("el-progress"),Ce=Tt("loading");return c(),h("div",Ut,[G.value?(c(),z(m,{key:0,title:G.value,type:"error","show-icon":"",closable:!1,center:"",style:{"margin-bottom":"15px"}},null,8,["title"])):x("",!0),i("div",Ht,[a(y,{modelValue:F.value,"onUpdate:modelValue":l[0]||(l[0]=v=>F.value=v),placeholder:"搜索名称...",clearable:"",class:"search-input",style:{width:"300px","margin-right":"15px"}},null,8,["modelValue"]),a(b,{type:"primary",onClick:et,plain:"",style:{"margin-right":"15px"}},{default:s(()=>[...l[9]||(l[9]=[o(" 筛选 ",-1)])]),_:1}),Ye.value?(c(),h("div",qt,[a($,{type:"info",size:"default",effect:"plain"},{default:s(()=>[o(f(Ge.value),1)]),_:1}),a(b,{type:"danger",link:"",style:{padding:"0","margin-left":"8px"},onClick:Ze},{default:s(()=>[...l[10]||(l[10]=[o("清除",-1)])]),_:1})])):x("",!0),a(b,{type:"warning",onClick:at,plain:"",style:{"margin-right":"15px"}},{default:s(()=>[a(ee,{style:{"margin-right":"5px"}},{default:s(()=>[a(jt(Mt))]),_:1}),l[11]||(l[11]=o(" 设置优先级 ",-1))]),_:1}),a(b,{type:"success",onClick:Se,plain:"",style:{"margin-right":"15px"},disabled:L.value.length===0},{default:s(()=>[o(" 批量获取数据 ("+f(L.value.length)+") ",1)]),_:1},8,["disabled"]),me.value?(c(),z(b,{key:1,type:"info",onClick:ze,plain:"",style:{"margin-right":"15px"}},{default:s(()=>[...l[12]||(l[12]=[o(" 查看进度 ",-1)])]),_:1})):x("",!0),ae.value.length>0?(c(),h("div",Wt,[a(ye,{"current-page":Y.value,"onUpdate:currentPage":l[1]||(l[1]=v=>Y.value=v),"page-size":_e.value,"onUpdate:pageSize":l[2]||(l[2]=v=>_e.value=v),"page-sizes":[20,50,100],total:U.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:j,onCurrentChange:M,background:""},null,8,["current-page","page-size","total"])])):x("",!0)]),i("div",Xt,[Fe((c(),z(Ne,{data:ae.value,border:"",style:{width:"100%"},"empty-text":"暂无种子数据",height:"100%",onSelectionChange:st},{default:s(()=>[a(B,{type:"selection",width:"55",align:"center","header-align":"center"}),a(B,{prop:"name",label:"种子名称","min-width":"400","show-overflow-tooltip":"","header-align":"center"}),a(B,{prop:"size",label:"大小",width:"110",align:"center","header-align":"center"},{default:s(v=>[o(f(ct(v.row.size)),1)]),_:1}),a(B,{prop:"save_path",label:"保存路径",width:"200","header-align":"center"},{default:s(v=>[i("div",{title:v.row.save_path,style:{width:"100%",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}},f(pt(v.row.save_path,30)),9,Kt)]),_:1}),a(B,{prop:"site_count",label:"站点数",width:"100",align:"center","header-align":"center"},{default:s(v=>[o(f(Object.keys(v.row.sites||{}).length),1)]),_:1}),a(B,{prop:"state",label:"状态",width:"120",align:"center","header-align":"center"}),a(B,{label:"已有源站点","min-width":"200","header-align":"center"},{default:s(v=>[(c(!0),h(fe,null,be(N(v.row.sites),(K,we)=>(c(),z($,{key:we,size:"small",type:"success",style:{margin:"2px"}},{default:s(()=>[o(f(we),1)]),_:2},1024))),128)),Object.keys(N(v.row.sites)).length===0?(c(),h("span",Gt," 无可用源站点 ")):x("",!0)]),_:1})]),_:1},8,["data"])),[[Ce,ge.value]])]),ne.value?(c(),h("div",{key:1,class:"filter-overlay",onClick:l[7]||(l[7]=ht(v=>ne.value=!1,["self"]))},[a(te,{class:"filter-card"},{header:s(()=>[i("div",Yt,[l[14]||(l[14]=i("span",null,"筛选选项",-1)),a(b,{type:"danger",circle:"",onClick:l[3]||(l[3]=v=>ne.value=!1),plain:""},{default:s(()=>[...l[13]||(l[13]=[o("X",-1)])]),_:1})])]),default:s(()=>[i("div",Qt,[a(H,{"content-position":"left"},{default:s(()=>[...l[15]||(l[15]=[o("保存路径",-1)])]),_:1}),i("div",Zt,[a(X,{ref_key:"pathTreeRef",ref:A,data:Ie.value,"show-checkbox":"","node-key":"path","default-expand-all":"","expand-on-click-node":!1,"check-on-click-node":"","check-strictly":!0,props:{class:"path-tree-node"}},null,8,["data"])]),a(H,{"content-position":"left"},{default:s(()=>[...l[16]||(l[16]=[o("状态",-1)])]),_:1}),a(Be,{modelValue:V.value.states,"onUpdate:modelValue":l[4]||(l[4]=v=>V.value.states=v)},{default:s(()=>[(c(!0),h(fe,null,be(re.value,v=>(c(),z(Le,{key:v,label:v},{default:s(()=>[o(f(v),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"]),a(H,{"content-position":"left"},{default:s(()=>[...l[17]||(l[17]=[o("下载器",-1)])]),_:1}),a(Be,{modelValue:V.value.downloaderIds,"onUpdate:modelValue":l[5]||(l[5]=v=>V.value.downloaderIds=v)},{default:s(()=>[(c(!0),h(fe,null,be(xe.value,v=>(c(),z(Le,{key:v.id,label:v.id},{default:s(()=>[o(f(v.name),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),i("div",es,[a(b,{onClick:l[6]||(l[6]=v=>ne.value=!1)},{default:s(()=>[...l[18]||(l[18]=[o("取消",-1)])]),_:1}),a(b,{type:"primary",onClick:tt},{default:s(()=>[...l[19]||(l[19]=[o("确认",-1)])]),_:1})])]),_:1})])):x("",!0),D.value?(c(),h("div",ts,[a(te,{class:"batch-fetch-card",shadow:"always"},{header:s(()=>[i("div",ss,[l[21]||(l[21]=i("span",null,"批量获取种子数据",-1)),a(b,{type:"danger",circle:"",onClick:$e,plain:""},{default:s(()=>[...l[20]||(l[20]=[o("X",-1)])]),_:1})])]),default:s(()=>[i("div",as,[i("div",ls,[i("h3",null,"已选择 "+f(L.value.length)+" 个种子",1),l[22]||(l[22]=i("p",{style:{color:"#909399","font-size":"13px","margin-top":"5px"}}," 系统将按名称聚合，逐个从源站点获取种子数据并存储到数据库 ",-1))])]),i("div",rs,[a(b,{onClick:$e},{default:s(()=>[...l[23]||(l[23]=[o("取消",-1)])]),_:1}),a(b,{type:"primary",onClick:ut},{default:s(()=>[...l[24]||(l[24]=[o(" 开始批量获取 ",-1)])]),_:1})])]),_:1})])):x("",!0),ve.value?(c(),h("div",ns,[a(te,{class:"priority-settings-card",shadow:"always"},{header:s(()=>[i("div",os,[l[26]||(l[26]=i("span",null,"源站点优先级设置",-1)),a(b,{type:"danger",circle:"",onClick:De,plain:""},{default:s(()=>[...l[25]||(l[25]=[o("X",-1)])]),_:1})])]),default:s(()=>[i("div",is,[a(m,{type:"info","show-icon":"",closable:!1,style:{"margin-bottom":"20px"}},{title:s(()=>[...l[27]||(l[27]=[o(" 设置批量获取种子数据时的源站点优先级顺序，系统将按顺序查找第一个可用的源站点 ",-1)])]),_:1}),i("div",ds,[l[28]||(l[28]=i("p",{style:{color:"#606266","font-size":"14px","margin-bottom":"10px","font-weight":"600"}}," 优先级顺序（拖拽调整）： ",-1)),Fe((c(),h("div",us,[(c(!0),h(fe,null,be(R.value,(v,K)=>(c(),z($,{key:v,type:nt(K),size:"large",closable:"",onClose:we=>ot(v),draggable:"true",onDragstart:we=>it(K),onDragover:l[8]||(l[8]=ht(()=>{},["prevent"])),onDrop:we=>dt(K),style:{margin:"5px",cursor:"move","user-select":"none"}},{default:s(()=>[o(f(K+1)+". "+f(v),1)]),_:2},1032,["type","onClose","onDragstart","onDrop"]))),128)),R.value.length===0?(c(),h("span",cs," 暂无源站点，请从下方添加 ")):x("",!0)])),[[Ce,O.value]]),a(H),l[29]||(l[29]=i("p",{style:{color:"#606266","font-size":"14px","margin-bottom":"10px","font-weight":"600"}}," 可用源站点列表（点击添加）： ",-1)),Fe((c(),h("div",ps,[(c(!0),h(fe,null,be(oe.value,v=>(c(),z($,{key:v,type:"info",size:"default",onClick:K=>Z(v),style:{margin:"5px",cursor:"pointer"}},{default:s(()=>[o(f(v),1)]),_:2},1032,["onClick"]))),128)),oe.value.length===0?(c(),h("span",fs," 所有源站点已添加 ")):x("",!0)])),[[Ce,O.value]])])]),i("div",gs,[a(b,{onClick:De},{default:s(()=>[...l[30]||(l[30]=[o("取消",-1)])]),_:1}),a(b,{type:"primary",onClick:rt,loading:le.value},{default:s(()=>[...l[31]||(l[31]=[o(" 保存设置 ",-1)])]),_:1},8,["loading"])])]),_:1})])):x("",!0),ue.value?(c(),h("div",vs,[a(te,{class:"progress-card",shadow:"always"},{header:s(()=>[i("div",hs,[i("span",null,"批量获取进度 "+f(S.value.isRunning?"(进行中...)":"(已完成)"),1),i("div",_s,[S.value.isRunning?(c(),z(b,{key:0,type:"warning",size:"small",onClick:ce},{default:s(()=>[...l[32]||(l[32]=[o(" 停止自动刷新 ",-1)])]),_:1})):(c(),z(b,{key:1,type:"primary",size:"small",onClick:Pe},{default:s(()=>[...l[33]||(l[33]=[o(" 刷新 ",-1)])]),_:1})),a(b,{type:"danger",circle:"",onClick:je,plain:""},{default:s(()=>[...l[34]||(l[34]=[o("X",-1)])]),_:1})])])]),default:s(()=>[i("div",ms,[i("div",ys,[a(ft,{column:2,border:""},{default:s(()=>[a(pe,{label:"总数"},{default:s(()=>[o(f(S.value.total),1)]),_:1}),a(pe,{label:"已处理"},{default:s(()=>[o(f(S.value.processed),1)]),_:1}),a(pe,{label:"成功"},{default:s(()=>[a($,{type:"success",size:"small"},{default:s(()=>[o(f(S.value.success),1)]),_:1})]),_:1}),a(pe,{label:"失败"},{default:s(()=>[a($,{type:"danger",size:"small"},{default:s(()=>[o(f(S.value.failed),1)]),_:1})]),_:1}),a(pe,{label:"跳过"},{default:s(()=>[a($,{type:"info",size:"small"},{default:s(()=>[o(f(S.value.skipped),1)]),_:1})]),_:1}),a(pe,{label:"状态"},{default:s(()=>[a($,{type:S.value.isRunning?"warning":"success",size:"small"},{default:s(()=>[o(f(S.value.isRunning?"进行中":"已完成"),1)]),_:1},8,["type"])]),_:1})]),_:1}),a(gt,{percentage:C.value,status:Q.value,style:{"margin-top":"15px"}},null,8,["percentage","status"])]),a(H,{"content-position":"left"},{default:s(()=>[...l[35]||(l[35]=[o("处理详情",-1)])]),_:1}),i("div",ws,[a(Ne,{data:S.value.results,style:{width:"100%"},size:"small",stripe:"","max-height":"400"},{default:s(()=>[a(B,{prop:"name",label:"种子名称","min-width":"300","show-overflow-tooltip":""}),a(B,{prop:"status",label:"状态",width:"100",align:"center"},{default:s(v=>[a($,{type:Re(v.row.status),size:"small"},{default:s(()=>[o(f(Je(v.row.status)),1)]),_:2},1032,["type"])]),_:1}),a(B,{prop:"source_site",label:"源站点",width:"120",align:"center"}),a(B,{prop:"reason",label:"失败原因","min-width":"200","show-overflow-tooltip":""})]),_:1},8,["data"])])]),i("div",bs,[a(b,{onClick:je},{default:s(()=>[...l[36]||(l[36]=[o("关闭",-1)])]),_:1})])]),_:1})])):x("",!0)])}}}),Cs=Dt(Ss,[["__scopeId","data-v-f7ec7976"]]),xs={class:"cross-seed-data-view"},Ts={class:"search-and-controls glass-table"},$s={key:0,class:"current-filters",style:{"margin-right":"15px",display:"flex","align-items":"center"}},Ds={key:1,class:"pagination-controls"},zs={class:"filter-card-header"},Ps={class:"filter-card-body"},Rs={class:"path-tree-container"},Ns={class:"target-sites-container"},Bs={class:"selected-site-display"},Os={key:0,class:"selected-site-info"},Fs={key:1,class:"selected-site-info"},Is={class:"target-sites-radio-container"},Es={class:"filter-card-footer"},Vs={class:"table-container"},js={class:"mapped-cell"},Ms={class:"title-cell"},Js=["title"],Ls=["title"],As={class:"tags-cell"},Us={class:"mapped-cell datetime-cell"},Hs={key:2,class:"modal-overlay"},qs={class:"modal-header"},Ws={class:"cross-seed-content"},Xs={key:3,class:"modal-overlay"},Ks={class:"modal-header"},Gs={class:"batch-cross-seed-content"},Ys={class:"target-site-selection-body"},Qs={class:"batch-info"},Zs={class:"batch-cross-seed-footer"},ea={key:4,class:"modal-overlay"},ta={class:"modal-header"},sa={class:"record-header-controls"},aa={class:"record-view-content"},la={key:0,class:"records-table-container"},ra={key:0},na={key:1},oa={key:0,class:"progress-cell"},ia={class:"progress-text"},da={key:1},ua={key:0},ca={key:1},pa={key:2},fa={key:1},ga={class:"mapped-cell datetime-cell"},va={key:1,class:"no-records"},ha={class:"record-view-footer"},_a={key:5,class:"modal-overlay"},ma={class:"modal-header"},ya={class:"batch-fetch-main-content"},wa=5e3,ba=St({__name:"CrossSeedDataView",emits:["ready"],setup(zt,{emit:Xe}){const Ke=Xe;vt(()=>{Ke("ready",N)});const ae=p({type:{},medium:{},video_codec:{},audio_codec:{},resolution:{},source:{},team:{},tags:{},site_name:{}}),ge=p([]),G=p(!0),L=p(null),D=p([]),ue=p(!1),ve=p(!1),O=p(!1),le=p(!1),E=p([]),R=p(!1),q=p(new Map),A=p(null),Ie=p(0),he=p(!1),re=p(null),xe=p([]),Y=p([]),_e=p(window.innerHeight-80),U=p(1),F=p(20),ne=p(0),T=p(""),V=p(""),me=async t=>{V.value=t,U.value=1;try{await fetch("/api/config/cross_seed_review_filter",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({review_filter:t})})}catch(e){console.error("保存检查状态筛选失败:",e)}N()},S=J(()=>{const t=C.value,e=[];return t.paths&&t.paths.length>0&&e.push(`路径: ${t.paths.length}`),t.isDeleted==="0"?e.push("未删除"):t.isDeleted==="1"&&e.push("已删除"),t.excludeTargetSites&&t.excludeTargetSites.trim()!==""&&e.push(`不存在于: ${t.excludeTargetSites}`),e.join(", ")}),ke=J(()=>D.value.length>0&&C.value.excludeTargetSites&&C.value.excludeTargetSites.trim()!==""),Ge=J(()=>{const t=D.value.length,e=C.value.excludeTargetSites;return!e||e.trim()===""?`批量转种 (${t}) - 请先在筛选中选择目标站点`:`批量转种到 ${e} (${t})`}),Ye=J(()=>{const t=C.value;return t.paths&&t.paths.length>0||t.isDeleted!==""||t.excludeTargetSites&&t.excludeTargetSites.trim()!==""}),oe=p(!1),C=p({paths:[],isDeleted:"",excludeTargetSites:""}),Q=p({...C.value}),Ee=p([]),W=J({get:()=>Q.value.excludeTargetSites||"",set:t=>{Q.value.excludeTargetSites=t}}),Qe=()=>{Q.value.excludeTargetSites=""},ie=(t,e)=>{if(!e)return"";const u=ae.value[t];return u&&u[e]||e},j=t=>t?/^[^.]+[.][^.]+$/.test(t):!0,M=(t,e)=>{if(!e)return!0;const u=ae.value[t];return u?!!u[e]:!1},Ze=t=>{let e=[];if(typeof t=="string")try{e=JSON.parse(t)}catch{e=t.split(",").map(u=>u.trim()).filter(u=>u)}else Array.isArray(t)&&(e=t);return e.length===0?[]:e.map(u=>ae.value.tags[u]||u)},et=(t,e)=>{let u=[];if(typeof t=="string")try{u=JSON.parse(t)}catch{u=t.split(",").map(g=>g.trim()).filter(g=>g)}else Array.isArray(t)&&(u=t);if(u.length===0||e>=u.length)return"info";const d=u[e];return d==="禁转"||d==="tag.禁转"||!j(d)||!M("tags",d)?"danger":"info"},tt=(t,e)=>{let u=[];if(typeof t=="string")try{u=JSON.parse(t)}catch{u=t.split(",").map(g=>g.trim()).filter(g=>g)}else Array.isArray(t)&&(u=t);if(u.length===0||e>=u.length)return"";const d=u[e];return d==="禁转"||d==="tag.禁转"?"restricted-tag":!j(d)||!M("tags",d)?"invalid-tag":""},Te=t=>{if(!t)return"";try{const e=new Date(t);if(isNaN(e.getTime()))return t;const u=e.getFullYear(),d=String(e.getMonth()+1).padStart(2,"0"),g=String(e.getDate()).padStart(2,"0"),P=String(e.getHours()).padStart(2,"0"),se=String(e.getMinutes()).padStart(2,"0"),I=String(e.getSeconds()).padStart(2,"0");return`${u}-${d}-${g}
${P}:${se}:${I}`}catch{return t}},Ve=t=>{const e=["type","medium","video_codec","audio_codec","resolution","team","source"];for(const d of e){const g=t[d];if(g&&(!j(g)||!M(d,g)))return!0}let u=[];if(typeof t.tags=="string")try{u=JSON.parse(t.tags)}catch{u=t.tags.split(",").map(d=>d.trim()).filter(d=>d)}else Array.isArray(t.tags)&&(u=t.tags);for(const d of u)if(!j(d)||!M("tags",d))return!0;return!!t.unrecognized},st=t=>{const e=[],u=new Map;return t.sort().forEach(d=>{const g=d.replace(/^\/|\/$/g,"").split("/");let P="",se=e;g.forEach((I,Ae)=>{if(P=Ae===0?`/${I}`:`${P}/${I}`,!u.has(P)){const He={path:Ae===g.length-1?d:P,label:I,children:[]};u.set(P,He),se.push(He)}se=u.get(P).children})}),u.forEach(d=>{d.children&&d.children.length===0&&delete d.children}),e},N=async()=>{G.value=!0,L.value=null;try{const t=new URLSearchParams({page:U.value.toString(),page_size:F.value.toString(),search:T.value,path_filters:JSON.stringify(C.value.paths||[]),is_deleted:C.value.isDeleted,exclude_target_sites:C.value.excludeTargetSites,review_status:V.value});C.value.excludeTargetSites&&console.log("发送目标站点排除参数:",C.value.excludeTargetSites);const e=await fetch(`/api/cross-seed-data?${t.toString()}`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const u=await e.text();if(!u.startsWith("{")&&!u.startsWith("["))throw new Error("服务器响应不是有效的JSON格式");const d=JSON.parse(u);d.success?(ge.value=d.data,ne.value=d.total,d.reverse_mappings&&(ae.value=d.reverse_mappings),d.unique_paths&&(Y.value=d.unique_paths,xe.value=st(d.unique_paths)),d.target_sites&&(Ee.value=d.target_sites)):(L.value=d.error||"获取数据失败",_.error(d.error||"获取数据失败"))}catch(t){L.value=t.message||"网络错误",_.error(t.message||"网络错误")}finally{G.value=!1}},Se=async()=>{try{const t={page_size:F.value,search_query:T.value,active_filters:C.value};await fetch("/api/ui_settings/cross_seed",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}catch(t){console.error("无法保存UI设置:",t.message)}},$e=async()=>{try{const t=await fetch("/api/ui_settings/cross_seed");if(!t.ok){console.warn("无法加载UI设置，将使用默认值。");return}const e=await t.json();F.value=e.page_size??20,T.value=e.search_query??"",e.active_filters&&Object.assign(C.value,e.active_filters)}catch(t){console.error("加载UI设置时出错:",t)}},at=t=>{F.value=t,U.value=1,N(),Se()},De=t=>{U.value=t,N()},lt=()=>{C.value={paths:[],isDeleted:"",excludeTargetSites:""},U.value=1,N(),Se()},rt=()=>{Q.value={...C.value},oe.value=!0,$t(()=>{re.value&&C.value.paths.length>0&&re.value.setCheckedKeys(C.value.paths,!1)})},nt=()=>{if(re.value){const t=re.value.getCheckedKeys(!1);Q.value.paths=t}C.value={...Q.value},oe.value=!1,U.value=1,N(),Se()},Z=Lt();xt(T,()=>{U.value=1,N(),Se()});const ot=J(()=>!!Z.taskId),it=J(()=>Z.workingParams?.title||""),dt=async t=>{try{Z.reset();const e=await fetch(`/api/migrate/get_db_seed_info?torrent_id=${t.torrent_id}&site_name=${t.site_name}`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const u=await e.text();if(!u.startsWith("{")&&!u.startsWith("["))throw new Error("服务器响应不是有效的JSON格式");const d=JSON.parse(u);if(d.success){const g={...d.data,name:d.data.name||d.data.title,save_path:d.data.save_path||"",size:0,size_formatted:"0 B",progress:100,state:"completed",total_uploaded:0,total_uploaded_formatted:"0 B",downloaderId:d.data.downloader_id||null,sites:{[d.data.site_name]:{torrentId:d.data.torrent_id,comment:`id=${d.data.torrent_id}`}}};Z.setParams(g);const P={name:d.data.site_name,site:d.data.site_name.toLowerCase(),torrentId:d.data.torrent_id};Z.setSourceInfo(P),Z.setTaskId(`cross_seed_${t.id}_${Date.now()}`)}else _.error(d.error||"获取种子参数失败")}catch(e){_.error(e.message||"网络错误")}},ut=async t=>{try{await kt.confirm(`确定要永久删除种子数据 "${t.title}" 吗？此操作无法恢复！`,"确认永久删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e={torrent_id:t.torrent_id,site_name:t.site_name},u=await fetch("/api/cross-seed-data/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!u.ok)throw new Error(`HTTP error! status: ${u.status}`);const d=await u.json();d.success?(_.success(d.message||"删除成功"),N()):_.error(d.error||"删除失败")}catch(e){e!=="cancel"&&_.error(e.message||"网络错误")}},ze=()=>{Z.reset()},je=()=>{_.success("转种操作已完成！"),Z.reset(),N()},Me=()=>{_e.value=window.innerHeight-80};vt(async()=>{await $e(),await ce(),N(),window.addEventListener("resize",Me)});const ce=async()=>{try{const t=await fetch("/api/config/cross_seed_review_filter");if(t.ok){const e=await t.json();e.success&&(V.value=e.data||"")}}catch(t){console.error("加载检查状态筛选配置失败:",t)}},Pe=({row:t})=>t.is_deleted||Re(t.tags)||t.unrecognized?"deleted-row":t.is_reviewed?Je(t)?"":"selected-row-disabled":"unreviewed-row",Re=t=>{let e=[];if(typeof t=="string")try{e=JSON.parse(t)}catch{e=t.split(",").map(u=>u.trim()).filter(u=>u)}else Array.isArray(t)&&(e=t);return e.some(u=>u==="禁转"||u==="tag.禁转")},Je=t=>O.value?!0:Re(t.tags)?!1:C.value.isDeleted==="1"?!Ve(t):!(t.is_deleted||Ve(t)||!t.is_reviewed),ct=t=>{D.value=t,O.value},pt=()=>{ue.value=!0},r=async()=>{const t=C.value.excludeTargetSites;if(!t||t.trim()===""){_.warning("请先在筛选中选择目标站点");return}try{l();const e={target_site_name:t,seeds:D.value.map(g=>({hash:g.hash,torrent_id:g.torrent_id,site_name:g.site_name,nickname:g.nickname}))};console.log("批量转种数据:",e),le.value=!0,H();const u=await fetch("/api/go-api/batch-enhance",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!u.ok)throw X(),new Error(`HTTP error! status: ${u.status}`);const d=await u.json();d.success?_.success(`批量转种请求已发送，成功 ${d.data.seeds_processed} 个，失败 ${d.data.seeds_failed} 个`):(X(),_.error(d.error||"批量转种失败"))}catch(e){X(),_.error(e.message||"网络错误")}},l=()=>{ue.value=!1},m=()=>O.value?D.value.length===0?"退出删除模式":`删除选中项 (${D.value.length})`:"批量删除模式",y=async()=>{O.value?(O.value=!1,D.value=[]):(O.value=!0,D.value=[])},b=async()=>{if(D.value.length===0){_.warning("请先选择要删除的行");return}try{await kt.confirm(`确定要删除选中的 ${D.value.length} 条种子数据吗？此操作无法恢复！`,"确认批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const t={items:D.value.map(d=>({torrent_id:d.torrent_id,site_name:d.site_name}))},e=await fetch("/api/cross-seed-data/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const u=await e.json();u.success?(_.success(u.message||`成功删除 ${u.deleted_count} 条数据`),D.value=[],O.value=!1,N()):_.error(u.error||"批量删除失败")}catch(t){t!=="cancel"&&_.error(t.message||"网络错误")}},$=()=>{ve.value=!0},ee=()=>{ve.value=!1},ye=()=>{_.success("批量获取种子数据已完成，正在刷新列表..."),N()},B=t=>t?t.includes("成功")||t.includes("失败"):!1,Ne=J(()=>{if(E.value.length===0)return!1;const t=E.value[0];return!B(t.downloader_add_result)}),H=()=>{X(),te(),A.value=setInterval(async()=>{le.value?await te():X()},wa)},X=()=>{A.value&&(clearInterval(A.value),A.value=null),Ie.value=0},Le=()=>{le.value=!0,te(),H()},Be=()=>{le.value=!1,X(),N()},te=async()=>{try{K();const t=await fetch("/api/go-api/records",{method:"GET",headers:{"Content-Type":"application/json"}});if(t.ok){const e=await t.json();e.success?E.value=e.records||[]:_.error(e.error||"获取记录失败")}else t.status===404?(E.value=[],_.warning("记录接口暂未实现，请等待后续更新")):_.error("获取记录失败")}catch(t){console.error("获取记录时出错:",t),_.error("获取记录失败: "+(t.message||"网络错误"))}},pe=async()=>{try{(await fetch("/api/go-api/records",{method:"DELETE",headers:{"Content-Type":"application/json"}})).ok?(E.value=[],K(),_.success("记录已清空")):(E.value=[],K(),_.success("本地记录已清空"))}catch{E.value=[],K(),_.success("本地记录已清空")}},ft=t=>{switch(t){case"success":return"success";case"failed":return"danger";case"filtered":return"warning";case"processing":return"primary";case"pending":return"info";default:return"info"}},gt=t=>{switch(t){case"success":return"成功";case"failed":return"失败";case"filtered":return"已过滤";case"processing":return"处理中";case"pending":return"等待中";default:return"未知"}},Ce=t=>t?(q.value.has(t)||q.value.set(t,q.value.size+1),q.value.get(t)):"-",v=t=>{if(typeof t!="number")return"info";const e=["success","primary","warning","info"];return e[(t-1)%e.length]},K=()=>{q.value.clear()},we=t=>t.startsWith("成功")?"success":t.startsWith("失败")?"danger":"info",Pt=t=>t.startsWith("成功")?"#67c23a":t.startsWith("失败")?"#f56c6c":"#909399",_t=t=>t.startsWith("成功:")||t.startsWith("失败:")?t.substring(3):t,Rt=t=>{if(!t)return t;const e=t.indexOf("&uploaded");return e!==-1?t.substring(0,e):t},Nt=t=>{try{const e=new Date(t);if(isNaN(e.getTime()))return t;const u=e.getFullYear(),d=String(e.getMonth()+1).padStart(2,"0"),g=String(e.getDate()).padStart(2,"0"),P=String(e.getHours()).padStart(2,"0"),se=String(e.getMinutes()).padStart(2,"0"),I=String(e.getSeconds()).padStart(2,"0");return`${u}-${d}-${g}
${P}:${se}:${I}`}catch{return t}},mt=t=>{if(!t)return 0;const e=t.match(/(\d+)\/(\d+)/);if(e){const u=parseInt(e[1]),d=parseInt(e[2]);if(d>0)return Math.round(u/d*100)}return 0},Bt=t=>t<30?"#e6a23c":t<70?"#409eff":"#67c23a",Ot=async()=>{he.value=!0;try{const t=await fetch("/api/go-api/batch-enhance/stop",{method:"POST",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=await t.json();e.success?(_.success("批量转种已停止"),X(),await te()):_.error(e.error||"停止批量转种失败")}catch(t){_.error(t.message||"停止批量转种失败")}finally{he.value=!1}};return Ct(()=>{window.removeEventListener("resize",Me),X()}),(t,e)=>{const u=w("el-alert"),d=w("el-input"),g=w("el-button"),P=w("el-radio-button"),se=w("el-radio-group"),I=w("el-tag"),Ae=w("el-pagination"),Ue=w("el-divider"),He=w("el-tree"),qe=w("el-radio"),Oe=w("el-card"),k=w("el-table-column"),yt=w("el-table"),Ft=w("el-progress"),It=w("el-link"),Et=w("el-tooltip"),Vt=w("el-empty"),wt=Tt("loading");return c(),h("div",xs,[L.value?(c(),z(u,{key:0,title:L.value,type:"error","show-icon":"",closable:!1,style:{margin:"0","border-radius":"0"}},null,8,["title"])):x("",!0),i("div",Ts,[a(d,{modelValue:T.value,"onUpdate:modelValue":e[0]||(e[0]=n=>T.value=n),placeholder:"搜索标题或种子ID...",clearable:"",class:"search-input",style:{width:"300px","margin-right":"15px"}},null,8,["modelValue"]),a(g,{type:"success",onClick:pt,plain:"",style:{"margin-right":"15px"},disabled:!ke.value||O.value},{default:s(()=>[o(f(Ge.value),1)]),_:1},8,["disabled"]),a(g,{type:"info",onClick:Le,plain:"",style:{"margin-right":"15px"}},{default:s(()=>[...e[10]||(e[10]=[o(" 转种记录 ",-1)])]),_:1}),a(g,{type:"warning",onClick:$,plain:"",style:{"margin-right":"15px"}},{default:s(()=>[...e[11]||(e[11]=[o(" 获取数据 ",-1)])]),_:1}),a(g,{type:"danger",onClick:e[1]||(e[1]=n=>O.value&&D.value.length>0?b():y()),plain:"",style:{"margin-right":"15px"}},{default:s(()=>[o(f(m()),1)]),_:1}),a(g,{type:"primary",onClick:rt,plain:"",style:{"margin-right":"15px"}},{default:s(()=>[...e[12]||(e[12]=[o(" 筛选 ",-1)])]),_:1}),a(se,{modelValue:V.value,"onUpdate:modelValue":e[2]||(e[2]=n=>V.value=n),onChange:me,style:{"margin-right":"15px"}},{default:s(()=>[a(P,{label:""},{default:s(()=>[...e[13]||(e[13]=[o("全部",-1)])]),_:1}),a(P,{label:"reviewed"},{default:s(()=>[...e[14]||(e[14]=[o("已检查",-1)])]),_:1}),a(P,{label:"unreviewed"},{default:s(()=>[...e[15]||(e[15]=[o("待检查",-1)])]),_:1}),a(P,{label:"error"},{default:s(()=>[...e[16]||(e[16]=[o("错误",-1)])]),_:1})]),_:1},8,["modelValue"]),Ye.value?(c(),h("div",$s,[a(I,{type:"info",size:"default",effect:"plain"},{default:s(()=>[o(f(S.value),1)]),_:1}),a(g,{type:"danger",link:"",style:{padding:"0","margin-left":"8px"},onClick:lt},{default:s(()=>[...e[17]||(e[17]=[o("清除",-1)])]),_:1})])):x("",!0),ge.value.length>0?(c(),h("div",Ds,[a(Ae,{"current-page":U.value,"onUpdate:currentPage":e[3]||(e[3]=n=>U.value=n),"page-size":F.value,"onUpdate:pageSize":e[4]||(e[4]=n=>F.value=n),"page-sizes":[20,50,100],total:ne.value,layout:"total, sizes, prev, pager, next",onSizeChange:at,onCurrentChange:De,background:""},null,8,["current-page","page-size","total"])])):x("",!0)]),oe.value?(c(),h("div",{key:1,class:"filter-overlay",onClick:e[9]||(e[9]=ht(n=>oe.value=!1,["self"]))},[a(Oe,{class:"filter-card"},{header:s(()=>[i("div",zs,[e[19]||(e[19]=i("span",null,"筛选选项",-1)),a(g,{type:"danger",circle:"",onClick:e[5]||(e[5]=n=>oe.value=!1),plain:""},{default:s(()=>[...e[18]||(e[18]=[o("X",-1)])]),_:1})])]),default:s(()=>[i("div",Ps,[a(Ue,{"content-position":"left"},{default:s(()=>[...e[20]||(e[20]=[o("保存路径",-1)])]),_:1}),i("div",Rs,[a(He,{ref_key:"pathTreeRef",ref:re,data:xe.value,"show-checkbox":"","node-key":"path","default-expand-all":"","expand-on-click-node":!1,"check-on-click-node":"","check-strictly":!0,props:{class:"path-tree-node"}},null,8,["data"])]),a(Ue,{"content-position":"left"},{default:s(()=>[...e[21]||(e[21]=[o("删除状态",-1)])]),_:1}),a(se,{modelValue:Q.value.isDeleted,"onUpdate:modelValue":e[6]||(e[6]=n=>Q.value.isDeleted=n),style:{width:"100%"}},{default:s(()=>[a(qe,{label:""},{default:s(()=>[...e[22]||(e[22]=[o("全部",-1)])]),_:1}),a(qe,{label:"0"},{default:s(()=>[...e[23]||(e[23]=[o("未删除",-1)])]),_:1}),a(qe,{label:"1"},{default:s(()=>[...e[24]||(e[24]=[o("已删除",-1)])]),_:1})]),_:1},8,["modelValue"]),a(Ue,{"content-position":"left"},{default:s(()=>[...e[25]||(e[25]=[o("不存在种子筛选",-1)])]),_:1}),i("div",Ns,[i("div",Bs,[W.value?(c(),h("div",Os,[a(I,{type:"info",size:"default",effect:"plain"},{default:s(()=>[o("已选择: "+f(W.value),1)]),_:1}),a(g,{type:"danger",link:"",style:{padding:"0","margin-left":"8px"},onClick:Qe},{default:s(()=>[...e[26]||(e[26]=[o("清除",-1)])]),_:1})])):(c(),h("div",Fs,[a(I,{type:"info",size:"default",effect:"plain"},{default:s(()=>[...e[27]||(e[27]=[o("未选择",-1)])]),_:1})]))]),i("div",Is,[a(se,{modelValue:W.value,"onUpdate:modelValue":e[7]||(e[7]=n=>W.value=n),class:"target-sites-radio-group"},{default:s(()=>[(c(!0),h(fe,null,be(Ee.value,n=>(c(),z(qe,{key:n,label:n,class:"target-site-radio"},{default:s(()=>[o(f(n),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])])])]),i("div",Es,[a(g,{onClick:e[8]||(e[8]=n=>oe.value=!1)},{default:s(()=>[...e[28]||(e[28]=[o("取消",-1)])]),_:1}),a(g,{type:"primary",onClick:nt},{default:s(()=>[...e[29]||(e[29]=[o("确认",-1)])]),_:1})])]),_:1})])):x("",!0),i("div",Vs,[Fe((c(),z(yt,{data:ge.value,border:"",style:{width:"100%"},"empty-text":"暂无转种数据","max-height":_e.value,height:"100%","row-class-name":Pe,onSelectionChange:ct,class:"glass-table"},{default:s(()=>[a(k,{type:"selection",width:"55",align:"center",selectable:Je}),a(k,{prop:"torrent_id",label:"种子ID",align:"center",width:"80","show-overflow-tooltip":""}),a(k,{prop:"nickname",label:"站点名称",width:"100",align:"center"},{default:s(n=>[i("div",js,f(n.row.nickname),1)]),_:1}),a(k,{prop:"title",label:"标题",align:"center"},{default:s(n=>[i("div",Ms,[i("div",{class:"subtitle-line",title:n.row.subtitle},f(n.row.subtitle||""),9,Js),i("div",{class:"main-title-line",title:n.row.title},f(n.row.title||""),9,Ls)])]),_:1}),a(k,{prop:"type",label:"类型",width:"100",align:"center"},{default:s(n=>[i("div",{class:de(["mapped-cell",{"invalid-value":!j(n.row.type)||!M("type",n.row.type)}])},f(ie("type",n.row.type)),3)]),_:1}),a(k,{prop:"medium",label:"媒介",width:"100",align:"center"},{default:s(n=>[i("div",{class:de(["mapped-cell",{"invalid-value":!j(n.row.medium)||!M("medium",n.row.medium)}])},f(ie("medium",n.row.medium)),3)]),_:1}),a(k,{prop:"video_codec",label:"视频编码",width:"120",align:"center"},{default:s(n=>[i("div",{class:de(["mapped-cell",{"invalid-value":!j(n.row.video_codec)||!M("video_codec",n.row.video_codec)}])},f(ie("video_codec",n.row.video_codec)),3)]),_:1}),a(k,{prop:"audio_codec",label:"音频编码",width:"90",align:"center"},{default:s(n=>[i("div",{class:de(["mapped-cell",{"invalid-value":!j(n.row.audio_codec)||!M("audio_codec",n.row.audio_codec)}])},f(ie("audio_codec",n.row.audio_codec)),3)]),_:1}),a(k,{prop:"resolution",label:"分辨率",width:"90",align:"center"},{default:s(n=>[i("div",{class:de(["mapped-cell",{"invalid-value":!j(n.row.resolution)||!M("resolution",n.row.resolution)}])},f(ie("resolution",n.row.resolution)),3)]),_:1}),a(k,{prop:"team",label:"制作组",width:"120",align:"center"},{default:s(n=>[i("div",{class:de(["mapped-cell",{"invalid-value":!j(n.row.team)||!M("team",n.row.team)}])},f(ie("team",n.row.team)),3)]),_:1}),a(k,{prop:"source",label:"产地",width:"100",align:"center"},{default:s(n=>[i("div",{class:de(["mapped-cell",{"invalid-value":!j(n.row.source)||!M("source",n.row.source)}])},f(ie("source",n.row.source)),3)]),_:1}),a(k,{prop:"tags",label:"标签",align:"center",width:"170"},{default:s(n=>[i("div",As,[(c(!0),h(fe,null,be(Ze(n.row.tags),(We,bt)=>(c(),z(I,{key:We,size:"small",type:et(n.row.tags,bt),class:de(tt(n.row.tags,bt)),style:{margin:"2px"}},{default:s(()=>[o(f(We),1)]),_:2},1032,["type","class"]))),128))])]),_:1}),a(k,{prop:"unrecognized",label:"无法识别",width:"120",align:"center"},{default:s(n=>[i("div",{class:de(["mapped-cell",{"invalid-value":n.row.unrecognized}])},f(n.row.unrecognized||""),3)]),_:1}),a(k,{prop:"updated_at",label:"更新时间",width:"140",align:"center",sortable:""},{default:s(n=>[i("div",Us,f(n.row.is_deleted||Re(n.row.tags)?"已删除/禁转":Te(n.row.updated_at)),1)]),_:1}),a(k,{label:"操作",width:"130",align:"center",fixed:"right"},{default:s(n=>[a(g,{size:"small",type:"primary",onClick:We=>dt(n.row)},{default:s(()=>[...e[30]||(e[30]=[o("编辑",-1)])]),_:1},8,["onClick"]),a(g,{size:"small",type:"danger",onClick:We=>ut(n.row),style:{"margin-left":"5px"}},{default:s(()=>[...e[31]||(e[31]=[o("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data","max-height"])),[[wt,G.value]])]),ot.value?(c(),h("div",Hs,[a(Oe,{class:"cross-seed-card",shadow:"always"},{header:s(()=>[i("div",qs,[i("span",null,"转种 - "+f(it.value),1),a(g,{type:"danger",circle:"",onClick:ze,plain:""},{default:s(()=>[...e[32]||(e[32]=[o("X",-1)])]),_:1})])]),default:s(()=>[i("div",Ws,[a(At,{"show-complete-button":!0,onComplete:je,onCancel:ze})])]),_:1})])):x("",!0),ue.value?(c(),h("div",Xs,[a(Oe,{class:"batch-cross-seed-card",shadow:"always"},{header:s(()=>[i("div",Ks,[e[34]||(e[34]=i("span",null,"批量转种",-1)),a(g,{type:"danger",circle:"",onClick:l,plain:""},{default:s(()=>[...e[33]||(e[33]=[o("X",-1)])]),_:1})])]),default:s(()=>[i("div",Gs,[i("div",Ys,[i("div",Qs,[i("p",null,[e[35]||(e[35]=i("strong",null,"目标站点：",-1)),o(f(C.value.excludeTargetSites),1)]),i("p",null,[e[36]||(e[36]=i("strong",null,"选中种子数量：",-1)),o(f(D.value.length)+" 个",1)]),e[37]||(e[37]=i("p",{style:{color:"#909399","font-size":"13px","margin-top":"10px"}}," 将把选中的种子转种到上述目标站点，请确认无误后点击确定。 ",-1))])])]),i("div",Zs,[a(g,{onClick:l},{default:s(()=>[...e[38]||(e[38]=[o("取消",-1)])]),_:1}),a(g,{type:"primary",onClick:r},{default:s(()=>[...e[39]||(e[39]=[o("确定",-1)])]),_:1})])]),_:1})])):x("",!0),le.value?(c(),h("div",ea,[a(Oe,{class:"record-view-card",shadow:"always"},{header:s(()=>[i("div",ta,[i("span",null,"批量转种记录 "+f(A.value?"(自动刷新中...)":""),1),e[44]||(e[44]=i("div",{class:"record-warning-text"},"批量转种需要等待种子文件验证，每个种子大概3s",-1)),i("div",sa,[a(g,{type:"danger",size:"small",onClick:Ot,disabled:he.value},{default:s(()=>[o(f(he.value?"停止中...":"停止转种"),1)]),_:1},8,["disabled"]),a(g,{type:"primary",size:"small",onClick:te,loading:R.value},{default:s(()=>[...e[40]||(e[40]=[o(" 刷新 ",-1)])]),_:1},8,["loading"]),A.value?(c(),z(g,{key:0,type:"warning",size:"small",onClick:X},{default:s(()=>[...e[41]||(e[41]=[o(" 停止自动刷新 ",-1)])]),_:1})):Ne.value?(c(),z(g,{key:1,type:"success",size:"small",onClick:H},{default:s(()=>[...e[42]||(e[42]=[o(" 开启自动刷新 ",-1)])]),_:1})):x("",!0),a(g,{type:"danger",circle:"",onClick:Be,plain:""},{default:s(()=>[...e[43]||(e[43]=[o("X",-1)])]),_:1})])])]),default:s(()=>[i("div",aa,[E.value.length>0?(c(),h("div",la,[Fe((c(),z(yt,{data:E.value,style:{width:"100%"},size:"small","element-loading-text":"加载记录中...",stripe:""},{default:s(()=>[a(k,{prop:"batch_id",label:"批次ID",width:"80",align:"center"},{default:s(n=>[a(I,{size:"small",type:v(Ce(n.row.batch_id)),effect:"dark"},{default:s(()=>[o(f(Ce(n.row.batch_id)),1)]),_:2},1032,["type"])]),_:1}),a(k,{prop:"title",label:"种子标题","min-width":"250",align:"center","show-overflow-tooltip":""}),a(k,{prop:"source_site",label:"源站点",width:"80",align:"center"}),a(k,{prop:"target_site",label:"目标站点",width:"80",align:"center"}),a(k,{prop:"video_size_gb",label:"视频大小",width:"80",align:"center"},{default:s(n=>[n.row.video_size_gb?(c(),h("span",ra,f(n.row.video_size_gb)+"GB",1)):(c(),h("span",na,"-"))]),_:1}),a(k,{prop:"status",label:"状态",width:"80",align:"center"},{default:s(n=>[a(I,{type:ft(n.row.status),size:"small"},{default:s(()=>[o(f(gt(n.row.status)),1)]),_:2},1032,["type"])]),_:1}),a(k,{prop:"progress",label:"进度",width:"100",align:"center"},{default:s(n=>[n.row.progress?(c(),h("div",oa,[a(Ft,{percentage:mt(n.row.progress),color:Bt(mt(n.row.progress)),"stroke-width":8,"show-text":!1,class:"progress-bar"},null,8,["percentage","color"]),i("span",ia,f(n.row.progress),1)])):(c(),h("span",da,"-"))]),_:1}),a(k,{prop:"error_detail",label:"详情",width:"110",align:"center","show-overflow-tooltip":""},{default:s(n=>[n.row.status==="success"&&n.row.success_url?(c(),h("span",ua,[a(It,{type:"primary",href:Rt(n.row.success_url),target:"_blank"},{default:s(()=>[...e[45]||(e[45]=[o("查看详情页",-1)])]),_:1},8,["href"])])):n.row.error_detail?(c(),h("span",ca,f(n.row.error_detail),1)):(c(),h("span",pa,"-"))]),_:1}),a(k,{prop:"downloader_add_result",label:"下载器状态",width:"150",align:"center"},{default:s(n=>[n.row.downloader_add_result?(c(),h(fe,{key:0},[we(n.row.downloader_add_result)==="danger"?(c(),z(Et,{key:0,effect:"dark",placement:"top"},{content:s(()=>[o(f(_t(n.row.downloader_add_result)),1)]),default:s(()=>[e[46]||(e[46]=i("span",{style:{color:"#f56c6c"}},"错误",-1))]),_:2},1024)):(c(),h("span",{key:1,style:Jt([{"text-align":"center"},{color:Pt(n.row.downloader_add_result)}])},f(_t(n.row.downloader_add_result)),5))],64)):(c(),h("span",fa,"-"))]),_:1}),a(k,{prop:"processed_at",label:"处理时间",width:"100",align:"center"},{default:s(n=>[i("div",ga,f(Nt(n.row.processed_at)),1)]),_:1})]),_:1},8,["data"])),[[wt,R.value]])])):x("",!0),E.value.length===0&&!R.value?(c(),h("div",va,[a(Vt,{description:"暂无批量转种记录"})])):x("",!0)]),i("div",ha,[a(g,{onClick:pe,type:"warning"},{default:s(()=>[...e[47]||(e[47]=[o("清空记录",-1)])]),_:1}),a(g,{onClick:Be},{default:s(()=>[...e[48]||(e[48]=[o("关闭",-1)])]),_:1})])]),_:1})])):x("",!0),ve.value?(c(),h("div",_a,[a(Oe,{class:"batch-fetch-main-card",shadow:"always"},{header:s(()=>[i("div",ma,[e[50]||(e[50]=i("span",null,"批量获取种子数据",-1)),a(g,{type:"danger",circle:"",onClick:ee,plain:""},{default:s(()=>[...e[49]||(e[49]=[o("X",-1)])]),_:1})])]),default:s(()=>[i("div",ya,[a(Cs,{onCancel:ee,onFetchCompleted:ye})])]),_:1})])):x("",!0)])}}}),Ca=Dt(ba,[["__scopeId","data-v-9bd850d6"]]);export{Ca as default};
