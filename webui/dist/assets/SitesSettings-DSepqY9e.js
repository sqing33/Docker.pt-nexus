import{p as Z,r as f,c as N,O as ee,o as le,g as k,z as p,a as T,i as u,u as ae,e as l,w as o,f as c,x,X as oe,a3 as te,v as se,m as S,j as d,t as U,ai as ne,ah as ie,k as re,R as ue,h as v}from"./index-Blemp3JD.js";const de={class:"cookie-view-container"},pe={class:"top-actions cookie-actions glass-pagination"},ce={class:"right-action-group"},me={class:"settings-view"},fe={style:{display:"flex","justify-content":"center","align-items":"center",width:"100%",height:"100%"}},ge={class:"settings-footer glass-pagination"},ve={class:"pagination-container"},_e={class:"page-size-text"},ke={key:0,class:"form-tip",style:{color:"#409eff","font-weight":"bold"}},ye={class:"dialog-footer"},y="/api",we={__name:"SitesSettings",setup(be){const h=f(!1),z=f([]),P=f(!1),B=f(!1),i=f({url:"",key:"",e2e_password:""}),w=f(""),L=f("active"),m=f({currentPage:1,pageSize:30,total:0}),b=f(!1),R=f(null),s=f({id:null,site:"",nickname:"",base_url:"",special_tracker_domain:"",group:"",cookie:"",passkey:"",speed_limit:0}),D=N(()=>{if(!w.value)return z.value;const t=w.value.toLowerCase();return z.value.filter(e=>{const n=(e.nickname||"").toLowerCase(),r=(e.site||"").toLowerCase(),$=(e.group||"").toLowerCase();return n.includes(t)||r.includes(t)||$.includes(t)})}),F=N(()=>{m.value.total=D.value.length;const t=(m.value.currentPage-1)*m.value.pageSize,e=t+m.value.pageSize;return D.value.slice(t,e)});ee(w,()=>{m.value.currentPage=1}),le(()=>{O(),V()});const O=async()=>{try{const t=await k.get(`${y}/settings`);t.data&&t.data.cookiecloud&&(i.value.url=t.data.cookiecloud.url||"",i.value.key=t.data.cookiecloud.key||"",i.value.e2e_password="")}catch{p.error("加载CookieCloud配置失败！")}},V=async()=>{P.value=!0;try{const t=await k.get(`${y}/sites`,{params:{filter_by_torrents:L.value}});z.value=t.data}catch{p.error("获取站点列表失败！")}finally{P.value=!1}},j=()=>{m.value.currentPage=1,V()},A=async()=>{if(!i.value.url||!i.value.key){p.warning("CookieCloud URL 和 KEY 不能为空！");return}B.value=!0;try{await k.post(`${y}/settings`,{cookiecloud:i.value});const t=await k.post(`${y}/cookiecloud/sync`,i.value);if(t.data.success){let e=t.data.message;e&&(e=e.replace(/在 CookieCloud 中另有 \d+ 个未匹配的 Cookie。?/,"")),p.success(`配置已保存. ${e||"同步完成！"}`),await V()}else p.error(t.data.message||"同步失败，但配置已保存。")}catch(t){const e=t.response?.data?.message||"操作失败，请检查网络或后端服务。";p.error(e)}finally{B.value=!1}},I=t=>{const e=JSON.parse(JSON.stringify(t));s.value=e,b.value=!0},J=async()=>{h.value=!0;try{const t=JSON.parse(JSON.stringify(s.value));t.cookie&&(t.cookie=t.cookie.trim());const e=await k.post(`${y}/sites/update`,t);e.data.success?(p.success(e.data.message),b.value=!1,await V()):p.error(e.data.message||"操作失败！")}catch(t){const e=t.response?.data?.message||"请求失败，请检查网络或后端服务。";p.error(e)}finally{h.value=!1}},K=t=>{ue.confirm("","警告",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0,message:`您确定要删除站点【${t.nickname}】吗？<br/>可以通过修改 config.json 然后重启恢复。`}).then(async()=>{try{const e=await k.post(`${y}/sites/delete`,{id:t.id});e.data.success?(p.success("站点已删除。"),await V()):p.error(e.data.message||"删除失败！")}catch(e){const n=e.response?.data?.message||"删除请求失败。";p.error(n)}}).catch(()=>{p.info("操作已取消。")})};return(t,e)=>{const n=c("el-input"),r=c("el-form-item"),$=c("el-icon"),C=c("el-button"),E=c("el-form"),g=c("el-table-column"),_=c("el-tag"),Y=c("el-table"),M=c("el-radio-button"),q=c("el-radio-group"),H=c("el-pagination"),Q=c("el-input-number"),W=c("el-dialog"),X=se("loading");return v(),T("div",de,[u("div",pe,[l(E,{model:i.value,inline:"",class:"cookie-cloud-form"},{default:o(()=>[l(r,{label:"CookieCloud"},{default:o(()=>[l(n,{modelValue:i.value.url,"onUpdate:modelValue":e[0]||(e[0]=a=>i.value.url=a),placeholder:"http://127.0.0.1:8088",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),l(r,{label:"KEY"},{default:o(()=>[l(n,{modelValue:i.value.key,"onUpdate:modelValue":e[1]||(e[1]=a=>i.value.key=a),placeholder:"KEY (UUID)",clearable:"",style:{width:"100px"}},null,8,["modelValue"])]),_:1}),l(r,{label:"端对端密码"},{default:o(()=>[l(n,{modelValue:i.value.e2e_password,"onUpdate:modelValue":e[2]||(e[2]=a=>i.value.e2e_password=a),type:"password","show-password":"",placeholder:"端对端加密密码",clearable:"",style:{width:"125px"}},null,8,["modelValue"])]),_:1}),l(r,null,{default:o(()=>[l(C,{type:"primary",size:"large",onClick:A,loading:B.value},{default:o(()=>[l($,null,{default:o(()=>[l(x(oe))]),_:1}),e[17]||(e[17]=u("span",null,"同步Cookie",-1))]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),u("div",ce,[l(n,{modelValue:w.value,"onUpdate:modelValue":e[3]||(e[3]=a=>w.value=a),placeholder:"搜索站点昵称/标识/官组",clearable:"","prefix-icon":x(te),class:"search-input"},null,8,["modelValue","prefix-icon"])])]),ae((v(),T("div",me,[l(Y,{data:F.value,class:"settings-table glass-table",height:"100%"},{default:o(()=>[l(g,{prop:"nickname",label:"站点昵称",width:"150",sortable:""}),l(g,{prop:"site",label:"站点标识",width:"200","show-overflow-tooltip":""}),l(g,{prop:"base_url",label:"基础URL",width:"225","show-overflow-tooltip":""}),l(g,{prop:"group",label:"官组","show-overflow-tooltip":""}),l(g,{label:"限速",width:"200",align:"center"},{default:o(a=>[u("div",fe,[a.row.speed_limit==0?(v(),S(_,{key:0,type:"error",size:"small"},{default:o(()=>[...e[18]||(e[18]=[d(" 当前不限速，重启恢复默认限速 ",-1)])]),_:1})):a.row.speed_limit>999?(v(),S(_,{key:1,type:"success",size:"small"},{default:o(()=>[...e[19]||(e[19]=[d(" 不限速 ",-1)])]),_:1})):(v(),S(_,{key:2,type:"primary",size:"small"},{default:o(()=>[d(U(a.row.speed_limit)+" MB/s ",1)]),_:2},1024))])]),_:1}),l(g,{label:"Cookie",width:"100",align:"center"},{default:o(a=>[l(_,{type:a.row.has_cookie?"success":"danger"},{default:o(()=>[d(U(a.row.has_cookie?"已配置":"未配置"),1)]),_:2},1032,["type"])]),_:1}),l(g,{label:"Passkey",width:"100",align:"center"},{default:o(a=>[["hddolby","m-team","hdtime"].includes(a.row.site)?(v(),S(_,{key:0,type:a.row.has_passkey?"success":"danger"},{default:o(()=>[d(U(a.row.has_passkey?"已配置":"未配置"),1)]),_:2},1032,["type"])):(v(),S(_,{key:1,type:"success"},{default:o(()=>[...e[20]||(e[20]=[d(" 自动获取 ",-1)])]),_:1}))]),_:1}),l(g,{label:"操作",width:"180",align:"center",fixed:"right"},{default:o(a=>[l(C,{type:"primary",icon:x(ne),link:"",onClick:G=>I(a.row)},{default:o(()=>[...e[21]||(e[21]=[d(" 编辑 ",-1)])]),_:1},8,["icon","onClick"]),l(C,{type:"danger",icon:x(ie),link:"",onClick:G=>K(a.row)},{default:o(()=>[...e[22]||(e[22]=[d(" 删除 ",-1)])]),_:1},8,["icon","onClick"])]),_:1})]),_:1},8,["data"])])),[[X,P.value]]),u("div",ge,[l(q,{modelValue:L.value,"onUpdate:modelValue":e[4]||(e[4]=a=>L.value=a),onChange:j},{default:o(()=>[l(M,{label:"active"},{default:o(()=>[...e[23]||(e[23]=[d("现有站点",-1)])]),_:1}),l(M,{label:"all"},{default:o(()=>[...e[24]||(e[24]=[d("所有站点",-1)])]),_:1})]),_:1},8,["modelValue"]),u("div",ve,[u("div",_e,U(m.value.pageSize)+" 条/页",1),l(H,{"current-page":m.value.currentPage,"onUpdate:currentPage":e[5]||(e[5]=a=>m.value.currentPage=a),"page-size":m.value.pageSize,"onUpdate:pageSize":e[6]||(e[6]=a=>m.value.pageSize=a),total:m.value.total,layout:"total, prev, pager, next, jumper",background:""},null,8,["current-page","page-size","total"])])]),l(W,{modelValue:b.value,"onUpdate:modelValue":e[16]||(e[16]=a=>b.value=a),title:"编辑站点",width:"700px","close-on-click-modal":!1},{footer:o(()=>[u("span",ye,[l(C,{onClick:e[15]||(e[15]=a=>b.value=!1)},{default:o(()=>[...e[30]||(e[30]=[d("取消",-1)])]),_:1}),l(C,{type:"primary",onClick:J,loading:h.value},{default:o(()=>[...e[31]||(e[31]=[d(" 保存 ",-1)])]),_:1},8,["loading"])])]),default:o(()=>[l(E,{model:s.value,ref_key:"siteFormRef",ref:R,"label-width":"140px","label-position":"left"},{default:o(()=>[l(r,{label:"站点标识",prop:"site",required:""},{default:o(()=>[l(n,{modelValue:s.value.site,"onUpdate:modelValue":e[7]||(e[7]=a=>s.value.site=a),placeholder:"例如：pt",disabled:""},null,8,["modelValue"]),e[25]||(e[25]=u("div",{class:"form-tip"},"站点标识不可修改。",-1))]),_:1}),l(r,{label:"站点昵称",prop:"nickname",required:""},{default:o(()=>[l(n,{modelValue:s.value.nickname,"onUpdate:modelValue":e[8]||(e[8]=a=>s.value.nickname=a),placeholder:"例如：PT站"},null,8,["modelValue"])]),_:1}),l(r,{label:"基础URL",prop:"base_url"},{default:o(()=>[l(n,{modelValue:s.value.base_url,"onUpdate:modelValue":e[9]||(e[9]=a=>s.value.base_url=a),placeholder:"例如：pt.com"},null,8,["modelValue"]),e[26]||(e[26]=u("div",{class:"form-tip"},"用于拼接种子详情页链接。",-1))]),_:1}),l(r,{label:"Tracker域名",prop:"special_tracker_domain"},{default:o(()=>[l(n,{modelValue:s.value.special_tracker_domain,"onUpdate:modelValue":e[10]||(e[10]=a=>s.value.special_tracker_domain=a),placeholder:"例如：pt-tracker.com"},null,8,["modelValue"]),e[27]||(e[27]=u("div",{class:"form-tip"}," 如果站点的Tracker域名与主域名的二级域名（则域名去掉前缀后缀部分）不同，请在此填写。 ",-1))]),_:1}),l(r,{label:"关联官组",prop:"group"},{default:o(()=>[l(n,{modelValue:s.value.group,"onUpdate:modelValue":e[11]||(e[11]=a=>s.value.group=a),placeholder:"例如：PT, PTWEB"},null,8,["modelValue"]),e[28]||(e[28]=u("div",{class:"form-tip"},"用于识别种子所属发布组，多个组用英文逗号(,)分隔。",-1))]),_:1}),l(r,{label:"Cookie",prop:"cookie"},{default:o(()=>[l(n,{modelValue:s.value.cookie,"onUpdate:modelValue":e[12]||(e[12]=a=>s.value.cookie=a),type:"textarea",rows:3,placeholder:"从浏览器获取的Cookie字符串"},null,8,["modelValue"])]),_:1}),l(r,{label:"Passkey",prop:"passkey"},{default:o(()=>[l(n,{modelValue:s.value.passkey,"onUpdate:modelValue":e[13]||(e[13]=a=>s.value.passkey=a),placeholder:"站点的Passkey"},null,8,["modelValue"]),s.value.site==="hddolby"?(v(),T("div",ke," 杜比的passkey为种子详情页复制种子链接时downhash=后的部分 ")):re("",!0)]),_:1}),l(r,{label:"上传限速 (MB/s)",prop:"speed_limit"},{default:o(()=>[l(Q,{modelValue:s.value.speed_limit,"onUpdate:modelValue":e[14]||(e[14]=a=>s.value.speed_limit=a),min:0,max:1e3,placeholder:"为防止失误操作导致超速，当设置为 0 时重启会自动设置为默认限速",style:{width:"100%"}},null,8,["modelValue"]),e[29]||(e[29]=u("div",{class:"form-tip",style:{color:"red","font-size":"14px"}},[d(" 单位为 MB/s，为防止误操作导致超速，当设置为 0 时重启会恢复默认限速"),u("br"),d(" 如缺点设置不限速可输入一个极大的数值，超过 999 会显示不限速 ")],-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Ce=Z(we,[["__scopeId","data-v-beb31e6e"]]);export{Ce as default};
