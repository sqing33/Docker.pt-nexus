import{C as et,d as vs,r as k,c as U,O as Ye,o as _s,s as fs,a as _,k as y,i as a,e as d,f as x,w as u,F as A,l as R,x as D,S as cs,h as m,m as V,T as st,U as tt,V as Re,p as gs,q as Se,g as B,E as p,W as ve,j as C,n as T,t as h,J as at,X as ms,Y as Ne,Z as Je,B as lt,y as ot,$ as nt,a0 as ps}from"./index-BMpCW-ko.js";const it=et("crossSeed",{state:()=>({taskId:null,sourceInfo:null,workingParams:null}),actions:{setTaskId(se){this.taskId=se},clearTaskId(){this.taskId=null},setSourceInfo(se){this.sourceInfo=se},clearSourceInfo(){this.sourceInfo=null},setParams(se){this.workingParams=se},clearParams(){this.workingParams=null},reset(){this.clearTaskId(),this.clearSourceInfo(),this.clearParams()}}}),rt={key:0,class:"log-progress-overlay"},dt={class:"log-progress-container"},ut={class:"steps-wrapper"},ct={key:0,class:"spinner-icon"},mt={key:1,class:"success-icon"},pt={key:2,class:"error-icon"},vt={key:3,class:"warning-icon"},_t={key:0,class:"completion-message"},ft=vs({__name:"LogProgress",props:{visible:{type:Boolean},taskId:{}},emits:["complete","close"],setup(se,{emit:xe}){const O=se,_e=xe,q=k([{name:"数据库查询",message:"正在检查缓存...",status:"pending"},{name:"开始抓取",message:"准备从源站点获取...",status:"pending"},{name:"获取种子信息",message:"",status:"pending"},{name:"解析参数",message:"",status:"pending"},{name:"验证图片链接",message:"",status:"pending"},{name:"提取媒体信息",message:"",status:"pending"},{name:"验证简介格式",message:"",status:"pending"},{name:"检查声明感谢",message:"",status:"pending"},{name:"成功获取参数",message:"",status:"pending"}]),fe=k(!1);let K=null;const ce=U(()=>{const $=q.value.findIndex(H=>H.status==="processing");return $!==-1?$:q.value.filter(H=>H.status==="success").length}),ge=$=>$.status==="success"?"success":$.status==="error"?"error":$.status==="warning"?"warning":$.status==="processing"?"process":"wait";Ye(()=>O.taskId,$=>{$&&O.visible&&w()}),Ye(()=>O.visible,$=>{$&&O.taskId?w():$||L()}),_s(()=>{O.visible&&O.taskId&&w()}),fs(()=>{L()});const w=()=>{K&&K.close(),fe.value=!1,q.value.forEach($=>{$.status="pending",$.message=$.name==="数据库查询"?"正在检查缓存...":$.name==="开始抓取"?"准备从源站点获取...":""}),K=new EventSource(`/api/migrate/logs/stream/${O.taskId}`),K.onmessage=$=>{try{const M=JSON.parse($.data);M.type==="connected"?console.log("SSE 连接成功",M):M.type==="log"?Le(M.step,M.message,M.status):M.type==="complete"?(fe.value=!0,_e("complete"),L(),_e("close")):M.type}catch(M){console.error("解析 SSE 消息失败:",M)}},K.onerror=$=>{console.error("SSE 连接错误:",$),L()}},L=()=>{K&&(K.close(),K=null)},Le=($,M,H)=>{const Y=q.value.findIndex(I=>I.name===$);if(Y!==-1){const I=q.value[Y];if(I.message=M,I.status=H,H==="success"&&Y<q.value.length-1){const G=q.value[Y+1];G.status==="pending"&&(G.status="processing")}}};return($,M)=>{const H=x("el-icon"),Y=x("el-step"),I=x("el-steps");return se.visible?(m(),_("div",rt,[a("div",dt,[a("div",ut,[d(I,{direction:"vertical",active:ce.value,"finish-status":"success"},{default:u(()=>[(m(!0),_(A,null,R(q.value,(G,le)=>(m(),V(Y,{key:le,title:G.name,description:G.message,status:ge(G)},{icon:u(()=>[G.status==="processing"?(m(),_("div",ct,[d(H,{class:"is-loading"},{default:u(()=>[d(D(st))]),_:1})])):G.status==="success"?(m(),_("div",mt,[d(H,null,{default:u(()=>[d(D(cs))]),_:1})])):G.status==="error"?(m(),_("div",pt,[d(H,null,{default:u(()=>[d(D(tt))]),_:1})])):G.status==="warning"?(m(),_("div",vt,[d(H,null,{default:u(()=>[d(D(Re))]),_:1})])):y("",!0)]),_:2},1032,["title","description","status"]))),128))]),_:1},8,["active"]),fe.value?(m(),_("div",_t,[d(H,{class:"icon-complete",color:"#67C23A"},{default:u(()=>[d(D(cs))]),_:1}),M[0]||(M[0]=a("span",null,"所有步骤已完成",-1))])):y("",!0)])])])):y("",!0)}}}),gt=gs(ft,[["__scopeId","data-v-b874a855"]]),bt={class:"cross-seed-panel"},ht={class:"panel-header"},yt={class:"custom-steps"},wt={class:"step-icon"},kt={key:1},St={class:"step-title"},It={key:0,class:"step-connector"},$t={class:"panel-content"},Ct={key:0,class:"step-container details-container"},zt={class:"main-info-container"},Et={class:"full-width-form-column"},Tt={class:"title-section"},Vt={class:"title-components-grid"},Dt={class:"bottom-info-section"},At={class:"subtitle-unrecognized-grid"},Mt={class:"subtitle-section",style:{"grid-column":"span 4"}},Nt={class:"standard-params-section"},Rt={class:"standard-params-grid"},xt={class:"standard-params-grid second-row"},Lt={class:"poster-statement-container"},Pt={class:"poster-statement-split"},Bt={class:"left-panel"},Ut={class:"form-label-with-button"},Ot={class:"right-panel"},jt={class:"poster-preview-section"},Ft={class:"image-preview-container"},qt=["src","onError"],Ht={key:1,class:"preview-placeholder"},Wt={class:"screenshot-container"},Kt={class:"form-column screenshot-text-column"},Gt={class:"form-label-with-button"},Jt={class:"preview-column screenshot-preview-column"},Yt={class:"carousel-container"},Zt={class:"carousel-image-wrapper"},Xt=["src","onError"],Qt={key:1,class:"preview-placeholder"},ea={class:"form-label-with-button"},sa={class:"form-label-with-button"},ta={class:"mediainfo-container"},aa={key:0,class:"bdinfo-progress-inline"},la={class:"progress-header"},oa={class:"header-buttons"},na={class:"progress-details-inline"},ia={class:"progress-info-row"},ra={class:"progress-item"},da={class:"progress-item"},ua={class:"progress-item"},ca={class:"filtered-declarations-container"},ma={class:"filtered-declarations-header"},pa={class:"filtered-declarations-content"},va={class:"declaration-header"},_a={class:"declaration-number"},fa={class:"declaration-content code-font"},ga={key:1,class:"no-filtered-declarations"},ba={key:1,class:"step-container publish-preview-container"},ha={class:"publish-preview-content"},ya={class:"preview-row main-title-row"},wa={class:"row-content main-title-content"},ka={class:"preview-row subtitle-row"},Sa={class:"row-content subtitle-content"},Ia={class:"preview-row params-row"},$a={class:"row-content"},Ca={class:"param-row"},za={class:"param-item imdb-item half-width"},Ea={style:{display:"flex"}},Ta={style:{display:"flex"}},Va={class:"param-item tags-item half-width"},Da={class:"param-value-container"},Aa={key:0,class:"param-standard-key"},Ma={class:"params-content"},Na={class:"param-item inline-param"},Ra={class:"param-value-container"},xa={key:0,class:"param-standard-key"},La={class:"param-item inline-param"},Pa={class:"param-value-container"},Ba={key:0,class:"param-standard-key"},Ua={class:"param-item inline-param"},Oa={class:"param-value-container"},ja={key:0,class:"param-standard-key"},Fa={class:"param-item inline-param"},qa={class:"param-value-container"},Ha={key:0,class:"param-standard-key"},Wa={class:"param-item inline-param"},Ka={class:"param-value-container"},Ga={key:0,class:"param-standard-key"},Ja={class:"param-item inline-param"},Ya={class:"param-value-container"},Za={key:0,class:"param-standard-key"},Xa={class:"param-item inline-param"},Qa={class:"param-value-container"},el={key:0,class:"param-standard-key"},sl={class:"preview-row mediainfo-row"},tl={class:"row-content mediainfo-content scrollable-content"},al={class:"mediainfo-pre"},ll={class:"preview-row description-row"},ol={class:"row-content description-content"},nl={class:"description-section"},il=["innerHTML"],rl={key:0,class:"description-section"},dl={class:"image-gallery"},ul=["src","alt","onError"],cl={class:"description-section"},ml=["innerHTML"],pl={key:1,class:"description-section"},vl={class:"image-gallery"},_l=["src","alt","onError"],fl={key:2,class:"step-container site-selection-container"},gl={class:"select-all-container",style:{"margin-top":"16px"}},bl={class:"site-buttons-group"},hl={key:3,class:"step-container results-container"},yl={key:0,class:"progress-section"},wl={key:0,class:"progress-item"},kl={class:"progress-text"},Sl={key:1,class:"progress-item"},Il={class:"progress-text"},$l={class:"results-rows-container"},Cl={class:"row-sites"},zl={class:"card-icon"},El={class:"card-title"},Tl={key:0,class:"existed-tag"},Vl={key:1,class:"downloader-status"},Dl={class:"status-icon"},Al={class:"card-extra"},Ml=["href"],Nl={class:"row-action"},Rl={class:"button-subtitle"},xl={class:"panel-footer"},Ll={key:0,class:"button-group"},Pl={key:0,class:"check-hint"},Bl={key:0,class:"validation-hint"},Ul={key:1,class:"button-group"},Ol={key:0,class:"validation-hint"},jl={key:0,class:"validation-hint"},Fl={key:2,class:"button-group"},ql={key:3,class:"button-group"},Hl={class:"card-header"},Wl={class:"log-content-pre"},Kl={class:"error-log-container"},Gl={class:"log-timeline"},Jl={class:"log-entry-header"},Yl={class:"log-time"},Zl={key:0,class:"log-site"},Xl={class:"log-text"},Ql={key:0,class:"log-entry-details"},eo={class:"code-block"},so={class:"dialog-footer"},to=vs({__name:"CrossSeedPanel",props:{showCompleteButton:{type:Boolean,default:!1}},emits:["complete","cancel","close-with-refresh"],setup(se,{emit:xe}){const O=s=>{if(!s)return"";s=s.replace(/[ \t\f\v]+$/gm,""),s=s.replace(/^\s*\n+/,"").replace(/\n\s*$/,""),s=s.replace(/(\n\s*){2,}/g,`

`),s=s.replace(/([^\n]+。)\s*\n\s*\n(\s*\d+\.)/g,`$1
$2`),s=s.replace(/(\d+\.[\s\S]*?)\n\s*\n(\s*\d+\.)/g,`$1
$2`),s=s.replace(/(\[(?:b|color)[^\]]*\][\s\S]*?)\n\s*\n([\s\S]*?\[\/(?:b|color)\])/gi,`$1
$2`);for(let e=0;e<3;e++)s=s.replace(/(\[(?:quote|b|color|size)[^\]]*\][\s\S]*?)\n\s*\n([\s\S]*?\[\/(?:quote|b|color|size)\])/gi,`$1
$2`);return s=s.replace(/(\n\s*){2,}/g,`

`),s},_e=s=>s?(s=O(s),s=s.replace(/\[quote\]([\s\S]*?)\[\/quote\]/gi,"<blockquote>$1</blockquote>"),s=s.replace(/\[b\]([\s\S]*?)\[\/b\]/gi,"<strong>$1</strong>"),s=s.replace(/\[color=(\w+|\#[0-9a-fA-F]{3,6})\]([\s\S]*?)\[\/color\]/gi,'<span style="color: $1;">$2</span>'),s=s.replace(/\[size=(\d+)\]([\s\S]*?)\[\/size\]/gi,(e,o,n)=>`<span style="font-size: ${{1:"12",2:"14",3:"16",4:"18",5:"24",6:"32",7:"48"}[o]||parseInt(o)*4}px;">${n}</span>`),s=s.replace(/\n/g,"<br>"),s):"",q=s=>{if(!s)return[];const e=s.split(`
`),o=[];let n=null;const l=/^\[(.*?)\]\s+(\d{2}:\d{2}:\d{2})\s+-\s+([A-Z]+)\s+-\s+(.*)$/;return e.forEach((i,c)=>{const b=i.trimEnd();if(!b)return;const v=b.match(l);v?(n={id:c,site:v[1],time:v[2],level:v[3],message:v[4],details:"",isError:v[3]==="ERROR"||v[3]==="CRITICAL"},n.message.includes("Traceback")&&(n.isError=!0),o.push(n)):n?(n.details+=(n.details?`
`:"")+b,b.trim().startsWith('File "')&&(n.isError=!0)):o.push({id:c,site:"System",time:"",level:"INFO",message:b,details:"",isError:!1})}),o},fe=s=>{switch(s){case"SUCCESS":return"success";case"ERROR":return"danger";case"WARNING":return"warning";case"DEBUG":return"info";default:return"primary"}},K=se,ce=xe,ge=it(),w=U(()=>ge.workingParams),L=U(()=>ge.sourceInfo?.name||""),Le=()=>({seed_id:null,title_components:[],original_main_title:"",subtitle:"",imdb_link:"",douban_link:"",intro:{statement:"",poster:"",body:"",screenshots:"",removed_ardtudeclarations:[]},mediainfo:"",source_params:{},standardized_params:{type:"",medium:"",video_codec:"",audio_codec:"",resolution:"",team:"",source:"",tags:[]},final_publish_parameters:{},complete_publish_params:{},raw_params_for_preview:{}}),$=s=>{if(!s||typeof s!="string")return[];const e=/\[img\](https?:\/\/[^\s[\]]+)\[\/img\]/gi;return[...s.matchAll(e)].map(n=>n[1])},M=k(new Map),H=s=>M.value.has(s)?M.value.get(s):(M.value.set(s,s),s),Y=(s,e,o)=>{const n=M.value.get(s);if(n&&!n.startsWith("http://pt-nexus-proxy.sqing33.dpdns.org/")){const l=`http://pt-nexus-proxy.sqing33.dpdns.org/${s}`;M.value.set(s,l),document.querySelectorAll(`img[src="${n}"]`).forEach(c=>{c.setAttribute("src",l)}),console.log(`图片加载失败，尝试使用代理URL: ${l}`);return}Es(s,e,o)},I=k(0),G=k("main"),le=k(!1),ne=k({current:0,total:0}),ie=k({current:0,total:0}),Ie=((s,e)=>{let o;return function(...l){const i=()=>{clearTimeout(o),s(...l)};clearTimeout(o),o=setTimeout(i,e)}})(()=>{const s=document.querySelector(".panel-content");if(s){const{scrollTop:e,scrollHeight:o,clientHeight:n}=s;le.value=e+n>=o-5}},100),Ze=()=>{const s=document.querySelector(".panel-content");s&&s.addEventListener("scroll",Ie)},bs=()=>{const s=document.querySelector(".panel-content");s&&s.removeEventListener("scroll",Ie)};_s(()=>{Ts(),Vs(),Se(()=>{I.value===1&&(Ze(),Ie())})}),Ye(I,(s,e)=>{e===1&&bs(),s===1&&Se(()=>{Ze(),Ie()})});const Pe=[{title:"核对种子详情"},{title:"发布参数预览"},{title:"选择发布站点"},{title:"完成发布"}],de=k([]),Z=k([]),j=k(!1),t=k(Le()),X=k(null),me=k([]),Be=k(!1),$e=k(!1),Ue=k(!1),Ce=k(!1),ze=k(!1),Oe=k(!1),te=k(!0),ue=k(""),Ee=k(!1),Xe=k([]),be=k(!1),ae=k(null),J=k({visible:!1,percent:0,currentFile:"",elapsedTime:"",remainingTime:""}),Qe=k(0),hs=s=>{if(!s)return"";const e=["B","KB","MB","GB","TB"];let o=s,n=0;for(;o>=1024&&n<e.length-1;)o/=1024,n++;return`${o.toFixed(2)} ${e[n]}`},Q=k(!1),oe=k([]),Te=k(!1),es=k(""),N=k({type:{},medium:{},video_codec:{},audio_codec:{},resolution:{},source:{},team:{},tags:{}}),Ve=U(()=>$(t.value.intro.poster)),he=U(()=>$(t.value.intro.screenshots)),ss=U(()=>{const s=t.value.intro.removed_ardtudeclarations;return Array.isArray(s)?s:[]}),ts=U(()=>ss.value.length),je=s=>{const e=de.value.find(o=>o.name===s);if(!e||!e.has_cookie||(s==="杜比"||s==="HDtime")&&!e.has_passkey||w.value?.sites?.[s])return!1;if(s.toLowerCase()==="ubits"){const o=t.value.standardized_params.team,n=t.value.title_components;if(o&&["cmct","cmctv"].includes(o.toLowerCase()))return!1;const l=n.find(i=>i.key==="制作组");if(l&&l.value){const i=l.value.toLowerCase(),c=["cmct","cmctv","telesto","shadow610"];for(const b of c)if(i.includes(b))return!1}}return!0},ys=s=>Z.value.includes(s.name)?"success":!s.has_cookie||(s.name==="杜比"||s.name==="HDtime")&&!s.has_passkey?"danger":"default",ws=async()=>{Ue.value=!0,p.info({title:"正在重新获取",message:"正在从豆瓣/IMDb重新获取简介...",duration:0});const s={type:"intro",source_info:{main_title:t.value.original_main_title,subtitle:t.value.subtitle,source_site:L.value,imdb_link:t.value.imdb_link,douban_link:t.value.douban_link}};try{const e=await B.post("/api/media/validate",s);p.closeAll(),e.data.success&&e.data.intro?(t.value.intro.body=O(e.data.intro),e.data.extracted_imdb_link&&!t.value.imdb_link&&(t.value.imdb_link=e.data.extracted_imdb_link),e.data.extracted_douban_link&&!t.value.douban_link&&(t.value.douban_link=e.data.extracted_douban_link),p.success({title:"重新获取成功",message:"已成功从豆瓣/IMDb获取并更新了简介内容。"})):p.error({title:"重新获取失败",message:e.data.error||"无法从豆瓣/IMDb获取简介。"})}catch(e){p.closeAll();const o=e.response?.data?.error||"未能重新获取简介";p.error({title:"操作失败",message:o})}finally{Ue.value=!1}},ks=async()=>{if(!t.value.original_main_title){p.warning("标题为空，无法重新获取截图。");return}if($e.value){p.info({title:"正在处理中",message:"截图重新生成请求已在处理中，请稍候..."});return}$e.value=!0,p.info({title:"正在重新获取",message:"正在从视频重新生成截图...",duration:0});const s={type:"screenshot",source_info:{main_title:t.value.original_main_title,source_site:L.value,imdb_link:t.value.imdb_link,douban_link:t.value.douban_link},savePath:w.value.save_path,torrentName:w.value.name,downloaderId:w.value.downloaderId};try{const e=await B.post("/api/media/validate",s);p.closeAll(),e.data.success&&e.data.screenshots?(t.value.intro.screenshots=e.data.screenshots,te.value=!0,p.success({title:"重新获取成功",message:"已成功生成并加载了新的截图。"})):(te.value=!1,p.error({title:"重新获取失败",message:e.data.error||"无法从后端获取新的截图，请查看后台日志。"}))}catch(e){p.closeAll();const o=e.response?.data?.error||"未能重新获取截图，请查看后台日志。";p.error({title:"操作失败",message:o}),te.value=!1}finally{$e.value=!1}},Ss=async()=>{if(Ce.value){p.info({title:"正在处理中",message:"媒体信息重新获取请求已在处理中，请稍候..."});return}Ce.value=!0,p.info({title:"正在重新获取",message:"正在从视频重新生成媒体信息...",duration:0});try{const s=await B.post("/api/migrate/refresh_mediainfo_async",{seed_id:t.value.seed_id,save_path:w.value.save_path,content_name:t.value.original_main_title,downloader_id:w.value.downloaderId,torrent_name:w.value.name,current_mediainfo:t.value.mediainfo,force_refresh:!0,priority:1});p.closeAll(),s.data.success?(s.data.mediainfo&&(t.value.mediainfo=s.data.mediainfo),s.data.bdinfo_async&&s.data.bdinfo_async.bdinfo_status==="processing"?(p.info({title:"MediaInfo 已更新",message:"BDInfo 正在后台处理中，完成后将自动更新...",duration:5e3}),Is()):s.data.mediainfo?p.success({title:"重新获取成功",message:s.data.message||"已成功生成并加载了新的媒体信息。"}):p.info({title:"任务已启动",message:s.data.message||"BDInfo 正在后台处理中..."})):p.error({title:"重新获取失败",message:s.data.message||"无法从后端获取新的媒体信息，请查看后台日志。"})}catch(s){p.closeAll();const e=s.response?.data?.message||s.response?.data?.error||"未能重新获取媒体信息，请查看后台日志。";p.error({title:"操作失败",message:e})}finally{Ce.value=!1}},Is=()=>{ye(),J.value={visible:!0,percent:0,currentFile:"准备中...",elapsedTime:"",remainingTime:""};const s=`/api/migrate/bdinfo_sse/${t.value.seed_id}`;ae.value=new EventSource(s),ae.value.onopen=()=>{console.log("BDInfo SSE连接已建立")},ae.value.onmessage=e=>{try{const o=JSON.parse(e.data);switch(o.type){case"connected":console.log("SSE连接成功:",o.connection_id);break;case"progress_update":const{progress_percent:n,current_file:l,elapsed_time:i,remaining_time:c,disc_size:b}=o.data;J.value={visible:!0,percent:Math.round(n),currentFile:l,elapsedTime:i,remainingTime:c},b&&(Qe.value=b),console.log(`BDInfo 进度: ${n}%`);break;case"completion":t.value.mediainfo=o.data.mediainfo,p.success({title:"BDInfo 获取完成",message:"BDInfo 已成功获取并更新"}),J.value.visible=!1,ye();break;case"error":p.warning({title:"BDInfo 获取失败",message:o.data.error||"BDInfo 获取失败，可手动重试"}),J.value.visible=!1,ye();break;case"heartbeat":return;default:console.log("未知SSE消息类型:",o.type)}}catch(o){console.error("解析SSE消息失败:",o)}},ae.value.onerror=e=>{console.error("SSE连接错误:",e),p.error({title:"连接错误",message:"BDInfo 进度更新连接中断，请刷新页面重试"}),J.value.visible=!1,ye()}},ye=()=>{ae.value&&(ae.value.close(),ae.value=null),J.value.visible=!1,p.info({title:"已取消",message:"BDInfo 获取已取消"})},$s=()=>{ae.value&&(ae.value.close(),ae.value=null),qe()};fs(()=>{bdinfoPollingTimer.value&&clearInterval(bdinfoPollingTimer.value)});const Cs=async()=>{if(!t.value.original_main_title){p.warning("标题为空，无法重新获取海报。");return}if(ze.value){p.info({title:"正在处理中",message:"海报重新获取请求已在处理中，请稍候..."});return}ze.value=!0,p.info({title:"正在重新获取",message:"正在重新生成海报...",duration:0});const s={type:"poster",source_info:{main_title:t.value.original_main_title,source_site:L.value,imdb_link:t.value.imdb_link,douban_link:t.value.douban_link},savePath:w.value.save_path,torrentName:w.value.name,downloaderId:w.value.downloaderId};try{const e=await B.post("/api/media/validate",s);p.closeAll(),e.data.success&&e.data.posters?(t.value.intro.poster=e.data.posters,p.success({title:"重新获取成功",message:"已成功生成并加载了新的海报。"})):p.error({title:"重新获取失败",message:e.data.error||"无法从后端获取新的海报，请查看后台日志。"})}catch(e){p.closeAll();const o=e.response?.data?.error||"未能重新获取海报，请查看后台日志。";p.error({title:"操作失败",message:o})}finally{ze.value=!1}},zs=async()=>{if(!t.value.original_main_title){p.warning("标题为空，无法解析。");return}Be.value=!0;try{const s=await B.post("/api/utils/parse_title",{title:t.value.original_main_title,mediainfo:t.value.mediainfo||""});s.data.success?(t.value.title_components=s.data.components,p.success("标题已重新解析！")):p.error(s.data.message||"解析失败")}catch(s){He(s,"未能重新解析标题，请查看后台日志。")}finally{Be.value=!1}},Es=async(s,e,o)=>{if(s&&s.includes("pixhost.to")){console.log(`检测到 pixhost.to 图片，跳过有效性检测: ${s}`);return}if(e==="screenshot"&&Oe.value){console.log(`截图错误已正在处理中，跳过重复请求: ${s}`);return}console.error(`图片加载失败: 类型=${e}, URL=${s}, 索引=${o}`),e==="screenshot"?(Oe.value=!0,te.value=!1,p.warning({title:"截图失效",message:"检测到截图链接失效，正在尝试从视频重新生成..."})):e==="poster"&&p.warning({title:"海报失效",message:"检测到海报链接失效，正在尝试重新获取..."});const n={type:e,source_info:{main_title:t.value.original_main_title,source_site:L.value,imdb_link:t.value.imdb_link,douban_link:t.value.douban_link},savePath:w.value.save_path,torrentName:w.value.name,downloaderId:w.value.downloaderId};try{const l=await B.post("/api/media/validate",n);l.data.success?e==="screenshot"&&l.data.screenshots?(t.value.intro.screenshots=l.data.screenshots,te.value=!0,p.success({title:"截图已更新",message:"已成功生成并加载了新的截图。"})):e==="poster"&&l.data.posters&&(t.value.intro.poster=l.data.posters,p.success({title:"海报已更新",message:"已成功生成并加载了新的海报。"})):(e==="screenshot"&&(te.value=!1),p.error({title:"更新失败",message:l.data.error||`无法从后端获取新的${e==="poster"?"海报":"截图"}。`}))}catch(l){const i=l.response?.data?.error||`发送失效${e==="poster"?"海报":"截图"}信息请求时发生错误，请查看后台日志。`;console.error("发送失效图片信息请求时发生错误:",l),p.error({title:"操作失败",message:i})}finally{e==="screenshot"&&(Oe.value=!1)}},Fe=async s=>{const e=de.value.find(n=>n.name===s);if(e?.site)return e.site;try{const n=await B.get("/api/sites/status");de.value=n.data;const l=de.value.find(i=>i.name===s);if(l?.site)return l.site}catch(n){console.warn("获取站点状态失败:",n)}return{人人:"audiences",不可说:"ssd",憨憨:"hhanclub",财神:"cspt"}[s]||s.toLowerCase()},Ts=async()=>{try{const s=await B.get("/api/sites/status");de.value=s.data;const e=await B.get("/api/downloaders_list");Xe.value=e.data}catch{p.error({title:"错误",message:"无法从服务器获取站点状态列表或下载器列表"})}},Vs=async()=>{if(!L.value||!w.value)return;const s=w.value.sites[L.value];let e=s.torrentId||null;if(!e){const l=s.comment?.match(/id=(\d+)/);if(!l||!l[1]){p.error(`无法从源站点 ${L.value} 的链接中提取种子ID。`),ce("cancel");return}e=l[1]}j.value=!0;const o=`fetch_${e}_${Date.now()}`;es.value=o,Te.value=!0;let n=null;try{const l=await Fe(L.value);console.log(`尝试从数据库读取种子信息: ${e} from ${L.value} (${l})`);const i=await B.get("/api/migrate/get_db_seed_info",{params:{torrent_id:e,site_name:l,task_id:o},timeout:12e4});if(i.status===202&&i.data.should_fetch){console.log("数据库中没有缓存，继续使用同一日志流从源站点抓取...");const c=i.data.task_id||o;try{const b=await B.post("/api/migrate/fetch_and_store",{sourceSite:L.value,searchTerm:e,savePath:w.value.save_path,torrentName:w.value.name,downloaderId:w.value.downloaderId,task_id:c},{timeout:12e4});if(!b.data.success){p.closeAll();const z=b.data.message||"从源站点抓取失败";oe.value=q(z),Q.value=!0,j.value=!1;return}const v=await B.get("/api/migrate/get_db_seed_info",{params:{torrent_id:e,site_name:l},timeout:12e4});if(!v.data.success){p.closeAll();const z="数据抓取成功但从数据库读取失败";oe.value=q(z),Q.value=!0,j.value=!1;return}p.closeAll(),p.success({title:"抓取成功",message:"种子信息已成功抓取并存储到数据库，请核对。"});const g=v.data.data;v.data.reverse_mappings&&(N.value=v.data.reverse_mappings);const S=`${g.hash||e}_${e}_${l}`;t.value={seed_id:S,original_main_title:g.title||"",title_components:g.title_components||[],subtitle:g.subtitle,imdb_link:g.imdb_link,douban_link:g.douban_link,intro:{statement:O(g.statement)||"",poster:g.poster||"",body:O(g.body)||"",screenshots:g.screenshots||"",removed_ardtudeclarations:g.removed_ardtudeclarations||[]},mediainfo:g.mediainfo||"",source_params:g.source_params||{},standardized_params:{type:g.type||"",medium:g.medium||"",video_codec:g.video_codec||"",audio_codec:g.audio_codec||"",resolution:g.resolution||"",team:g.team||"",source:g.source||"",tags:(g.tags||[]).sort((z,P)=>{const F=["禁转","tag.禁转","限转","tag.限转"],re=F.includes(z),we=F.includes(P);return re===we?0:re?-1:1})},final_publish_parameters:g.final_publish_parameters||{},complete_publish_params:g.complete_publish_params||{},raw_params_for_preview:g.raw_params_for_preview||{}},X.value=b.data.task_id,be.value=!0,I.value=0,Se(()=>{Ge()}),j.value=!1;return}catch(b){p.closeAll(),He(b,"从源站点抓取时发生错误，请查看后台日志。"),j.value=!1;return}}else if(i.data.success){p.closeAll(),p.success({title:"读取成功",message:"种子信息已从数据库成功加载，请核对。"});const c=i.data.data;if(!c||!c.title)throw new Error("数据库返回的种子信息不完整");i.data.reverse_mappings?(N.value=i.data.reverse_mappings,console.log("成功加载反向映射表:",N.value),console.log("type映射数量:",Object.keys(N.value.type||{}).length),console.log("当前standardized_params:",c.standardized_params)):console.warn("后端未返回反向映射表，将使用空的默认映射");const b=`${c.hash||e}_${e}_${l}`;if(t.value={seed_id:b,original_main_title:c.title||"",title_components:c.title_components||[],subtitle:c.subtitle,imdb_link:c.imdb_link,douban_link:c.douban_link,intro:{statement:O(c.statement)||"",poster:c.poster||"",body:O(c.body)||"",screenshots:c.screenshots||"",removed_ardtudeclarations:c.removed_ardtudeclarations||[]},mediainfo:c.mediainfo||"",source_params:c.source_params||{},standardized_params:{type:c.type||"",medium:c.medium||"",video_codec:c.video_codec||"",audio_codec:c.audio_codec||"",resolution:c.resolution||"",team:c.team||"",source:c.source||"",tags:(c.tags||[]).sort((v,g)=>{const S=["禁转","tag.禁转","限转","tag.限转"],z=S.includes(v),P=S.includes(g);return z===P?0:z?-1:1})},final_publish_parameters:c.final_publish_parameters||{},complete_publish_params:c.complete_publish_params||{},raw_params_for_preview:c.raw_params_for_preview||{}},(!c.title_components||c.title_components.length===0)&&c.title)try{const v=await B.post("/api/utils/parse_title",{title:c.title});v.data.success&&(t.value.title_components=v.data.components,p.info({title:"标题解析",message:"已自动解析主标题为组件信息。"}))}catch(v){console.warn("自动解析标题失败:",v)}if(console.log("设置torrentData.standardized_params:",t.value.standardized_params),console.log("检查绑定 - type:",t.value.standardized_params.type),console.log("检查绑定 - medium:",t.value.standardized_params.medium),i.data.task_id?(X.value=i.data.task_id,p.success({title:"缓存准备完成",message:"发布任务已准备就绪"})):(X.value=`db_${e}_${l}`,console.warn("后端未返回taskId，使用标识符")),be.value=!0,(!t.value.imdb_link||!t.value.douban_link)&&t.value.intro.body){let v=!1,g=!1;if(!t.value.imdb_link){const S=/(https?:\/\/www\.imdb\.com\/title\/tt\d+)/,z=t.value.intro.body.match(S);z&&z[1]&&(t.value.imdb_link=z[1],v=!0)}if(!t.value.douban_link){const S=/(https:\/\/movie\.douban\.com\/subject\/\d+)/,z=t.value.intro.body.match(S);z&&z[1]&&(t.value.douban_link=z[1],g=!0)}if(v||g){const S=[];v&&S.push("IMDb链接"),g&&S.push("豆瓣链接"),p.info({title:"自动填充",message:`已从简介正文中自动提取并填充 ${S.join(" 和 ")}。`})}}I.value=0,Se(()=>{Ge()}),be.value=!0,j.value=!1;return}else console.log("数据库中没有找到种子信息，开始抓取数据...")}catch(l){n=l,console.log("从数据库读取失败，开始抓取数据...",l),l.code==="ECONNABORTED"||l.message.includes("timeout")?console.warn("数据库读取超时，将尝试直接抓取数据..."):l.response?.status>=500?console.warn("数据库服务器错误，将尝试直接抓取数据..."):console.warn("数据库读取发生未知错误，将尝试直接抓取数据...")}try{p.closeAll(),p({title:"正在抓取",message:"正在从源站点抓取种子信息并存储到数据库...",type:"info",duration:0}),n&&(console.warn(`由于数据库读取失败（${n.message}），正在直接抓取数据...`),p.warning({title:"数据库读取失败",message:"正在尝试直接抓取数据，请稍候...",duration:3e3}));const l=await B.post("/api/migrate/fetch_and_store",{sourceSite:L.value,searchTerm:e,savePath:w.value.save_path,torrentName:w.value.name,downloaderId:w.value.downloaderId||(w.value.downloaderIds?.length>0?w.value.downloaderIds[0]:null)},{timeout:12e4});if(l.data.success){console.log("数据抓取成功，立即从数据库读取...");let i=0;const c=3;let b=null;for(;i<c;){i++;try{const v=await Fe(L.value);if(console.log(`重试从数据库读取种子信息: ${e} from ${L.value} (${v})`),b=await B.get("/api/migrate/get_db_seed_info",{params:{torrent_id:e,site_name:v},timeout:12e4}),b.data.success)break;console.warn(`数据库读取第${i}次失败：${b.data.message}`),i<c&&await new Promise(g=>setTimeout(g,1e3))}catch(v){if(console.warn(`数据库读取第${i}次失败：`,v),i<c)await new Promise(g=>setTimeout(g,1e3));else throw v}}if(b&&b.data.success){p.closeAll();const v=b.data.data;if(!v||!v.title)throw new Error("数据库返回的种子信息不完整");b.data.reverse_mappings?(N.value=b.data.reverse_mappings,console.log("成功加载反向映射表:",N.value)):console.warn("后端未返回反向映射表，将使用空的默认映射"),p.success({title:"抓取成功",message:n?"种子信息已成功抓取，请核对。由于数据库读取失败，数据未持久化存储。":"种子信息已成功抓取并存储到数据库，请核对。"});const g=`${v.hash||e}_${e}_${englishSiteName}`;if(t.value={seed_id:g,original_main_title:v.title||"",title_components:v.title_components||[],subtitle:v.subtitle,imdb_link:v.imdb_link,douban_link:v.douban_link,intro:{statement:O(v.statement)||"",poster:v.poster||"",body:O(v.body)||"",screenshots:v.screenshots||"",removed_ardtudeclarations:v.removed_ardtudeclarations||[]},mediainfo:v.mediainfo||"",source_params:v.source_params||{},standardized_params:{type:v.type||"",medium:v.medium||"",video_codec:v.video_codec||"",audio_codec:v.audio_codec||"",resolution:v.resolution||"",team:v.team||"",source:v.source||"",tags:(v.tags||[]).sort((S,z)=>{const P=["禁转","tag.禁转","限转","tag.限转"],F=P.includes(S),re=P.includes(z);return F===re?0:F?-1:1})},final_publish_parameters:v.final_publish_parameters||{},complete_publish_params:v.complete_publish_params||{},raw_params_for_preview:v.raw_params_for_preview||{}},(!v.title_components||v.title_components.length===0)&&v.title)try{const S=await B.post("/api/utils/parse_title",{title:v.title});S.data.success&&(t.value.title_components=S.data.components,p.info({title:"标题解析",message:"已自动解析主标题为组件信息。"}))}catch(S){console.warn("自动解析标题失败:",S)}if(X.value=l.data.task_id,be.value=!0,(!t.value.imdb_link||!t.value.douban_link)&&t.value.intro.body){let S=!1,z=!1;if(!t.value.imdb_link){const P=/(https?:\/\/www\.imdb\.com\/title\/tt\d+)/,F=t.value.intro.body.match(P);F&&F[1]&&(t.value.imdb_link=F[1],S=!0)}if(!t.value.douban_link){const P=/(https:\/\/movie\.douban\.com\/subject\/\d+)/,F=t.value.intro.body.match(P);F&&F[1]&&(t.value.douban_link=F[1],z=!0)}if(S||z){const P=[];S&&P.push("IMDb链接"),z&&P.push("豆瓣链接"),p.info({title:"自动填充",message:`已从简介正文中自动提取并填充 ${P.join(" 和 ")}。`})}}I.value=0,Se(()=>{Ge()})}else{p.closeAll();const v=`数据抓取成功但数据库读取失败，已重试${c}次。请检查数据库连接或稍后重试。`;oe.value=q(v),Q.value=!0,j.value=!1}}else{p.closeAll();const i=l.data.message||"抓取种子信息失败";let c=i;(i.includes("数据库")||n)&&(c=`${i}。可能由于数据库连接问题导致，请检查数据库状态。`),oe.value=q(c),Q.value=!0,j.value=!1}}catch(l){if(p.closeAll(),l.code==="ECONNABORTED"||l.message.includes("timeout")){const i="抓取种子信息超时，请检查网络连接或稍后重试。";oe.value=q(i),Q.value=!0}else if(l.response?.status===404){const i="在源站点未找到指定的种子，请检查种子ID是否正确。";oe.value=q(i),Q.value=!0}else if(l.response?.status>=500){const i="后端服务器发生错误，请稍后重试或联系管理员。";oe.value=q(i),Q.value=!0}else{const i=l.message||"获取种子信息时发生错误，请查看后台日志。";oe.value=q(i),Q.value=!0}}finally{j.value=!1}},ee=U(()=>{const s=t.value.standardized_params,e=["type","medium","video_codec","audio_codec","resolution","team","source"],o=[],n=new RegExp(/^[\p{L}\p{N}_-]+\.[\p{L}\p{N}_-]+$/u);for(const l of e){const i=s[l];i&&typeof i=="string"&&i.trim()!==""&&!n.test(i)&&o.push(l)}return De.value.length>0&&o.push("tags"),o}),Ds=async()=>{if(console.log("=== 从store获取的已存在站点信息 ==="),console.log("torrent.value:",w.value),console.log("torrent.value.sites:",w.value?.sites),w.value?.sites){const e=Object.keys(w.value.sites);console.log("已存在的站点列表:",e),console.log("已存在站点详细信息:",w.value.sites)}else console.log("未找到已存在站点信息");console.log("=====================================");const s=ee.value;if(s.length>0){const e={type:"类型",medium:"媒介",video_codec:"视频编码",audio_codec:"音频编码",resolution:"分辨率",team:"制作组",source:"产地",tags:"标签"},o=s.map(n=>e[n]||n);p({title:"参数格式不正确",message:`以下参数格式不正确，请修改为 *.* 的标准格式: ${o.join(", ")}`,type:"warning",duration:0,showClose:!0});return}j.value=!0;try{p({title:"正在处理",message:"正在更新参数并生成预览...",type:"info",duration:0});let e,o;if(be.value&&X.value&&X.value.startsWith("db_")){const i=X.value.split("_");i.length>=3&&(e=i[1],o=i.slice(2).join("_"))}else if(X.value&&X.value.startsWith("db_")){const i=X.value.split("_");i.length>=3&&(e=i[1],o=i.slice(2).join("_"))}else{const i=w.value.sites[L.value];if(e=i.torrentId||null,o=await Fe(L.value),!e){const c=i.comment?.match(/id=(\d+)/);c&&c[1]&&(e=c[1])}}if(!e||!o){p.error({title:"参数错误",message:"无法获取种子ID或站点名称",duration:0,showClose:!0});return}console.log(`更新种子参数: ${e} from ${o}`);const n={title:t.value.original_main_title,subtitle:t.value.subtitle,imdb_link:t.value.imdb_link,douban_link:t.value.douban_link,poster:t.value.intro.poster,screenshots:t.value.intro.screenshots,statement:O(t.value.intro.statement),body:O(t.value.intro.body),mediainfo:t.value.mediainfo,source_params:t.value.source_params,title_components:t.value.title_components,standardized_params:t.value.standardized_params};console.log("发送到后端的标准参数:",t.value.standardized_params);const l=await B.post("/api/migrate/update_db_seed_info",{torrent_id:e,site_name:o,updated_parameters:n});if(console.log("已调用更新接口，is_reviewed 将被设置为 true"),p.closeAll(),l.data.success){p.closeAll();const{standardized_params:i,final_publish_parameters:c,complete_publish_params:b,raw_params_for_preview:v,reverse_mappings:g}=l.data;g&&(N.value=g,console.log("成功更新反向映射表:",N.value)),t.value={...t.value,standardized_params:i||{},final_publish_parameters:c||{},complete_publish_params:b||{},raw_params_for_preview:v||{}},p.success({title:"更新成功",message:"参数已更新并重新标准化，请核对预览内容。"}),I.value=1}else p.error({title:"更新失败",message:l.data.message||"更新参数失败",duration:0,showClose:!0})}catch(e){p.closeAll(),He(e,"更新预览数据时发生错误，请查看后台日志。")}finally{j.value=!1}},As=U(()=>{const s=Object.keys(N.value.tags||{}),e=t.value.standardized_params.tags||[];return[...new Set([...s,...e])].filter(l=>!Ae(l)).map(l=>({value:l,label:N.value.tags[l]||l}))}),Ms=s=>s==="禁转"||s==="tag.禁转"||s==="限转"||s==="tag.限转"?"danger":(console.log(`[getTagType] 检查标签: "${s}", 是否无效: ${De.value.includes(s)}`),De.value.includes(s)?"danger":"info"),Ns=async()=>{const s=w.value?.sites?Object.keys(w.value.sites).length:0;if(s<2){console.log(`已存在站点数量不足(${s}个)，正在重新获取种子数据...`);try{p.info({title:"正在更新数据",message:"正在重新获取种子站点信息...",duration:0});const e=new URLSearchParams({page:"1",pageSize:"1",nameSearch:w.value.name}),n=(await B.get(`/api/data?${e.toString()}`)).data;if(n.error)throw new Error(n.error);if(n.data&&n.data.length>0){const l=n.data[0];console.log("重新获取到的种子数据:",l),console.log("重新获取到的站点信息:",l.sites),console.log(`站点数量从 ${s} 更新到 ${Object.keys(l.sites).length}`),ge.setParams(l),p.success({title:"数据更新成功",message:`已重新获取种子站点信息，发现 ${Object.keys(l.sites).length} 个站点`})}else p.warning({title:"未找到种子",message:"未能找到匹配的种子数据"})}catch(e){console.error("重新获取种子数据时出错:",e),p.error({title:"数据更新失败",message:e.message||"重新获取种子数据时发生错误"})}}else console.log(`已存在站点数量充足(${s}个)，跳过重新获取`);I.value=2},Rs=s=>{const e=Z.value.indexOf(s);e>-1?Z.value.splice(e,1):Z.value.push(s)},xs=()=>{const s=de.value.filter(e=>e.is_target&&je(e.name)).map(e=>e.name);Z.value=s},Ls=()=>{Z.value=[]},Ps=async()=>{I.value=3,j.value=!0,me.value=[],ne.value={current:0,total:Z.value.length},ie.value={current:0,total:0},p({title:"正在发布",message:`准备向 ${Z.value.length} 个站点发布种子...`,type:"info",duration:0});const s=[];for(const l of Z.value){try{const i=await B.post("/api/migrate/publish",{task_id:X.value,upload_data:{...t.value,save_path:w.value.save_path},targetSite:l,sourceSite:L.value,downloaderId:w.value.downloaderId,auto_add_to_downloader:!0}),c={siteName:l,message:Us(i.data.logs||"发布成功"),...i.data};if(i.data.logs&&i.data.logs.includes("种子已存在")&&(c.isExisted=!0),c.auto_add_result){let b="自动检测";if(c.auto_add_result.downloader_id){const v=Xe.value.find(g=>g.id===c.auto_add_result.downloader_id);v&&(b=v.name)}c.downloaderStatus={success:c.auto_add_result.success,message:c.auto_add_result.message,downloaderName:b},c.auto_add_result.success&&ie.value.current++}s.push(c),me.value=[...s],c.success&&p.success({title:`发布成功 - ${l}`,message:"种子已成功发布到该站点"})}catch(i){const c={siteName:l,success:!1,logs:i.response?.data?.logs||i.message,url:null,message:`发布到 ${l} 时发生错误，请查看日志。`,downloaderStatus:{success:!1,message:"发布失败，无法添加到下载器",downloaderName:"错误"}};s.push(c),me.value=[...s],p.error({title:`发布失败 - ${l}`,message:c.message})}ne.value.current++,await new Promise(i=>setTimeout(i,1e3))}p.closeAll();const e=s.filter(l=>l.success).length;p.success({title:"发布完成",message:`成功发布到 ${e} / ${Z.value.length} 个站点。`}),ue.value+=`

--- [自动添加任务结果] ---`;const o={};s.forEach(l=>{if(l.auto_add_result){const i=l.downloaderStatus?.downloaderName||"自动检测";o[l.siteName]={success:l.auto_add_result.success,message:l.auto_add_result.message,downloaderName:i};const c=l.auto_add_result.success?"✅":"❌",b=l.auto_add_result.success?"成功":"失败";ue.value+=`
[${l.siteName}] ${c} ${b}: ${l.auto_add_result.message}`}else l.success&&l.url&&(ue.value+=`
[${l.siteName}] ⚠️  未执行自动添加`)}),ue.value+=`
--- [自动添加任务结束] ---`;const n=s.map(l=>{let i=`--- Log for ${l.siteName} ---
${l.logs||"No logs available."}`;if(o[l.siteName]){const c=o[l.siteName];i+=`

--- Downloader Status for ${l.siteName} ---`,c.success?i+=`
✅ 成功: ${c.message}`:i+=`
❌ 失败: ${c.message}`}return i});ue.value=n.join(`

`),me.value=s.map(l=>({...l,downloaderStatus:o[l.siteName]}));try{await B.post("/api/refresh_data"),p.success({title:"数据刷新",message:"种子数据已刷新"})}catch(l){console.warn("刷新种子数据失败:",l)}j.value=!1},Bs=()=>{I.value>0&&I.value--},qe=()=>{I.value===3?ce("close-with-refresh"):ce("cancel")},as=()=>{ce("complete")},Us=s=>s==="发布成功"?"发布成功":s.includes("种子已存在")?"种子已存在，发布成功":s.split(`
`).filter(n=>n&&!n.includes("--- [步骤")&&!n.includes("INFO - ---")).map(n=>n.replace(/^\d{2}:\d{2}:\d{2} - \w+ - /,"")).filter(Boolean).pop()||"发布成功",He=(s,e)=>{const o=s.response?.data?.logs||s.message||e;p.error({title:"操作失败",message:o,duration:0,showClose:!0})},W=s=>{const e=t.value.standardized_params;if(!e||!N.value)return"N/A";const o=e[s];if(!o)return"N/A";const n=N.value[s];return n&&n[o]||o},We=()=>!pe.value||!N.value.tags?[]:pe.value.map(s=>N.value.tags[s]||s),ls=U(()=>t.value.title_components.filter(s=>s.key!=="无法识别")),pe=U(()=>t.value.standardized_params.tags?.filter(e=>e&&typeof e=="string"&&e.trim()!=="")||[]),De=U(()=>{const s=new RegExp(/^[\p{L}\p{N}_-]+\.[\p{L}\p{N}_-]+$/u);return pe.value.filter(e=>!s.test(e))}),Os=U(()=>["主标题","季集","年份","剧集状态","发布版本","分辨率","片源平台","媒介","视频编码","视频格式","HDR格式","色深","帧率","音频编码","制作组"].map(e=>({key:e,value:""}))),Ae=s=>s==="禁转"||s==="tag.禁转"||s==="限转"||s==="tag.限转",os=U(()=>(t.value.standardized_params.tags||[]).some(e=>Ae(e))),js=s=>{if(Ae(s)){p.warning({title:"无法删除",message:"禁转/限转标签不允许删除",duration:2e3});return}const e=t.value.standardized_params.tags.indexOf(s);e>-1&&t.value.standardized_params.tags.splice(e,1)},Ke=U({get(){const s=t.value.title_components.find(e=>e.key==="无法识别");return s?s.value:""},set(s){const e=t.value.title_components.findIndex(o=>o.key==="无法识别");s===""||s===null?e!==-1&&t.value.title_components.splice(e,1):e!==-1?t.value.title_components[e].value=s:t.value.title_components.push({key:"无法识别",value:s})}}),Fs=U(()=>{const s=t.value.standardized_params.team,e=t.value.title_components;if(s&&["cmct","cmctv"].includes(s.toLowerCase()))return!0;const o=e.find(n=>n.key==="制作组");if(o&&o.value){const n=o.value.toLowerCase(),l=["cmct","cmctv","telesto","shadow610"];for(const i of l)if(n.includes(i))return!0}return!1}),ns=U(()=>{const s=t.value.title_components.find(ke=>ke.key==="无法识别"),e=s&&s.value!=="";if(os.value)return!0;const o=t.value.intro,n=!o.poster||o.poster.trim()==="",l=!o.screenshots||o.screenshots.trim()==="",i=!o.body||o.body.trim()==="";if(n||l||i)return!0;const c=t.value.standardized_params,b=!c.type||c.type.trim()==="",v=!c.medium||c.medium.trim()==="",g=!c.video_codec||c.video_codec.trim()==="",S=!c.audio_codec||c.audio_codec.trim()==="",z=!c.resolution||c.resolution.trim()==="";if(b||v||g||S||z)return!0;const P=t.value.mediainfo||"";if(!P||P.trim()==="")return!0;{const ke=is(P),Me=rs(P);if(!ke&&!Me)return!0}if(ee.value.length>0)return!0;const we=!te.value;return!!(e||we)}),qs=U(()=>{if(os.value)return"检测到禁转/限转标签，不允许继续发布";const s=t.value.title_components.find(i=>i.key==="无法识别");if(s&&s.value!=="")return"存在无法识别的标题内容，请手动修正或删除";const e=t.value.standardized_params,o=t.value.intro,n=[];if((!o.poster||o.poster.trim()==="")&&n.push("海报"),(!o.screenshots||o.screenshots.trim()==="")&&n.push("截图"),(!o.body||o.body.trim()==="")&&n.push("简介正文"),(!t.value.mediainfo||t.value.mediainfo.trim()==="")&&n.push("Mediainfo"),(!e.type||e.type.trim()==="")&&n.push("类型"),(!e.medium||e.medium.trim()==="")&&n.push("媒介"),(!e.video_codec||e.video_codec.trim()==="")&&n.push("视频编码"),(!e.audio_codec||e.audio_codec.trim()==="")&&n.push("音频编码"),(!e.resolution||e.resolution.trim()==="")&&n.push("分辨率"),n.length>0)return`请补充必填项：${n.join("、")}`;if(ee.value.length>0){const i={type:"类型",medium:"媒介",video_codec:"视频编码",audio_codec:"音频编码",resolution:"分辨率",team:"制作组",source:"产地",tags:"标签"};return`参数格式不正确 (${ee.value.map(b=>i[b]||b).join("、")})`}const l=t.value.mediainfo||"";return!is(l)&&!rs(l)?"MediaInfo 或 BDInfo 格式无效":te.value?"准备就绪":"截图链接失效，请等待重新获取或手动修复"}),is=s=>["General","Video","Audio","Complete name","File size","Duration","Width","Height"].filter(n=>s.includes(n)).length>=3,rs=s=>{const e=["DISC INFO","PLAYLIST REPORT"],o=["VIDEO:","AUDIO:","SUBTITLES:","FILES:","Disc Label","Disc Size","BDInfo:","Protection:","Codec","Bitrate","Language","Description"],n=e.filter(i=>s.includes(i)).length,l=o.filter(i=>s.includes(i)).length;return n===e.length||n>=1&&l>=2},Ge=async()=>{const s=he.value;if(s.length===0){te.value=!0;return}let e=!0;for(const o of s)try{await new Promise((n,l)=>{const i=new Image;i.onload=()=>{n(!0)},i.onerror=()=>{l(new Error("Image load failed"))},i.src=o})}catch{e=!1;break}te.value=e},ds=()=>{Ee.value=!1},Hs=(s,e)=>{let o=`--- Log for ${s} ---
${e||"No logs available."}`;const n=me.value.find(l=>l.siteName===s);if(n&&n.downloaderStatus){const l=n.downloaderStatus;o+=`

--- Downloader Status for ${s} ---`,l.success?o+=`
✅ 成功: ${l.message}`:o+=`
❌ 失败: ${l.message}`}ue.value=o,Ee.value=!0},Ws=U(()=>{const s=me.value,e=[];for(let o=0;o<s.length;o+=5)e.push(s.slice(o,o+5));return e}),Ks=s=>s.some(e=>e.success&&e.url),Gs=s=>s.filter(e=>e.success&&e.url).length,Js=s=>{const e=s.filter(o=>o.success&&o.url);if(e.length===0){p.warning({title:"无法打开",message:"该行没有可用的种子链接"});return}e.forEach(o=>{const n=us(o.url);window.open(n,"_blank","noopener,noreferrer")}),p.success({title:"批量打开成功",message:`已打开 ${e.length} 个种子页面`})},Ys=()=>{console.log("日志进度处理完成"),setTimeout(()=>{Te.value=!1},1e3)},us=s=>{if(!s)return s;try{if(s.includes("|DIRECT_DOWNLOAD:")){const o=s.split("|DIRECT_DOWNLOAD:")[0],n=new URL(o);return n.searchParams.delete("uploaded"),n.toString()}const e=new URL(s);return e.searchParams.delete("uploaded"),e.toString()}catch(e){return console.warn("Invalid URL format:",s,e),s}};return(s,e)=>{const o=x("el-icon"),n=x("el-button"),l=x("el-input"),i=x("el-form-item"),c=x("el-option"),b=x("el-select"),v=x("el-tag"),g=x("el-form"),S=x("el-tab-pane"),z=x("el-carousel-item"),P=x("el-carousel"),F=x("el-progress"),re=x("el-card"),we=x("el-empty"),ke=x("el-tabs"),Me=x("el-alert"),Zs=x("el-button-group"),Xs=x("el-scrollbar"),Qs=x("el-dialog");return m(),_(A,null,[a("div",bt,[a("header",ht,[a("div",yt,[(m(),_(A,null,R(Pe,(r,f)=>a("div",{key:f,class:T(["custom-step",{active:f===I.value,completed:f<I.value,last:f===Pe.length-1}])},[a("div",wt,[f<I.value?(m(),V(o,{key:0},{default:u(()=>[d(D(Je))]),_:1})):(m(),_("span",kt,h(f+1),1))]),a("div",St,h(r.title),1),f<Pe.length-1?(m(),_("div",It)):y("",!0)],2)),64))])]),a("main",$t,[I.value===0?(m(),_("div",Ct,[d(ke,{modelValue:G.value,"onUpdate:modelValue":e[18]||(e[18]=r=>G.value=r),type:"border-card",class:"details-tabs"},{default:u(()=>[d(S,{label:"主要信息",name:"main"},{default:u(()=>[a("div",zt,[a("div",Et,[d(g,{"label-position":"top",class:"fill-height-form"},{default:u(()=>[a("div",Tt,[d(i,{label:"原始/待解析标题"},{default:u(()=>[d(l,{modelValue:t.value.original_main_title,"onUpdate:modelValue":e[0]||(e[0]=r=>t.value.original_main_title=r)},{append:u(()=>[d(n,{icon:D(ve),onClick:zs,loading:Be.value},{default:u(()=>[...e[22]||(e[22]=[C(" 重新解析 ",-1)])]),_:1},8,["icon","loading"])]),_:1},8,["modelValue"])]),_:1}),a("div",Vt,[ls.value.length>0?(m(!0),_(A,{key:0},R(ls.value,r=>(m(),V(i,{key:r.key,label:r.key},{default:u(()=>[d(l,{modelValue:r.value,"onUpdate:modelValue":f=>r.value=f},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128)):(m(!0),_(A,{key:1},R(Os.value,(r,f)=>(m(),V(i,{key:"init-"+f,label:r.key},{default:u(()=>[d(l,{modelValue:r.value,"onUpdate:modelValue":E=>r.value=E},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))])]),a("div",Dt,[a("div",At,[a("div",Mt,[d(i,{label:"副标题"},{default:u(()=>[d(l,{modelValue:t.value.subtitle,"onUpdate:modelValue":e[1]||(e[1]=r=>t.value.subtitle=r)},null,8,["modelValue"])]),_:1})]),a("div",{class:T({"unrecognized-section":Ke.value}),style:{"grid-column":"span 1"}},[d(i,{label:"无法识别"},{default:u(()=>[d(l,{modelValue:Ke.value,"onUpdate:modelValue":e[2]||(e[2]=r=>Ke.value=r)},null,8,["modelValue"])]),_:1})],2)]),a("div",Nt,[a("div",Rt,[d(i,{label:"类型 (type)"},{default:u(()=>[d(b,{modelValue:t.value.standardized_params.type,"onUpdate:modelValue":e[3]||(e[3]=r=>t.value.standardized_params.type=r),placeholder:"请选择类型",clearable:"",class:T({"is-invalid":ee.value.includes("type"),"is-empty":!t.value.standardized_params.type}),"data-tag-style":""},{default:u(()=>[(m(!0),_(A,null,R(N.value.type,(r,f)=>(m(),V(c,{key:f,label:r,value:f},null,8,["label","value"]))),128))]),_:1},8,["modelValue","class"])]),_:1}),d(i,{label:"媒介 (medium)"},{default:u(()=>[d(b,{modelValue:t.value.standardized_params.medium,"onUpdate:modelValue":e[4]||(e[4]=r=>t.value.standardized_params.medium=r),placeholder:"请选择媒介",clearable:"",class:T({"is-invalid":ee.value.includes("medium"),"is-empty":!t.value.standardized_params.medium}),"data-tag-style":""},{default:u(()=>[(m(!0),_(A,null,R(N.value.medium,(r,f)=>(m(),V(c,{key:f,label:r,value:f},null,8,["label","value"]))),128))]),_:1},8,["modelValue","class"])]),_:1}),d(i,{label:"视频编码 (video_codec)"},{default:u(()=>[d(b,{modelValue:t.value.standardized_params.video_codec,"onUpdate:modelValue":e[5]||(e[5]=r=>t.value.standardized_params.video_codec=r),placeholder:"请选择视频编码",clearable:"",class:T({"is-invalid":ee.value.includes("video_codec"),"is-empty":!t.value.standardized_params.video_codec}),"data-tag-style":""},{default:u(()=>[(m(!0),_(A,null,R(N.value.video_codec,(r,f)=>(m(),V(c,{key:f,label:r,value:f},null,8,["label","value"]))),128))]),_:1},8,["modelValue","class"])]),_:1}),d(i,{label:"音频编码 (audio_codec)"},{default:u(()=>[d(b,{modelValue:t.value.standardized_params.audio_codec,"onUpdate:modelValue":e[6]||(e[6]=r=>t.value.standardized_params.audio_codec=r),placeholder:"请选择音频编码",clearable:"",class:T({"is-invalid":ee.value.includes("audio_codec"),"is-empty":!t.value.standardized_params.audio_codec}),"data-tag-style":""},{default:u(()=>[(m(!0),_(A,null,R(N.value.audio_codec,(r,f)=>(m(),V(c,{key:f,label:r,value:f},null,8,["label","value"]))),128))]),_:1},8,["modelValue","class"])]),_:1}),d(i,{label:"分辨率 (resolution)"},{default:u(()=>[d(b,{modelValue:t.value.standardized_params.resolution,"onUpdate:modelValue":e[7]||(e[7]=r=>t.value.standardized_params.resolution=r),placeholder:"请选择分辨率",clearable:"",class:T({"is-invalid":ee.value.includes("resolution"),"is-empty":!t.value.standardized_params.resolution}),"data-tag-style":""},{default:u(()=>[(m(!0),_(A,null,R(N.value.resolution,(r,f)=>(m(),V(c,{key:f,label:r,value:f},null,8,["label","value"]))),128))]),_:1},8,["modelValue","class"])]),_:1})]),a("div",xt,[d(i,{label:"制作组 (team)"},{default:u(()=>[d(b,{modelValue:t.value.standardized_params.team,"onUpdate:modelValue":e[8]||(e[8]=r=>t.value.standardized_params.team=r),placeholder:"请选择制作组",clearable:"",filterable:"","allow-create":"","default-first-option":"",class:T(["team-select",{"is-invalid":ee.value.includes("team")}])},{default:u(()=>[(m(!0),_(A,null,R(N.value.team,(r,f)=>(m(),V(c,{key:f,label:r,value:f},null,8,["label","value"]))),128))]),_:1},8,["modelValue","class"])]),_:1}),d(i,{label:"产地 (source)"},{default:u(()=>[d(b,{modelValue:t.value.standardized_params.source,"onUpdate:modelValue":e[9]||(e[9]=r=>t.value.standardized_params.source=r),placeholder:"请选择产地",clearable:"",class:T({"is-invalid":ee.value.includes("source")}),"data-tag-style":""},{default:u(()=>[(m(!0),_(A,null,R(N.value.source,(r,f)=>(m(),V(c,{key:f,label:r,value:f},null,8,["label","value"]))),128))]),_:1},8,["modelValue","class"])]),_:1}),d(i,{label:"标签 (tags)",class:"tags-wide-item"},{default:u(()=>[d(b,{modelValue:t.value.standardized_params.tags,"onUpdate:modelValue":e[10]||(e[10]=r=>t.value.standardized_params.tags=r),multiple:"",filterable:"","allow-create":"","default-first-option":"",placeholder:"请选择或输入标签",style:{width:"100%"}},{tag:u(({data:r})=>[(m(!0),_(A,null,R(r,f=>(m(),V(v,{key:f.value,type:Ms(f.value),closable:!Ae(f.value),"disable-transitions":"",onClose:E=>js(f.value),style:{margin:"2px"}},{default:u(()=>[a("span",null,h(N.value.tags[f.value]||f.currentLabel),1)]),_:2},1032,["type","closable","onClose"]))),128))]),default:u(()=>[(m(!0),_(A,null,R(As.value,r=>(m(),V(c,{key:r.value,label:r.label,value:r.value},{default:u(()=>[a("span",{style:lt({color:De.value.includes(r.value)?"#F56C6C":""})},h(r.label),5)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e[23]||(e[23]=a("div",{class:"placeholder-item"},null,-1)),e[24]||(e[24]=a("div",{class:"placeholder-item"},null,-1))])])])]),_:1})])])]),_:1}),d(S,{label:"海报与声明",name:"poster-statement"},{default:u(()=>[a("div",Lt,[d(g,{"label-position":"top",class:"fill-height-form"},{default:u(()=>[a("div",Pt,[a("div",Bt,[d(i,{label:"声明",class:"statement-item"},{default:u(()=>[d(l,{type:"textarea",modelValue:t.value.intro.statement,"onUpdate:modelValue":e[11]||(e[11]=r=>t.value.intro.statement=r),rows:18},null,8,["modelValue"])]),_:1}),d(i,null,{label:u(()=>[a("div",Ut,[e[26]||(e[26]=a("span",null,"海报链接",-1)),d(n,{icon:D(ve),onClick:Cs,loading:ze.value,size:"small",type:"text"},{default:u(()=>[...e[25]||(e[25]=[C(" 重新获取 ",-1)])]),_:1},8,["icon","loading"])])]),default:u(()=>[d(l,{type:"textarea",modelValue:t.value.intro.poster,"onUpdate:modelValue":e[12]||(e[12]=r=>t.value.intro.poster=r),rows:2},null,8,["modelValue"])]),_:1})]),a("div",Ot,[a("div",jt,[e[27]||(e[27]=a("div",{class:"preview-header"},"海报预览",-1)),a("div",Ft,[Ve.value.length?(m(!0),_(A,{key:0},R(Ve.value,(r,f)=>(m(),_("img",{key:"poster-"+f,src:H(r),alt:"海报预览",class:"preview-image",onError:E=>Y(r,"poster",f)},null,40,qt))),128)):(m(),_("div",Ht,"暂无海报预览"))])])])])]),_:1})])]),_:1}),d(S,{label:"视频截图",name:"images"},{default:u(()=>[a("div",Wt,[a("div",Kt,[d(g,{"label-position":"top",class:"fill-height-form"},{default:u(()=>[d(i,{class:"is-flexible"},{label:u(()=>[a("div",Gt,[e[29]||(e[29]=a("span",null,"截图",-1)),d(n,{icon:D(ve),onClick:ks,loading:$e.value,size:"small",type:"text"},{default:u(()=>[...e[28]||(e[28]=[C(" 重新获取 ",-1)])]),_:1},8,["icon","loading"])])]),default:u(()=>[d(l,{type:"textarea",modelValue:t.value.intro.screenshots,"onUpdate:modelValue":e[13]||(e[13]=r=>t.value.intro.screenshots=r),rows:20},null,8,["modelValue"])]),_:1})]),_:1})]),a("div",Jt,[a("div",Yt,[he.value.length?(m(),V(P,{key:0,interval:5e3,height:"500px","indicator-position":"outside"},{default:u(()=>[(m(!0),_(A,null,R(he.value,(r,f)=>(m(),V(z,{key:"ss-"+f},{default:u(()=>[a("div",Zt,[a("img",{src:H(r),alt:"截图预览",class:"carousel-image",onError:E=>Y(r,"screenshot",f)},null,40,Xt)])]),_:2},1024))),128))]),_:1})):(m(),_("div",Qt,"截图预览"))])])])]),_:1}),d(S,{label:"简介详情",name:"intro"},{default:u(()=>[d(g,{"label-position":"top",class:"fill-height-form"},{default:u(()=>[d(i,{class:"is-flexible"},{label:u(()=>[a("div",ea,[e[31]||(e[31]=a("span",null,"正文",-1)),d(n,{icon:D(ve),onClick:ws,loading:Ue.value,size:"small",type:"text"},{default:u(()=>[...e[30]||(e[30]=[C(" 重新获取 ",-1)])]),_:1},8,["icon","loading"])])]),default:u(()=>[d(l,{type:"textarea",modelValue:t.value.intro.body,"onUpdate:modelValue":e[14]||(e[14]=r=>t.value.intro.body=r),rows:18},null,8,["modelValue"])]),_:1}),d(i,{label:"豆瓣链接"},{default:u(()=>[d(l,{modelValue:t.value.douban_link,"onUpdate:modelValue":e[15]||(e[15]=r=>t.value.douban_link=r),placeholder:"请输入豆瓣电影链接"},null,8,["modelValue"])]),_:1}),d(i,{label:"IMDb链接"},{default:u(()=>[d(l,{modelValue:t.value.imdb_link,"onUpdate:modelValue":e[16]||(e[16]=r=>t.value.imdb_link=r),placeholder:"请输入IMDb电影链接"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),d(S,{label:"媒体信息",name:"mediainfo"},{default:u(()=>[d(g,{"label-position":"top",class:"fill-height-form"},{default:u(()=>[d(i,{class:"is-flexible"},{label:u(()=>[a("div",sa,[e[33]||(e[33]=a("span",null,"Mediainfo",-1)),d(n,{icon:D(ve),onClick:Ss,loading:Ce.value,size:"small",type:"text"},{default:u(()=>[...e[32]||(e[32]=[C(" 重新获取 ",-1)])]),_:1},8,["icon","loading"])])]),default:u(()=>[a("div",ta,[J.value.visible?(m(),_("div",aa,[d(re,{class:"bdinfo-progress-card-inline",shadow:"never"},{header:u(()=>[a("div",la,[e[37]||(e[37]=a("span",null,"BDInfo 获取中...",-1)),a("div",oa,[e[36]||(e[36]=a("span",{class:"background-hint"},"可在后台继续获取",-1)),d(n,{icon:D(at),onClick:$s,size:"small",text:"",type:"primary"},{default:u(()=>[...e[34]||(e[34]=[C(" 放置后台 ",-1)])]),_:1},8,["icon"]),d(n,{icon:D(ms),onClick:ye,size:"small",text:"",type:"info"},{default:u(()=>[...e[35]||(e[35]=[C(" 取消获取 ",-1)])]),_:1},8,["icon"])])])]),default:u(()=>[d(F,{percentage:J.value.percent,status:J.value.percent===100?"success":""},null,8,["percentage","status"]),a("div",na,[a("div",ia,[a("div",ra,"原盘体积: "+h(hs(Qe.value)),1),a("div",da,"已用时: "+h(J.value.elapsedTime),1),a("div",ua," 剩余时间: "+h(J.value.remainingTime),1)])])]),_:1})])):y("",!0),d(l,{type:"textarea",class:"code-font",modelValue:t.value.mediainfo,"onUpdate:modelValue":e[17]||(e[17]=r=>t.value.mediainfo=r),rows:J.value.visible?18:26},null,8,["modelValue","rows"])])]),_:1})]),_:1})]),_:1}),d(S,{label:"已过滤声明",name:"filtered-declarations",class:"filtered-declarations-pane"},{default:u(()=>[a("div",ca,[a("div",ma,[e[38]||(e[38]=a("h3",null,"已自动过滤的声明内容",-1)),d(v,{type:"warning",size:"small"},{default:u(()=>[C("共 "+h(ts.value)+" 条",1)]),_:1})]),a("div",pa,[ts.value>0?(m(!0),_(A,{key:0},R(ss.value,(r,f)=>(m(),_("div",{key:f,class:"declaration-item"},[a("div",va,[a("span",_a,"#"+h(f+1),1),d(v,{type:"danger",size:"small"},{default:u(()=>[...e[39]||(e[39]=[C("已过滤",-1)])]),_:1})]),a("pre",fa,h(r),1)]))),128)):(m(),_("div",ga,[d(we,{description:"未检测到需要过滤的 ARDTU 声明内容"})]))])])]),_:1})]),_:1},8,["modelValue"])])):y("",!0),I.value===1?(m(),_("div",ba,[a("div",ha,[a("div",ya,[e[40]||(e[40]=a("div",{class:"row-label"},"主标题：",-1)),a("div",wa,h(t.value.final_publish_parameters?.["主标题 (预览)"]||t.value.original_main_title||"暂无数据"),1)]),a("div",ka,[e[41]||(e[41]=a("div",{class:"row-label"},"副标题：",-1)),a("div",Sa,h(t.value.subtitle||"暂无数据"),1)]),a("div",Ia,[e[53]||(e[53]=a("div",{class:"row-label"},"参数信息：",-1)),a("div",$a,[a("div",Ca,[a("div",za,[a("div",Ea,[e[42]||(e[42]=a("span",{class:"param-label"},"IMDb链接：",-1)),a("span",{class:T(["param-value",{empty:!t.value.imdb_link||t.value.imdb_link==="N/A"}])},h(t.value.imdb_link||"N/A"),3)]),a("div",Ta,[e[43]||(e[43]=a("span",{style:{"letter-spacing":"2.6px"},class:"param-label"},"豆瓣链接",-1)),e[44]||(e[44]=a("span",{style:{"font-size":"13px"}},"：",-1)),a("span",{class:T(["param-value",{empty:!t.value.douban_link||t.value.douban_link==="N/A"}])},h(t.value.douban_link||"N/A"),3)])]),a("div",Va,[e[45]||(e[45]=a("span",{class:"param-label"},"标签：",-1)),a("div",Da,[a("span",{class:T(["param-value",{empty:!We()||We().length===0}])},h(We().join(", ")||"N/A"),3),pe.value&&pe.value.length>0?(m(),_("span",Aa,h(pe.value.join(", ")),1)):y("",!0)])])]),a("div",Ma,[a("div",Na,[e[46]||(e[46]=a("span",{class:"param-label"},"类型：",-1)),a("div",Ra,[a("span",{class:T(["param-value",{empty:!W("type")}])},h(W("type")||"N/A"),3),t.value.standardized_params.type?(m(),_("span",xa,h(t.value.standardized_params.type),1)):y("",!0)])]),a("div",La,[e[47]||(e[47]=a("span",{class:"param-label"},"媒介：",-1)),a("div",Pa,[a("span",{class:T(["param-value",{empty:!W("medium")}])},h(W("medium")||"N/A"),3),t.value.standardized_params.medium?(m(),_("span",Ba,h(t.value.standardized_params.medium),1)):y("",!0)])]),a("div",Ua,[e[48]||(e[48]=a("span",{class:"param-label"},"视频编码：",-1)),a("div",Oa,[a("span",{class:T(["param-value",{empty:!W("video_codec")}])},h(W("video_codec")||"N/A"),3),t.value.standardized_params.video_codec?(m(),_("span",ja,h(t.value.standardized_params.video_codec),1)):y("",!0)])]),a("div",Fa,[e[49]||(e[49]=a("span",{class:"param-label"},"音频编码：",-1)),a("div",qa,[a("span",{class:T(["param-value",{empty:!W("audio_codec")}])},h(W("audio_codec")||"N/A"),3),t.value.standardized_params.audio_codec?(m(),_("span",Ha,h(t.value.standardized_params.audio_codec),1)):y("",!0)])]),a("div",Wa,[e[50]||(e[50]=a("span",{class:"param-label"},"分辨率：",-1)),a("div",Ka,[a("span",{class:T(["param-value",{empty:!W("resolution")}])},h(W("resolution")||"N/A"),3),t.value.standardized_params.resolution?(m(),_("span",Ga,h(t.value.standardized_params.resolution),1)):y("",!0)])]),a("div",Ja,[e[51]||(e[51]=a("span",{class:"param-label"},"制作组：",-1)),a("div",Ya,[a("span",{class:T(["param-value",{empty:!W("team")}])},h(W("team")||"N/A"),3),t.value.standardized_params.team?(m(),_("span",Za,h(t.value.standardized_params.team),1)):y("",!0)])]),a("div",Xa,[e[52]||(e[52]=a("span",{class:"param-label"},"产地/来源：",-1)),a("div",Qa,[a("span",{class:T(["param-value",{empty:!W("source")}])},h(W("source")||"N/A"),3),t.value.standardized_params.source?(m(),_("span",el,h(t.value.standardized_params.source),1)):y("",!0)])])])])]),a("div",sl,[e[54]||(e[54]=a("div",{class:"row-label"},"Mediainfo：",-1)),a("div",tl,[a("pre",al,h(t.value.mediainfo||"暂无数据"),1)])]),a("div",ll,[e[56]||(e[56]=a("div",{class:"row-label"},"简介内容：",-1)),a("div",ol,[a("div",nl,[a("div",{class:"section-content",innerHTML:_e(t.value.intro?.statement)||"暂无声明"},null,8,il)]),Ve.value.length>0?(m(),_("div",rl,[a("div",dl,[(m(!0),_(A,null,R(Ve.value,(r,f)=>(m(),_("img",{key:"poster-preview-"+f,src:H(r),alt:"海报 "+(f+1),class:"preview-image-inline",style:{width:"300px"},onError:E=>Y(r,"poster",f)},null,40,ul))),128))])])):y("",!0),a("div",cl,[e[55]||(e[55]=a("br",null,null,-1)),a("div",{class:"section-content",innerHTML:_e(t.value.intro?.body)||"暂无正文"},null,8,ml)]),he.value.length>0?(m(),_("div",pl,[a("div",vl,[(m(!0),_(A,null,R(he.value,(r,f)=>(m(),_("img",{key:"screenshot-preview-"+f,src:H(r),alt:"截图 "+(f+1),class:"preview-image-inline",onError:E=>Y(r,"screenshot",f)},null,40,_l))),128))])])):y("",!0)])])])])):y("",!0),I.value===2?(m(),_("div",fl,[e[61]||(e[61]=a("h3",{class:"selection-title"},"请选择要发布的目标站点",-1)),e[62]||(e[62]=a("p",{class:"selection-subtitle"},"已存在的站点已被自动禁用。红色站点表示配置不完整。",-1)),Fs.value?(m(),V(Me,{key:0,type:"error",closable:!1,style:{width:"410px",margin:"0 auto"}},{title:u(()=>[...e[57]||(e[57]=[a("span",{style:{"font-weight":"600"}},"禁止转载",-1)])]),default:u(()=>[e[58]||(e[58]=a("div",null,[C(" 检测到制作组包含禁止转载的内容，已自动禁用 UBits 站点。"),a("br"),C(" 禁止转载的制作组：CMCT、CMCTV ")],-1))]),_:1})):y("",!0),a("div",gl,[d(Zs,null,{default:u(()=>[d(n,{type:"primary",onClick:xs},{default:u(()=>[...e[59]||(e[59]=[C("全选",-1)])]),_:1}),d(n,{type:"info",onClick:Ls},{default:u(()=>[...e[60]||(e[60]=[C("清空",-1)])]),_:1})]),_:1})]),a("div",bl,[(m(!0),_(A,null,R(de.value.filter(r=>r.is_target),r=>(m(),V(n,{key:r.name,class:"site-button",type:ys(r),plain:!r.has_cookie,disabled:!je(r.name),onClick:f=>Rs(r.name)},{default:u(()=>[C(h(r.name)+" ",1),r.name==="ubits"&&!je(r.name)?(m(),V(D(ot),{key:0,content:"该制作组禁止转载到 uBits 站点",placement:"top"},{default:u(()=>[d(o,{style:{"margin-left":"4px",color:"#f56c6c"}},{default:u(()=>[d(D(nt))]),_:1})]),_:1})):y("",!0)]),_:2},1032,["type","plain","disabled","onClick"]))),128))])])):y("",!0),I.value===3?(m(),_("div",hl,[ne.value.total>0||ie.value.total>0?(m(),_("div",yl,[ne.value.total>0?(m(),_("div",wl,[e[63]||(e[63]=a("div",{class:"progress-label"},"发布进度:",-1)),d(F,{percentage:Math.round(ne.value.current/ne.value.total*100),"show-text":!0},null,8,["percentage"]),a("div",kl,h(ne.value.current)+" / "+h(ne.value.total),1)])):y("",!0),ie.value.total>0?(m(),_("div",Sl,[e[64]||(e[64]=a("div",{class:"progress-label"},"下载器添加进度:",-1)),d(F,{percentage:Math.round(ie.value.current/ie.value.total*100),"show-text":!0},null,8,["percentage"]),a("div",Il,h(ie.value.current)+" / "+h(ie.value.total),1)])):y("",!0)])):y("",!0),a("div",$l,[(m(!0),_(A,null,R(Ws.value,(r,f)=>(m(),_("div",{key:f,class:"results-row"},[a("div",Cl,[(m(!0),_(A,null,R(r,E=>(m(),_("div",{key:E.siteName,class:T(["result-card",{"is-success":E.success,"is-error":!E.success}])},[a("div",zl,[E.success?(m(),V(o,{key:0,color:"#67C23A",size:32},{default:u(()=>[d(D(Je))]),_:1})):(m(),V(o,{key:1,color:"#F56C6C",size:32},{default:u(()=>[d(D(ps))]),_:1}))]),a("h4",El,h(E.siteName),1),E.isExisted?(m(),_("div",Tl,[d(v,{type:"warning",size:"small"},{default:u(()=>[...e[65]||(e[65]=[C("已存在",-1)])]),_:1})])):y("",!0),E.downloaderStatus?(m(),_("div",Vl,[a("div",Dl,[E.downloaderStatus.success?(m(),V(o,{key:0,color:"#67C23A",size:16},{default:u(()=>[d(D(Je))]),_:1})):(m(),V(o,{key:1,color:"#F56C6C",size:16},{default:u(()=>[d(D(ps))]),_:1}))]),a("span",{class:T(["status-text",{success:E.downloaderStatus.success,error:!E.downloaderStatus.success}])},h(E.downloaderStatus.success?`种子已添加到'${E.downloaderStatus.downloaderName}'`:"添加失败"),3)])):y("",!0),a("div",Al,[d(n,{type:"primary",size:"small",onClick:lo=>Hs(E.siteName,E.logs)},{default:u(()=>[...e[66]||(e[66]=[C(" 查看日志 ",-1)])]),_:1},8,["onClick"]),E.success&&E.url?(m(),_("a",{key:0,href:us(E.url),target:"_blank",rel:"noopener noreferrer",style:{transform:"translateY(-1px)"}},[d(n,{type:"success",size:"small"},{default:u(()=>[...e[67]||(e[67]=[C(" 查看种子 ",-1)])]),_:1})],8,Ml)):y("",!0)])],2))),128))]),a("div",Nl,[d(n,{type:"warning",icon:D(ve),size:"large",onClick:E=>Js(r),disabled:!Ks(r),class:"open-all-button"},{default:u(()=>[a("div",Rl,"打开"+h(Gs(r))+"个站点",1)]),_:2},1032,["icon","onClick","disabled"])])]))),128))])])):y("",!0)]),a("footer",xl,[I.value===0?(m(),_("div",Ll,[d(Ne,{name:"el-fade-in-linear"},{default:u(()=>[K.showCompleteButton?(m(),_("div",Pl," 修改完成后请预览一遍种子信息确保无误后完成修改！ ")):y("",!0)]),_:1}),d(n,{onClick:qe},{default:u(()=>[...e[68]||(e[68]=[C("取消",-1)])]),_:1}),d(n,{type:"primary",onClick:Ds,disabled:ns.value},{default:u(()=>[...e[69]||(e[69]=[C(" 下一步：发布参数预览 ",-1)])]),_:1},8,["disabled"]),d(Ne,{name:"el-fade-in-linear"},{default:u(()=>[ns.value?(m(),_("div",Bl,[d(o,{class:"hint-icon"},{default:u(()=>[d(D(Re))]),_:1}),a("span",null,h(qs.value),1)])):y("",!0)]),_:1})])):y("",!0),I.value===1?(m(),_("div",Ul,[d(n,{onClick:Bs,disabled:j.value},{default:u(()=>[...e[70]||(e[70]=[C("上一步",-1)])]),_:1},8,["disabled"]),K.showCompleteButton?(m(),V(n,{key:0,type:"primary",onClick:as,disabled:j.value||!le.value,class:T({"scrolled-to-bottom":le.value})},{default:u(()=>[...e[71]||(e[71]=[C(" 修改完成 ",-1)])]),_:1},8,["disabled","class"])):y("",!0),d(n,{type:"primary",onClick:Ns,disabled:j.value||!le.value,class:T({"scrolled-to-bottom":le.value})},{default:u(()=>[...e[72]||(e[72]=[C(" 下一步：选择发布站点 ",-1)])]),_:1},8,["disabled","class"]),d(Ne,{name:"el-fade-in-linear"},{default:u(()=>[K.showCompleteButton&&!le.value?(m(),_("div",Ol,[d(o,{class:"hint-icon"},{default:u(()=>[d(D(Re))]),_:1}),e[73]||(e[73]=a("span",null,"请滚动到页面底部检查完种子信息无误再发布！",-1))])):y("",!0)]),_:1}),d(Ne,{name:"el-fade-in-linear"},{default:u(()=>[!K.showCompleteButton&&!le.value?(m(),_("div",jl,[d(o,{class:"hint-icon"},{default:u(()=>[d(D(Re))]),_:1}),e[74]||(e[74]=a("span",null,"请先滚动到页面底部检查完种子信息再发布！",-1))])):y("",!0)]),_:1})])):y("",!0),I.value===2?(m(),_("div",Fl,[d(n,{onClick:qe,disabled:j.value},{default:u(()=>[...e[75]||(e[75]=[C("取消",-1)])]),_:1},8,["disabled"]),d(n,{type:"primary",onClick:Ps,loading:j.value,disabled:Z.value.length===0},{default:u(()=>[...e[76]||(e[76]=[C(" 立即发布 ",-1)])]),_:1},8,["loading","disabled"])])):y("",!0),I.value===3?(m(),_("div",ql,[d(n,{type:"primary",onClick:as},{default:u(()=>[...e[77]||(e[77]=[C("完成",-1)])]),_:1})])):y("",!0)])]),Ee.value?(m(),_("div",{key:0,class:"log-card-overlay",onClick:ds})):y("",!0),Ee.value?(m(),V(re,{key:1,class:"log-card",shadow:"xl"},{header:u(()=>[a("div",Hl,[e[78]||(e[78]=a("span",null,"操作日志",-1)),d(n,{type:"danger",icon:D(ms),circle:"",onClick:ds},null,8,["icon"])])]),default:u(()=>[a("pre",Wl,h(ue.value),1)]),_:1})):y("",!0),d(gt,{visible:Te.value,taskId:es.value,onComplete:Ys,onClose:e[19]||(e[19]=r=>Te.value=!1)},null,8,["visible","taskId"]),d(Qs,{modelValue:Q.value,"onUpdate:modelValue":e[21]||(e[21]=r=>Q.value=r),title:"抓取失败 - 详细日志",width:"800px","destroy-on-close":"","append-to-body":"",class:"error-log-dialog"},{footer:u(()=>[a("span",so,[d(n,{onClick:e[20]||(e[20]=r=>Q.value=!1)},{default:u(()=>[...e[80]||(e[80]=[C("关闭",-1)])]),_:1})])]),default:u(()=>[a("div",Kl,[d(Me,{title:"获取种子信息过程中发生错误",type:"error",closable:!1,"show-icon":"",style:{"margin-bottom":"15px"}},{default:u(()=>[...e[79]||(e[79]=[a("div",null,"请查看下方详细日志以排查问题（如 Python 堆栈信息）。",-1)])]),_:1}),d(Xs,{height:"500px"},{default:u(()=>[a("div",Gl,[(m(!0),_(A,null,R(oe.value,r=>(m(),_("div",{key:r.id,class:T(["log-entry",{"is-error":r.isError}])},[a("div",Jl,[a("span",Yl,h(r.time),1),d(v,{type:fe(r.level),size:"small",effect:"dark",class:"log-level-tag"},{default:u(()=>[C(h(r.level),1)]),_:2},1032,["type"]),r.site?(m(),_("span",Zl,"["+h(r.site)+"]",1)):y("",!0),a("span",Xl,h(r.message),1)]),r.details?(m(),_("div",Ql,[a("pre",eo,h(r.details),1)])):y("",!0)],2))),128))])]),_:1})])]),_:1},8,["modelValue"])],64)}}}),no=gs(to,[["__scopeId","data-v-2447ddbc"]]);export{no as C,it as u};
