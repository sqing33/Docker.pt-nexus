import{K as Fs,d as rs,r as I,c as U,D as qe,o as ds,s as qs,a as v,k as w,i as a,e as d,f as R,w as u,F as T,l as M,x as L,L as ns,h as c,m as E,M as Hs,N as Ks,O as Te,p as us,q as _e,g as D,E as p,P as re,j as z,n as V,t as h,T as Ee,Q as Ws,R as Fe,B as Gs,y as Ys,S as Js,U as is}from"./index-C49IlDSN.js";const Qs=Fs("crossSeed",{state:()=>({taskId:null,sourceInfo:null,workingParams:null}),actions:{setTaskId(X){this.taskId=X},clearTaskId(){this.taskId=null},setSourceInfo(X){this.sourceInfo=X},clearSourceInfo(){this.sourceInfo=null},setParams(X){this.workingParams=X},clearParams(){this.workingParams=null},reset(){this.clearTaskId(),this.clearSourceInfo(),this.clearParams()}}}),Zs={key:0,class:"log-progress-overlay"},Xs={class:"log-progress-container"},et={class:"steps-wrapper"},st={key:0,class:"spinner-icon"},tt={key:1,class:"success-icon"},at={key:2,class:"error-icon"},lt={key:3,class:"warning-icon"},ot={key:0,class:"completion-message"},nt=rs({__name:"LogProgress",props:{visible:{type:Boolean},taskId:{}},emits:["complete","close"],setup(X,{emit:Ne}){const B=X,de=Ne,F=I([{name:"数据库查询",message:"正在检查缓存...",status:"pending"},{name:"开始抓取",message:"准备从源站点获取...",status:"pending"},{name:"获取种子信息",message:"",status:"pending"},{name:"解析参数",message:"",status:"pending"},{name:"验证图片链接",message:"",status:"pending"},{name:"提取媒体信息",message:"",status:"pending"},{name:"验证简介格式",message:"",status:"pending"},{name:"检查声明感谢",message:"",status:"pending"},{name:"成功获取参数",message:"",status:"pending"}]),ue=I(!1);let G=null;const oe=U(()=>{const C=F.value.findIndex(q=>q.status==="processing");return C!==-1?C:F.value.filter(q=>q.status==="success").length}),ce=C=>C.status==="success"?"success":C.status==="error"?"error":C.status==="warning"?"warning":C.status==="processing"?"process":"wait";qe(()=>B.taskId,C=>{C&&B.visible&&k()}),qe(()=>B.visible,C=>{C&&B.taskId?k():C||N()}),ds(()=>{B.visible&&B.taskId&&k()}),qs(()=>{N()});const k=()=>{G&&G.close(),ue.value=!1,F.value.forEach(C=>{C.status="pending",C.message=C.name==="数据库查询"?"正在检查缓存...":C.name==="开始抓取"?"准备从源站点获取...":""}),G=new EventSource(`/api/migrate/logs/stream/${B.taskId}`),G.onmessage=C=>{try{const y=JSON.parse(C.data);y.type==="connected"?console.log("SSE 连接成功",y):y.type==="log"?Ae(y.step,y.message,y.status):y.type==="complete"?(ue.value=!0,de("complete"),N(),de("close")):y.type}catch(y){console.error("解析 SSE 消息失败:",y)}},G.onerror=C=>{console.error("SSE 连接错误:",C),N()}},N=()=>{G&&(G.close(),G=null)},Ae=(C,y,q)=>{const K=F.value.findIndex(H=>H.name===C);if(K!==-1){const H=F.value[K];if(H.message=y,H.status=q,q==="success"&&K<F.value.length-1){const x=F.value[K+1];x.status==="pending"&&(x.status="processing")}}};return(C,y)=>{const q=R("el-icon"),K=R("el-step"),H=R("el-steps");return X.visible?(c(),v("div",Zs,[a("div",Xs,[a("div",et,[d(H,{direction:"vertical",active:oe.value,"finish-status":"success"},{default:u(()=>[(c(!0),v(T,null,M(F.value,(x,He)=>(c(),E(K,{key:He,title:x.name,description:x.message,status:ce(x)},{icon:u(()=>[x.status==="processing"?(c(),v("div",st,[d(q,{class:"is-loading"},{default:u(()=>[d(L(Hs))]),_:1})])):x.status==="success"?(c(),v("div",tt,[d(q,null,{default:u(()=>[d(L(ns))]),_:1})])):x.status==="error"?(c(),v("div",at,[d(q,null,{default:u(()=>[d(L(Ks))]),_:1})])):x.status==="warning"?(c(),v("div",lt,[d(q,null,{default:u(()=>[d(L(Te))]),_:1})])):w("",!0)]),_:2},1032,["title","description","status"]))),128))]),_:1},8,["active"]),ue.value?(c(),v("div",ot,[d(q,{class:"icon-complete",color:"#67C23A"},{default:u(()=>[d(L(ns))]),_:1}),y[0]||(y[0]=a("span",null,"所有步骤已完成",-1))])):w("",!0)])])])):w("",!0)}}}),it=us(nt,[["__scopeId","data-v-b874a855"]]),rt={class:"cross-seed-panel"},dt={class:"panel-header"},ut={class:"custom-steps"},ct={class:"step-icon"},mt={key:1},pt={class:"step-title"},vt={key:0,class:"step-connector"},_t={class:"panel-content"},ft={key:0,class:"step-container details-container"},gt={class:"main-info-container"},bt={class:"full-width-form-column"},ht={class:"title-section"},yt={class:"title-components-grid"},wt={class:"bottom-info-section"},kt={class:"subtitle-unrecognized-grid"},St={class:"subtitle-section",style:{"grid-column":"span 4"}},It={class:"standard-params-section"},Ct={class:"standard-params-grid"},$t={class:"standard-params-grid second-row"},zt={class:"poster-statement-container"},Vt={class:"poster-statement-split"},Et={class:"left-panel"},Tt={class:"form-label-with-button"},Nt={class:"right-panel"},At={class:"poster-preview-section"},Mt={class:"image-preview-container"},Rt=["src","onError"],Lt={key:1,class:"preview-placeholder"},Pt={class:"screenshot-container"},Dt={class:"form-column screenshot-text-column"},xt={class:"form-label-with-button"},Ut={class:"preview-column screenshot-preview-column"},Bt={class:"carousel-container"},Ot={class:"carousel-image-wrapper"},jt=["src","onError"],Ft={key:1,class:"preview-placeholder"},qt={class:"form-label-with-button"},Ht={class:"form-label-with-button"},Kt={class:"filtered-declarations-container"},Wt={class:"filtered-declarations-header"},Gt={class:"filtered-declarations-content"},Yt={class:"declaration-header"},Jt={class:"declaration-number"},Qt={class:"declaration-content code-font"},Zt={key:1,class:"no-filtered-declarations"},Xt={key:1,class:"step-container publish-preview-container"},ea={class:"publish-preview-content"},sa={class:"preview-row main-title-row"},ta={class:"row-content main-title-content"},aa={class:"preview-row subtitle-row"},la={class:"row-content subtitle-content"},oa={class:"preview-row params-row"},na={class:"row-content"},ia={class:"param-row"},ra={class:"param-item imdb-item half-width"},da={style:{display:"flex"}},ua={style:{display:"flex"}},ca={class:"param-item tags-item half-width"},ma={class:"param-value-container"},pa={key:0,class:"param-standard-key"},va={class:"params-content"},_a={class:"param-item inline-param"},fa={class:"param-value-container"},ga={key:0,class:"param-standard-key"},ba={class:"param-item inline-param"},ha={class:"param-value-container"},ya={key:0,class:"param-standard-key"},wa={class:"param-item inline-param"},ka={class:"param-value-container"},Sa={key:0,class:"param-standard-key"},Ia={class:"param-item inline-param"},Ca={class:"param-value-container"},$a={key:0,class:"param-standard-key"},za={class:"param-item inline-param"},Va={class:"param-value-container"},Ea={key:0,class:"param-standard-key"},Ta={class:"param-item inline-param"},Na={class:"param-value-container"},Aa={key:0,class:"param-standard-key"},Ma={class:"param-item inline-param"},Ra={class:"param-value-container"},La={key:0,class:"param-standard-key"},Pa={class:"preview-row mediainfo-row"},Da={class:"row-content mediainfo-content scrollable-content"},xa={class:"mediainfo-pre"},Ua={class:"preview-row description-row"},Ba={class:"row-content description-content"},Oa={class:"description-section"},ja=["innerHTML"],Fa={key:0,class:"description-section"},qa={class:"image-gallery"},Ha=["src","alt","onError"],Ka={class:"description-section"},Wa=["innerHTML"],Ga={key:1,class:"description-section"},Ya={class:"image-gallery"},Ja=["src","alt","onError"],Qa={key:2,class:"step-container site-selection-container"},Za={class:"select-all-container",style:{"margin-top":"16px"}},Xa={class:"site-buttons-group"},el={key:3,class:"step-container results-container"},sl={key:0,class:"progress-section"},tl={key:0,class:"progress-item"},al={class:"progress-text"},ll={key:1,class:"progress-item"},ol={class:"progress-text"},nl={class:"results-rows-container"},il={class:"row-sites"},rl={class:"card-icon"},dl={class:"card-title"},ul={key:0,class:"existed-tag"},cl={key:1,class:"downloader-status"},ml={class:"status-icon"},pl={class:"card-extra"},vl=["href"],_l={class:"row-action"},fl={class:"button-subtitle"},gl={class:"panel-footer"},bl={key:0,class:"button-group"},hl={key:0,class:"check-hint"},yl={key:0,class:"validation-hint"},wl={key:1,class:"button-group"},kl={key:0,class:"validation-hint"},Sl={key:0,class:"validation-hint"},Il={key:2,class:"button-group"},Cl={key:3,class:"button-group"},$l={class:"card-header"},zl={class:"log-content-pre"},Vl={class:"error-log-container"},El={class:"log-timeline"},Tl={class:"log-entry-header"},Nl={class:"log-time"},Al={key:0,class:"log-site"},Ml={class:"log-text"},Rl={key:0,class:"log-entry-details"},Ll={class:"code-block"},Pl={class:"dialog-footer"},Dl=rs({__name:"CrossSeedPanel",props:{showCompleteButton:{type:Boolean,default:!1}},emits:["complete","cancel","close-with-refresh"],setup(X,{emit:Ne}){const B=s=>{if(!s)return"";s=s.replace(/[ \t\f\v]+$/gm,""),s=s.replace(/^\s*\n+/,"").replace(/\n\s*$/,""),s=s.replace(/(\n\s*){2,}/g,`

`),s=s.replace(/([^\n]+。)\s*\n\s*\n(\s*\d+\.)/g,`$1
$2`),s=s.replace(/(\d+\.[\s\S]*?)\n\s*\n(\s*\d+\.)/g,`$1
$2`),s=s.replace(/(\[(?:b|color)[^\]]*\][\s\S]*?)\n\s*\n([\s\S]*?\[\/(?:b|color)\])/gi,`$1
$2`);for(let e=0;e<3;e++)s=s.replace(/(\[(?:quote|b|color|size)[^\]]*\][\s\S]*?)\n\s*\n([\s\S]*?\[\/(?:quote|b|color|size)\])/gi,`$1
$2`);return s=s.replace(/(\n\s*){2,}/g,`

`),s},de=s=>s?(s=B(s),s=s.replace(/\[quote\]([\s\S]*?)\[\/quote\]/gi,"<blockquote>$1</blockquote>"),s=s.replace(/\[b\]([\s\S]*?)\[\/b\]/gi,"<strong>$1</strong>"),s=s.replace(/\[color=(\w+|\#[0-9a-fA-F]{3,6})\]([\s\S]*?)\[\/color\]/gi,'<span style="color: $1;">$2</span>'),s=s.replace(/\[size=(\d+)\]([\s\S]*?)\[\/size\]/gi,(e,i,r)=>`<span style="font-size: ${{1:"12",2:"14",3:"16",4:"18",5:"24",6:"32",7:"48"}[i]||parseInt(i)*4}px;">${r}</span>`),s=s.replace(/\n/g,"<br>"),s):"",F=s=>{if(!s)return[];const e=s.split(`
`),i=[];let r=null;const l=/^\[(.*?)\]\s+(\d{2}:\d{2}:\d{2})\s+-\s+([A-Z]+)\s+-\s+(.*)$/;return e.forEach((n,m)=>{const b=n.trimEnd();if(!b)return;const _=b.match(l);_?(r={id:m,site:_[1],time:_[2],level:_[3],message:_[4],details:"",isError:_[3]==="ERROR"||_[3]==="CRITICAL"},r.message.includes("Traceback")&&(r.isError=!0),i.push(r)):r?(r.details+=(r.details?`
`:"")+b,b.trim().startsWith('File "')&&(r.isError=!0)):i.push({id:m,site:"System",time:"",level:"INFO",message:b,details:"",isError:!1})}),i},ue=s=>{switch(s){case"SUCCESS":return"success";case"ERROR":return"danger";case"WARNING":return"warning";case"DEBUG":return"info";default:return"primary"}},G=X,oe=Ne,ce=Qs(),k=U(()=>ce.workingParams),N=U(()=>ce.sourceInfo?.name||""),Ae=()=>({title_components:[],original_main_title:"",subtitle:"",imdb_link:"",douban_link:"",intro:{statement:"",poster:"",body:"",screenshots:"",removed_ardtudeclarations:[]},mediainfo:"",source_params:{},standardized_params:{type:"",medium:"",video_codec:"",audio_codec:"",resolution:"",team:"",source:"",tags:[]},final_publish_parameters:{},complete_publish_params:{},raw_params_for_preview:{}}),C=s=>{if(!s||typeof s!="string")return[];const e=/\[img\](https?:\/\/[^\s[\]]+)\[\/img\]/gi;return[...s.matchAll(e)].map(r=>r[1])},y=I(0),q=I("main"),K=I(!1),H=I({current:0,total:0}),x=I({current:0,total:0}),fe=((s,e)=>{let i;return function(...l){const n=()=>{clearTimeout(i),s(...l)};clearTimeout(i),i=setTimeout(n,e)}})(()=>{const s=document.querySelector(".panel-content");if(s){const{scrollTop:e,scrollHeight:i,clientHeight:r}=s;K.value=e+r>=i-5}},100),Ke=()=>{const s=document.querySelector(".panel-content");s&&s.addEventListener("scroll",fe)},cs=()=>{const s=document.querySelector(".panel-content");s&&s.removeEventListener("scroll",fe)};ds(()=>{bs(),hs(),_e(()=>{y.value===1&&(Ke(),fe())})}),qe(y,(s,e)=>{e===1&&cs(),s===1&&_e(()=>{Ke(),fe()})});const Me=[{title:"核对种子详情"},{title:"发布参数预览"},{title:"选择发布站点"},{title:"完成发布"}],te=I([]),Y=I([]),O=I(!1),t=I(Ae()),J=I(null),ne=I([]),Re=I(!1),ge=I(!1),Le=I(!1),be=I(!1),he=I(!1),Pe=I(!1),ee=I(!0),ae=I(""),ye=I(!1),We=I([]),me=I(!1),Q=I(!1),se=I([]),we=I(!1),Ge=I(""),A=I({type:{},medium:{},video_codec:{},audio_codec:{},resolution:{},source:{},team:{},tags:{}}),ke=U(()=>C(t.value.intro.poster)),pe=U(()=>C(t.value.intro.screenshots)),Ye=U(()=>{const s=t.value.intro.removed_ardtudeclarations;return Array.isArray(s)?s:[]}),Je=U(()=>Ye.value.length),De=s=>{const e=te.value.find(i=>i.name===s);if(!e||!e.has_cookie||k.value?.sites?.[s])return!1;if(s.toLowerCase()==="ubits"){const i=t.value.standardized_params.team,r=t.value.title_components;if(i&&["cmct","cmctv"].includes(i.toLowerCase()))return!1;const l=r.find(n=>n.key==="制作组");if(l&&l.value){const n=l.value.toLowerCase(),m=["cmct","cmctv","telesto","shadow610"];for(const b of m)if(n.includes(b))return!1}}return!0},ms=s=>Y.value.includes(s.name)?"success":s.has_cookie?"default":"danger",ps=async()=>{Le.value=!0,p.info({title:"正在重新获取",message:"正在从豆瓣/IMDb重新获取简介...",duration:0});const s={type:"intro",source_info:{main_title:t.value.original_main_title,subtitle:t.value.subtitle,source_site:N.value,imdb_link:t.value.imdb_link,douban_link:t.value.douban_link}};try{const e=await D.post("/api/media/validate",s);p.closeAll(),e.data.success&&e.data.intro?(t.value.intro.body=B(e.data.intro),e.data.extracted_imdb_link&&!t.value.imdb_link&&(t.value.imdb_link=e.data.extracted_imdb_link),e.data.extracted_douban_link&&!t.value.douban_link&&(t.value.douban_link=e.data.extracted_douban_link),p.success({title:"重新获取成功",message:"已成功从豆瓣/IMDb获取并更新了简介内容。"})):p.error({title:"重新获取失败",message:e.data.error||"无法从豆瓣/IMDb获取简介。"})}catch(e){p.closeAll();const i=e.response?.data?.error||"未能重新获取简介";p.error({title:"操作失败",message:i})}finally{Le.value=!1}},vs=async()=>{if(!t.value.original_main_title){p.warning("标题为空，无法重新获取截图。");return}if(ge.value){p.info({title:"正在处理中",message:"截图重新生成请求已在处理中，请稍候..."});return}ge.value=!0,p.info({title:"正在重新获取",message:"正在从视频重新生成截图...",duration:0});const s={type:"screenshot",source_info:{main_title:t.value.original_main_title,source_site:N.value,imdb_link:t.value.imdb_link,douban_link:t.value.douban_link},savePath:k.value.save_path,torrentName:k.value.name,downloaderId:k.value.downloaderId};try{const e=await D.post("/api/media/validate",s);p.closeAll(),e.data.success&&e.data.screenshots?(t.value.intro.screenshots=e.data.screenshots,ee.value=!0,p.success({title:"重新获取成功",message:"已成功生成并加载了新的截图。"})):(ee.value=!1,p.error({title:"重新获取失败",message:e.data.error||"无法从后端获取新的截图，请查看后台日志。"}))}catch(e){p.closeAll();const i=e.response?.data?.error||"未能重新获取截图，请查看后台日志。";p.error({title:"操作失败",message:i}),ee.value=!1}finally{ge.value=!1}},_s=async()=>{if(be.value){p.info({title:"正在处理中",message:"媒体信息重新获取请求已在处理中，请稍候..."});return}be.value=!0,p.info({title:"正在重新获取",message:"正在从视频重新生成媒体信息...",duration:0});const s={type:"mediainfo",source_info:{main_title:t.value.original_main_title,source_site:N.value,imdb_link:t.value.imdb_link,douban_link:t.value.douban_link},current_mediainfo:t.value.mediainfo,savePath:k.value.save_path,torrentName:k.value.name,downloaderId:k.value.downloaderId};try{const e=await D.post("/api/media/validate",s);p.closeAll(),e.data.success&&e.data.mediainfo?(t.value.mediainfo=e.data.mediainfo,p.success({title:"重新获取成功",message:"已成功生成并加载了新的媒体信息。"})):p.error({title:"重新获取失败",message:e.data.error||"无法从后端获取新的媒体信息，请查看后台日志。"})}catch(e){p.closeAll();const i=e.response?.data?.error||"未能重新获取媒体信息，请查看后台日志。";p.error({title:"操作失败",message:i})}finally{be.value=!1}},fs=async()=>{if(!t.value.original_main_title){p.warning("标题为空，无法重新获取海报。");return}if(he.value){p.info({title:"正在处理中",message:"海报重新获取请求已在处理中，请稍候..."});return}he.value=!0,p.info({title:"正在重新获取",message:"正在重新生成海报...",duration:0});const s={type:"poster",source_info:{main_title:t.value.original_main_title,source_site:N.value,imdb_link:t.value.imdb_link,douban_link:t.value.douban_link},savePath:k.value.save_path,torrentName:k.value.name,downloaderId:k.value.downloaderId};try{const e=await D.post("/api/media/validate",s);p.closeAll(),e.data.success&&e.data.posters?(t.value.intro.poster=e.data.posters,p.success({title:"重新获取成功",message:"已成功生成并加载了新的海报。"})):p.error({title:"重新获取失败",message:e.data.error||"无法从后端获取新的海报，请查看后台日志。"})}catch(e){p.closeAll();const i=e.response?.data?.error||"未能重新获取海报，请查看后台日志。";p.error({title:"操作失败",message:i})}finally{he.value=!1}},gs=async()=>{if(!t.value.original_main_title){p.warning("标题为空，无法解析。");return}Re.value=!0;try{const s=await D.post("/api/utils/parse_title",{title:t.value.original_main_title});s.data.success?(t.value.title_components=s.data.components,p.success("标题已重新解析！")):p.error(s.data.message||"解析失败")}catch(s){Ue(s,"未能重新解析标题，请查看后台日志。")}finally{Re.value=!1}},Se=async(s,e,i)=>{if(s&&s.includes("pixhost.to")){console.log(`检测到 pixhost.to 图片，跳过有效性检测: ${s}`);return}if(e==="screenshot"&&Pe.value){console.log(`截图错误已正在处理中，跳过重复请求: ${s}`);return}console.error(`图片加载失败: 类型=${e}, URL=${s}, 索引=${i}`),e==="screenshot"?(Pe.value=!0,ee.value=!1,p.warning({title:"截图失效",message:"检测到截图链接失效，正在尝试从视频重新生成..."})):e==="poster"&&p.warning({title:"海报失效",message:"检测到海报链接失效，正在尝试重新获取..."});const r={type:e,source_info:{main_title:t.value.original_main_title,source_site:N.value,imdb_link:t.value.imdb_link,douban_link:t.value.douban_link},savePath:k.value.save_path,torrentName:k.value.name,downloaderId:k.value.downloaderId};try{const l=await D.post("/api/media/validate",r);l.data.success?e==="screenshot"&&l.data.screenshots?(t.value.intro.screenshots=l.data.screenshots,ee.value=!0,p.success({title:"截图已更新",message:"已成功生成并加载了新的截图。"})):e==="poster"&&l.data.posters&&(t.value.intro.poster=l.data.posters,p.success({title:"海报已更新",message:"已成功生成并加载了新的海报。"})):(e==="screenshot"&&(ee.value=!1),p.error({title:"更新失败",message:l.data.error||`无法从后端获取新的${e==="poster"?"海报":"截图"}。`}))}catch(l){const n=l.response?.data?.error||`发送失效${e==="poster"?"海报":"截图"}信息请求时发生错误，请查看后台日志。`;console.error("发送失效图片信息请求时发生错误:",l),p.error({title:"操作失败",message:n})}finally{e==="screenshot"&&(Pe.value=!1)}},xe=async s=>{const e=te.value.find(r=>r.name===s);if(e?.site)return e.site;try{const r=await D.get("/api/sites/status");te.value=r.data;const l=te.value.find(n=>n.name===s);if(l?.site)return l.site}catch(r){console.warn("获取站点状态失败:",r)}return{人人:"audiences",不可说:"ssd",憨憨:"hhanclub",财神:"cspt"}[s]||s.toLowerCase()},bs=async()=>{try{const s=await D.get("/api/sites/status");te.value=s.data;const e=await D.get("/api/downloaders_list");We.value=e.data}catch{p.error({title:"错误",message:"无法从服务器获取站点状态列表或下载器列表"})}},hs=async()=>{if(!N.value||!k.value)return;const s=k.value.sites[N.value];let e=s.torrentId||null;if(!e){const l=s.comment?.match(/id=(\d+)/);if(!l||!l[1]){p.error(`无法从源站点 ${N.value} 的链接中提取种子ID。`),oe("cancel");return}e=l[1]}O.value=!0;const i=`fetch_${e}_${Date.now()}`;Ge.value=i,we.value=!0;let r=null;try{const l=await xe(N.value);console.log(`尝试从数据库读取种子信息: ${e} from ${N.value} (${l})`);const n=await D.get("/api/migrate/get_db_seed_info",{params:{torrent_id:e,site_name:l,task_id:i},timeout:12e4});if(n.status===202&&n.data.should_fetch){console.log("数据库中没有缓存，继续使用同一日志流从源站点抓取...");const m=n.data.task_id||i;try{const b=await D.post("/api/migrate/fetch_and_store",{sourceSite:N.value,searchTerm:e,savePath:k.value.save_path,torrentName:k.value.name,downloaderId:k.value.downloaderId,task_id:m},{timeout:12e4});if(!b.data.success){p.closeAll();const S=b.data.message||"从源站点抓取失败";se.value=F(S),Q.value=!0,O.value=!1;return}const _=await D.get("/api/migrate/get_db_seed_info",{params:{torrent_id:e,site_name:l},timeout:12e4});if(!_.data.success){p.closeAll();const S="数据抓取成功但从数据库读取失败";se.value=F(S),Q.value=!0,O.value=!1;return}p.closeAll(),p.success({title:"抓取成功",message:"种子信息已成功抓取并存储到数据库，请核对。"});const f=_.data.data;_.data.reverse_mappings&&(A.value=_.data.reverse_mappings),t.value={original_main_title:f.title||"",title_components:f.title_components||[],subtitle:f.subtitle,imdb_link:f.imdb_link,douban_link:f.douban_link,intro:{statement:B(f.statement)||"",poster:f.poster||"",body:B(f.body)||"",screenshots:f.screenshots||"",removed_ardtudeclarations:f.removed_ardtudeclarations||[]},mediainfo:f.mediainfo||"",source_params:f.source_params||{},standardized_params:{type:f.type||"",medium:f.medium||"",video_codec:f.video_codec||"",audio_codec:f.audio_codec||"",resolution:f.resolution||"",team:f.team||"",source:f.source||"",tags:(f.tags||[]).sort((S,j)=>{const P=["禁转","tag.禁转","限转","tag.限转"],le=P.includes(S),$e=P.includes(j);return le===$e?0:le?-1:1})},final_publish_parameters:f.final_publish_parameters||{},complete_publish_params:f.complete_publish_params||{},raw_params_for_preview:f.raw_params_for_preview||{}},J.value=b.data.task_id,me.value=!0,y.value=0,_e(()=>{je()}),O.value=!1;return}catch(b){p.closeAll(),Ue(b,"从源站点抓取时发生错误，请查看后台日志。"),O.value=!1;return}}else if(n.data.success){p.closeAll(),p.success({title:"读取成功",message:"种子信息已从数据库成功加载，请核对。"});const m=n.data.data;if(!m||!m.title)throw new Error("数据库返回的种子信息不完整");if(n.data.reverse_mappings?(A.value=n.data.reverse_mappings,console.log("成功加载反向映射表:",A.value),console.log("type映射数量:",Object.keys(A.value.type||{}).length),console.log("当前standardized_params:",m.standardized_params)):console.warn("后端未返回反向映射表，将使用空的默认映射"),t.value={original_main_title:m.title||"",title_components:m.title_components||[],subtitle:m.subtitle,imdb_link:m.imdb_link,douban_link:m.douban_link,intro:{statement:B(m.statement)||"",poster:m.poster||"",body:B(m.body)||"",screenshots:m.screenshots||"",removed_ardtudeclarations:m.removed_ardtudeclarations||[]},mediainfo:m.mediainfo||"",source_params:m.source_params||{},standardized_params:{type:m.type||"",medium:m.medium||"",video_codec:m.video_codec||"",audio_codec:m.audio_codec||"",resolution:m.resolution||"",team:m.team||"",source:m.source||"",tags:(m.tags||[]).sort((b,_)=>{const f=["禁转","tag.禁转","限转","tag.限转"],S=f.includes(b),j=f.includes(_);return S===j?0:S?-1:1})},final_publish_parameters:m.final_publish_parameters||{},complete_publish_params:m.complete_publish_params||{},raw_params_for_preview:m.raw_params_for_preview||{}},(!m.title_components||m.title_components.length===0)&&m.title)try{const b=await D.post("/api/utils/parse_title",{title:m.title});b.data.success&&(t.value.title_components=b.data.components,p.info({title:"标题解析",message:"已自动解析主标题为组件信息。"}))}catch(b){console.warn("自动解析标题失败:",b)}if(console.log("设置torrentData.standardized_params:",t.value.standardized_params),console.log("检查绑定 - type:",t.value.standardized_params.type),console.log("检查绑定 - medium:",t.value.standardized_params.medium),n.data.task_id?(J.value=n.data.task_id,p.success({title:"缓存准备完成",message:"发布任务已准备就绪"})):(J.value=`db_${e}_${l}`,console.warn("后端未返回taskId，使用标识符")),me.value=!0,(!t.value.imdb_link||!t.value.douban_link)&&t.value.intro.body){let b=!1,_=!1;if(!t.value.imdb_link){const f=/(https?:\/\/www\.imdb\.com\/title\/tt\d+)/,S=t.value.intro.body.match(f);S&&S[1]&&(t.value.imdb_link=S[1],b=!0)}if(!t.value.douban_link){const f=/(https:\/\/movie\.douban\.com\/subject\/\d+)/,S=t.value.intro.body.match(f);S&&S[1]&&(t.value.douban_link=S[1],_=!0)}if(b||_){const f=[];b&&f.push("IMDb链接"),_&&f.push("豆瓣链接"),p.info({title:"自动填充",message:`已从简介正文中自动提取并填充 ${f.join(" 和 ")}。`})}}y.value=0,_e(()=>{je()}),me.value=!0,O.value=!1;return}else console.log("数据库中没有找到种子信息，开始抓取数据...")}catch(l){r=l,console.log("从数据库读取失败，开始抓取数据...",l),l.code==="ECONNABORTED"||l.message.includes("timeout")?console.warn("数据库读取超时，将尝试直接抓取数据..."):l.response?.status>=500?console.warn("数据库服务器错误，将尝试直接抓取数据..."):console.warn("数据库读取发生未知错误，将尝试直接抓取数据...")}try{p.closeAll(),p({title:"正在抓取",message:"正在从源站点抓取种子信息并存储到数据库...",type:"info",duration:0}),r&&(console.warn(`由于数据库读取失败（${r.message}），正在直接抓取数据...`),p.warning({title:"数据库读取失败",message:"正在尝试直接抓取数据，请稍候...",duration:3e3}));const l=await D.post("/api/migrate/fetch_and_store",{sourceSite:N.value,searchTerm:e,savePath:k.value.save_path,torrentName:k.value.name,downloaderId:k.value.downloaderId||(k.value.downloaderIds?.length>0?k.value.downloaderIds[0]:null)},{timeout:12e4});if(l.data.success){console.log("数据抓取成功，立即从数据库读取...");let n=0;const m=3;let b=null;for(;n<m;){n++;try{const _=await xe(N.value);if(console.log(`重试从数据库读取种子信息: ${e} from ${N.value} (${_})`),b=await D.get("/api/migrate/get_db_seed_info",{params:{torrent_id:e,site_name:_},timeout:12e4}),b.data.success)break;console.warn(`数据库读取第${n}次失败：${b.data.message}`),n<m&&await new Promise(f=>setTimeout(f,1e3))}catch(_){if(console.warn(`数据库读取第${n}次失败：`,_),n<m)await new Promise(f=>setTimeout(f,1e3));else throw _}}if(b&&b.data.success){p.closeAll();const _=b.data.data;if(!_||!_.title)throw new Error("数据库返回的种子信息不完整");if(b.data.reverse_mappings?(A.value=b.data.reverse_mappings,console.log("成功加载反向映射表:",A.value)):console.warn("后端未返回反向映射表，将使用空的默认映射"),p.success({title:"抓取成功",message:r?"种子信息已成功抓取，请核对。由于数据库读取失败，数据未持久化存储。":"种子信息已成功抓取并存储到数据库，请核对。"}),t.value={original_main_title:_.title||"",title_components:_.title_components||[],subtitle:_.subtitle,imdb_link:_.imdb_link,douban_link:_.douban_link,intro:{statement:B(_.statement)||"",poster:_.poster||"",body:B(_.body)||"",screenshots:_.screenshots||"",removed_ardtudeclarations:_.removed_ardtudeclarations||[]},mediainfo:_.mediainfo||"",source_params:_.source_params||{},standardized_params:{type:_.type||"",medium:_.medium||"",video_codec:_.video_codec||"",audio_codec:_.audio_codec||"",resolution:_.resolution||"",team:_.team||"",source:_.source||"",tags:(_.tags||[]).sort((f,S)=>{const j=["禁转","tag.禁转","限转","tag.限转"],P=j.includes(f),le=j.includes(S);return P===le?0:P?-1:1})},final_publish_parameters:_.final_publish_parameters||{},complete_publish_params:_.complete_publish_params||{},raw_params_for_preview:_.raw_params_for_preview||{}},(!_.title_components||_.title_components.length===0)&&_.title)try{const f=await D.post("/api/utils/parse_title",{title:_.title});f.data.success&&(t.value.title_components=f.data.components,p.info({title:"标题解析",message:"已自动解析主标题为组件信息。"}))}catch(f){console.warn("自动解析标题失败:",f)}if(J.value=l.data.task_id,me.value=!0,(!t.value.imdb_link||!t.value.douban_link)&&t.value.intro.body){let f=!1,S=!1;if(!t.value.imdb_link){const j=/(https?:\/\/www\.imdb\.com\/title\/tt\d+)/,P=t.value.intro.body.match(j);P&&P[1]&&(t.value.imdb_link=P[1],f=!0)}if(!t.value.douban_link){const j=/(https:\/\/movie\.douban\.com\/subject\/\d+)/,P=t.value.intro.body.match(j);P&&P[1]&&(t.value.douban_link=P[1],S=!0)}if(f||S){const j=[];f&&j.push("IMDb链接"),S&&j.push("豆瓣链接"),p.info({title:"自动填充",message:`已从简介正文中自动提取并填充 ${j.join(" 和 ")}。`})}}y.value=0,_e(()=>{je()})}else{p.closeAll();const _=`数据抓取成功但数据库读取失败，已重试${m}次。请检查数据库连接或稍后重试。`;se.value=F(_),Q.value=!0,O.value=!1}}else{p.closeAll();const n=l.data.message||"抓取种子信息失败";let m=n;(n.includes("数据库")||r)&&(m=`${n}。可能由于数据库连接问题导致，请检查数据库状态。`),se.value=F(m),Q.value=!0,O.value=!1}}catch(l){if(p.closeAll(),l.code==="ECONNABORTED"||l.message.includes("timeout")){const n="抓取种子信息超时，请检查网络连接或稍后重试。";se.value=F(n),Q.value=!0}else if(l.response?.status===404){const n="在源站点未找到指定的种子，请检查种子ID是否正确。";se.value=F(n),Q.value=!0}else if(l.response?.status>=500){const n="后端服务器发生错误，请稍后重试或联系管理员。";se.value=F(n),Q.value=!0}else{const n=l.message||"获取种子信息时发生错误，请查看后台日志。";se.value=F(n),Q.value=!0}}finally{O.value=!1}},Z=U(()=>{const s=t.value.standardized_params,e=["type","medium","video_codec","audio_codec","resolution","team","source"],i=[],r=new RegExp(/^[\p{L}\p{N}_-]+\.[\p{L}\p{N}_-]+$/u);for(const l of e){const n=s[l];n&&typeof n=="string"&&n.trim()!==""&&!r.test(n)&&i.push(l)}return Ie.value.length>0&&i.push("tags"),i}),ys=async()=>{if(console.log("=== 从store获取的已存在站点信息 ==="),console.log("torrent.value:",k.value),console.log("torrent.value.sites:",k.value?.sites),k.value?.sites){const e=Object.keys(k.value.sites);console.log("已存在的站点列表:",e),console.log("已存在站点详细信息:",k.value.sites)}else console.log("未找到已存在站点信息");console.log("=====================================");const s=Z.value;if(s.length>0){const e={type:"类型",medium:"媒介",video_codec:"视频编码",audio_codec:"音频编码",resolution:"分辨率",team:"制作组",source:"产地",tags:"标签"},i=s.map(r=>e[r]||r);p({title:"参数格式不正确",message:`以下参数格式不正确，请修改为 *.* 的标准格式: ${i.join(", ")}`,type:"warning",duration:0,showClose:!0});return}O.value=!0;try{p({title:"正在处理",message:"正在更新参数并生成预览...",type:"info",duration:0});let e,i;if(me.value&&J.value&&J.value.startsWith("db_")){const n=J.value.split("_");n.length>=3&&(e=n[1],i=n.slice(2).join("_"))}else if(J.value&&J.value.startsWith("db_")){const n=J.value.split("_");n.length>=3&&(e=n[1],i=n.slice(2).join("_"))}else{const n=k.value.sites[N.value];if(e=n.torrentId||null,i=await xe(N.value),!e){const m=n.comment?.match(/id=(\d+)/);m&&m[1]&&(e=m[1])}}if(!e||!i){p.error({title:"参数错误",message:"无法获取种子ID或站点名称",duration:0,showClose:!0});return}console.log(`更新种子参数: ${e} from ${i}`);const r={title:t.value.original_main_title,subtitle:t.value.subtitle,imdb_link:t.value.imdb_link,douban_link:t.value.douban_link,poster:t.value.intro.poster,screenshots:t.value.intro.screenshots,statement:B(t.value.intro.statement),body:B(t.value.intro.body),mediainfo:t.value.mediainfo,source_params:t.value.source_params,title_components:t.value.title_components,standardized_params:t.value.standardized_params};console.log("发送到后端的标准参数:",t.value.standardized_params);const l=await D.post("/api/migrate/update_db_seed_info",{torrent_id:e,site_name:i,updated_parameters:r});if(console.log("已调用更新接口，is_reviewed 将被设置为 true"),p.closeAll(),l.data.success){p.closeAll();const{standardized_params:n,final_publish_parameters:m,complete_publish_params:b,raw_params_for_preview:_,reverse_mappings:f}=l.data;f&&(A.value=f,console.log("成功更新反向映射表:",A.value)),t.value={...t.value,standardized_params:n||{},final_publish_parameters:m||{},complete_publish_params:b||{},raw_params_for_preview:_||{}},p.success({title:"更新成功",message:"参数已更新并重新标准化，请核对预览内容。"}),y.value=1}else p.error({title:"更新失败",message:l.data.message||"更新参数失败",duration:0,showClose:!0})}catch(e){p.closeAll(),Ue(e,"更新预览数据时发生错误，请查看后台日志。")}finally{O.value=!1}},ws=U(()=>{const s=Object.keys(A.value.tags||{}),e=t.value.standardized_params.tags||[];return[...new Set([...s,...e])].filter(l=>!Ce(l)).map(l=>({value:l,label:A.value.tags[l]||l}))}),ks=s=>s==="禁转"||s==="tag.禁转"||s==="限转"||s==="tag.限转"?"danger":(console.log(`[getTagType] 检查标签: "${s}", 是否无效: ${Ie.value.includes(s)}`),Ie.value.includes(s)?"danger":"info"),Ss=async()=>{const s=k.value?.sites?Object.keys(k.value.sites).length:0;if(s<2){console.log(`已存在站点数量不足(${s}个)，正在重新获取种子数据...`);try{p.info({title:"正在更新数据",message:"正在重新获取种子站点信息...",duration:0});const e=new URLSearchParams({page:"1",pageSize:"1",nameSearch:k.value.name}),r=(await D.get(`/api/data?${e.toString()}`)).data;if(r.error)throw new Error(r.error);if(r.data&&r.data.length>0){const l=r.data[0];console.log("重新获取到的种子数据:",l),console.log("重新获取到的站点信息:",l.sites),console.log(`站点数量从 ${s} 更新到 ${Object.keys(l.sites).length}`),ce.setParams(l),p.success({title:"数据更新成功",message:`已重新获取种子站点信息，发现 ${Object.keys(l.sites).length} 个站点`})}else p.warning({title:"未找到种子",message:"未能找到匹配的种子数据"})}catch(e){console.error("重新获取种子数据时出错:",e),p.error({title:"数据更新失败",message:e.message||"重新获取种子数据时发生错误"})}}else console.log(`已存在站点数量充足(${s}个)，跳过重新获取`);y.value=2},Is=s=>{const e=Y.value.indexOf(s);e>-1?Y.value.splice(e,1):Y.value.push(s)},Cs=()=>{const s=te.value.filter(e=>e.is_target&&De(e.name)).map(e=>e.name);Y.value=s},$s=()=>{Y.value=[]},zs=async()=>{y.value=3,O.value=!0,ne.value=[],H.value={current:0,total:Y.value.length},x.value={current:0,total:0},p({title:"正在发布",message:`准备向 ${Y.value.length} 个站点发布种子...`,type:"info",duration:0});const s=[];for(const l of Y.value){try{const n=await D.post("/api/migrate/publish",{task_id:J.value,upload_data:{...t.value,save_path:k.value.save_path},targetSite:l,sourceSite:N.value,downloaderId:k.value.downloaderId,auto_add_to_downloader:!0}),m={siteName:l,message:Es(n.data.logs||"发布成功"),...n.data};if(n.data.logs&&n.data.logs.includes("种子已存在")&&(m.isExisted=!0),m.auto_add_result){let b="自动检测";if(m.auto_add_result.downloader_id){const _=We.value.find(f=>f.id===m.auto_add_result.downloader_id);_&&(b=_.name)}m.downloaderStatus={success:m.auto_add_result.success,message:m.auto_add_result.message,downloaderName:b},m.auto_add_result.success&&x.value.current++}s.push(m),ne.value=[...s],m.success&&p.success({title:`发布成功 - ${l}`,message:"种子已成功发布到该站点"})}catch(n){const m={siteName:l,success:!1,logs:n.response?.data?.logs||n.message,url:null,message:`发布到 ${l} 时发生错误，请查看日志。`,downloaderStatus:{success:!1,message:"发布失败，无法添加到下载器",downloaderName:"错误"}};s.push(m),ne.value=[...s],p.error({title:`发布失败 - ${l}`,message:m.message})}H.value.current++,await new Promise(n=>setTimeout(n,1e3))}p.closeAll();const e=s.filter(l=>l.success).length;p.success({title:"发布完成",message:`成功发布到 ${e} / ${Y.value.length} 个站点。`}),ae.value+=`

--- [自动添加任务结果] ---`;const i={};s.forEach(l=>{if(l.auto_add_result){const n=l.downloaderStatus?.downloaderName||"自动检测";i[l.siteName]={success:l.auto_add_result.success,message:l.auto_add_result.message,downloaderName:n};const m=l.auto_add_result.success?"✅":"❌",b=l.auto_add_result.success?"成功":"失败";ae.value+=`
[${l.siteName}] ${m} ${b}: ${l.auto_add_result.message}`}else l.success&&l.url&&(ae.value+=`
[${l.siteName}] ⚠️  未执行自动添加`)}),ae.value+=`
--- [自动添加任务结束] ---`;const r=s.map(l=>{let n=`--- Log for ${l.siteName} ---
${l.logs||"No logs available."}`;if(i[l.siteName]){const m=i[l.siteName];n+=`

--- Downloader Status for ${l.siteName} ---`,m.success?n+=`
✅ 成功: ${m.message}`:n+=`
❌ 失败: ${m.message}`}return n});ae.value=r.join(`

`),ne.value=s.map(l=>({...l,downloaderStatus:i[l.siteName]}));try{await D.post("/api/refresh_data"),p.success({title:"数据刷新",message:"种子数据已刷新"})}catch(l){console.warn("刷新种子数据失败:",l)}O.value=!1},Vs=()=>{y.value>0&&y.value--},Qe=()=>{y.value===3?oe("close-with-refresh"):oe("cancel")},Ze=()=>{oe("complete")},Es=s=>s==="发布成功"?"发布成功":s.includes("种子已存在")?"种子已存在，发布成功":s.split(`
`).filter(r=>r&&!r.includes("--- [步骤")&&!r.includes("INFO - ---")).map(r=>r.replace(/^\d{2}:\d{2}:\d{2} - \w+ - /,"")).filter(Boolean).pop()||"发布成功",Ue=(s,e)=>{const i=s.response?.data?.logs||s.message||e;p.error({title:"操作失败",message:i,duration:0,showClose:!0})},W=s=>{const e=t.value.standardized_params;if(!e||!A.value)return"N/A";const i=e[s];if(!i)return"N/A";const r=A.value[s];return r&&r[i]||i},Be=()=>!ie.value||!A.value.tags?[]:ie.value.map(s=>A.value.tags[s]||s),Xe=U(()=>t.value.title_components.filter(s=>s.key!=="无法识别")),ie=U(()=>t.value.standardized_params.tags?.filter(e=>e&&typeof e=="string"&&e.trim()!=="")||[]),Ie=U(()=>{const s=new RegExp(/^[\p{L}\p{N}_-]+\.[\p{L}\p{N}_-]+$/u);return ie.value.filter(e=>!s.test(e))}),Ts=U(()=>["主标题","季集","年份","剧集状态","发布版本","分辨率","片源平台","媒介","视频编码","视频格式","HDR格式","色深","帧率","音频编码","制作组"].map(e=>({key:e,value:""}))),Ce=s=>s==="禁转"||s==="tag.禁转"||s==="限转"||s==="tag.限转",es=U(()=>(t.value.standardized_params.tags||[]).some(e=>Ce(e))),Ns=s=>{if(Ce(s)){p.warning({title:"无法删除",message:"禁转/限转标签不允许删除",duration:2e3});return}const e=t.value.standardized_params.tags.indexOf(s);e>-1&&t.value.standardized_params.tags.splice(e,1)},Oe=U({get(){const s=t.value.title_components.find(e=>e.key==="无法识别");return s?s.value:""},set(s){const e=t.value.title_components.findIndex(i=>i.key==="无法识别");s===""||s===null?e!==-1&&t.value.title_components.splice(e,1):e!==-1?t.value.title_components[e].value=s:t.value.title_components.push({key:"无法识别",value:s})}}),As=U(()=>{const s=t.value.standardized_params.team,e=t.value.title_components;if(s&&["cmct","cmctv"].includes(s.toLowerCase()))return!0;const i=e.find(r=>r.key==="制作组");if(i&&i.value){const r=i.value.toLowerCase(),l=["cmct","cmctv","telesto","shadow610"];for(const n of l)if(r.includes(n))return!0}return!1}),ss=U(()=>{const s=t.value.title_components.find(ve=>ve.key==="无法识别"),e=s&&s.value!=="";if(es.value)return!0;const i=t.value.intro,r=!i.poster||i.poster.trim()==="",l=!i.screenshots||i.screenshots.trim()==="",n=!i.body||i.body.trim()==="";if(r||l||n)return!0;const m=t.value.standardized_params,b=!m.type||m.type.trim()==="",_=!m.medium||m.medium.trim()==="",f=!m.video_codec||m.video_codec.trim()==="",S=!m.audio_codec||m.audio_codec.trim()==="",j=!m.resolution||m.resolution.trim()==="";if(b||_||f||S||j)return!0;const P=t.value.mediainfo||"";if(!P||P.trim()==="")return!0;{const ve=ts(P),Ve=as(P);if(!ve&&!Ve)return!0}if(Z.value.length>0)return!0;const ze=!ee.value;return!!(e||ze)}),Ms=U(()=>{if(es.value)return"检测到禁转/限转标签，不允许继续发布";const s=t.value.title_components.find(n=>n.key==="无法识别");if(s&&s.value!=="")return"存在无法识别的标题内容，请手动修正或删除";const e=t.value.standardized_params,i=t.value.intro,r=[];if((!i.poster||i.poster.trim()==="")&&r.push("海报"),(!i.screenshots||i.screenshots.trim()==="")&&r.push("截图"),(!i.body||i.body.trim()==="")&&r.push("简介正文"),(!t.value.mediainfo||t.value.mediainfo.trim()==="")&&r.push("Mediainfo"),(!e.type||e.type.trim()==="")&&r.push("类型"),(!e.medium||e.medium.trim()==="")&&r.push("媒介"),(!e.video_codec||e.video_codec.trim()==="")&&r.push("视频编码"),(!e.audio_codec||e.audio_codec.trim()==="")&&r.push("音频编码"),(!e.resolution||e.resolution.trim()==="")&&r.push("分辨率"),r.length>0)return`请补充必填项：${r.join("、")}`;if(Z.value.length>0){const n={type:"类型",medium:"媒介",video_codec:"视频编码",audio_codec:"音频编码",resolution:"分辨率",team:"制作组",source:"产地",tags:"标签"};return`参数格式不正确 (${Z.value.map(b=>n[b]||b).join("、")})`}const l=t.value.mediainfo||"";return!ts(l)&&!as(l)?"MediaInfo 或 BDInfo 格式无效":ee.value?"准备就绪":"截图链接失效，请等待重新获取或手动修复"}),ts=s=>["General","Video","Audio","Complete name","File size","Duration","Width","Height"].filter(r=>s.includes(r)).length>=3,as=s=>{const e=["DISC INFO","PLAYLIST REPORT"],i=["VIDEO:","AUDIO:","SUBTITLES:","FILES:","Disc Label","Disc Size","BDInfo:","Protection:","Codec","Bitrate","Language","Description"],r=e.filter(n=>s.includes(n)).length,l=i.filter(n=>s.includes(n)).length;return r===e.length||r>=1&&l>=2},je=async()=>{const s=pe.value;if(s.length===0){ee.value=!0;return}let e=!0;for(const i of s)try{await new Promise((r,l)=>{const n=new Image;n.onload=()=>{r(!0)},n.onerror=()=>{l(new Error("Image load failed"))},n.src=i})}catch{e=!1;break}ee.value=e},ls=()=>{ye.value=!1},Rs=(s,e)=>{let i=`--- Log for ${s} ---
${e||"No logs available."}`;const r=ne.value.find(l=>l.siteName===s);if(r&&r.downloaderStatus){const l=r.downloaderStatus;i+=`

--- Downloader Status for ${s} ---`,l.success?i+=`
✅ 成功: ${l.message}`:i+=`
❌ 失败: ${l.message}`}ae.value=i,ye.value=!0},Ls=U(()=>{const s=ne.value,e=[];for(let i=0;i<s.length;i+=5)e.push(s.slice(i,i+5));return e}),Ps=s=>s.some(e=>e.success&&e.url),Ds=s=>s.filter(e=>e.success&&e.url).length,xs=s=>{const e=s.filter(i=>i.success&&i.url);if(e.length===0){p.warning({title:"无法打开",message:"该行没有可用的种子链接"});return}e.forEach(i=>{const r=os(i.url);window.open(r,"_blank","noopener,noreferrer")}),p.success({title:"批量打开成功",message:`已打开 ${e.length} 个种子页面`})},Us=()=>{console.log("日志进度处理完成"),setTimeout(()=>{we.value=!1},1e3)},os=s=>{if(!s)return s;try{const e=new URL(s);return e.searchParams.delete("uploaded"),e.toString()}catch(e){return console.warn("Invalid URL format:",s,e),s}};return(s,e)=>{const i=R("el-icon"),r=R("el-button"),l=R("el-input"),n=R("el-form-item"),m=R("el-option"),b=R("el-select"),_=R("el-tag"),f=R("el-form"),S=R("el-tab-pane"),j=R("el-carousel-item"),P=R("el-carousel"),le=R("el-empty"),$e=R("el-tabs"),ze=R("el-alert"),ve=R("el-button-group"),Ve=R("el-progress"),Bs=R("el-card"),Os=R("el-scrollbar"),js=R("el-dialog");return c(),v(T,null,[a("div",rt,[a("header",dt,[a("div",ut,[(c(),v(T,null,M(Me,(o,g)=>a("div",{key:g,class:V(["custom-step",{active:g===y.value,completed:g<y.value,last:g===Me.length-1}])},[a("div",ct,[g<y.value?(c(),E(i,{key:0},{default:u(()=>[d(L(Fe))]),_:1})):(c(),v("span",mt,h(g+1),1))]),a("div",pt,h(o.title),1),g<Me.length-1?(c(),v("div",vt)):w("",!0)],2)),64))])]),a("main",_t,[y.value===0?(c(),v("div",ft,[d($e,{modelValue:q.value,"onUpdate:modelValue":e[18]||(e[18]=o=>q.value=o),type:"border-card",class:"details-tabs"},{default:u(()=>[d(S,{label:"主要信息",name:"main"},{default:u(()=>[a("div",gt,[a("div",bt,[d(f,{"label-position":"top",class:"fill-height-form"},{default:u(()=>[a("div",ht,[d(n,{label:"原始/待解析标题"},{default:u(()=>[d(l,{modelValue:t.value.original_main_title,"onUpdate:modelValue":e[0]||(e[0]=o=>t.value.original_main_title=o)},{append:u(()=>[d(r,{icon:L(re),onClick:gs,loading:Re.value},{default:u(()=>[...e[22]||(e[22]=[z(" 重新解析 ",-1)])]),_:1},8,["icon","loading"])]),_:1},8,["modelValue"])]),_:1}),a("div",yt,[Xe.value.length>0?(c(!0),v(T,{key:0},M(Xe.value,o=>(c(),E(n,{key:o.key,label:o.key},{default:u(()=>[d(l,{modelValue:o.value,"onUpdate:modelValue":g=>o.value=g},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128)):(c(!0),v(T,{key:1},M(Ts.value,(o,g)=>(c(),E(n,{key:"init-"+g,label:o.key},{default:u(()=>[d(l,{modelValue:o.value,"onUpdate:modelValue":$=>o.value=$},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))])]),a("div",wt,[a("div",kt,[a("div",St,[d(n,{label:"副标题"},{default:u(()=>[d(l,{modelValue:t.value.subtitle,"onUpdate:modelValue":e[1]||(e[1]=o=>t.value.subtitle=o)},null,8,["modelValue"])]),_:1})]),a("div",{class:V({"unrecognized-section":Oe.value}),style:{"grid-column":"span 1"}},[d(n,{label:"无法识别"},{default:u(()=>[d(l,{modelValue:Oe.value,"onUpdate:modelValue":e[2]||(e[2]=o=>Oe.value=o)},null,8,["modelValue"])]),_:1})],2)]),a("div",It,[a("div",Ct,[d(n,{label:"类型 (type)"},{default:u(()=>[d(b,{modelValue:t.value.standardized_params.type,"onUpdate:modelValue":e[3]||(e[3]=o=>t.value.standardized_params.type=o),placeholder:"请选择类型",clearable:"",class:V({"is-invalid":Z.value.includes("type"),"is-empty":!t.value.standardized_params.type}),"data-tag-style":""},{default:u(()=>[(c(!0),v(T,null,M(A.value.type,(o,g)=>(c(),E(m,{key:g,label:o,value:g},null,8,["label","value"]))),128))]),_:1},8,["modelValue","class"])]),_:1}),d(n,{label:"媒介 (medium)"},{default:u(()=>[d(b,{modelValue:t.value.standardized_params.medium,"onUpdate:modelValue":e[4]||(e[4]=o=>t.value.standardized_params.medium=o),placeholder:"请选择媒介",clearable:"",class:V({"is-invalid":Z.value.includes("medium"),"is-empty":!t.value.standardized_params.medium}),"data-tag-style":""},{default:u(()=>[(c(!0),v(T,null,M(A.value.medium,(o,g)=>(c(),E(m,{key:g,label:o,value:g},null,8,["label","value"]))),128))]),_:1},8,["modelValue","class"])]),_:1}),d(n,{label:"视频编码 (video_codec)"},{default:u(()=>[d(b,{modelValue:t.value.standardized_params.video_codec,"onUpdate:modelValue":e[5]||(e[5]=o=>t.value.standardized_params.video_codec=o),placeholder:"请选择视频编码",clearable:"",class:V({"is-invalid":Z.value.includes("video_codec"),"is-empty":!t.value.standardized_params.video_codec}),"data-tag-style":""},{default:u(()=>[(c(!0),v(T,null,M(A.value.video_codec,(o,g)=>(c(),E(m,{key:g,label:o,value:g},null,8,["label","value"]))),128))]),_:1},8,["modelValue","class"])]),_:1}),d(n,{label:"音频编码 (audio_codec)"},{default:u(()=>[d(b,{modelValue:t.value.standardized_params.audio_codec,"onUpdate:modelValue":e[6]||(e[6]=o=>t.value.standardized_params.audio_codec=o),placeholder:"请选择音频编码",clearable:"",class:V({"is-invalid":Z.value.includes("audio_codec"),"is-empty":!t.value.standardized_params.audio_codec}),"data-tag-style":""},{default:u(()=>[(c(!0),v(T,null,M(A.value.audio_codec,(o,g)=>(c(),E(m,{key:g,label:o,value:g},null,8,["label","value"]))),128))]),_:1},8,["modelValue","class"])]),_:1}),d(n,{label:"分辨率 (resolution)"},{default:u(()=>[d(b,{modelValue:t.value.standardized_params.resolution,"onUpdate:modelValue":e[7]||(e[7]=o=>t.value.standardized_params.resolution=o),placeholder:"请选择分辨率",clearable:"",class:V({"is-invalid":Z.value.includes("resolution"),"is-empty":!t.value.standardized_params.resolution}),"data-tag-style":""},{default:u(()=>[(c(!0),v(T,null,M(A.value.resolution,(o,g)=>(c(),E(m,{key:g,label:o,value:g},null,8,["label","value"]))),128))]),_:1},8,["modelValue","class"])]),_:1})]),a("div",$t,[d(n,{label:"制作组 (team)"},{default:u(()=>[d(b,{modelValue:t.value.standardized_params.team,"onUpdate:modelValue":e[8]||(e[8]=o=>t.value.standardized_params.team=o),placeholder:"请选择制作组",clearable:"",filterable:"","allow-create":"","default-first-option":"",class:V(["team-select",{"is-invalid":Z.value.includes("team")}])},{default:u(()=>[(c(!0),v(T,null,M(A.value.team,(o,g)=>(c(),E(m,{key:g,label:o,value:g},null,8,["label","value"]))),128))]),_:1},8,["modelValue","class"])]),_:1}),d(n,{label:"产地 (source)"},{default:u(()=>[d(b,{modelValue:t.value.standardized_params.source,"onUpdate:modelValue":e[9]||(e[9]=o=>t.value.standardized_params.source=o),placeholder:"请选择产地",clearable:"",class:V({"is-invalid":Z.value.includes("source")}),"data-tag-style":""},{default:u(()=>[(c(!0),v(T,null,M(A.value.source,(o,g)=>(c(),E(m,{key:g,label:o,value:g},null,8,["label","value"]))),128))]),_:1},8,["modelValue","class"])]),_:1}),d(n,{label:"标签 (tags)",class:"tags-wide-item"},{default:u(()=>[d(b,{modelValue:t.value.standardized_params.tags,"onUpdate:modelValue":e[10]||(e[10]=o=>t.value.standardized_params.tags=o),multiple:"",filterable:"","allow-create":"","default-first-option":"",placeholder:"请选择或输入标签",style:{width:"100%"}},{tag:u(({data:o})=>[(c(!0),v(T,null,M(o,g=>(c(),E(_,{key:g.value,type:ks(g.value),closable:!Ce(g.value),"disable-transitions":"",onClose:$=>Ns(g.value),style:{margin:"2px"}},{default:u(()=>[a("span",null,h(A.value.tags[g.value]||g.currentLabel),1)]),_:2},1032,["type","closable","onClose"]))),128))]),default:u(()=>[(c(!0),v(T,null,M(ws.value,o=>(c(),E(m,{key:o.value,label:o.label,value:o.value},{default:u(()=>[a("span",{style:Gs({color:Ie.value.includes(o.value)?"#F56C6C":""})},h(o.label),5)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e[23]||(e[23]=a("div",{class:"placeholder-item"},null,-1)),e[24]||(e[24]=a("div",{class:"placeholder-item"},null,-1))])])])]),_:1})])])]),_:1}),d(S,{label:"海报与声明",name:"poster-statement"},{default:u(()=>[a("div",zt,[d(f,{"label-position":"top",class:"fill-height-form"},{default:u(()=>[a("div",Vt,[a("div",Et,[d(n,{label:"声明",class:"statement-item"},{default:u(()=>[d(l,{type:"textarea",modelValue:t.value.intro.statement,"onUpdate:modelValue":e[11]||(e[11]=o=>t.value.intro.statement=o),rows:18},null,8,["modelValue"])]),_:1}),d(n,null,{label:u(()=>[a("div",Tt,[e[26]||(e[26]=a("span",null,"海报链接",-1)),d(r,{icon:L(re),onClick:fs,loading:he.value,size:"small",type:"text"},{default:u(()=>[...e[25]||(e[25]=[z(" 重新获取 ",-1)])]),_:1},8,["icon","loading"])])]),default:u(()=>[d(l,{type:"textarea",modelValue:t.value.intro.poster,"onUpdate:modelValue":e[12]||(e[12]=o=>t.value.intro.poster=o),rows:2},null,8,["modelValue"])]),_:1})]),a("div",Nt,[a("div",At,[e[27]||(e[27]=a("div",{class:"preview-header"},"海报预览",-1)),a("div",Mt,[ke.value.length?(c(!0),v(T,{key:0},M(ke.value,(o,g)=>(c(),v("img",{key:"poster-"+g,src:o,alt:"海报预览",class:"preview-image",onError:$=>Se(o,"poster",g)},null,40,Rt))),128)):(c(),v("div",Lt,"暂无海报预览"))])])])])]),_:1})])]),_:1}),d(S,{label:"视频截图",name:"images"},{default:u(()=>[a("div",Pt,[a("div",Dt,[d(f,{"label-position":"top",class:"fill-height-form"},{default:u(()=>[d(n,{class:"is-flexible"},{label:u(()=>[a("div",xt,[e[29]||(e[29]=a("span",null,"截图",-1)),d(r,{icon:L(re),onClick:vs,loading:ge.value,size:"small",type:"text"},{default:u(()=>[...e[28]||(e[28]=[z(" 重新获取 ",-1)])]),_:1},8,["icon","loading"])])]),default:u(()=>[d(l,{type:"textarea",modelValue:t.value.intro.screenshots,"onUpdate:modelValue":e[13]||(e[13]=o=>t.value.intro.screenshots=o),rows:20},null,8,["modelValue"])]),_:1})]),_:1})]),a("div",Ut,[a("div",Bt,[pe.value.length?(c(),E(P,{key:0,interval:5e3,height:"500px","indicator-position":"outside"},{default:u(()=>[(c(!0),v(T,null,M(pe.value,(o,g)=>(c(),E(j,{key:"ss-"+g},{default:u(()=>[a("div",Ot,[a("img",{src:o,alt:"截图预览",class:"carousel-image",onError:$=>Se(o,"screenshot",g)},null,40,jt)])]),_:2},1024))),128))]),_:1})):(c(),v("div",Ft,"截图预览"))])])])]),_:1}),d(S,{label:"简介详情",name:"intro"},{default:u(()=>[d(f,{"label-position":"top",class:"fill-height-form"},{default:u(()=>[d(n,{class:"is-flexible"},{label:u(()=>[a("div",qt,[e[31]||(e[31]=a("span",null,"正文",-1)),d(r,{icon:L(re),onClick:ps,loading:Le.value,size:"small",type:"text"},{default:u(()=>[...e[30]||(e[30]=[z(" 重新获取 ",-1)])]),_:1},8,["icon","loading"])])]),default:u(()=>[d(l,{type:"textarea",modelValue:t.value.intro.body,"onUpdate:modelValue":e[14]||(e[14]=o=>t.value.intro.body=o),rows:18},null,8,["modelValue"])]),_:1}),d(n,{label:"豆瓣链接"},{default:u(()=>[d(l,{modelValue:t.value.douban_link,"onUpdate:modelValue":e[15]||(e[15]=o=>t.value.douban_link=o),placeholder:"请输入豆瓣电影链接"},null,8,["modelValue"])]),_:1}),d(n,{label:"IMDb链接"},{default:u(()=>[d(l,{modelValue:t.value.imdb_link,"onUpdate:modelValue":e[16]||(e[16]=o=>t.value.imdb_link=o),placeholder:"请输入IMDb电影链接"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),d(S,{label:"媒体信息",name:"mediainfo"},{default:u(()=>[d(f,{"label-position":"top",class:"fill-height-form"},{default:u(()=>[d(n,{class:"is-flexible"},{label:u(()=>[a("div",Ht,[e[33]||(e[33]=a("span",null,"Mediainfo",-1)),d(r,{icon:L(re),onClick:_s,loading:be.value,size:"small",type:"text"},{default:u(()=>[...e[32]||(e[32]=[z(" 重新获取 ",-1)])]),_:1},8,["icon","loading"])])]),default:u(()=>[d(l,{type:"textarea",class:"code-font",modelValue:t.value.mediainfo,"onUpdate:modelValue":e[17]||(e[17]=o=>t.value.mediainfo=o),rows:26},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),d(S,{label:"已过滤声明",name:"filtered-declarations",class:"filtered-declarations-pane"},{default:u(()=>[a("div",Kt,[a("div",Wt,[e[34]||(e[34]=a("h3",null,"已自动过滤的声明内容",-1)),d(_,{type:"warning",size:"small"},{default:u(()=>[z("共 "+h(Je.value)+" 条",1)]),_:1})]),a("div",Gt,[Je.value>0?(c(!0),v(T,{key:0},M(Ye.value,(o,g)=>(c(),v("div",{key:g,class:"declaration-item"},[a("div",Yt,[a("span",Jt,"#"+h(g+1),1),d(_,{type:"danger",size:"small"},{default:u(()=>[...e[35]||(e[35]=[z("已过滤",-1)])]),_:1})]),a("pre",Qt,h(o),1)]))),128)):(c(),v("div",Zt,[d(le,{description:"未检测到需要过滤的 ARDTU 声明内容"})]))])])]),_:1})]),_:1},8,["modelValue"])])):w("",!0),y.value===1?(c(),v("div",Xt,[a("div",ea,[a("div",sa,[e[36]||(e[36]=a("div",{class:"row-label"},"主标题：",-1)),a("div",ta,h(t.value.final_publish_parameters?.["主标题 (预览)"]||t.value.original_main_title||"暂无数据"),1)]),a("div",aa,[e[37]||(e[37]=a("div",{class:"row-label"},"副标题：",-1)),a("div",la,h(t.value.subtitle||"暂无数据"),1)]),a("div",oa,[e[49]||(e[49]=a("div",{class:"row-label"},"参数信息：",-1)),a("div",na,[a("div",ia,[a("div",ra,[a("div",da,[e[38]||(e[38]=a("span",{class:"param-label"},"IMDb链接：",-1)),a("span",{class:V(["param-value",{empty:!t.value.imdb_link||t.value.imdb_link==="N/A"}])},h(t.value.imdb_link||"N/A"),3)]),a("div",ua,[e[39]||(e[39]=a("span",{style:{"letter-spacing":"2.6px"},class:"param-label"},"豆瓣链接",-1)),e[40]||(e[40]=a("span",{style:{"font-size":"13px"}},"：",-1)),a("span",{class:V(["param-value",{empty:!t.value.douban_link||t.value.douban_link==="N/A"}])},h(t.value.douban_link||"N/A"),3)])]),a("div",ca,[e[41]||(e[41]=a("span",{class:"param-label"},"标签：",-1)),a("div",ma,[a("span",{class:V(["param-value",{empty:!Be()||Be().length===0}])},h(Be().join(", ")||"N/A"),3),ie.value&&ie.value.length>0?(c(),v("span",pa,h(ie.value.join(", ")),1)):w("",!0)])])]),a("div",va,[a("div",_a,[e[42]||(e[42]=a("span",{class:"param-label"},"类型：",-1)),a("div",fa,[a("span",{class:V(["param-value",{empty:!W("type")}])},h(W("type")||"N/A"),3),t.value.standardized_params.type?(c(),v("span",ga,h(t.value.standardized_params.type),1)):w("",!0)])]),a("div",ba,[e[43]||(e[43]=a("span",{class:"param-label"},"媒介：",-1)),a("div",ha,[a("span",{class:V(["param-value",{empty:!W("medium")}])},h(W("medium")||"N/A"),3),t.value.standardized_params.medium?(c(),v("span",ya,h(t.value.standardized_params.medium),1)):w("",!0)])]),a("div",wa,[e[44]||(e[44]=a("span",{class:"param-label"},"视频编码：",-1)),a("div",ka,[a("span",{class:V(["param-value",{empty:!W("video_codec")}])},h(W("video_codec")||"N/A"),3),t.value.standardized_params.video_codec?(c(),v("span",Sa,h(t.value.standardized_params.video_codec),1)):w("",!0)])]),a("div",Ia,[e[45]||(e[45]=a("span",{class:"param-label"},"音频编码：",-1)),a("div",Ca,[a("span",{class:V(["param-value",{empty:!W("audio_codec")}])},h(W("audio_codec")||"N/A"),3),t.value.standardized_params.audio_codec?(c(),v("span",$a,h(t.value.standardized_params.audio_codec),1)):w("",!0)])]),a("div",za,[e[46]||(e[46]=a("span",{class:"param-label"},"分辨率：",-1)),a("div",Va,[a("span",{class:V(["param-value",{empty:!W("resolution")}])},h(W("resolution")||"N/A"),3),t.value.standardized_params.resolution?(c(),v("span",Ea,h(t.value.standardized_params.resolution),1)):w("",!0)])]),a("div",Ta,[e[47]||(e[47]=a("span",{class:"param-label"},"制作组：",-1)),a("div",Na,[a("span",{class:V(["param-value",{empty:!W("team")}])},h(W("team")||"N/A"),3),t.value.standardized_params.team?(c(),v("span",Aa,h(t.value.standardized_params.team),1)):w("",!0)])]),a("div",Ma,[e[48]||(e[48]=a("span",{class:"param-label"},"产地/来源：",-1)),a("div",Ra,[a("span",{class:V(["param-value",{empty:!W("source")}])},h(W("source")||"N/A"),3),t.value.standardized_params.source?(c(),v("span",La,h(t.value.standardized_params.source),1)):w("",!0)])])])])]),a("div",Pa,[e[50]||(e[50]=a("div",{class:"row-label"},"Mediainfo：",-1)),a("div",Da,[a("pre",xa,h(t.value.mediainfo||"暂无数据"),1)])]),a("div",Ua,[e[52]||(e[52]=a("div",{class:"row-label"},"简介内容：",-1)),a("div",Ba,[a("div",Oa,[a("div",{class:"section-content",innerHTML:de(t.value.intro?.statement)||"暂无声明"},null,8,ja)]),ke.value.length>0?(c(),v("div",Fa,[a("div",qa,[(c(!0),v(T,null,M(ke.value,(o,g)=>(c(),v("img",{key:"poster-preview-"+g,src:o,alt:"海报 "+(g+1),class:"preview-image-inline",style:{width:"300px"},onError:$=>Se(o,"poster",g)},null,40,Ha))),128))])])):w("",!0),a("div",Ka,[e[51]||(e[51]=a("br",null,null,-1)),a("div",{class:"section-content",innerHTML:de(t.value.intro?.body)||"暂无正文"},null,8,Wa)]),pe.value.length>0?(c(),v("div",Ga,[a("div",Ya,[(c(!0),v(T,null,M(pe.value,(o,g)=>(c(),v("img",{key:"screenshot-preview-"+g,src:o,alt:"截图 "+(g+1),class:"preview-image-inline",onError:$=>Se(o,"screenshot",g)},null,40,Ja))),128))])])):w("",!0)])])])])):w("",!0),y.value===2?(c(),v("div",Qa,[e[57]||(e[57]=a("h3",{class:"selection-title"},"请选择要发布的目标站点",-1)),e[58]||(e[58]=a("p",{class:"selection-subtitle"},"已存在的站点已被自动禁用。红色站点表示未配置Cookie。",-1)),As.value?(c(),E(ze,{key:0,type:"error",closable:!1,style:{width:"410px",margin:"0 auto"}},{title:u(()=>[...e[53]||(e[53]=[a("span",{style:{"font-weight":"600"}},"禁止转载",-1)])]),default:u(()=>[e[54]||(e[54]=a("div",null,[z(" 检测到制作组包含禁止转载的内容，已自动禁用 UBits 站点。"),a("br"),z(" 禁止转载的制作组：CMCT、CMCTV ")],-1))]),_:1})):w("",!0),a("div",Za,[d(ve,null,{default:u(()=>[d(r,{type:"primary",onClick:Cs},{default:u(()=>[...e[55]||(e[55]=[z("全选",-1)])]),_:1}),d(r,{type:"info",onClick:$s},{default:u(()=>[...e[56]||(e[56]=[z("清空",-1)])]),_:1})]),_:1})]),a("div",Xa,[(c(!0),v(T,null,M(te.value.filter(o=>o.is_target),o=>(c(),E(r,{key:o.name,class:"site-button",type:ms(o),plain:!o.has_cookie,disabled:!De(o.name),onClick:g=>Is(o.name)},{default:u(()=>[z(h(o.name)+" ",1),o.name==="ubits"&&!De(o.name)?(c(),E(L(Ys),{key:0,content:"该制作组禁止转载到 uBits 站点",placement:"top"},{default:u(()=>[d(i,{style:{"margin-left":"4px",color:"#f56c6c"}},{default:u(()=>[d(L(Js))]),_:1})]),_:1})):w("",!0)]),_:2},1032,["type","plain","disabled","onClick"]))),128))])])):w("",!0),y.value===3?(c(),v("div",el,[H.value.total>0||x.value.total>0?(c(),v("div",sl,[H.value.total>0?(c(),v("div",tl,[e[59]||(e[59]=a("div",{class:"progress-label"},"发布进度:",-1)),d(Ve,{percentage:Math.round(H.value.current/H.value.total*100),"show-text":!0},null,8,["percentage"]),a("div",al,h(H.value.current)+" / "+h(H.value.total),1)])):w("",!0),x.value.total>0?(c(),v("div",ll,[e[60]||(e[60]=a("div",{class:"progress-label"},"下载器添加进度:",-1)),d(Ve,{percentage:Math.round(x.value.current/x.value.total*100),"show-text":!0},null,8,["percentage"]),a("div",ol,h(x.value.current)+" / "+h(x.value.total),1)])):w("",!0)])):w("",!0),a("div",nl,[(c(!0),v(T,null,M(Ls.value,(o,g)=>(c(),v("div",{key:g,class:"results-row"},[a("div",il,[(c(!0),v(T,null,M(o,$=>(c(),v("div",{key:$.siteName,class:V(["result-card",{"is-success":$.success,"is-error":!$.success}])},[a("div",rl,[$.success?(c(),E(i,{key:0,color:"#67C23A",size:32},{default:u(()=>[d(L(Fe))]),_:1})):(c(),E(i,{key:1,color:"#F56C6C",size:32},{default:u(()=>[d(L(is))]),_:1}))]),a("h4",dl,h($.siteName),1),$.isExisted?(c(),v("div",ul,[d(_,{type:"warning",size:"small"},{default:u(()=>[...e[61]||(e[61]=[z("已存在",-1)])]),_:1})])):w("",!0),$.downloaderStatus?(c(),v("div",cl,[a("div",ml,[$.downloaderStatus.success?(c(),E(i,{key:0,color:"#67C23A",size:16},{default:u(()=>[d(L(Fe))]),_:1})):(c(),E(i,{key:1,color:"#F56C6C",size:16},{default:u(()=>[d(L(is))]),_:1}))]),a("span",{class:V(["status-text",{success:$.downloaderStatus.success,error:!$.downloaderStatus.success}])},h($.downloaderStatus.success?`种子已添加到'${$.downloaderStatus.downloaderName}'`:"添加失败"),3)])):w("",!0),a("div",pl,[d(r,{type:"primary",size:"small",onClick:xl=>Rs($.siteName,$.logs)},{default:u(()=>[...e[62]||(e[62]=[z(" 查看日志 ",-1)])]),_:1},8,["onClick"]),$.success&&$.url?(c(),v("a",{key:0,href:os($.url),target:"_blank",rel:"noopener noreferrer",style:{transform:"translateY(-3px)"}},[d(r,{type:"success",size:"small"},{default:u(()=>[...e[63]||(e[63]=[z(" 查看种子 ",-1)])]),_:1})],8,vl)):w("",!0)])],2))),128))]),a("div",_l,[d(r,{type:"warning",icon:L(re),size:"large",onClick:$=>xs(o),disabled:!Ps(o),class:"open-all-button"},{default:u(()=>[a("div",fl,"打开"+h(Ds(o))+"个站点",1)]),_:2},1032,["icon","onClick","disabled"])])]))),128))])])):w("",!0)]),a("footer",gl,[y.value===0?(c(),v("div",bl,[d(Ee,{name:"el-fade-in-linear"},{default:u(()=>[G.showCompleteButton?(c(),v("div",hl," 修改完成后请预览一遍种子信息确保无误后完成修改！ ")):w("",!0)]),_:1}),d(r,{onClick:Qe},{default:u(()=>[...e[64]||(e[64]=[z("取消",-1)])]),_:1}),d(r,{type:"primary",onClick:ys,disabled:ss.value},{default:u(()=>[...e[65]||(e[65]=[z(" 下一步：发布参数预览 ",-1)])]),_:1},8,["disabled"]),d(Ee,{name:"el-fade-in-linear"},{default:u(()=>[ss.value?(c(),v("div",yl,[d(i,{class:"hint-icon"},{default:u(()=>[d(L(Te))]),_:1}),a("span",null,h(Ms.value),1)])):w("",!0)]),_:1})])):w("",!0),y.value===1?(c(),v("div",wl,[d(r,{onClick:Vs,disabled:O.value},{default:u(()=>[...e[66]||(e[66]=[z("上一步",-1)])]),_:1},8,["disabled"]),G.showCompleteButton?(c(),E(r,{key:0,type:"primary",onClick:Ze,disabled:O.value||!K.value,class:V({"scrolled-to-bottom":K.value})},{default:u(()=>[...e[67]||(e[67]=[z(" 修改完成 ",-1)])]),_:1},8,["disabled","class"])):w("",!0),d(r,{type:"primary",onClick:Ss,disabled:O.value||!K.value,class:V({"scrolled-to-bottom":K.value})},{default:u(()=>[...e[68]||(e[68]=[z(" 下一步：选择发布站点 ",-1)])]),_:1},8,["disabled","class"]),d(Ee,{name:"el-fade-in-linear"},{default:u(()=>[G.showCompleteButton&&!K.value?(c(),v("div",kl,[d(i,{class:"hint-icon"},{default:u(()=>[d(L(Te))]),_:1}),e[69]||(e[69]=a("span",null,"请滚动到页面底部检查完种子信息无误再发布！",-1))])):w("",!0)]),_:1}),d(Ee,{name:"el-fade-in-linear"},{default:u(()=>[!G.showCompleteButton&&!K.value?(c(),v("div",Sl,[d(i,{class:"hint-icon"},{default:u(()=>[d(L(Te))]),_:1}),e[70]||(e[70]=a("span",null,"请先滚动到页面底部检查完种子信息再发布！",-1))])):w("",!0)]),_:1})])):w("",!0),y.value===2?(c(),v("div",Il,[d(r,{onClick:Qe,disabled:O.value},{default:u(()=>[...e[71]||(e[71]=[z("取消",-1)])]),_:1},8,["disabled"]),d(r,{type:"primary",onClick:zs,loading:O.value,disabled:Y.value.length===0},{default:u(()=>[...e[72]||(e[72]=[z(" 立即发布 ",-1)])]),_:1},8,["loading","disabled"])])):w("",!0),y.value===3?(c(),v("div",Cl,[d(r,{type:"primary",onClick:Ze},{default:u(()=>[...e[73]||(e[73]=[z("完成",-1)])]),_:1})])):w("",!0)])]),ye.value?(c(),v("div",{key:0,class:"log-card-overlay",onClick:ls})):w("",!0),ye.value?(c(),E(Bs,{key:1,class:"log-card",shadow:"xl"},{header:u(()=>[a("div",$l,[e[74]||(e[74]=a("span",null,"操作日志",-1)),d(r,{type:"danger",icon:L(Ws),circle:"",onClick:ls},null,8,["icon"])])]),default:u(()=>[a("pre",zl,h(ae.value),1)]),_:1})):w("",!0),d(it,{visible:we.value,taskId:Ge.value,onComplete:Us,onClose:e[19]||(e[19]=o=>we.value=!1)},null,8,["visible","taskId"]),d(js,{modelValue:Q.value,"onUpdate:modelValue":e[21]||(e[21]=o=>Q.value=o),title:"抓取失败 - 详细日志",width:"800px","destroy-on-close":"","append-to-body":"",class:"error-log-dialog"},{footer:u(()=>[a("span",Pl,[d(r,{onClick:e[20]||(e[20]=o=>Q.value=!1)},{default:u(()=>[...e[76]||(e[76]=[z("关闭",-1)])]),_:1})])]),default:u(()=>[a("div",Vl,[d(ze,{title:"获取种子信息过程中发生错误",type:"error",closable:!1,"show-icon":"",style:{"margin-bottom":"15px"}},{default:u(()=>[...e[75]||(e[75]=[a("div",null,"请查看下方详细日志以排查问题（如 Python 堆栈信息）。",-1)])]),_:1}),d(Os,{height:"500px"},{default:u(()=>[a("div",El,[(c(!0),v(T,null,M(se.value,o=>(c(),v("div",{key:o.id,class:V(["log-entry",{"is-error":o.isError}])},[a("div",Tl,[a("span",Nl,h(o.time),1),d(_,{type:ue(o.level),size:"small",effect:"dark",class:"log-level-tag"},{default:u(()=>[z(h(o.level),1)]),_:2},1032,["type"]),o.site?(c(),v("span",Al,"["+h(o.site)+"]",1)):w("",!0),a("span",Ml,h(o.message),1)]),o.details?(c(),v("div",Rl,[a("pre",Ll,h(o.details),1)])):w("",!0)],2))),128))])]),_:1})])]),_:1},8,["modelValue"])],64)}}}),Bl=us(Dl,[["__scopeId","data-v-ea40e4d9"]]);export{Bl as C,Qs as u};
