import{d as we,r as g,C as R,o as ke,a as k,i as a,e as s,n as ee,m as S,k as se,w as t,f as w,g as f,z as _,x as r,Z as te,j as d,O as ae,$ as le,a0 as j,a1 as O,S as q,I as M,a2 as be,a3 as xe,u as he,v as Ve,F as D,l as $,T as Ue,a4 as ze,a5 as Ie,h as m,t as H,B as Ce,p as Se}from"./index-D6Hhcci2.js";const qe={class:"settings-container"},Te={class:"settings-grid"},Pe={class:"card-header"},Ae={class:"header-content"},Fe={class:"card-content"},Re={class:"password-hint"},Me={class:"settings-card glass-card glass-rounded glass-transparent-header glass-transparent-body"},Ge={class:"card-header"},Le={class:"header-content"},Ye={class:"card-content"},Be={class:"settings-card glass-card glass-rounded glass-transparent-header glass-transparent-body"},Ee={class:"card-header"},Ne={class:"header-content"},je={class:"card-content"},Oe={style:{flex:"1",display:"flex","flex-direction":"column","justify-content":"center"}},De={style:{display:"flex",margin:"auto","align-items":"center",gap:"20px","justify-content":"center",padding:"15px 0"}},$e={style:{display:"flex",margin:"auto",gap:"20px","justify-content":"center",padding:"15px 0"}},He={style:{height:"500px","overflow-y":"auto"}},Qe={key:0,style:{"text-align":"center",padding:"20px",color:"#999"}},We={key:1},Ze={style:{color:"#999","margin-right":"10px"}},Je={style:{"margin-left":"10px"}},Ke={style:{"text-align":"right"}},Xe={class:"settings-card glass-card glass-rounded glass-transparent-header glass-transparent-body"},es={class:"card-header"},ss={class:"header-content"},ts={class:"card-content"},as={key:"agsv",class:"credential-section"},ls={class:"credential-header"},os={class:"credential-form"},ns={key:"other",class:"placeholder-section"},rs={class:"settings-card glass-card glass-rounded glass-transparent-header glass-transparent-body"},ds={class:"card-header"},is={class:"header-content"},us={class:"card-content"},ps={class:"settings-card glass-card glass-rounded glass-transparent-header glass-transparent-body"},_s={class:"card-header"},gs={class:"header-content"},ms={class:"card-content"},cs={style:{display:"flex","align-items":"center",gap:"20px",padding:"15px 0"}},fs={class:"form-item",style:{"margin-bottom":"16px"}},vs={style:{display:"flex","align-items":"center","justify-content":"space-between","margin-bottom":"6px"}},ys={class:"settings-card glass-card glass-rounded glass-transparent-header glass-transparent-body"},ws={class:"card-header"},ks={class:"header-content"},bs={class:"card-content placeholder-content"},xs=we({__name:"GeneralSettings",setup(hs){const T=g(!1),G=g(!1),Q=g("admin"),P=g(!1),i=g({old_password:"",username:"",password:""}),u=R({token:"",query_interval_hours:72,query_interval_days:3,auto_query_enabled:!0}),A=g(!1),p=R({image_hoster:"pixhost",agsv_email:"",agsv_password:"",default_downloader:""}),oe=[{value:"pixhost",label:"Pixhost (免费)"},{value:"agsv",label:"末日图床 (需账号)"}],W=g([]),v=g(""),V=g(!1),U=g(""),ne=()=>{V.value=!V.value,V.value?U.value=v.value:U.value=v.value?"*".repeat(v.value.length):""},re=o=>{o.length>0&&o.split("").every(l=>l==="*")||(v.value=o,u.token=o)},F=g(!1),C=g([]),L=g(!1),Y=g(!1),z=R({background_url:""}),B=g(!1),b=R({anonymous_upload:!0,cspt_ptgen_token:""}),de=()=>{window.open("https://cspt.top/ptgen.php","_blank")},ie=async()=>{try{const o=await f.get("/api/auth/status");o.data?.success&&(Q.value=o.data.username||"admin",P.value=!!o.data.must_change_password,i.value.username=Q.value);const l=(await f.get("/api/settings")).data;if(l.iyuu_token){v.value=l.iyuu_token;const c="*".repeat(l.iyuu_token.length);u.token=c,U.value=c}else v.value="",u.token="",U.value="";l.iyuu_settings&&(u.query_interval_hours=l.iyuu_settings.query_interval_hours||72,u.query_interval_days=Math.ceil(u.query_interval_hours/24),u.auto_query_enabled=l.iyuu_settings.auto_query_enabled!==!1),Object.assign(p,l.cross_seed||{}),l.ui_settings&&l.ui_settings.background_url&&(z.background_url=l.ui_settings.background_url),l.upload_settings&&(b.anonymous_upload=l.upload_settings.anonymous_upload!==!1),l.cross_seed&&l.cross_seed.cspt_ptgen_token&&(b.cspt_ptgen_token=l.cross_seed.cspt_ptgen_token);const E=await f.get("/api/downloaders_list");W.value=E.data}catch{_.error("无法加载设置。")}},ue=async()=>{G.value=!0;try{if(v.value&&u.token!=="********"){const l={iyuu_token:v.value};await f.post("/api/settings",l)}else if(!v.value&&u.token){const l={iyuu_token:u.token};await f.post("/api/settings",l),v.value=u.token}V.value=!1;const o=v.value?"*".repeat(v.value.length):"";U.value=o,u.token=o;const e={query_interval_hours:u.query_interval_days*24,auto_query_enabled:u.auto_query_enabled};await f.post("/api/iyuu/settings",e),u.query_interval_hours=e.query_interval_hours,_.success("IYUU 设置已保存！")}catch(o){const e=o.response?.data?.error||"保存失败。";_.error(e)}finally{G.value=!1}},pe=async()=>{try{_.success("IYUU 查询已触发，请稍后查看结果。"),f.post("/api/iyuu/trigger_query").catch(o=>{console.error("IYUU 查询后台执行失败:",o)})}catch(o){const e=o.response?.data?.message||"触发查询失败。";_.error(e)}},Z=async()=>{L.value=!0,F.value=!0;try{const o=await f.get("/api/iyuu/logs");o.data.success?C.value=o.data.logs||[]:(_.error(o.data.message||"获取日志失败"),C.value=[])}catch(o){const e=o.response?.data?.message||"获取日志失败";_.error(e),C.value=[]}finally{L.value=!1}},_e=async()=>{if(!T.value){if(!i.value.old_password){_.warning("请填写当前密码");return}if(!i.value.username&&!i.value.password){_.warning("请输入新用户名或新密码");return}if(i.value.username&&i.value.username.trim().length<3){_.warning("用户名至少 3 个字符");return}if(i.value.password&&i.value.password.length<6){_.warning("密码至少 6 位");return}T.value=!0;try{const o={old_password:i.value.old_password};i.value.username&&(o.username=i.value.username),i.value.password&&(o.password=i.value.password);const e=await f.post("/api/auth/change_password",o);e.data?.success?(_.success("保存成功，请重新登录"),localStorage.removeItem("token"),window.location.href="/login"):_.error(e.data?.message||"保存失败")}catch(o){_.error(o?.response?.data?.message||"保存失败")}finally{T.value=!1}}},J=async()=>{A.value=!0;try{const o={image_hoster:p.image_hoster,agsv_email:p.agsv_email,agsv_password:p.agsv_password,default_downloader:p.default_downloader};await f.post("/api/settings/cross_seed",o),_.success("转种设置已保存！")}catch(o){const e=o.response?.data?.error||"保存失败。";_.error(e)}finally{A.value=!1}},ge=async()=>{Y.value=!0;try{const o={ui_settings:{background_url:z.background_url}};await f.post("/api/settings",o),_.success("背景设置已保存！"),window.dispatchEvent(new CustomEvent("background-updated",{detail:{backgroundUrl:z.background_url}}))}catch(o){const e=o.response?.data?.error||"保存失败。";_.error(e)}finally{Y.value=!1}},me=async()=>{B.value=!0;try{const o={anonymous_upload:b.anonymous_upload};await f.post("/api/upload_settings",o);const e={image_hoster:p.image_hoster,agsv_email:p.agsv_email,agsv_password:p.agsv_password,default_downloader:p.default_downloader,cspt_ptgen_token:b.cspt_ptgen_token};await f.post("/api/settings/cross_seed",e),_.success("上传设置已保存！")}catch(o){const e=o.response?.data?.error||"保存失败。";_.error(e)}finally{B.value=!1}};return ke(()=>{ie()}),(o,e)=>{const l=w("el-icon"),E=w("el-tag"),c=w("el-button"),x=w("el-input"),y=w("el-form-item"),h=w("el-text"),I=w("el-form"),K=w("el-switch"),ce=w("el-input-number"),fe=w("el-dialog"),N=w("el-option"),X=w("el-select"),ve=Ve("loading");return m(),k("div",qe,[a("div",Te,[a("div",{class:ee(["settings-card glass-card glass-rounded glass-transparent-header glass-transparent-body",{"temp-password-highlight":P.value}])},[a("div",Pe,[a("div",Ae,[s(l,{class:"header-icon"},{default:t(()=>[s(r(te))]),_:1}),e[16]||(e[16]=a("h3",null,"账户信息",-1)),P.value?(m(),S(E,{key:0,type:"danger",size:"small",effect:"dark"},{default:t(()=>[s(l,{style:{"vertical-align":"middle","margin-right":"4px"}},{default:t(()=>[s(r(ae))]),_:1}),e[15]||(e[15]=d(" 临时密码-请立即修改 ",-1))]),_:1})):se("",!0)]),s(c,{type:"primary",loading:T.value,onClick:_e,size:"small"},{default:t(()=>[...e[17]||(e[17]=[d(" 保存 ",-1)])]),_:1},8,["loading"])]),a("div",Fe,[s(I,{model:i.value,"label-position":"top",class:"settings-form"},{default:t(()=>[s(y,{label:"用户名",class:"form-item"},{default:t(()=>[s(x,{modelValue:i.value.username,"onUpdate:modelValue":e[0]||(e[0]=n=>i.value.username=n),placeholder:"请输入用户名",clearable:""},{prefix:t(()=>[s(l,null,{default:t(()=>[s(r(te))]),_:1})]),_:1},8,["modelValue"])]),_:1}),s(y,{label:"当前密码",required:"",class:"form-item"},{default:t(()=>[s(x,{modelValue:i.value.old_password,"onUpdate:modelValue":e[1]||(e[1]=n=>i.value.old_password=n),type:"password",placeholder:"请输入当前密码","show-password":""},{prefix:t(()=>[s(l,null,{default:t(()=>[s(r(le))]),_:1})]),_:1},8,["modelValue"])]),_:1}),s(y,{label:"新密码",class:"form-item"},{default:t(()=>[s(x,{modelValue:i.value.password,"onUpdate:modelValue":e[2]||(e[2]=n=>i.value.password=n),type:"password",placeholder:"至少 6 位","show-password":""},{prefix:t(()=>[s(l,null,{default:t(()=>[s(r(j))]),_:1})]),_:1},8,["modelValue"]),a("div",Re,[s(h,{type:"info",size:"small"},{default:t(()=>[...e[18]||(e[18]=[d("留空表示不修改密码",-1)])]),_:1})])]),_:1}),e[20]||(e[20]=a("div",{class:"form-spacer"},null,-1)),P.value?(m(),S(h,{key:0,type:"warning",size:"small",class:"security-hint"},{default:t(()=>[s(l,{size:"12"},{default:t(()=>[s(r(ae))]),_:1}),e[19]||(e[19]=d(" 为确保安全，请立即设置新用户名与密码 ",-1))]),_:1})):se("",!0)]),_:1},8,["model"])])],2),a("div",Me,[a("div",Ge,[a("div",Le,[s(l,{class:"header-icon"},{default:t(()=>[s(r(O))]),_:1}),e[21]||(e[21]=a("h3",null,"背景设置",-1))]),s(c,{type:"primary",loading:Y.value,onClick:ge,size:"small"},{default:t(()=>[...e[22]||(e[22]=[d(" 保存 ",-1)])]),_:1},8,["loading"])]),a("div",Ye,[s(I,{model:z,"label-position":"top",class:"settings-form"},{default:t(()=>[s(y,{label:"背景图片URL",class:"form-item"},{default:t(()=>[s(x,{modelValue:z.background_url,"onUpdate:modelValue":e[3]||(e[3]=n=>z.background_url=n),placeholder:"请输入背景图片的URL地址",clearable:""},{prefix:t(()=>[s(l,null,{default:t(()=>[s(r(O))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e[24]||(e[24]=a("div",{class:"form-spacer"},null,-1)),s(h,{type:"info",size:"small",class:"proxy-hint"},{default:t(()=>[s(l,{size:"12"},{default:t(()=>[s(r(q))]),_:1}),e[23]||(e[23]=d(" 设置应用程序的背景图片，支持在线图片URL ",-1))]),_:1})]),_:1},8,["model"])])]),a("div",Be,[a("div",Ee,[a("div",Ne,[s(l,{class:"header-icon"},{default:t(()=>[s(r(M))]),_:1}),e[25]||(e[25]=a("h3",null,"IYUU设置",-1))]),s(c,{type:"primary",loading:G.value,onClick:ue,size:"small"},{default:t(()=>[...e[26]||(e[26]=[d(" 保存 ",-1)])]),_:1},8,["loading"])]),a("div",je,[s(I,{model:u,"label-position":"top",class:"settings-form"},{default:t(()=>[s(y,{label:"IYUU Token",class:"form-item"},{default:t(()=>[s(x,{modelValue:U.value,"onUpdate:modelValue":e[4]||(e[4]=n=>U.value=n),type:V.value?"text":"password",placeholder:"请输入IYUU Token",onInput:re},{prefix:t(()=>[s(l,null,{default:t(()=>[s(r(j))]),_:1})]),suffix:t(()=>[s(l,{onClick:ne,style:{cursor:"pointer"},class:ee({"is-active":V.value})},{default:t(()=>[V.value?(m(),S(r(xe),{key:1})):(m(),S(r(be),{key:0}))]),_:1},8,["class"])]),_:1},8,["modelValue","type"])]),_:1}),a("div",Oe,[s(y,{label:"自动查询与间隔",class:"form-item"},{default:t(()=>[a("div",De,[s(K,{modelValue:u.auto_query_enabled,"onUpdate:modelValue":e[5]||(e[5]=n=>u.auto_query_enabled=n),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"]),s(ce,{modelValue:u.query_interval_days,"onUpdate:modelValue":e[6]||(e[6]=n=>u.query_interval_days=n),min:1,placeholder:"天数","controls-position":"right",style:{width:"120px"}},null,8,["modelValue"]),e[27]||(e[27]=a("span",null,"天",-1))])]),_:1}),s(y,{label:"",class:"form-item"},{default:t(()=>[a("div",$e,[s(c,{type:"success",onClick:pe,size:"default",style:{"font-size":"14px",padding:"12px 24px"}},{default:t(()=>[...e[28]||(e[28]=[d(" 手动触发查询 ",-1)])]),_:1}),s(c,{type:"primary",onClick:Z,size:"default",style:{"font-size":"14px",padding:"12px 24px"}},{default:t(()=>[...e[29]||(e[29]=[d(" 查看日志 ",-1)])]),_:1})])]),_:1}),s(h,{type:"info",size:"small",style:{display:"block","text-align":"center",margin:"10px 0"}},{default:t(()=>[s(l,{size:"12"},{default:t(()=>[s(r(q))]),_:1}),e[30]||(e[30]=d(" 种子查询页面的红色表示可辅种但未在做种 ",-1))]),_:1})]),e[32]||(e[32]=a("div",{class:"form-spacer"},null,-1)),s(h,{type:"info",size:"small",class:"proxy-hint"},{default:t(()=>[s(l,{size:"12"},{default:t(()=>[s(r(q))]),_:1}),e[31]||(e[31]=d(" 用于与IYUU平台进行数据同步和通信的身份验证令牌 ",-1))]),_:1})]),_:1},8,["model"])])]),s(fe,{modelValue:F.value,"onUpdate:modelValue":e[8]||(e[8]=n=>F.value=n),title:"IYUU 查询日志",width:"800px",top:"50px"},{footer:t(()=>[a("div",Ke,[s(c,{onClick:e[7]||(e[7]=n=>F.value=!1)},{default:t(()=>[...e[33]||(e[33]=[d("关闭",-1)])]),_:1}),s(c,{type:"primary",onClick:Z},{default:t(()=>[...e[34]||(e[34]=[d("刷新",-1)])]),_:1})])]),default:t(()=>[he((m(),k("div",He,[C.value.length===0?(m(),k("div",Qe," 暂无日志记录 ")):(m(),k("div",We,[(m(!0),k(D,null,$(C.value,(n,ye)=>(m(),k("div",{key:ye,style:{padding:"8px 0","border-bottom":"1px solid #eee","font-size":"12px"}},[a("span",Ze,"["+H(n.timestamp)+"]",1),a("span",{style:Ce({color:n.level==="ERROR"?"#F56C6C":n.level==="WARNING"?"#E6A23C":n.level==="INFO"?"#409EFF":"#67C23A"})},"["+H(n.level)+"]",5),a("span",Je,H(n.message),1)]))),128))]))])),[[ve,L.value]])]),_:1},8,["modelValue"]),a("div",Xe,[a("div",es,[a("div",ss,[s(l,{class:"header-icon"},{default:t(()=>[s(r(O))]),_:1}),e[35]||(e[35]=a("h3",null,"图床设置",-1))]),s(c,{type:"primary",onClick:J,loading:A.value,size:"small"},{default:t(()=>[...e[36]||(e[36]=[d(" 保存 ",-1)])]),_:1},8,["loading"])]),a("div",ts,[s(I,{model:p,"label-position":"top",class:"settings-form"},{default:t(()=>[s(y,{label:"截图图床",class:"form-item"},{default:t(()=>[s(X,{modelValue:p.image_hoster,"onUpdate:modelValue":e[9]||(e[9]=n=>p.image_hoster=n),placeholder:"请选择图床服务"},{default:t(()=>[(m(),k(D,null,$(oe,n=>s(N,{key:n.value,label:n.label,value:n.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),s(Ue,{name:"slide",mode:"out-in"},{default:t(()=>[p.image_hoster==="agsv"?(m(),k("div",as,[a("div",ls,[s(l,{class:"credential-icon"},{default:t(()=>[s(r(le))]),_:1}),e[37]||(e[37]=a("span",{class:"credential-title"},"末日图床账号凭据",-1))]),a("div",os,[s(y,{label:"邮箱",class:"form-item compact"},{default:t(()=>[s(x,{modelValue:p.agsv_email,"onUpdate:modelValue":e[10]||(e[10]=n=>p.agsv_email=n),placeholder:"请输入邮箱",size:"small"},null,8,["modelValue"])]),_:1}),s(y,{label:"密码",class:"form-item compact"},{default:t(()=>[s(x,{modelValue:p.agsv_password,"onUpdate:modelValue":e[11]||(e[11]=n=>p.agsv_password=n),type:"password",placeholder:"请输入密码","show-password":"",size:"small"},null,8,["modelValue"])]),_:1})])])):(m(),k("div",ns,[s(h,{type:"info",size:"small"},{default:t(()=>[...e[38]||(e[38]=[d("当前图床无需额外配置，但是需要代理才能上传",-1)])]),_:1})]))]),_:1})]),_:1},8,["model"])])]),a("div",rs,[a("div",ds,[a("div",is,[s(l,{class:"header-icon"},{default:t(()=>[s(r(ze))]),_:1}),e[39]||(e[39]=a("h3",null,"默认下载器设置",-1))]),s(c,{type:"primary",onClick:J,loading:A.value,size:"small"},{default:t(()=>[...e[40]||(e[40]=[d(" 保存 ",-1)])]),_:1},8,["loading"])]),a("div",us,[s(I,{model:p,"label-position":"top",class:"settings-form"},{default:t(()=>[s(y,{label:"默认下载器",class:"form-item"},{default:t(()=>[s(X,{modelValue:p.default_downloader,"onUpdate:modelValue":e[12]||(e[12]=n=>p.default_downloader=n),placeholder:"请选择默认下载器",clearable:""},{default:t(()=>[s(N,{label:"使用源种子所在的下载器",value:""}),(m(!0),k(D,null,$(W.value,n=>(m(),S(N,{key:n.id,label:n.name,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e[42]||(e[42]=a("div",{class:"form-spacer"},null,-1)),s(h,{type:"info",size:"small",class:"proxy-hint"},{default:t(()=>[s(l,{size:"12"},{default:t(()=>[s(r(q))]),_:1}),e[41]||(e[41]=d(' 转种完成后自动将种子添加到指定的下载器。选择"使用源种子所在的下载器"或不选择任何下载器，则添加到源种子所在的下载器。 ',-1))]),_:1})]),_:1},8,["model"])])]),a("div",ps,[a("div",_s,[a("div",gs,[s(l,{class:"header-icon"},{default:t(()=>[s(r(M))]),_:1}),e[43]||(e[43]=a("h3",null,"转种设置",-1))]),s(c,{type:"primary",onClick:me,loading:B.value,size:"small"},{default:t(()=>[...e[44]||(e[44]=[d(" 保存 ",-1)])]),_:1},8,["loading"])]),a("div",ms,[s(I,{model:b,"label-position":"top",class:"settings-form"},{default:t(()=>[s(y,{label:"",class:"form-item"},{default:t(()=>[a("div",cs,[s(K,{modelValue:b.anonymous_upload,"onUpdate:modelValue":e[13]||(e[13]=n=>b.anonymous_upload=n),"active-text":"启用匿名","inactive-text":"禁用匿名",size:"large"},null,8,["modelValue"])])]),_:1}),a("div",fs,[a("div",vs,[e[46]||(e[46]=a("span",{style:{"font-weight":"500",color:"var(--el-text-color-regular)","font-size":"13px"}}," 财神 PTGen API Token（每日100次） ",-1)),s(c,{type:"primary",link:"",onClick:de,style:{"white-space":"nowrap"}},{default:t(()=>[s(l,{style:{"margin-right":"4px"}},{default:t(()=>[s(r(Ie))]),_:1}),e[45]||(e[45]=d(" 获取Token ",-1))]),_:1})]),s(x,{modelValue:b.cspt_ptgen_token,"onUpdate:modelValue":e[14]||(e[14]=n=>b.cspt_ptgen_token=n),type:"password",placeholder:"请输入财神 PTGen API Token","show-password":""},{prefix:t(()=>[s(l,null,{default:t(()=>[s(r(j))]),_:1})]),_:1},8,["modelValue"])]),e[54]||(e[54]=a("div",{class:"form-spacer"},null,-1)),s(h,{type:"info",size:"small",class:"proxy-hint"},{default:t(()=>[s(l,{size:"12"},{default:t(()=>[s(r(q))]),_:1}),e[47]||(e[47]=d(" 启用后，发布种子时将使用匿名模式，不显示上传者信息",-1)),e[48]||(e[48]=a("br",null,null,-1)),e[49]||(e[49]=d(" 配置财神 PTGen API Token 后，优先使用该API获取影片信息",-1)),e[50]||(e[50]=a("br",null,null,-1)),e[51]||(e[51]=d(" 财神 PTGen API 每日限量 100次",-1)),e[52]||(e[52]=a("br",null,null,-1)),e[53]||(e[53]=d(" 使用完会自动切换内置的其他 PTGen API ",-1))]),_:1})]),_:1},8,["model"])])]),a("div",ys,[a("div",ws,[a("div",ks,[s(l,{class:"header-icon"},{default:t(()=>[s(r(M))]),_:1}),e[55]||(e[55]=a("h3",null,"功能扩展",-1))])]),a("div",bs,[s(l,{class:"placeholder-icon"},{default:t(()=>[s(r(M))]),_:1}),e[56]||(e[56]=a("p",{class:"placeholder-text"},"功能扩展中",-1))])])])])}}}),Us=Se(xs,[["__scopeId","data-v-9bf3c650"]]);export{Us as default};
