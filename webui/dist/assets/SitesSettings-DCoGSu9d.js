import{p as Z,r as g,c as M,D as ee,o as le,g as f,z as d,a as N,i as r,u as ae,e as l,w as t,f as p,x as S,P as oe,V as te,v as se,m as P,j as m,t as $,aa as ne,a9 as ie,J as re,h as V}from"./index-g-1vxImM.js";const ue={class:"cookie-view-container"},de={class:"top-actions cookie-actions glass-pagination"},pe={class:"right-action-group"},ce={class:"settings-view"},me={style:{display:"flex","justify-content":"center","align-items":"center",width:"100%",height:"100%"}},ge={class:"settings-footer glass-pagination"},ve={class:"pagination-container"},fe={class:"page-size-text"},_e={class:"dialog-footer"},_="/api",ke={__name:"SitesSettings",setup(ye){const x=g(!1),U=g([]),z=g(!1),h=g(!1),n=g({url:"",key:"",e2e_password:""}),k=g(""),B=g("active"),c=g({currentPage:1,pageSize:30,total:0}),y=g(!1),R=g(null),s=g({id:null,site:"",nickname:"",base_url:"",special_tracker_domain:"",group:"",cookie:"",speed_limit:0}),D=M(()=>{if(!k.value)return U.value;const o=k.value.toLowerCase();return U.value.filter(e=>{const i=(e.nickname||"").toLowerCase(),u=(e.site||"").toLowerCase(),L=(e.group||"").toLowerCase();return i.includes(o)||u.includes(o)||L.includes(o)})}),F=M(()=>{c.value.total=D.value.length;const o=(c.value.currentPage-1)*c.value.pageSize,e=o+c.value.pageSize;return D.value.slice(o,e)});ee(k,()=>{c.value.currentPage=1}),le(()=>{J(),w()});const J=async()=>{try{const o=await f.get(`${_}/settings`);o.data&&o.data.cookiecloud&&(n.value.url=o.data.cookiecloud.url||"",n.value.key=o.data.cookiecloud.key||"",n.value.e2e_password="")}catch{d.error("加载CookieCloud配置失败！")}},w=async()=>{z.value=!0;try{const o=await f.get(`${_}/sites`,{params:{filter_by_torrents:B.value}});U.value=o.data}catch{d.error("获取站点列表失败！")}finally{z.value=!1}},O=()=>{c.value.currentPage=1,w()},j=async()=>{if(!n.value.url||!n.value.key){d.warning("CookieCloud URL 和 KEY 不能为空！");return}h.value=!0;try{await f.post(`${_}/settings`,{cookiecloud:n.value});const o=await f.post(`${_}/cookiecloud/sync`,n.value);if(o.data.success){let e=o.data.message;e&&(e=e.replace(/在 CookieCloud 中另有 \d+ 个未匹配的 Cookie。?/,"")),d.success(`配置已保存. ${e||"同步完成！"}`),await w()}else d.error(o.data.message||"同步失败，但配置已保存。")}catch(o){const e=o.response?.data?.message||"操作失败，请检查网络或后端服务。";d.error(e)}finally{h.value=!1}},A=o=>{const e=JSON.parse(JSON.stringify(o));s.value=e,y.value=!0},I=async()=>{x.value=!0;try{const o=JSON.parse(JSON.stringify(s.value));o.cookie&&(o.cookie=o.cookie.trim());const e=await f.post(`${_}/sites/update`,o);e.data.success?(d.success(e.data.message),y.value=!1,await w()):d.error(e.data.message||"操作失败！")}catch(o){const e=o.response?.data?.message||"请求失败，请检查网络或后端服务。";d.error(e)}finally{x.value=!1}},K=o=>{re.confirm("","警告",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0,message:`您确定要删除站点【${o.nickname}】吗？<br/>可以通过修改 config.json 然后重启恢复。`}).then(async()=>{try{const e=await f.post(`${_}/sites/delete`,{id:o.id});e.data.success?(d.success("站点已删除。"),await w()):d.error(e.data.message||"删除失败！")}catch(e){const i=e.response?.data?.message||"删除请求失败。";d.error(i)}}).catch(()=>{d.info("操作已取消。")})};return(o,e)=>{const i=p("el-input"),u=p("el-form-item"),L=p("el-icon"),b=p("el-button"),T=p("el-form"),v=p("el-table-column"),C=p("el-tag"),Y=p("el-table"),E=p("el-radio-button"),q=p("el-radio-group"),H=p("el-pagination"),Q=p("el-input-number"),W=p("el-dialog"),G=se("loading");return V(),N("div",ue,[r("div",de,[l(T,{model:n.value,inline:"",class:"cookie-cloud-form"},{default:t(()=>[l(u,{label:"CookieCloud"},{default:t(()=>[l(i,{modelValue:n.value.url,"onUpdate:modelValue":e[0]||(e[0]=a=>n.value.url=a),placeholder:"http://127.0.0.1:8088",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),l(u,{label:"KEY"},{default:t(()=>[l(i,{modelValue:n.value.key,"onUpdate:modelValue":e[1]||(e[1]=a=>n.value.key=a),placeholder:"KEY (UUID)",clearable:"",style:{width:"100px"}},null,8,["modelValue"])]),_:1}),l(u,{label:"端对端密码"},{default:t(()=>[l(i,{modelValue:n.value.e2e_password,"onUpdate:modelValue":e[2]||(e[2]=a=>n.value.e2e_password=a),type:"password","show-password":"",placeholder:"端对端加密密码",clearable:"",style:{width:"125px"}},null,8,["modelValue"])]),_:1}),l(u,null,{default:t(()=>[l(b,{type:"primary",size:"large",onClick:j,loading:h.value},{default:t(()=>[l(L,null,{default:t(()=>[l(S(oe))]),_:1}),e[16]||(e[16]=r("span",null,"同步Cookie",-1))]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),r("div",pe,[l(i,{modelValue:k.value,"onUpdate:modelValue":e[3]||(e[3]=a=>k.value=a),placeholder:"搜索站点昵称/标识/官组",clearable:"","prefix-icon":S(te),class:"search-input"},null,8,["modelValue","prefix-icon"])])]),ae((V(),N("div",ce,[l(Y,{data:F.value,class:"settings-table glass-table",height:"100%"},{default:t(()=>[l(v,{prop:"nickname",label:"站点昵称",width:"150",sortable:""}),l(v,{prop:"site",label:"站点标识",width:"200","show-overflow-tooltip":""}),l(v,{prop:"base_url",label:"基础URL",width:"225","show-overflow-tooltip":""}),l(v,{prop:"group",label:"官组","show-overflow-tooltip":""}),l(v,{label:"限速",width:"200",align:"center"},{default:t(a=>[r("div",me,[a.row.speed_limit==0?(V(),P(C,{key:0,type:"error",size:"small"},{default:t(()=>[...e[17]||(e[17]=[m(" 当前不限速，重启恢复默认限速 ",-1)])]),_:1})):a.row.speed_limit>999?(V(),P(C,{key:1,type:"success",size:"small"},{default:t(()=>[...e[18]||(e[18]=[m(" 不限速 ",-1)])]),_:1})):(V(),P(C,{key:2,type:"primary",size:"small"},{default:t(()=>[m($(a.row.speed_limit)+" MB/s ",1)]),_:2},1024))])]),_:1}),l(v,{label:"Cookie",width:"100",align:"center"},{default:t(a=>[l(C,{type:a.row.has_cookie?"success":"danger"},{default:t(()=>[m($(a.row.has_cookie?"已配置":"未配置"),1)]),_:2},1032,["type"])]),_:1}),l(v,{label:"操作",width:"180",align:"center",fixed:"right"},{default:t(a=>[l(b,{type:"primary",icon:S(ne),link:"",onClick:X=>A(a.row)},{default:t(()=>[...e[19]||(e[19]=[m(" 编辑 ",-1)])]),_:1},8,["icon","onClick"]),l(b,{type:"danger",icon:S(ie),link:"",onClick:X=>K(a.row)},{default:t(()=>[...e[20]||(e[20]=[m(" 删除 ",-1)])]),_:1},8,["icon","onClick"])]),_:1})]),_:1},8,["data"])])),[[G,z.value]]),r("div",ge,[l(q,{modelValue:B.value,"onUpdate:modelValue":e[4]||(e[4]=a=>B.value=a),onChange:O},{default:t(()=>[l(E,{label:"active"},{default:t(()=>[...e[21]||(e[21]=[m("现有站点",-1)])]),_:1}),l(E,{label:"all"},{default:t(()=>[...e[22]||(e[22]=[m("所有站点",-1)])]),_:1})]),_:1},8,["modelValue"]),r("div",ve,[r("div",fe,$(c.value.pageSize)+" 条/页",1),l(H,{"current-page":c.value.currentPage,"onUpdate:currentPage":e[5]||(e[5]=a=>c.value.currentPage=a),"page-size":c.value.pageSize,"onUpdate:pageSize":e[6]||(e[6]=a=>c.value.pageSize=a),total:c.value.total,layout:"total, prev, pager, next, jumper",background:""},null,8,["current-page","page-size","total"])])]),l(W,{modelValue:y.value,"onUpdate:modelValue":e[15]||(e[15]=a=>y.value=a),title:"编辑站点",width:"700px","close-on-click-modal":!1},{footer:t(()=>[r("span",_e,[l(b,{onClick:e[14]||(e[14]=a=>y.value=!1)},{default:t(()=>[...e[28]||(e[28]=[m("取消",-1)])]),_:1}),l(b,{type:"primary",onClick:I,loading:x.value},{default:t(()=>[...e[29]||(e[29]=[m(" 保存 ",-1)])]),_:1},8,["loading"])])]),default:t(()=>[l(T,{model:s.value,ref_key:"siteFormRef",ref:R,"label-width":"140px","label-position":"left"},{default:t(()=>[l(u,{label:"站点标识",prop:"site",required:""},{default:t(()=>[l(i,{modelValue:s.value.site,"onUpdate:modelValue":e[7]||(e[7]=a=>s.value.site=a),placeholder:"例如：pt",disabled:""},null,8,["modelValue"]),e[23]||(e[23]=r("div",{class:"form-tip"},"站点标识不可修改。",-1))]),_:1}),l(u,{label:"站点昵称",prop:"nickname",required:""},{default:t(()=>[l(i,{modelValue:s.value.nickname,"onUpdate:modelValue":e[8]||(e[8]=a=>s.value.nickname=a),placeholder:"例如：PT站"},null,8,["modelValue"])]),_:1}),l(u,{label:"基础URL",prop:"base_url"},{default:t(()=>[l(i,{modelValue:s.value.base_url,"onUpdate:modelValue":e[9]||(e[9]=a=>s.value.base_url=a),placeholder:"例如：pt.com"},null,8,["modelValue"]),e[24]||(e[24]=r("div",{class:"form-tip"},"用于拼接种子详情页链接。",-1))]),_:1}),l(u,{label:"Tracker域名",prop:"special_tracker_domain"},{default:t(()=>[l(i,{modelValue:s.value.special_tracker_domain,"onUpdate:modelValue":e[10]||(e[10]=a=>s.value.special_tracker_domain=a),placeholder:"例如：pt-tracker.com"},null,8,["modelValue"]),e[25]||(e[25]=r("div",{class:"form-tip"}," 如果站点的Tracker域名与主域名的二级域名（则域名去掉前缀后缀部分）不同，请在此填写。 ",-1))]),_:1}),l(u,{label:"关联官组",prop:"group"},{default:t(()=>[l(i,{modelValue:s.value.group,"onUpdate:modelValue":e[11]||(e[11]=a=>s.value.group=a),placeholder:"例如：PT, PTWEB"},null,8,["modelValue"]),e[26]||(e[26]=r("div",{class:"form-tip"},"用于识别种子所属发布组，多个组用英文逗号(,)分隔。",-1))]),_:1}),l(u,{label:"Cookie",prop:"cookie"},{default:t(()=>[l(i,{modelValue:s.value.cookie,"onUpdate:modelValue":e[12]||(e[12]=a=>s.value.cookie=a),type:"textarea",rows:3,placeholder:"从浏览器获取的Cookie字符串"},null,8,["modelValue"])]),_:1}),l(u,{label:"上传限速 (MB/s)",prop:"speed_limit"},{default:t(()=>[l(Q,{modelValue:s.value.speed_limit,"onUpdate:modelValue":e[13]||(e[13]=a=>s.value.speed_limit=a),min:0,max:1e3,placeholder:"为防止失误操作导致超速，当设置为 0 时重启会自动设置为默认限速",style:{width:"100%"}},null,8,["modelValue"]),e[27]||(e[27]=r("div",{class:"form-tip",style:{color:"red","font-size":"14px"}},[m(" 单位为 MB/s，为防止误操作导致超速，当设置为 0 时重启会恢复默认限速"),r("br"),m(" 如缺点设置不限速可输入一个极大的数值，超过 999 会显示不限速 ")],-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},be=Z(ke,[["__scopeId","data-v-e97b6b58"]]);export{be as default};
