import{C as dt,d as Is,r as S,c as O,O as es,o as $s,s as Cs,a as f,k,i as a,e as u,f as B,w as c,F as N,l as M,x as z,T as ks,h as m,m as V,U as ut,V as ct,W as xe,p as Ts,q as Ie,g as x,E as v,X as fe,j as T,n as E,Y as Xe,t as h,J as mt,Z as ws,$ as Pe,a0 as Qe,B as pt,y as vt,a1 as _t,a2 as Ss}from"./index-Cke9XBnk.js";const ft=dt("crossSeed",{state:()=>({taskId:null,sourceInfo:null,workingParams:null}),actions:{setTaskId(ae){this.taskId=ae},clearTaskId(){this.taskId=null},setSourceInfo(ae){this.sourceInfo=ae},clearSourceInfo(){this.sourceInfo=null},setParams(ae){this.workingParams=ae},clearParams(){this.workingParams=null},reset(){this.clearTaskId(),this.clearSourceInfo(),this.clearParams()}}}),gt={key:0,class:"log-progress-overlay"},bt={class:"log-progress-container"},ht={class:"steps-wrapper"},yt={key:0,class:"spinner-icon"},kt={key:1,class:"success-icon"},wt={key:2,class:"error-icon"},St={key:3,class:"warning-icon"},It={key:0,class:"completion-message"},$t=Is({__name:"LogProgress",props:{visible:{type:Boolean},taskId:{}},emits:["complete","close"],setup(ae,{emit:Me}){const j=ae,ge=Me,q=S([{name:"æ•°æ®åº“æŸ¥è¯¢",message:"æ­£åœ¨æ£€æŸ¥ç¼“å­˜...",status:"pending"},{name:"å¼€å§‹æŠ“å–",message:"å‡†å¤‡ä»æºç«™ç‚¹è·å–...",status:"pending"},{name:"è·å–ç§å­ä¿¡æ¯",message:"",status:"pending"},{name:"è§£æå‚æ•°",message:"",status:"pending"},{name:"éªŒè¯å›¾ç‰‡é“¾æ¥",message:"",status:"pending"},{name:"æå–åª’ä½“ä¿¡æ¯",message:"",status:"pending"},{name:"éªŒè¯ç®€ä»‹æ ¼å¼",message:"",status:"pending"},{name:"æ£€æŸ¥å£°æ˜æ„Ÿè°¢",message:"",status:"pending"},{name:"æˆåŠŸè·å–å‚æ•°",message:"",status:"pending"}]),be=S(!1);let J=null;const ve=O(()=>{const $=q.value.findIndex(G=>G.status==="processing");return $!==-1?$:q.value.filter(G=>G.status==="success").length}),he=$=>$.status==="success"?"success":$.status==="error"?"error":$.status==="warning"?"warning":$.status==="processing"?"process":"wait";es(()=>j.taskId,$=>{$&&j.visible&&w()}),es(()=>j.visible,$=>{$&&j.taskId?w():$||L()}),$s(()=>{j.visible&&j.taskId&&w()}),Cs(()=>{L()});const w=()=>{J&&J.close(),be.value=!1,q.value.forEach($=>{$.status="pending",$.message=$.name==="æ•°æ®åº“æŸ¥è¯¢"?"æ­£åœ¨æ£€æŸ¥ç¼“å­˜...":$.name==="å¼€å§‹æŠ“å–"?"å‡†å¤‡ä»æºç«™ç‚¹è·å–...":""}),J=new EventSource(`/api/migrate/logs/stream/${j.taskId}`),J.onmessage=$=>{try{const R=JSON.parse($.data);R.type==="connected"?console.log("SSE è¿æ¥æˆåŠŸ",R):R.type==="log"?Le(R.step,R.message,R.status):R.type==="complete"?(be.value=!0,ge("complete"),L(),ge("close")):R.type}catch(R){console.error("è§£æ SSE æ¶ˆæ¯å¤±è´¥:",R)}},J.onerror=$=>{console.error("SSE è¿æ¥é”™è¯¯:",$),L()}},L=()=>{J&&(J.close(),J=null)},Le=($,R,G)=>{const X=q.value.findIndex(I=>I.name===$);if(X!==-1){const I=q.value[X];if(I.message=R,I.status=G,G==="success"&&X<q.value.length-1){const Y=q.value[X+1];Y.status==="pending"&&(Y.status="processing")}}};return($,R)=>{const G=B("el-icon"),X=B("el-step"),I=B("el-steps");return ae.visible?(m(),f("div",gt,[a("div",bt,[a("div",ht,[u(I,{direction:"vertical",active:ve.value,"finish-status":"success"},{default:c(()=>[(m(!0),f(N,null,M(q.value,(Y,oe)=>(m(),V(X,{key:oe,title:Y.name,description:Y.message,status:he(Y)},{icon:c(()=>[Y.status==="processing"?(m(),f("div",yt,[u(G,{class:"is-loading"},{default:c(()=>[u(z(ut))]),_:1})])):Y.status==="success"?(m(),f("div",kt,[u(G,null,{default:c(()=>[u(z(ks))]),_:1})])):Y.status==="error"?(m(),f("div",wt,[u(G,null,{default:c(()=>[u(z(ct))]),_:1})])):Y.status==="warning"?(m(),f("div",St,[u(G,null,{default:c(()=>[u(z(xe))]),_:1})])):k("",!0)]),_:2},1032,["title","description","status"]))),128))]),_:1},8,["active"]),be.value?(m(),f("div",It,[u(G,{class:"icon-complete",color:"#67C23A"},{default:c(()=>[u(z(ks))]),_:1}),R[0]||(R[0]=a("span",null,"æ‰€æœ‰æ­¥éª¤å·²å®Œæˆ",-1))])):k("",!0)])])])):k("",!0)}}}),Ct=Ts($t,[["__scopeId","data-v-b874a855"]]),Tt={class:"cross-seed-panel"},Et={class:"panel-header"},zt={class:"custom-steps"},Dt={class:"step-icon"},Vt={key:1},Nt={class:"step-title"},Bt={key:0,class:"step-connector"},Rt={class:"panel-content"},At={key:0,class:"step-container details-container"},Pt={class:"main-info-container"},xt={class:"full-width-form-column"},Mt={class:"title-section"},Lt={class:"title-components-grid"},Ut={class:"bottom-info-section"},Ot={class:"subtitle-unrecognized-grid"},jt={class:"subtitle-section",style:{"grid-column":"span 4"}},Ft={class:"standard-params-section"},qt={class:"standard-params-grid"},Gt={class:"standard-params-grid second-row"},Ht={class:"poster-statement-container"},Kt={class:"poster-statement-split"},Wt={class:"left-panel"},Jt={class:"form-label-with-button"},Yt={class:"right-panel"},Zt={class:"poster-preview-section"},Xt={class:"image-preview-container"},Qt=["src","onError"],ea={key:1,class:"preview-placeholder"},sa={class:"screenshot-container"},ta={class:"form-column screenshot-text-column"},aa={class:"form-label-with-button"},la={class:"preview-column screenshot-preview-column"},oa={class:"carousel-container"},na={class:"carousel-image-wrapper"},ia=["src","onError"],ra={key:1,class:"preview-placeholder"},da={class:"form-label-with-button"},ua={class:"form-label-with-button"},ca={class:"mediainfo-container"},ma={key:0,class:"bdinfo-progress-inline"},pa={class:"progress-header"},va={class:"header-buttons"},_a={class:"progress-details-inline"},fa={class:"progress-info-row"},ga={class:"progress-item"},ba={class:"progress-item"},ha={class:"progress-item"},ya={class:"filtered-declarations-container"},ka={class:"filtered-declarations-header"},wa={class:"filtered-declarations-content"},Sa={class:"declaration-header"},Ia={class:"declaration-number"},$a={class:"declaration-content code-font"},Ca={key:1,class:"no-filtered-declarations"},Ta={key:1,class:"step-container publish-preview-container"},Ea={class:"publish-preview-content"},za={class:"preview-row main-title-row"},Da={class:"row-content main-title-content"},Va={class:"preview-row subtitle-row"},Na={class:"row-content subtitle-content"},Ba={class:"preview-row params-row"},Ra={class:"row-content"},Aa={class:"param-row"},Pa={class:"param-item imdb-item half-width"},xa={style:{display:"flex"}},Ma={style:{display:"flex"}},La={style:{display:"flex"}},Ua={class:"param-item tags-item half-width"},Oa={class:"param-value-container"},ja={key:0,class:"param-standard-key"},Fa={class:"params-content"},qa={class:"param-item inline-param"},Ga={class:"param-value-container"},Ha={key:0,class:"param-standard-key"},Ka={class:"param-item inline-param"},Wa={class:"param-value-container"},Ja={key:0,class:"param-standard-key"},Ya={class:"param-item inline-param"},Za={class:"param-value-container"},Xa={key:0,class:"param-standard-key"},Qa={class:"param-item inline-param"},el={class:"param-value-container"},sl={key:0,class:"param-standard-key"},tl={class:"param-item inline-param"},al={class:"param-value-container"},ll={key:0,class:"param-standard-key"},ol={class:"param-item inline-param"},nl={class:"param-value-container"},il={key:0,class:"param-standard-key"},rl={class:"param-item inline-param"},dl={class:"param-value-container"},ul={key:0,class:"param-standard-key"},cl={class:"preview-row mediainfo-row"},ml={class:"row-content mediainfo-content scrollable-content"},pl={class:"mediainfo-pre"},vl={class:"preview-row description-row"},_l={class:"row-content description-content"},fl={class:"description-section"},gl=["innerHTML"],bl={key:0,class:"description-section"},hl={class:"image-gallery"},yl=["src","alt","onError"],kl={class:"description-section"},wl=["innerHTML"],Sl={key:1,class:"description-section"},Il={class:"image-gallery"},$l=["src","alt","onError"],Cl={key:2,class:"step-container site-selection-container"},Tl={class:"select-all-container",style:{"margin-top":"16px"}},El={class:"site-buttons-group"},zl={key:3,class:"step-container results-container"},Dl={key:0,class:"progress-section"},Vl={key:0,class:"progress-item"},Nl={class:"progress-text"},Bl={key:1,class:"progress-item"},Rl={class:"progress-text"},Al={key:2,class:"limit-alert-section"},Pl={class:"limit-alert"},xl={class:"limit-alert-content"},Ml={class:"limit-alert-title"},Ll={class:"limit-alert-message"},Ul={class:"results-rows-container"},Ol={class:"row-sites"},jl={class:"card-icon"},Fl={class:"card-title"},ql={key:0,class:"existed-tag"},Gl={key:1,class:"downloader-status"},Hl={class:"status-icon"},Kl={class:"card-extra"},Wl=["href"],Jl={class:"row-action"},Yl={class:"button-subtitle"},Zl={class:"panel-footer"},Xl={key:0,class:"button-group"},Ql={key:0,class:"check-hint"},eo={key:0,class:"validation-hint"},so={key:1,class:"button-group"},to={key:0,class:"validation-hint"},ao={key:0,class:"validation-hint"},lo={key:2,class:"button-group"},oo={key:3,class:"button-group"},no={class:"card-header"},io={class:"log-content-pre"},ro={class:"error-log-container"},uo={class:"log-timeline"},co={class:"log-entry-header"},mo={class:"log-time"},po={key:0,class:"log-site"},vo={class:"log-text"},_o={key:0,class:"log-entry-details"},fo={class:"code-block"},go={class:"dialog-footer"},bo=Is({__name:"CrossSeedPanel",props:{showCompleteButton:{type:Boolean,default:!1}},emits:["complete","cancel","close-with-refresh"],setup(ae,{emit:Me}){const j=s=>{if(!s)return"";s=s.replace(/[ \t\f\v]+$/gm,""),s=s.replace(/^\s*\n+/,"").replace(/\n\s*$/,""),s=s.replace(/(\n\s*){2,}/g,`

`),s=s.replace(/([^\n]+ã€‚)\s*\n\s*\n(\s*\d+\.)/g,`$1
$2`),s=s.replace(/(\d+\.[\s\S]*?)\n\s*\n(\s*\d+\.)/g,`$1
$2`),s=s.replace(/(\[(?:b|color)[^\]]*\][\s\S]*?)\n\s*\n([\s\S]*?\[\/(?:b|color)\])/gi,`$1
$2`);for(let e=0;e<3;e++)s=s.replace(/(\[(?:quote|b|color|size)[^\]]*\][\s\S]*?)\n\s*\n([\s\S]*?\[\/(?:quote|b|color|size)\])/gi,`$1
$2`);return s=s.replace(/(\n\s*){2,}/g,`

`),s},ge=s=>s?(s=j(s),s=s.replace(/\[quote\]([\s\S]*?)\[\/quote\]/gi,"<blockquote>$1</blockquote>"),s=s.replace(/\[b\]([\s\S]*?)\[\/b\]/gi,"<strong>$1</strong>"),s=s.replace(/\[color=(\w+|\#[0-9a-fA-F]{3,6})\]([\s\S]*?)\[\/color\]/gi,'<span style="color: $1;">$2</span>'),s=s.replace(/\[size=(\d+)\]([\s\S]*?)\[\/size\]/gi,(e,i,n)=>`<span style="font-size: ${{1:"12",2:"14",3:"16",4:"18",5:"24",6:"32",7:"48"}[i]||parseInt(i)*4}px;">${n}</span>`),s=s.replace(/\n/g,"<br>"),s):"",q=s=>{if(!s)return[];const e=s.split(`
`),i=[];let n=null;const d=/^\[(.*?)\]\s+(\d{2}:\d{2}:\d{2})\s+-\s+([A-Z]+)\s+-\s+(.*)$/;return e.forEach((l,o)=>{const _=l.trimEnd();if(!_)return;const p=_.match(d);p?(n={id:o,site:p[1],time:p[2],level:p[3],message:p[4],details:"",isError:p[3]==="ERROR"||p[3]==="CRITICAL"},n.message.includes("Traceback")&&(n.isError=!0),i.push(n)):n?(n.details+=(n.details?`
`:"")+_,_.trim().startsWith('File "')&&(n.isError=!0)):i.push({id:o,site:"System",time:"",level:"INFO",message:_,details:"",isError:!1})}),i},be=s=>{switch(s){case"SUCCESS":return"success";case"ERROR":return"danger";case"WARNING":return"warning";case"DEBUG":return"info";default:return"primary"}},J=ae,ve=Me,he=ft(),w=O(()=>he.workingParams),L=O(()=>he.sourceInfo?.name||""),Le=()=>({seed_id:null,title_components:[],original_main_title:"",subtitle:"",imdb_link:"",douban_link:"",tmdb_link:"",intro:{statement:"",poster:"",body:"",screenshots:"",removed_ardtudeclarations:[]},mediainfo:"",source_params:{},standardized_params:{type:"",medium:"",video_codec:"",audio_codec:"",resolution:"",team:"",source:"",tags:[]},final_publish_parameters:{},complete_publish_params:{},raw_params_for_preview:{}}),$=s=>{if(!s||typeof s!="string")return[];const e=/\[img\](https?:\/\/[^\s[\]]+)\[\/img\]/gi;return[...s.matchAll(e)].map(n=>n[1])},R=S(new Map),G=s=>R.value.has(s)?R.value.get(s):(R.value.set(s,s),s),X=(s,e,i)=>{const n=R.value.get(s);if(n&&!n.startsWith("http://pt-nexus-proxy.sqing33.dpdns.org/")){const d=`http://pt-nexus-proxy.sqing33.dpdns.org/${s}`;R.value.set(s,d),document.querySelectorAll(`img[src="${n}"]`).forEach(o=>{o.setAttribute("src",d)}),console.log(`å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œå°è¯•ä½¿ç”¨ä»£ç†URL: ${d}`);return}Ls(s,e,i)},I=S(0),Y=S("main"),oe=S(!1),ue=S({current:0,total:0}),ce=S({current:0,total:0}),ye=S({visible:!1,title:"",message:""}),$e=((s,e)=>{let i;return function(...d){const l=()=>{clearTimeout(i),s(...d)};clearTimeout(i),i=setTimeout(l,e)}})(()=>{const s=document.querySelector(".panel-content");if(s){const{scrollTop:e,scrollHeight:i,clientHeight:n}=s;oe.value=e+n>=i-5}},100),ss=()=>{const s=document.querySelector(".panel-content");s&&s.addEventListener("scroll",$e)},Es=()=>{const s=document.querySelector(".panel-content");s&&s.removeEventListener("scroll",$e)};$s(()=>{Us(),Os(),Ie(()=>{I.value===1&&(ss(),$e())})}),es(I,(s,e)=>{e===1&&Es(),s===1&&Ie(()=>{ss(),$e()})});const Ue=[{title:"æ ¸å¯¹ç§å­è¯¦æƒ…"},{title:"å‘å¸ƒå‚æ•°é¢„è§ˆ"},{title:"é€‰æ‹©å‘å¸ƒç«™ç‚¹"},{title:"å®Œæˆå‘å¸ƒ"}],me=S([]),Z=S([]),F=S(!1),t=S(Le()),Q=S(null),re=S([]),Oe=S(!1),Ce=S(!1),je=S(!1),Te=S(!1),Ee=S(!1),Fe=S(!1),le=S(!0),ee=S(""),ze=S(!1),ts=S([]),ke=S(!1),K=S(null),H=S({visible:!1,percent:0,currentFile:"",elapsedTime:"",remainingTime:""}),zs=S(""),as=S(0),Ds=s=>{if(!s)return"";const e=["B","KB","MB","GB","TB"];let i=s,n=0;for(;i>=1024&&n<e.length-1;)i/=1024,n++;return`${i.toFixed(2)} ${e[n]}`},se=S(!1),ne=S([]),De=S(!1),ls=S(""),A=S({type:{},medium:{},video_codec:{},audio_codec:{},resolution:{},source:{},team:{},tags:{}}),Ve=O(()=>$(t.value.intro.poster)),we=O(()=>$(t.value.intro.screenshots)),os=O(()=>{const s=t.value.intro.removed_ardtudeclarations;return Array.isArray(s)?s:[]}),ns=O(()=>os.value.length),qe=s=>{const e=me.value.find(i=>i.name===s);if(!e||!e.has_cookie||(s==="æœæ¯”"||s==="HDtime")&&!e.has_passkey||w.value?.sites?.[s])return!1;if(s.toLowerCase()==="ubits"){const i=t.value.standardized_params.team,n=t.value.title_components;if(i&&["cmct","cmctv"].includes(i.toLowerCase()))return!1;const d=n.find(l=>l.key==="åˆ¶ä½œç»„");if(d&&d.value){const l=d.value.toLowerCase(),o=["cmct","cmctv","telesto","shadow610"];for(const _ of o)if(l.includes(_))return!1}}return!0},Vs=s=>Z.value.includes(s.name)?"success":!s.has_cookie||(s.name==="æœæ¯”"||s.name==="HDtime")&&!s.has_passkey?"danger":"default",Ns=async()=>{je.value=!0,v.info({title:"æ­£åœ¨é‡æ–°è·å–",message:"æ­£åœ¨ä»è±†ç“£/IMDb/TMDbé‡æ–°è·å–ç®€ä»‹...",duration:0});const s={type:"intro",content_name:t.value.original_main_title,source_info:{main_title:t.value.original_main_title,subtitle:t.value.subtitle,source_site:L.value,imdb_link:t.value.imdb_link,douban_link:t.value.douban_link,tmdb_link:t.value.tmdb_link}};try{const e=await x.post("/api/media/validate",s);v.closeAll(),e.data.success&&e.data.intro?(t.value.intro.body=j(e.data.intro),e.data.extracted_imdb_link&&!t.value.imdb_link&&(t.value.imdb_link=e.data.extracted_imdb_link),e.data.extracted_douban_link&&!t.value.douban_link&&(t.value.douban_link=e.data.extracted_douban_link),e.data.extracted_tmdb_link&&!t.value.tmdb_link&&(t.value.tmdb_link=e.data.extracted_tmdb_link),v.success({title:"é‡æ–°è·å–æˆåŠŸ",message:"å·²æˆåŠŸä»è±†ç“£/IMDb/TMDbè·å–å¹¶æ›´æ–°äº†ç®€ä»‹å†…å®¹ã€‚"})):v.error({title:"é‡æ–°è·å–å¤±è´¥",message:e.data.error||"æ— æ³•ä»è±†ç“£/IMDb/TMDbè·å–ç®€ä»‹ã€‚"})}catch(e){v.closeAll();const i=e.response?.data?.error||"æœªèƒ½é‡æ–°è·å–ç®€ä»‹";v.error({title:"æ“ä½œå¤±è´¥",message:i})}finally{je.value=!1}},Bs=async()=>{if(!t.value.original_main_title){v.warning("æ ‡é¢˜ä¸ºç©ºï¼Œæ— æ³•é‡æ–°è·å–æˆªå›¾ã€‚");return}if(Ce.value){v.info({title:"æ­£åœ¨å¤„ç†ä¸­",message:"æˆªå›¾é‡æ–°ç”Ÿæˆè¯·æ±‚å·²åœ¨å¤„ç†ä¸­ï¼Œè¯·ç¨å€™..."});return}Ce.value=!0,v.info({title:"æ­£åœ¨é‡æ–°è·å–",message:"æ­£åœ¨ä»è§†é¢‘é‡æ–°ç”Ÿæˆæˆªå›¾...",duration:0});const s={type:"screenshot",content_name:t.value.original_main_title,source_info:{main_title:t.value.original_main_title,source_site:L.value,imdb_link:t.value.imdb_link,douban_link:t.value.douban_link,tmdb_link:t.value.tmdb_link},savePath:w.value.save_path,torrentName:w.value.name,downloaderId:w.value.downloaderId};try{const e=await x.post("/api/media/validate",s);v.closeAll(),e.data.success&&e.data.screenshots?(t.value.intro.screenshots=e.data.screenshots,le.value=!0,v.success({title:"é‡æ–°è·å–æˆåŠŸ",message:"å·²æˆåŠŸç”Ÿæˆå¹¶åŠ è½½äº†æ–°çš„æˆªå›¾ã€‚"})):(le.value=!1,v.error({title:"é‡æ–°è·å–å¤±è´¥",message:e.data.error||"æ— æ³•ä»åç«¯è·å–æ–°çš„æˆªå›¾ï¼Œè¯·æŸ¥çœ‹åå°æ—¥å¿—ã€‚"}))}catch(e){v.closeAll();const i=e.response?.data?.error||"æœªèƒ½é‡æ–°è·å–æˆªå›¾ï¼Œè¯·æŸ¥çœ‹åå°æ—¥å¿—ã€‚";v.error({title:"æ“ä½œå¤±è´¥",message:i}),le.value=!1}finally{Ce.value=!1}},Rs=async()=>{if(Te.value){v.info({title:"æ­£åœ¨å¤„ç†ä¸­",message:"åª’ä½“ä¿¡æ¯é‡æ–°è·å–è¯·æ±‚å·²åœ¨å¤„ç†ä¸­ï¼Œè¯·ç¨å€™..."});return}Te.value=!0,v.info({title:"æ­£åœ¨é‡æ–°è·å–",message:"æ­£åœ¨ä»è§†é¢‘é‡æ–°ç”Ÿæˆåª’ä½“ä¿¡æ¯...",duration:0});try{const s=await x.post("/api/migrate/refresh_mediainfo_async",{seed_id:t.value.seed_id,save_path:w.value.save_path,content_name:t.value.original_main_title,downloader_id:w.value.downloaderId,torrent_name:w.value.name,current_mediainfo:t.value.mediainfo,force_refresh:!0,priority:1});v.closeAll(),s.data.success?(s.data.mediainfo&&(t.value.mediainfo=s.data.mediainfo),s.data.bdinfo_async&&s.data.bdinfo_async.bdinfo_status==="processing"?(v.info({title:"BDInfo å¤„ç†ä¸­",message:"BDInfo æ­£åœ¨åå°å¤„ç†ä¸­ï¼Œå®Œæˆåå°†è‡ªåŠ¨æ›´æ–°...",duration:5e3}),Ne()):s.data.mediainfo?v.success({title:"é‡æ–°è·å–æˆåŠŸ",message:s.data.message||"å·²æˆåŠŸç”Ÿæˆå¹¶åŠ è½½äº†æ–°çš„åª’ä½“ä¿¡æ¯ã€‚"}):v.info({title:"ä»»åŠ¡å·²å¯åŠ¨",message:s.data.message||"BDInfo æ­£åœ¨åå°å¤„ç†ä¸­..."})):v.error({title:"é‡æ–°è·å–å¤±è´¥",message:s.data.message||"æ— æ³•ä»åç«¯è·å–æ–°çš„åª’ä½“ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹åå°æ—¥å¿—ã€‚"})}catch(s){v.closeAll();const e=s.response?.data?.message||s.response?.data?.error||"æœªèƒ½é‡æ–°è·å–åª’ä½“ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹åå°æ—¥å¿—ã€‚";v.error({title:"æ“ä½œå¤±è´¥",message:e})}finally{Te.value=!1}},is=async(s,e=!1)=>{const i=e?5:3,n=e?2e3:1e3;for(let d=1;d<=i;d++){try{const l=await x.get(`/api/migrate/bdinfo_status/${s}`);console.log(`BDInfo çŠ¶æ€ API å“åº” (å°è¯• ${d}/${i}):`,l.data);const o=l.data;if(o&&!o.error){const _=o.mediainfo_status||o.task_status?.status;if(_==="processing_bdinfo"||_==="queued"){console.log(`æ£€æµ‹åˆ° BDInfo ä»»åŠ¡æ­£åœ¨è¿›è¡Œä¸­: ${_}`),console.log("ä»»åŠ¡ ID:",o.bdinfo_task_id),console.log("è¿›åº¦ä¿¡æ¯:",o.progress_info),Ne(),zs.value=_;return}else if(_==="completed"||_==="failed"){console.log(`BDInfo ä»»åŠ¡å·²ç»“æŸ: ${_}ï¼Œæ— éœ€å¯åŠ¨è¿›åº¦æ˜¾ç¤º`);return}else console.log(`BDInfo ä»»åŠ¡çŠ¶æ€: ${_}ï¼Œå°è¯• ${d}/${i}`)}else console.warn("BDInfo çŠ¶æ€ API è¿”å›é”™è¯¯:",o?.error)}catch(l){if(l.response){const o=l.response.status;console.warn(o===404?`ç§å­è®°å½•ä¸å­˜åœ¨: ${s} (å°è¯• ${d}/${i})`:o===500?"æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œæ£€æŸ¥ BDInfo çŠ¶æ€å¤±è´¥":`HTTP ${o}: æ£€æŸ¥ BDInfo çŠ¶æ€å¤±è´¥`)}else l.request?console.warn("ç½‘ç»œè¿æ¥é—®é¢˜ï¼Œæ— æ³•æ£€æŸ¥ BDInfo çŠ¶æ€"):console.warn("æ£€æŸ¥ BDInfo çŠ¶æ€å¤±è´¥:",l.message)}d<i&&(console.log(`ç­‰å¾… ${n}ms åé‡è¯•æ£€æŸ¥ BDInfo çŠ¶æ€...`),await new Promise(l=>setTimeout(l,n)))}console.warn(`ç»è¿‡ ${i} æ¬¡å°è¯•ï¼Œæœªèƒ½æ£€æµ‹åˆ° BDInfo ä»»åŠ¡`)},Ne=()=>{if(console.log("å¯åŠ¨ BDInfo SSE è¿æ¥..."),!t.value?.seed_id){console.error("seed_id æœªè®¾ç½®ï¼Œæ— æ³•å»ºç«‹ SSE è¿æ¥"),v.error({title:"è¿æ¥é”™è¯¯",message:"ç§å­IDæœªè®¾ç½®ï¼Œæ— æ³•å»ºç«‹è¿›åº¦è¿æ¥"});return}console.log(`ä½¿ç”¨ seed_id å»ºç«‹ SSE è¿æ¥: ${t.value.seed_id}`),Se(!1),H.value={visible:!0,percent:0,currentFile:"æ­£åœ¨è¿æ¥...",elapsedTime:"",remainingTime:""};const s=`/api/migrate/bdinfo_sse/${t.value.seed_id}`;console.log(`SSE è¿æ¥ URL: ${s}`),K.value=new EventSource(s);let e=setTimeout(()=>{K.value?.readyState===EventSource.CONNECTING&&(console.warn("SSE è¿æ¥è¶…æ—¶ï¼Œå°è¯•é‡æ–°è¿æ¥"),K.value?.close(),H.value.visible&&setTimeout(()=>{console.log("å°è¯•é‡æ–°å»ºç«‹ SSE è¿æ¥..."),Ne()},2e3))},5e3);K.value.onopen=()=>{console.log("BDInfo SSEè¿æ¥å·²å»ºç«‹"),e&&(clearTimeout(e),e=null),As()},K.value.onmessage=i=>{try{const n=JSON.parse(i.data);switch(n.type){case"connected":console.log("SSEè¿æ¥æˆåŠŸ:",n.connection_id);break;case"progress_update":const{progress_percent:d,current_file:l,elapsed_time:o,remaining_time:_,disc_size:p}=n.data;H.value={visible:!0,percent:Math.round(d),currentFile:l,elapsedTime:o,remainingTime:_},p&&(as.value=p),console.log(`BDInfo è¿›åº¦: ${d}%`);break;case"completion":t.value.mediainfo=n.data.mediainfo,v.success({title:"BDInfo è·å–å®Œæˆ",message:"BDInfo å·²æˆåŠŸè·å–å¹¶æ›´æ–°"}),H.value.visible=!1,Se(!1);break;case"error":v.warning({title:"BDInfo è·å–å¤±è´¥",message:n.data.error||"BDInfo è·å–å¤±è´¥ï¼Œå¯æ‰‹åŠ¨é‡è¯•"}),H.value.visible=!1,Se(!1);break;case"heartbeat":return;default:console.log("æœªçŸ¥SSEæ¶ˆæ¯ç±»å‹:",n.type)}}catch(n){console.error("è§£æSSEæ¶ˆæ¯å¤±è´¥:",n)}},K.value.onerror=i=>{console.error("SSEè¿æ¥é”™è¯¯:",i),e&&(clearTimeout(e),e=null);const n=K.value?.readyState;console.log(`SSE è¿æ¥çŠ¶æ€: ${n} (0=CONNECTING, 1=OPEN, 2=CLOSED)`),n===EventSource.CONNECTING||n===EventSource.CLOSED?H.value.visible&&(console.log("å°è¯•é‡æ–°å»ºç«‹ SSE è¿æ¥..."),H.value.currentFile="è¿æ¥ä¸­æ–­ï¼Œæ­£åœ¨é‡è¿...",setTimeout(()=>{H.value.visible&&Ne()},2e3)):(v.error({title:"è¿æ¥é”™è¯¯",message:"BDInfo è¿›åº¦æ›´æ–°è¿æ¥ä¸­æ–­ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•"}),H.value.visible=!1,Se(!1))}},Se=(s=!0)=>{K.value&&(K.value.close(),K.value=null),H.value.visible=!1,(s===!0||typeof s=="object"&&s)&&v.info({title:"å·²å–æ¶ˆ",message:"BDInfo è·å–å·²å–æ¶ˆ"})},As=async()=>{if(!t.value?.seed_id){console.warn("seed_id æœªè®¾ç½®ï¼Œæ— æ³•è¯·æ±‚å½“å‰è¿›åº¦");return}try{console.log("è¯·æ±‚å½“å‰ BDInfo è¿›åº¦çŠ¶æ€...");const s=await x.get(`/api/migrate/bdinfo_status/${t.value.seed_id}`);if(s.data&&s.data.task_status){const e=s.data.task_status;console.log("è·å–åˆ°å½“å‰è¿›åº¦çŠ¶æ€:",e),e.status==="processing_bdinfo"&&(H.value={visible:!0,percent:Math.round(e.progress_percent||0),currentFile:e.current_file||"å¤„ç†ä¸­...",elapsedTime:e.elapsed_time||"",remainingTime:e.remaining_time||""},console.log(`æ›´æ–°è¿›åº¦æ˜¾ç¤º: ${e.progress_percent||0}%`))}}catch(s){console.error("è¯·æ±‚å½“å‰è¿›åº¦å¤±è´¥:",s)}},Ps=()=>{K.value&&(K.value.close(),K.value=null),He()};Cs(()=>{K.value&&(K.value.close(),K.value=null)});const xs=async()=>{if(!t.value.original_main_title){v.warning("æ ‡é¢˜ä¸ºç©ºï¼Œæ— æ³•é‡æ–°è·å–æµ·æŠ¥ã€‚");return}if(Ee.value){v.info({title:"æ­£åœ¨å¤„ç†ä¸­",message:"æµ·æŠ¥é‡æ–°è·å–è¯·æ±‚å·²åœ¨å¤„ç†ä¸­ï¼Œè¯·ç¨å€™..."});return}Ee.value=!0,v.info({title:"æ­£åœ¨é‡æ–°è·å–",message:"æ­£åœ¨é‡æ–°ç”Ÿæˆæµ·æŠ¥...",duration:0});const s={type:"poster",content_name:t.value.original_main_title,source_info:{main_title:t.value.original_main_title,source_site:L.value,imdb_link:t.value.imdb_link,douban_link:t.value.douban_link,tmdb_link:t.value.tmdb_link},savePath:w.value.save_path,torrentName:w.value.name,downloaderId:w.value.downloaderId};try{const e=await x.post("/api/media/validate",s);v.closeAll(),e.data.success&&e.data.posters?(t.value.intro.poster=e.data.posters,e.data.extracted_imdb_link&&!t.value.imdb_link&&(t.value.imdb_link=e.data.extracted_imdb_link),e.data.extracted_douban_link&&!t.value.douban_link&&(t.value.douban_link=e.data.extracted_douban_link),e.data.extracted_tmdb_link&&!t.value.tmdb_link&&(t.value.tmdb_link=e.data.extracted_tmdb_link),v.success({title:"é‡æ–°è·å–æˆåŠŸ",message:"å·²æˆåŠŸç”Ÿæˆå¹¶åŠ è½½äº†æ–°çš„æµ·æŠ¥ã€‚"})):v.error({title:"é‡æ–°è·å–å¤±è´¥",message:e.data.error||"æ— æ³•ä»åç«¯è·å–æ–°çš„æµ·æŠ¥ï¼Œè¯·æŸ¥çœ‹åå°æ—¥å¿—ã€‚"})}catch(e){v.closeAll();const i=e.response?.data?.error||"æœªèƒ½é‡æ–°è·å–æµ·æŠ¥ï¼Œè¯·æŸ¥çœ‹åå°æ—¥å¿—ã€‚";v.error({title:"æ“ä½œå¤±è´¥",message:i})}finally{Ee.value=!1}},Ms=async()=>{if(!t.value.original_main_title){v.warning("æ ‡é¢˜ä¸ºç©ºï¼Œæ— æ³•è§£æã€‚");return}Oe.value=!0;try{const s=await x.post("/api/utils/parse_title",{title:t.value.original_main_title,mediainfo:t.value.mediainfo||""});s.data.success?(t.value.title_components=s.data.components,v.success("æ ‡é¢˜å·²é‡æ–°è§£æï¼")):v.error(s.data.message||"è§£æå¤±è´¥")}catch(s){Ke(s,"æœªèƒ½é‡æ–°è§£ææ ‡é¢˜ï¼Œè¯·æŸ¥çœ‹åå°æ—¥å¿—ã€‚")}finally{Oe.value=!1}},Ls=async(s,e,i)=>{if(s&&s.includes("pixhost.to")){console.log(`æ£€æµ‹åˆ° pixhost.to å›¾ç‰‡ï¼Œè·³è¿‡æœ‰æ•ˆæ€§æ£€æµ‹: ${s}`);return}if(e==="screenshot"&&Fe.value){console.log(`æˆªå›¾é”™è¯¯å·²æ­£åœ¨å¤„ç†ä¸­ï¼Œè·³è¿‡é‡å¤è¯·æ±‚: ${s}`);return}console.error(`å›¾ç‰‡åŠ è½½å¤±è´¥: ç±»å‹=${e}, URL=${s}, ç´¢å¼•=${i}`),e==="screenshot"?(Fe.value=!0,le.value=!1,v.warning({title:"æˆªå›¾å¤±æ•ˆ",message:"æ£€æµ‹åˆ°æˆªå›¾é“¾æ¥å¤±æ•ˆï¼Œæ­£åœ¨å°è¯•ä»è§†é¢‘é‡æ–°ç”Ÿæˆ..."})):e==="poster"&&v.warning({title:"æµ·æŠ¥å¤±æ•ˆ",message:"æ£€æµ‹åˆ°æµ·æŠ¥é“¾æ¥å¤±æ•ˆï¼Œæ­£åœ¨å°è¯•é‡æ–°è·å–..."});const n={type:e,content_name:t.value.original_main_title,source_info:{main_title:t.value.original_main_title,source_site:L.value,imdb_link:t.value.imdb_link,douban_link:t.value.douban_link,tmdb_link:t.value.tmdb_link},savePath:w.value.save_path,torrentName:w.value.name,downloaderId:w.value.downloaderId};try{const d=await x.post("/api/media/validate",n);d.data.success?e==="screenshot"&&d.data.screenshots?(t.value.intro.screenshots=d.data.screenshots,le.value=!0,v.success({title:"æˆªå›¾å·²æ›´æ–°",message:"å·²æˆåŠŸç”Ÿæˆå¹¶åŠ è½½äº†æ–°çš„æˆªå›¾ã€‚"})):e==="poster"&&d.data.posters&&(t.value.intro.poster=d.data.posters,v.success({title:"æµ·æŠ¥å·²æ›´æ–°",message:"å·²æˆåŠŸç”Ÿæˆå¹¶åŠ è½½äº†æ–°çš„æµ·æŠ¥ã€‚"})):(e==="screenshot"&&(le.value=!1),v.error({title:"æ›´æ–°å¤±è´¥",message:d.data.error||`æ— æ³•ä»åç«¯è·å–æ–°çš„${e==="poster"?"æµ·æŠ¥":"æˆªå›¾"}ã€‚`}))}catch(d){const l=d.response?.data?.error||`å‘é€å¤±æ•ˆ${e==="poster"?"æµ·æŠ¥":"æˆªå›¾"}ä¿¡æ¯è¯·æ±‚æ—¶å‘ç”Ÿé”™è¯¯ï¼Œè¯·æŸ¥çœ‹åå°æ—¥å¿—ã€‚`;console.error("å‘é€å¤±æ•ˆå›¾ç‰‡ä¿¡æ¯è¯·æ±‚æ—¶å‘ç”Ÿé”™è¯¯:",d),v.error({title:"æ“ä½œå¤±è´¥",message:l})}finally{e==="screenshot"&&(Fe.value=!1)}},Ge=async s=>{const e=me.value.find(i=>i.name===s);if(e?.site)return e.site;try{const i=await x.get("/api/sites/status");me.value=i.data;const n=me.value.find(d=>d.name===s);if(n?.site)return n.site}catch(i){console.warn("è·å–ç«™ç‚¹çŠ¶æ€å¤±è´¥:",i)}return s.toLowerCase()},Us=async()=>{try{const s=await x.get("/api/sites/status");me.value=s.data;const e=await x.get("/api/downloaders_list");ts.value=e.data}catch{v.error({title:"é”™è¯¯",message:"æ— æ³•ä»æœåŠ¡å™¨è·å–ç«™ç‚¹çŠ¶æ€åˆ—è¡¨æˆ–ä¸‹è½½å™¨åˆ—è¡¨"})}},Os=async()=>{if(!L.value||!w.value)return;const s=w.value.sites[L.value];let e=s.torrentId||null;if(!e){const d=s.comment?.match(/id=(\d+)/);if(!d||!d[1]){v.error(`æ— æ³•ä»æºç«™ç‚¹ ${L.value} çš„é“¾æ¥ä¸­æå–ç§å­IDã€‚`),ve("cancel");return}e=d[1]}F.value=!0;const i=`fetch_${e}_${Date.now()}`;ls.value=i,De.value=!0;let n=null;try{const d=await Ge(L.value);console.log(`å°è¯•ä»æ•°æ®åº“è¯»å–ç§å­ä¿¡æ¯: ${e} from ${L.value} (${d})`);const l=await x.get("/api/migrate/get_db_seed_info",{params:{torrent_id:e,site_name:d,task_id:i},timeout:12e4});if(l.status===202&&l.data.should_fetch){console.log("æ•°æ®åº“ä¸­æ²¡æœ‰ç¼“å­˜ï¼Œç»§ç»­ä½¿ç”¨åŒä¸€æ—¥å¿—æµä»æºç«™ç‚¹æŠ“å–...");const o=l.data.task_id||i;try{const _=await x.post("/api/migrate/fetch_and_store",{sourceSite:L.value,searchTerm:e,savePath:w.value.save_path,torrentName:w.value.name,downloaderId:w.value.downloaderId,task_id:o},{timeout:12e4});if(!_.data.success){v.closeAll();const D=_.data.message||"ä»æºç«™ç‚¹æŠ“å–å¤±è´¥";ne.value=q(D),se.value=!0,F.value=!1;return}const p=await x.get("/api/migrate/get_db_seed_info",{params:{torrent_id:e,site_name:d},timeout:12e4});if(!p.data.success){v.closeAll();const D="æ•°æ®æŠ“å–æˆåŠŸä½†ä»æ•°æ®åº“è¯»å–å¤±è´¥";ne.value=q(D),se.value=!0,F.value=!1;return}v.closeAll(),v.success({title:"æŠ“å–æˆåŠŸ",message:"ç§å­ä¿¡æ¯å·²æˆåŠŸæŠ“å–å¹¶å­˜å‚¨åˆ°æ•°æ®åº“ï¼Œè¯·æ ¸å¯¹ã€‚"});const b=p.data.data;p.data.reverse_mappings&&(A.value=p.data.reverse_mappings);const y=`${b.hash||e}_${e}_${d}`;t.value={seed_id:y,original_main_title:b.title||"",title_components:b.title_components||[],subtitle:b.subtitle,imdb_link:b.imdb_link,douban_link:b.douban_link,tmdb_link:b.tmdb_link,intro:{statement:j(b.statement)||"",poster:b.poster||"",body:j(b.body)||"",screenshots:b.screenshots||"",removed_ardtudeclarations:b.removed_ardtudeclarations||[]},mediainfo:b.mediainfo||"",source_params:b.source_params||{},standardized_params:{type:b.type||"",medium:b.medium||"",video_codec:b.video_codec||"",audio_codec:b.audio_codec||"",resolution:b.resolution||"",team:b.team||"",source:b.source||"",tags:(b.tags||[]).sort((D,P)=>{const U=["ç¦è½¬","tag.ç¦è½¬","é™è½¬","tag.é™è½¬","åˆ†é›†","tag.åˆ†é›†"],de=U.includes(D),ie=U.includes(P);return de===ie?0:de?-1:1})},final_publish_parameters:b.final_publish_parameters||{},complete_publish_params:b.complete_publish_params||{},raw_params_for_preview:b.raw_params_for_preview||{}},Q.value=_.data.task_id,ke.value=!0,I.value=0,is(y,!0),Ie(()=>{Ye()}),F.value=!1;return}catch(_){v.closeAll(),Ke(_,"ä»æºç«™ç‚¹æŠ“å–æ—¶å‘ç”Ÿé”™è¯¯ï¼Œè¯·æŸ¥çœ‹åå°æ—¥å¿—ã€‚"),F.value=!1;return}}else if(l.data.success){v.closeAll(),v.success({title:"è¯»å–æˆåŠŸ",message:"ç§å­ä¿¡æ¯å·²ä»æ•°æ®åº“æˆåŠŸåŠ è½½ï¼Œè¯·æ ¸å¯¹ã€‚"});const o=l.data.data;if(!o||!o.title)throw new Error("æ•°æ®åº“è¿”å›çš„ç§å­ä¿¡æ¯ä¸å®Œæ•´");l.data.reverse_mappings?(A.value=l.data.reverse_mappings,console.log("æˆåŠŸåŠ è½½åå‘æ˜ å°„è¡¨:",A.value),console.log("typeæ˜ å°„æ•°é‡:",Object.keys(A.value.type||{}).length),console.log("å½“å‰standardized_params:",o.standardized_params)):console.warn("åç«¯æœªè¿”å›åå‘æ˜ å°„è¡¨ï¼Œå°†ä½¿ç”¨ç©ºçš„é»˜è®¤æ˜ å°„");const _=`${o.hash||e}_${e}_${d}`;if(t.value={seed_id:_,original_main_title:o.title||"",title_components:o.title_components||[],subtitle:o.subtitle,imdb_link:o.imdb_link,douban_link:o.douban_link,tmdb_link:o.tmdb_link,intro:{statement:j(o.statement)||"",poster:o.poster||"",body:j(o.body)||"",screenshots:o.screenshots||"",removed_ardtudeclarations:o.removed_ardtudeclarations||[]},mediainfo:o.mediainfo||"",source_params:o.source_params||{},standardized_params:{type:o.type||"",medium:o.medium||"",video_codec:o.video_codec||"",audio_codec:o.audio_codec||"",resolution:o.resolution||"",team:o.team||"",source:o.source||"",tags:(o.tags||[]).sort((p,b)=>{const y=["ç¦è½¬","tag.ç¦è½¬","é™è½¬","tag.é™è½¬","åˆ†é›†","tag.åˆ†é›†"],D=y.includes(p),P=y.includes(b);return D===P?0:D?-1:1})},final_publish_parameters:o.final_publish_parameters||{},complete_publish_params:o.complete_publish_params||{},raw_params_for_preview:o.raw_params_for_preview||{}},(!o.title_components||o.title_components.length===0)&&o.title)try{const p=await x.post("/api/utils/parse_title",{title:o.title});p.data.success&&(t.value.title_components=p.data.components,v.info({title:"æ ‡é¢˜è§£æ",message:"å·²è‡ªåŠ¨è§£æä¸»æ ‡é¢˜ä¸ºç»„ä»¶ä¿¡æ¯ã€‚"}))}catch(p){console.warn("è‡ªåŠ¨è§£ææ ‡é¢˜å¤±è´¥:",p)}if(console.log("è®¾ç½®torrentData.standardized_params:",t.value.standardized_params),console.log("æ£€æŸ¥ç»‘å®š - type:",t.value.standardized_params.type),console.log("æ£€æŸ¥ç»‘å®š - medium:",t.value.standardized_params.medium),l.data.task_id?(Q.value=l.data.task_id,v.success({title:"ç¼“å­˜å‡†å¤‡å®Œæˆ",message:"å‘å¸ƒä»»åŠ¡å·²å‡†å¤‡å°±ç»ª"})):(Q.value=`db_${e}_${d}`,console.warn("åç«¯æœªè¿”å›taskIdï¼Œä½¿ç”¨æ ‡è¯†ç¬¦")),ke.value=!0,is(_,!1),(!t.value.imdb_link||!t.value.douban_link)&&t.value.intro.body){let p=!1,b=!1;if(!t.value.imdb_link){const y=/(https?:\/\/www\.imdb\.com\/title\/tt\d+)/,D=t.value.intro.body.match(y);D&&D[1]&&(t.value.imdb_link=D[1],p=!0)}if(!t.value.douban_link){const y=/(https:\/\/movie\.douban\.com\/subject\/\d+)/,D=t.value.intro.body.match(y);D&&D[1]&&(t.value.douban_link=D[1],b=!0)}if(p||b){const y=[];p&&y.push("IMDbé“¾æ¥"),b&&y.push("è±†ç“£é“¾æ¥"),v.info({title:"è‡ªåŠ¨å¡«å……",message:`å·²ä»ç®€ä»‹æ­£æ–‡ä¸­è‡ªåŠ¨æå–å¹¶å¡«å…… ${y.join(" å’Œ ")}ã€‚`})}}I.value=0,Ie(()=>{Ye()}),ke.value=!0,F.value=!1;return}else console.log("æ•°æ®åº“ä¸­æ²¡æœ‰æ‰¾åˆ°ç§å­ä¿¡æ¯ï¼Œå¼€å§‹æŠ“å–æ•°æ®...")}catch(d){n=d,console.log("ä»æ•°æ®åº“è¯»å–å¤±è´¥ï¼Œå¼€å§‹æŠ“å–æ•°æ®...",d),d.code==="ECONNABORTED"||d.message.includes("timeout")?console.warn("æ•°æ®åº“è¯»å–è¶…æ—¶ï¼Œå°†å°è¯•ç›´æ¥æŠ“å–æ•°æ®..."):d.response?.status>=500?console.warn("æ•°æ®åº“æœåŠ¡å™¨é”™è¯¯ï¼Œå°†å°è¯•ç›´æ¥æŠ“å–æ•°æ®..."):console.warn("æ•°æ®åº“è¯»å–å‘ç”ŸæœªçŸ¥é”™è¯¯ï¼Œå°†å°è¯•ç›´æ¥æŠ“å–æ•°æ®...")}try{v.closeAll(),v({title:"æ­£åœ¨æŠ“å–",message:"æ­£åœ¨ä»æºç«™ç‚¹æŠ“å–ç§å­ä¿¡æ¯å¹¶å­˜å‚¨åˆ°æ•°æ®åº“...",type:"info",duration:0}),n&&(console.warn(`ç”±äºæ•°æ®åº“è¯»å–å¤±è´¥ï¼ˆ${n.message}ï¼‰ï¼Œæ­£åœ¨ç›´æ¥æŠ“å–æ•°æ®...`),v.warning({title:"æ•°æ®åº“è¯»å–å¤±è´¥",message:"æ­£åœ¨å°è¯•ç›´æ¥æŠ“å–æ•°æ®ï¼Œè¯·ç¨å€™...",duration:3e3}));const d=await x.post("/api/migrate/fetch_and_store",{sourceSite:L.value,searchTerm:e,savePath:w.value.save_path,torrentName:w.value.name,downloaderId:w.value.downloaderId||(w.value.downloaderIds?.length>0?w.value.downloaderIds[0]:null)},{timeout:12e4});if(d.data.success){console.log("æ•°æ®æŠ“å–æˆåŠŸï¼Œç«‹å³ä»æ•°æ®åº“è¯»å–...");let l=0;const o=3;let _=null;for(;l<o;){l++;try{const p=await Ge(L.value);if(console.log(`é‡è¯•ä»æ•°æ®åº“è¯»å–ç§å­ä¿¡æ¯: ${e} from ${L.value} (${p})`),_=await x.get("/api/migrate/get_db_seed_info",{params:{torrent_id:e,site_name:p},timeout:12e4}),_.data.success)break;console.warn(`æ•°æ®åº“è¯»å–ç¬¬${l}æ¬¡å¤±è´¥ï¼š${_.data.message}`),l<o&&await new Promise(b=>setTimeout(b,1e3))}catch(p){if(console.warn(`æ•°æ®åº“è¯»å–ç¬¬${l}æ¬¡å¤±è´¥ï¼š`,p),l<o)await new Promise(b=>setTimeout(b,1e3));else throw p}}if(_&&_.data.success){v.closeAll();const p=_.data.data;if(!p||!p.title)throw new Error("æ•°æ®åº“è¿”å›çš„ç§å­ä¿¡æ¯ä¸å®Œæ•´");_.data.reverse_mappings?(A.value=_.data.reverse_mappings,console.log("æˆåŠŸåŠ è½½åå‘æ˜ å°„è¡¨:",A.value)):console.warn("åç«¯æœªè¿”å›åå‘æ˜ å°„è¡¨ï¼Œå°†ä½¿ç”¨ç©ºçš„é»˜è®¤æ˜ å°„"),v.success({title:"æŠ“å–æˆåŠŸ",message:n?"ç§å­ä¿¡æ¯å·²æˆåŠŸæŠ“å–ï¼Œè¯·æ ¸å¯¹ã€‚ç”±äºæ•°æ®åº“è¯»å–å¤±è´¥ï¼Œæ•°æ®æœªæŒä¹…åŒ–å­˜å‚¨ã€‚":"ç§å­ä¿¡æ¯å·²æˆåŠŸæŠ“å–å¹¶å­˜å‚¨åˆ°æ•°æ®åº“ï¼Œè¯·æ ¸å¯¹ã€‚"});const b=`${p.hash||e}_${e}_${englishSiteName}`;if(t.value={seed_id:b,original_main_title:p.title||"",title_components:p.title_components||[],subtitle:p.subtitle,imdb_link:p.imdb_link,douban_link:p.douban_link,tmdb_link:p.tmdb_link,intro:{statement:j(p.statement)||"",poster:p.poster||"",body:j(p.body)||"",screenshots:p.screenshots||"",removed_ardtudeclarations:p.removed_ardtudeclarations||[]},mediainfo:p.mediainfo||"",source_params:p.source_params||{},standardized_params:{type:p.type||"",medium:p.medium||"",video_codec:p.video_codec||"",audio_codec:p.audio_codec||"",resolution:p.resolution||"",team:p.team||"",source:p.source||"",tags:(p.tags||[]).sort((y,D)=>{const P=["ç¦è½¬","tag.ç¦è½¬","é™è½¬","tag.é™è½¬","åˆ†é›†","tag.åˆ†é›†"],U=P.includes(y),de=P.includes(D);return U===de?0:U?-1:1})},final_publish_parameters:p.final_publish_parameters||{},complete_publish_params:p.complete_publish_params||{},raw_params_for_preview:p.raw_params_for_preview||{}},(!p.title_components||p.title_components.length===0)&&p.title)try{const y=await x.post("/api/utils/parse_title",{title:p.title});y.data.success&&(t.value.title_components=y.data.components,v.info({title:"æ ‡é¢˜è§£æ",message:"å·²è‡ªåŠ¨è§£æä¸»æ ‡é¢˜ä¸ºç»„ä»¶ä¿¡æ¯ã€‚"}))}catch(y){console.warn("è‡ªåŠ¨è§£ææ ‡é¢˜å¤±è´¥:",y)}if(Q.value=d.data.task_id,ke.value=!0,(!t.value.imdb_link||!t.value.douban_link)&&t.value.intro.body){let y=!1,D=!1;if(!t.value.imdb_link){const P=/(https?:\/\/www\.imdb\.com\/title\/tt\d+)/,U=t.value.intro.body.match(P);U&&U[1]&&(t.value.imdb_link=U[1],y=!0)}if(!t.value.douban_link){const P=/(https:\/\/movie\.douban\.com\/subject\/\d+)/,U=t.value.intro.body.match(P);U&&U[1]&&(t.value.douban_link=U[1],D=!0)}if(y||D){const P=[];y&&P.push("IMDbé“¾æ¥"),D&&P.push("è±†ç“£é“¾æ¥"),v.info({title:"è‡ªåŠ¨å¡«å……",message:`å·²ä»ç®€ä»‹æ­£æ–‡ä¸­è‡ªåŠ¨æå–å¹¶å¡«å…… ${P.join(" å’Œ ")}ã€‚`})}}I.value=0,Ie(()=>{Ye()})}else{v.closeAll();const p=`æ•°æ®æŠ“å–æˆåŠŸä½†æ•°æ®åº“è¯»å–å¤±è´¥ï¼Œå·²é‡è¯•${o}æ¬¡ã€‚è¯·æ£€æŸ¥æ•°æ®åº“è¿æ¥æˆ–ç¨åé‡è¯•ã€‚`;ne.value=q(p),se.value=!0,F.value=!1}}else{v.closeAll();const l=d.data.message||"æŠ“å–ç§å­ä¿¡æ¯å¤±è´¥";let o=l;(l.includes("æ•°æ®åº“")||n)&&(o=`${l}ã€‚å¯èƒ½ç”±äºæ•°æ®åº“è¿æ¥é—®é¢˜å¯¼è‡´ï¼Œè¯·æ£€æŸ¥æ•°æ®åº“çŠ¶æ€ã€‚`),ne.value=q(o),se.value=!0,F.value=!1}}catch(d){if(v.closeAll(),d.code==="ECONNABORTED"||d.message.includes("timeout")){const l="æŠ“å–ç§å­ä¿¡æ¯è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åé‡è¯•ã€‚";ne.value=q(l),se.value=!0}else if(d.response?.status===404){const l="åœ¨æºç«™ç‚¹æœªæ‰¾åˆ°æŒ‡å®šçš„ç§å­ï¼Œè¯·æ£€æŸ¥ç§å­IDæ˜¯å¦æ­£ç¡®ã€‚";ne.value=q(l),se.value=!0}else if(d.response?.status>=500){const l="åç«¯æœåŠ¡å™¨å‘ç”Ÿé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•æˆ–è”ç³»ç®¡ç†å‘˜ã€‚";ne.value=q(l),se.value=!0}else{const l=d.message||"è·å–ç§å­ä¿¡æ¯æ—¶å‘ç”Ÿé”™è¯¯ï¼Œè¯·æŸ¥çœ‹åå°æ—¥å¿—ã€‚";ne.value=q(l),se.value=!0}}finally{F.value=!1}},te=O(()=>{const s=t.value.standardized_params,e=["type","medium","video_codec","audio_codec","resolution","team","source"],i=[],n=new RegExp(/^[\p{L}\p{N}_-]+\.[\p{L}\p{N}_+-]+$/u);for(const d of e){const l=s[d];l&&typeof l=="string"&&l.trim()!==""&&!n.test(l)&&i.push(d)}return Be.value.length>0&&i.push("tags"),i}),rs=s=>!s||typeof s!="string"?s:s.replace(/-/g,""),ds=(s,e)=>{s.key==="åˆ¶ä½œç»„"&&(s.value=rs(e))},js=async()=>{if(console.log("=== ä»storeè·å–çš„å·²å­˜åœ¨ç«™ç‚¹ä¿¡æ¯ ==="),console.log("torrent.value:",w.value),console.log("torrent.value.sites:",w.value?.sites),w.value?.sites){const e=Object.keys(w.value.sites);console.log("å·²å­˜åœ¨çš„ç«™ç‚¹åˆ—è¡¨:",e),console.log("å·²å­˜åœ¨ç«™ç‚¹è¯¦ç»†ä¿¡æ¯:",w.value.sites)}else console.log("æœªæ‰¾åˆ°å·²å­˜åœ¨ç«™ç‚¹ä¿¡æ¯");console.log("=====================================");const s=te.value;if(s.length>0){const e={type:"ç±»å‹",medium:"åª’ä»‹",video_codec:"è§†é¢‘ç¼–ç ",audio_codec:"éŸ³é¢‘ç¼–ç ",resolution:"åˆ†è¾¨ç‡",team:"åˆ¶ä½œç»„",source:"äº§åœ°",tags:"æ ‡ç­¾"},i=s.map(n=>e[n]||n);v({title:"å‚æ•°æ ¼å¼ä¸æ­£ç¡®",message:`ä»¥ä¸‹å‚æ•°æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·ä¿®æ”¹ä¸º *.* çš„æ ‡å‡†æ ¼å¼: ${i.join(", ")}`,type:"warning",duration:0,showClose:!0});return}F.value=!0;try{v({title:"æ­£åœ¨å¤„ç†",message:"æ­£åœ¨æ›´æ–°å‚æ•°å¹¶ç”Ÿæˆé¢„è§ˆ...",type:"info",duration:0});let e,i;if(ke.value&&Q.value&&Q.value.startsWith("db_")){const o=Q.value.split("_");o.length>=3&&(e=o[1],i=o.slice(2).join("_"))}else if(Q.value&&Q.value.startsWith("db_")){const o=Q.value.split("_");o.length>=3&&(e=o[1],i=o.slice(2).join("_"))}else{const o=w.value.sites[L.value];if(e=o.torrentId||null,i=await Ge(L.value),!e){const _=o.comment?.match(/id=(\d+)/);_&&_[1]&&(e=_[1])}}if(!e||!i){v.error({title:"å‚æ•°é”™è¯¯",message:"æ— æ³•è·å–ç§å­IDæˆ–ç«™ç‚¹åç§°",duration:0,showClose:!0});return}console.log(`æ›´æ–°ç§å­å‚æ•°: ${e} from ${i}`);const n=t.value.title_components.map(o=>o.key==="åˆ¶ä½œç»„"?{...o,value:rs(o.value)}:o),d={title:t.value.original_main_title,subtitle:t.value.subtitle,imdb_link:t.value.imdb_link,douban_link:t.value.douban_link,tmdb_link:t.value.tmdb_link,poster:t.value.intro.poster,screenshots:t.value.intro.screenshots,statement:j(t.value.intro.statement),body:j(t.value.intro.body),mediainfo:t.value.mediainfo,source_params:t.value.source_params,title_components:n,standardized_params:t.value.standardized_params};console.log("å‘é€åˆ°åç«¯çš„æ ‡å‡†å‚æ•°:",t.value.standardized_params);const l=await x.post("/api/migrate/update_db_seed_info",{torrent_name:w.value.name,torrent_id:e,site_name:i,updated_parameters:d});if(console.log("å·²è°ƒç”¨æ›´æ–°æ¥å£ï¼Œis_reviewed å°†è¢«è®¾ç½®ä¸º true"),v.closeAll(),l.data.success){v.closeAll();const{standardized_params:o,final_publish_parameters:_,complete_publish_params:p,raw_params_for_preview:b,reverse_mappings:y}=l.data;y&&(A.value=y,console.log("æˆåŠŸæ›´æ–°åå‘æ˜ å°„è¡¨:",A.value)),t.value={...t.value,standardized_params:o||{},final_publish_parameters:_||{},complete_publish_params:p||{},raw_params_for_preview:b||{}},v.success({title:"æ›´æ–°æˆåŠŸ",message:"å‚æ•°å·²æ›´æ–°å¹¶é‡æ–°æ ‡å‡†åŒ–ï¼Œè¯·æ ¸å¯¹é¢„è§ˆå†…å®¹ã€‚"}),I.value=1}else v.error({title:"æ›´æ–°å¤±è´¥",message:l.data.message||"æ›´æ–°å‚æ•°å¤±è´¥",duration:0,showClose:!0})}catch(e){v.closeAll(),Ke(e,"æ›´æ–°é¢„è§ˆæ•°æ®æ—¶å‘ç”Ÿé”™è¯¯ï¼Œè¯·æŸ¥çœ‹åå°æ—¥å¿—ã€‚")}finally{F.value=!1}},Fs=O(()=>{const s=Object.keys(A.value.tags||{}),e=t.value.standardized_params.tags||[];return[...new Set([...s,...e])].filter(d=>!Re(d)).map(d=>({value:d,label:A.value.tags[d]||d}))}),qs=s=>s==="ç¦è½¬"||s==="tag.ç¦è½¬"||s==="é™è½¬"||s==="tag.é™è½¬"||s==="åˆ†é›†"||s==="tag.åˆ†é›†"?"danger":(console.log(`[getTagType] æ£€æŸ¥æ ‡ç­¾: "${s}", æ˜¯å¦æ— æ•ˆ: ${Be.value.includes(s)}`),Be.value.includes(s)?"danger":"info"),Gs=async()=>{const s=w.value?.sites?Object.keys(w.value.sites).length:0;if(s<2){console.log(`å·²å­˜åœ¨ç«™ç‚¹æ•°é‡ä¸è¶³(${s}ä¸ª)ï¼Œæ­£åœ¨é‡æ–°è·å–ç§å­æ•°æ®...`);try{v.info({title:"æ­£åœ¨æ›´æ–°æ•°æ®",message:"æ­£åœ¨é‡æ–°è·å–ç§å­ç«™ç‚¹ä¿¡æ¯...",duration:0});const e=new URLSearchParams({page:"1",pageSize:"1",nameSearch:w.value.name}),n=(await x.get(`/api/data?${e.toString()}`)).data;if(n.error)throw new Error(n.error);if(n.data&&n.data.length>0){const d=n.data[0];console.log("é‡æ–°è·å–åˆ°çš„ç§å­æ•°æ®:",d),console.log("é‡æ–°è·å–åˆ°çš„ç«™ç‚¹ä¿¡æ¯:",d.sites),console.log(`ç«™ç‚¹æ•°é‡ä» ${s} æ›´æ–°åˆ° ${Object.keys(d.sites).length}`),he.setParams(d),v.success({title:"æ•°æ®æ›´æ–°æˆåŠŸ",message:`å·²é‡æ–°è·å–ç§å­ç«™ç‚¹ä¿¡æ¯ï¼Œå‘ç° ${Object.keys(d.sites).length} ä¸ªç«™ç‚¹`})}else v.warning({title:"æœªæ‰¾åˆ°ç§å­",message:"æœªèƒ½æ‰¾åˆ°åŒ¹é…çš„ç§å­æ•°æ®"})}catch(e){console.error("é‡æ–°è·å–ç§å­æ•°æ®æ—¶å‡ºé”™:",e),v.error({title:"æ•°æ®æ›´æ–°å¤±è´¥",message:e.message||"é‡æ–°è·å–ç§å­æ•°æ®æ—¶å‘ç”Ÿé”™è¯¯"})}}else console.log(`å·²å­˜åœ¨ç«™ç‚¹æ•°é‡å……è¶³(${s}ä¸ª)ï¼Œè·³è¿‡é‡æ–°è·å–`);I.value=2},Hs=s=>{const e=Z.value.indexOf(s);e>-1?Z.value.splice(e,1):Z.value.push(s)},Ks=()=>{const s=me.value.filter(e=>e.is_target&&qe(e.name)).map(e=>e.name);Z.value=s},Ws=()=>{Z.value=[]},Js=async()=>{I.value=3,F.value=!0,re.value=[];const s=Z.value.length;ue.value={current:0,total:s},ce.value={current:0,total:s},v({title:"æ­£åœ¨å‘å¸ƒ",message:`å‡†å¤‡å‘ ${Z.value.length} ä¸ªç«™ç‚¹å‘å¸ƒç§å­...`,type:"info",duration:0});const e=[];for(const l of Z.value){try{const o=await x.post("/api/migrate/publish",{task_id:Q.value,upload_data:{...t.value,save_path:w.value.save_path},targetSite:l,sourceSite:L.value,downloaderId:w.value.downloaderId,auto_add_to_downloader:!0}),_={siteName:l,message:Zs(o.data.logs||"å‘å¸ƒæˆåŠŸ"),...o.data};if(o.data.logs&&o.data.logs.includes("ç§å­å·²å­˜åœ¨")&&(_.isExisted=!0),_.auto_add_result&&_.auto_add_result.limit_reached){const p=_.auto_add_result.message;_.downloaderStatus={success:!1,message:_.auto_add_result.message,downloaderName:"é™åˆ¶è§¦å‘",limit_reached:!0},e.push(_),re.value=[...e],ye.value={visible:!0,title:"å‘ç§é™åˆ¶è§¦å‘",message:p},ee.value=`

=== ğŸš« å‘ç§é™åˆ¶è§¦å‘ ===
${p}

=== ğŸ›‘ æ‰¹é‡å‘å¸ƒå·²åœæ­¢ ===
ç”±äºå‘ç§é™åˆ¶è§¦å‘ï¼Œåç»­ ${Z.value.length-e.length} ä¸ªç«™ç‚¹å‘å¸ƒå·²æš‚åœã€‚

`+ee.value,v({title:"å‘ç§é™åˆ¶è§¦å‘",message:`${l} å‘å¸ƒæˆåŠŸä½†å› é™åˆ¶æ— æ³•æ·»åŠ åˆ°ä¸‹è½½å™¨
${p}
åç»­ç«™ç‚¹å‘å¸ƒå·²è‡ªåŠ¨åœæ­¢ã€‚`,type:"warning",duration:0,showClose:!0});break}if(_.pre_check&&_.limit_reached){const p=_.message.replace("ğŸš« å‘å¸ƒå‰é¢„æ£€æŸ¥è§¦å‘é™åˆ¶: ","");_.downloaderStatus={success:!1,message:_.message,downloaderName:"å‘å¸ƒå‰é™åˆ¶",limit_reached:!0,pre_check:!0},e.push(_),re.value=[...e],ye.value={visible:!0,title:"å‘å¸ƒå‰é™åˆ¶è§¦å‘",message:p},ee.value=`

=== ğŸš« å‘ç§é™åˆ¶è§¦å‘ ===
${p}

=== ğŸ›‘ æ‰¹é‡å‘å¸ƒå·²åœæ­¢ ===
ç”±äºå‘ç§é™åˆ¶è§¦å‘ï¼Œåç»­ ${Z.value.length-e.length} ä¸ªç«™ç‚¹å‘å¸ƒå·²æš‚åœã€‚

`+ee.value,v({title:"å‘å¸ƒå‰é™åˆ¶è§¦å‘",message:`${l} å› å‘ç§é™åˆ¶æ— æ³•å‘å¸ƒ
${p}
åç»­ç«™ç‚¹å‘å¸ƒå·²è‡ªåŠ¨åœæ­¢ã€‚`,type:"warning",duration:0,showClose:!0});break}if(_.auto_add_result){let p="è‡ªåŠ¨æ£€æµ‹";if(_.auto_add_result.downloader_id){const b=ts.value.find(y=>y.id===_.auto_add_result.downloader_id);b&&(p=b.name)}_.downloaderStatus={success:_.auto_add_result.success,message:_.auto_add_result.message,downloaderName:p},_.auto_add_result.success&&ce.value.current++}e.push(_),re.value=[...e],_.success&&v.success({title:`å‘å¸ƒæˆåŠŸ - ${l}`,message:"ç§å­å·²æˆåŠŸå‘å¸ƒåˆ°è¯¥ç«™ç‚¹"})}catch(o){const _={siteName:l,success:!1,logs:o.response?.data?.logs||o.message,url:null,message:`å‘å¸ƒåˆ° ${l} æ—¶å‘ç”Ÿé”™è¯¯ï¼Œè¯·æŸ¥çœ‹æ—¥å¿—ã€‚`,downloaderStatus:{success:!1,message:"å‘å¸ƒå¤±è´¥ï¼Œæ— æ³•æ·»åŠ åˆ°ä¸‹è½½å™¨",downloaderName:"é”™è¯¯"}};e.push(_),re.value=[...e],v.error({title:`å‘å¸ƒå¤±è´¥ - ${l}`,message:_.message})}ue.value.current++,await new Promise(o=>setTimeout(o,1e3))}v.closeAll();const i=e.filter(l=>l.success).length;v.success({title:"å‘å¸ƒå®Œæˆ",message:`æˆåŠŸå‘å¸ƒåˆ° ${i} / ${Z.value.length} ä¸ªç«™ç‚¹ã€‚`}),ee.value+=`

--- [è‡ªåŠ¨æ·»åŠ ä»»åŠ¡ç»“æœ] ---`;const n={};e.forEach(l=>{if(l.auto_add_result){const o=l.downloaderStatus?.downloaderName||"è‡ªåŠ¨æ£€æµ‹";n[l.siteName]={success:l.auto_add_result.success,message:l.auto_add_result.message,downloaderName:o};const _=l.auto_add_result.success?"âœ…":"âŒ",p=l.auto_add_result.success?"æˆåŠŸ":"å¤±è´¥";ee.value+=`
[${l.siteName}] ${_} ${p}: ${l.auto_add_result.message}`}else l.success&&l.url&&(ee.value+=`
[${l.siteName}] âš ï¸  æœªæ‰§è¡Œè‡ªåŠ¨æ·»åŠ `)}),ee.value+=`
--- [è‡ªåŠ¨æ·»åŠ ä»»åŠ¡ç»“æŸ] ---`;const d=e.map(l=>{let o=`--- Log for ${l.siteName} ---
${l.logs||"No logs available."}`;if(n[l.siteName]){const _=n[l.siteName];o+=`

--- Downloader Status for ${l.siteName} ---`,_.success?o+=`
âœ… æˆåŠŸ: ${_.message}`:o+=`
âŒ å¤±è´¥: ${_.message}`}return o});ee.value=d.join(`

`),re.value=e.map(l=>({...l,downloaderStatus:n[l.siteName]}));try{await x.post("/api/refresh_data"),v.success({title:"æ•°æ®åˆ·æ–°",message:"ç§å­æ•°æ®å·²åˆ·æ–°"})}catch(l){console.warn("åˆ·æ–°ç§å­æ•°æ®å¤±è´¥:",l)}F.value=!1},Ys=()=>{I.value>0&&I.value--},He=()=>{I.value===3?ve("close-with-refresh"):ve("cancel")},us=()=>{ve("complete")},Zs=s=>s==="å‘å¸ƒæˆåŠŸ"?"å‘å¸ƒæˆåŠŸ":s.includes("ç§å­å·²å­˜åœ¨")?"ç§å­å·²å­˜åœ¨ï¼Œå‘å¸ƒæˆåŠŸ":s.split(`
`).filter(n=>n&&!n.includes("--- [æ­¥éª¤")&&!n.includes("INFO - ---")).map(n=>n.replace(/^\d{2}:\d{2}:\d{2} - \w+ - /,"")).filter(Boolean).pop()||"å‘å¸ƒæˆåŠŸ",Ke=(s,e)=>{const i=s.response?.data?.logs||s.message||e;v.error({title:"æ“ä½œå¤±è´¥",message:i,duration:0,showClose:!0})},W=s=>{const e=t.value.standardized_params;if(!e||!A.value)return"N/A";const i=e[s];if(!i)return"N/A";const n=A.value[s];return n&&n[i]||i},We=()=>!_e.value||!A.value.tags?[]:_e.value.map(s=>A.value.tags[s]||s),cs=O(()=>t.value.title_components.filter(s=>s.key!=="æ— æ³•è¯†åˆ«")),_e=O(()=>t.value.standardized_params.tags?.filter(e=>e&&typeof e=="string"&&e.trim()!=="")||[]),Be=O(()=>{const s=new RegExp(/^[\p{L}\p{N}_-]+\.[\p{L}\p{N}_+-]+$/u);return _e.value.filter(e=>!s.test(e))}),Xs=O(()=>["ä¸»æ ‡é¢˜","å­£é›†","å¹´ä»½","å‰§é›†çŠ¶æ€","å‘å¸ƒç‰ˆæœ¬","åˆ†è¾¨ç‡","ç‰‡æºå¹³å°","åª’ä»‹","è§†é¢‘ç¼–ç ","è§†é¢‘æ ¼å¼","HDRæ ¼å¼","è‰²æ·±","å¸§ç‡","éŸ³é¢‘ç¼–ç ","åˆ¶ä½œç»„"].map(e=>({key:e,value:""}))),Re=s=>s==="ç¦è½¬"||s==="tag.ç¦è½¬"||s==="é™è½¬"||s==="tag.é™è½¬"||s==="åˆ†é›†"||s==="tag.åˆ†é›†",ms=O(()=>(t.value.standardized_params.tags||[]).some(e=>Re(e))),Qs=s=>{if(Re(s)){v.warning({title:"æ— æ³•åˆ é™¤",message:"ç¦è½¬/é™è½¬/åˆ†é›†æ ‡ç­¾ä¸å…è®¸åˆ é™¤",duration:2e3});return}const e=t.value.standardized_params.tags.indexOf(s);e>-1&&t.value.standardized_params.tags.splice(e,1)},Je=O({get(){const s=t.value.title_components.find(e=>e.key==="æ— æ³•è¯†åˆ«");return s?s.value:""},set(s){const e=t.value.title_components.findIndex(i=>i.key==="æ— æ³•è¯†åˆ«");s===""||s===null?e!==-1&&t.value.title_components.splice(e,1):e!==-1?t.value.title_components[e].value=s:t.value.title_components.push({key:"æ— æ³•è¯†åˆ«",value:s})}}),et=O(()=>{const s=t.value.standardized_params.team,e=t.value.title_components;if(s&&["cmct","cmctv"].includes(s.toLowerCase()))return!0;const i=e.find(n=>n.key==="åˆ¶ä½œç»„");if(i&&i.value){const n=i.value.toLowerCase(),d=["cmct","cmctv","telesto","shadow610"];for(const l of d)if(n.includes(l))return!0}return!1}),ps=O(()=>{const s=t.value.title_components.find(pe=>pe.key==="æ— æ³•è¯†åˆ«"),e=s&&s.value!=="";if(ms.value)return!0;const i=t.value.intro,n=!i.poster||i.poster.trim()==="",d=!i.screenshots||i.screenshots.trim()==="",l=!i.body||i.body.trim()==="";if(n||d||l)return!0;const o=t.value.standardized_params,_=!o.type||o.type.trim()==="",p=!o.medium||o.medium.trim()==="",b=!o.video_codec||o.video_codec.trim()==="",y=!o.audio_codec||o.audio_codec.trim()==="",D=!o.resolution||o.resolution.trim()==="";if(_||p||b||y||D)return!0;const P=t.value.title_components.find(pe=>pe.key==="åˆ¶ä½œç»„"),U=!P||!P.value||P.value.trim()==="",de=P&&P.value.trim().toUpperCase()==="NOGROUP";if(U||de)return!0;const ie=t.value.mediainfo||"";if(!ie||ie.trim()==="")return!0;{const pe=_s(ie),Ze=fs(ie);if(!pe&&!Ze)return!0}if(te.value.length>0)return!0;const Ae=!le.value;return!!(e||Ae)}),st=O(()=>{if(ms.value)return"æ£€æµ‹åˆ°ç¦è½¬/é™è½¬/åˆ†é›†æ ‡ç­¾ï¼Œä¸å…è®¸ç»§ç»­å‘å¸ƒ";const s=t.value.title_components.find(p=>p.key==="æ— æ³•è¯†åˆ«");if(s&&s.value!=="")return"å­˜åœ¨æ— æ³•è¯†åˆ«çš„æ ‡é¢˜å†…å®¹ï¼Œè¯·æ‰‹åŠ¨ä¿®æ­£æˆ–åˆ é™¤";const e=t.value.title_components.find(p=>p.key==="åˆ¶ä½œç»„"),i=!e||!e.value||e.value.trim()==="",n=e&&e.value.trim().toUpperCase()==="NOGROUP";if(i)return"æ— åˆ¶ä½œç»„ï¼Œç¦æ­¢å‘å¸ƒ";if(n)return"åˆ¶ä½œç»„ä¸ºNOGROUPï¼Œç¦æ­¢å‘å¸ƒ";const d=t.value.standardized_params,l=t.value.intro,o=[];if((!l.poster||l.poster.trim()==="")&&o.push("æµ·æŠ¥"),(!l.screenshots||l.screenshots.trim()==="")&&o.push("æˆªå›¾"),(!l.body||l.body.trim()==="")&&o.push("ç®€ä»‹æ­£æ–‡"),(!t.value.mediainfo||t.value.mediainfo.trim()==="")&&o.push("Mediainfo"),(!d.type||d.type.trim()==="")&&o.push("ç±»å‹"),(!d.medium||d.medium.trim()==="")&&o.push("åª’ä»‹"),(!d.video_codec||d.video_codec.trim()==="")&&o.push("è§†é¢‘ç¼–ç "),(!d.audio_codec||d.audio_codec.trim()==="")&&o.push("éŸ³é¢‘ç¼–ç "),(!d.resolution||d.resolution.trim()==="")&&o.push("åˆ†è¾¨ç‡"),o.length>0)return`è¯·è¡¥å……å¿…å¡«é¡¹ï¼š${o.join("ã€")}`;if(te.value.length>0){const p={type:"ç±»å‹",medium:"åª’ä»‹",video_codec:"è§†é¢‘ç¼–ç ",audio_codec:"éŸ³é¢‘ç¼–ç ",resolution:"åˆ†è¾¨ç‡",team:"åˆ¶ä½œç»„",source:"äº§åœ°",tags:"æ ‡ç­¾"};return`å‚æ•°æ ¼å¼ä¸æ­£ç¡® (${te.value.map(y=>p[y]||y).join("ã€")})`}const _=t.value.mediainfo||"";return!_s(_)&&!fs(_)?"MediaInfo æˆ– BDInfo æ ¼å¼æ— æ•ˆ":le.value?"å‡†å¤‡å°±ç»ª":"æˆªå›¾é“¾æ¥å¤±æ•ˆï¼Œè¯·ç­‰å¾…é‡æ–°è·å–æˆ–æ‰‹åŠ¨ä¿®å¤"}),vs=s=>{const e=[{pattern:/\[b\]/,description:"BBCodeç²—ä½“æ ‡ç­¾"},{pattern:/\[color=[^\]]+\]/,description:"BBCodeé¢œè‰²æ ‡ç­¾"},{pattern:/\[size=[^\]]+\]/,description:"BBCodeå¤§å°æ ‡ç­¾"},{pattern:/\[\/[^\]]+\]/,description:"BBCodeç»“æŸæ ‡ç­¾"},{pattern:/â˜…{2,}/,description:"è¿ç»­çš„æ˜Ÿæ˜Ÿç¬¦å·"},{pattern:/ã€‚{3,}/,description:"è¿ç»­çš„ä¸­æ–‡å¥å·"},{pattern:/â€¦{2,}/,description:"è¿ç»­çš„çœç•¥å·"},{pattern:/â€¦â€¦{2,}/,description:"è¿ç»­çš„ä¸­æ–‡çœç•¥å·"}];for(const{pattern:i,description:n}of e)if(i.test(s))return console.log(`æ£€æµ‹åˆ°ç¦æ­¢æ¨¡å¼: ${n}`),!0;return!1},_s=s=>!(["General","Video","Audio","Complete name","File size","Duration","Width","Height"].filter(n=>s.includes(n)).length<3||vs(s)),fs=s=>{const e=["DISC INFO","PLAYLIST REPORT"],i=["VIDEO:","AUDIO:","SUBTITLES:","FILES:","Disc Label","Disc Size","BDInfo:","Protection:","Codec","Bitrate","Language","Description"],n=e.filter(o=>s.includes(o)).length,d=i.filter(o=>s.includes(o)).length;return!(!(n===e.length||n>=1&&d>=2)||vs(s))},Ye=async()=>{const s=we.value;if(s.length===0){le.value=!0;return}let e=!0;for(const i of s)try{await new Promise((n,d)=>{const l=new Image;l.onload=()=>{n(!0)},l.onerror=()=>{d(new Error("Image load failed"))},l.src=i})}catch{e=!1;break}le.value=e},gs=()=>{ze.value=!1},tt=(s,e)=>{let i=`--- Log for ${s} ---
${e||"No logs available."}`;const n=re.value.find(d=>d.siteName===s);if(n&&n.downloaderStatus){const d=n.downloaderStatus;i+=`

--- Downloader Status for ${s} ---`,d.success?i+=`
âœ… æˆåŠŸ: ${d.message}`:i+=`
âŒ å¤±è´¥: ${d.message}`}ee.value=i,ze.value=!0},at=O(()=>{const s=re.value,e=[];for(let i=0;i<s.length;i+=5)e.push(s.slice(i,i+5));return e}),lt=s=>s.some(e=>e.success&&e.url),ot=s=>s.filter(e=>e.success&&e.url).length,nt=s=>{const e=s.filter(i=>i.success&&i.url);if(e.length===0){v.warning({title:"æ— æ³•æ‰“å¼€",message:"è¯¥è¡Œæ²¡æœ‰å¯ç”¨çš„ç§å­é“¾æ¥"});return}e.forEach(i=>{const n=bs(i.url);window.open(n,"_blank","noopener,noreferrer")}),v.success({title:"æ‰¹é‡æ‰“å¼€æˆåŠŸ",message:`å·²æ‰“å¼€ ${e.length} ä¸ªç§å­é¡µé¢`})},it=()=>{console.log("æ—¥å¿—è¿›åº¦å¤„ç†å®Œæˆ"),setTimeout(()=>{De.value=!1},1e3)},bs=s=>{if(!s)return s;try{if(s.includes("|DIRECT_DOWNLOAD:")){const i=s.split("|DIRECT_DOWNLOAD:")[0],n=new URL(i);return n.searchParams.delete("uploaded"),n.toString()}const e=new URL(s);return e.searchParams.delete("uploaded"),e.toString()}catch(e){return console.warn("Invalid URL format:",s,e),s}};return(s,e)=>{const i=B("el-icon"),n=B("el-button"),d=B("el-input"),l=B("el-form-item"),o=B("el-option"),_=B("el-select"),p=B("el-tag"),b=B("el-form"),y=B("el-tab-pane"),D=B("el-carousel-item"),P=B("el-carousel"),U=B("el-col"),de=B("el-row"),ie=B("el-card"),hs=B("el-empty"),ys=B("el-tabs"),Ae=B("el-alert"),pe=B("el-button-group"),Ze=B("el-scrollbar"),rt=B("el-dialog");return m(),f(N,null,[a("div",Tt,[a("header",Et,[a("div",zt,[(m(),f(N,null,M(Ue,(r,g)=>a("div",{key:g,class:E(["custom-step",{active:g===I.value,completed:g<I.value,last:g===Ue.length-1}])},[a("div",Dt,[g<I.value?(m(),V(i,{key:0},{default:c(()=>[u(z(Qe))]),_:1})):(m(),f("span",Vt,h(g+1),1))]),a("div",Nt,h(r.title),1),g<Ue.length-1?(m(),f("div",Bt)):k("",!0)],2)),64))])]),a("main",Rt,[I.value===0?(m(),f("div",At,[u(ys,{modelValue:Y.value,"onUpdate:modelValue":e[19]||(e[19]=r=>Y.value=r),type:"border-card",class:"details-tabs"},{default:c(()=>[u(y,{label:"ä¸»è¦ä¿¡æ¯",name:"main"},{default:c(()=>[a("div",Pt,[a("div",xt,[u(b,{"label-position":"top",class:"fill-height-form"},{default:c(()=>[a("div",Mt,[u(l,{label:"åŸå§‹/å¾…è§£ææ ‡é¢˜"},{default:c(()=>[u(d,{modelValue:t.value.original_main_title,"onUpdate:modelValue":e[0]||(e[0]=r=>t.value.original_main_title=r)},{append:c(()=>[u(n,{icon:z(fe),onClick:Ms,loading:Oe.value},{default:c(()=>[...e[23]||(e[23]=[T(" é‡æ–°è§£æ ",-1)])]),_:1},8,["icon","loading"])]),_:1},8,["modelValue"])]),_:1}),a("div",Lt,[cs.value.length>0?(m(!0),f(N,{key:0},M(cs.value,r=>(m(),V(l,{key:r.key,label:r.key,class:E({"unrecognized-section":r.key==="åˆ¶ä½œç»„"&&(!r.value||r.value.toUpperCase()==="NOGROUP")})},{default:c(()=>[u(d,{modelValue:r.value,"onUpdate:modelValue":g=>r.value=g,onInput:g=>ds(r,g)},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:2},1032,["label","class"]))),128)):(m(!0),f(N,{key:1},M(Xs.value,(r,g)=>(m(),V(l,{key:"init-"+g,label:r.key,class:E({"unrecognized-section":r.key==="åˆ¶ä½œç»„"&&(!r.value||r.value.toUpperCase()==="NOGROUP")})},{default:c(()=>[u(d,{modelValue:r.value,"onUpdate:modelValue":C=>r.value=C,onInput:C=>ds(r,C)},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:2},1032,["label","class"]))),128))])]),a("div",Ut,[a("div",Ot,[a("div",jt,[u(l,{label:"å‰¯æ ‡é¢˜"},{default:c(()=>[u(d,{modelValue:t.value.subtitle,"onUpdate:modelValue":e[1]||(e[1]=r=>t.value.subtitle=r)},null,8,["modelValue"])]),_:1})]),a("div",{class:E({"unrecognized-section":Je.value}),style:{"grid-column":"span 1"}},[u(l,{label:"æ— æ³•è¯†åˆ«"},{default:c(()=>[u(d,{modelValue:Je.value,"onUpdate:modelValue":e[2]||(e[2]=r=>Je.value=r)},null,8,["modelValue"])]),_:1})],2)]),a("div",Ft,[a("div",qt,[u(l,{label:"ç±»å‹ (type)"},{default:c(()=>[u(_,{modelValue:t.value.standardized_params.type,"onUpdate:modelValue":e[3]||(e[3]=r=>t.value.standardized_params.type=r),placeholder:"è¯·é€‰æ‹©ç±»å‹",clearable:"",class:E({"is-invalid":te.value.includes("type"),"is-empty":!t.value.standardized_params.type}),"data-tag-style":""},{default:c(()=>[(m(!0),f(N,null,M(A.value.type,(r,g)=>(m(),V(o,{key:g,label:r,value:g},null,8,["label","value"]))),128))]),_:1},8,["modelValue","class"])]),_:1}),u(l,{label:"åª’ä»‹ (medium)"},{default:c(()=>[u(_,{modelValue:t.value.standardized_params.medium,"onUpdate:modelValue":e[4]||(e[4]=r=>t.value.standardized_params.medium=r),placeholder:"è¯·é€‰æ‹©åª’ä»‹",clearable:"",class:E({"is-invalid":te.value.includes("medium"),"is-empty":!t.value.standardized_params.medium}),"data-tag-style":""},{default:c(()=>[(m(!0),f(N,null,M(A.value.medium,(r,g)=>(m(),V(o,{key:g,label:r,value:g},null,8,["label","value"]))),128))]),_:1},8,["modelValue","class"])]),_:1}),u(l,{label:"è§†é¢‘ç¼–ç  (video_codec)"},{default:c(()=>[u(_,{modelValue:t.value.standardized_params.video_codec,"onUpdate:modelValue":e[5]||(e[5]=r=>t.value.standardized_params.video_codec=r),placeholder:"è¯·é€‰æ‹©è§†é¢‘ç¼–ç ",clearable:"",class:E({"is-invalid":te.value.includes("video_codec"),"is-empty":!t.value.standardized_params.video_codec}),"data-tag-style":""},{default:c(()=>[(m(!0),f(N,null,M(A.value.video_codec,(r,g)=>(m(),V(o,{key:g,label:r,value:g},null,8,["label","value"]))),128))]),_:1},8,["modelValue","class"])]),_:1}),u(l,{label:"éŸ³é¢‘ç¼–ç  (audio_codec)"},{default:c(()=>[u(_,{modelValue:t.value.standardized_params.audio_codec,"onUpdate:modelValue":e[6]||(e[6]=r=>t.value.standardized_params.audio_codec=r),placeholder:"è¯·é€‰æ‹©éŸ³é¢‘ç¼–ç ",clearable:"",class:E({"is-invalid":te.value.includes("audio_codec"),"is-empty":!t.value.standardized_params.audio_codec}),"data-tag-style":""},{default:c(()=>[(m(!0),f(N,null,M(A.value.audio_codec,(r,g)=>(m(),V(o,{key:g,label:r,value:g},null,8,["label","value"]))),128))]),_:1},8,["modelValue","class"])]),_:1}),u(l,{label:"åˆ†è¾¨ç‡ (resolution)"},{default:c(()=>[u(_,{modelValue:t.value.standardized_params.resolution,"onUpdate:modelValue":e[7]||(e[7]=r=>t.value.standardized_params.resolution=r),placeholder:"è¯·é€‰æ‹©åˆ†è¾¨ç‡",clearable:"",class:E({"is-invalid":te.value.includes("resolution"),"is-empty":!t.value.standardized_params.resolution}),"data-tag-style":""},{default:c(()=>[(m(!0),f(N,null,M(A.value.resolution,(r,g)=>(m(),V(o,{key:g,label:r,value:g},null,8,["label","value"]))),128))]),_:1},8,["modelValue","class"])]),_:1})]),a("div",Gt,[u(l,{label:"åˆ¶ä½œç»„ (team)"},{default:c(()=>[u(_,{modelValue:t.value.standardized_params.team,"onUpdate:modelValue":e[8]||(e[8]=r=>t.value.standardized_params.team=r),placeholder:"è¯·é€‰æ‹©åˆ¶ä½œç»„",clearable:"",filterable:"","allow-create":"","default-first-option":"",class:E(["team-select",{"is-invalid":te.value.includes("team")}])},{default:c(()=>[(m(!0),f(N,null,M(A.value.team,(r,g)=>(m(),V(o,{key:g,label:r,value:g},null,8,["label","value"]))),128))]),_:1},8,["modelValue","class"])]),_:1}),u(l,{label:"äº§åœ° (source)"},{default:c(()=>[u(_,{modelValue:t.value.standardized_params.source,"onUpdate:modelValue":e[9]||(e[9]=r=>t.value.standardized_params.source=r),placeholder:"è¯·é€‰æ‹©äº§åœ°",clearable:"",class:E({"is-invalid":te.value.includes("source")}),"data-tag-style":""},{default:c(()=>[(m(!0),f(N,null,M(A.value.source,(r,g)=>(m(),V(o,{key:g,label:r,value:g},null,8,["label","value"]))),128))]),_:1},8,["modelValue","class"])]),_:1}),u(l,{label:"æ ‡ç­¾ (tags)",class:"tags-wide-item"},{default:c(()=>[u(_,{modelValue:t.value.standardized_params.tags,"onUpdate:modelValue":e[10]||(e[10]=r=>t.value.standardized_params.tags=r),multiple:"",filterable:"","allow-create":"","default-first-option":"",placeholder:"è¯·é€‰æ‹©æˆ–è¾“å…¥æ ‡ç­¾",style:{width:"100%"}},{tag:c(({data:r})=>[(m(!0),f(N,null,M(r,g=>(m(),V(p,{key:g.value,type:qs(g.value),closable:!Re(g.value),"disable-transitions":"",onClose:C=>Qs(g.value),style:{margin:"2px"}},{default:c(()=>[a("span",null,h(A.value.tags[g.value]||g.currentLabel),1)]),_:2},1032,["type","closable","onClose"]))),128))]),default:c(()=>[(m(!0),f(N,null,M(Fs.value,r=>(m(),V(o,{key:r.value,label:r.label,value:r.value},{default:c(()=>[a("span",{style:pt({color:Be.value.includes(r.value)?"#F56C6C":""})},h(r.label),5)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e[24]||(e[24]=a("div",{class:"placeholder-item"},null,-1)),e[25]||(e[25]=a("div",{class:"placeholder-item"},null,-1))])])])]),_:1})])])]),_:1}),u(y,{label:"æµ·æŠ¥ä¸å£°æ˜",name:"poster-statement"},{default:c(()=>[a("div",Ht,[u(b,{"label-position":"top",class:"fill-height-form"},{default:c(()=>[a("div",Kt,[a("div",Wt,[u(l,{label:"å£°æ˜",class:"statement-item"},{default:c(()=>[u(d,{type:"textarea",modelValue:t.value.intro.statement,"onUpdate:modelValue":e[11]||(e[11]=r=>t.value.intro.statement=r),rows:18},null,8,["modelValue"])]),_:1}),u(l,null,{label:c(()=>[a("div",Jt,[e[27]||(e[27]=a("span",null,"æµ·æŠ¥é“¾æ¥",-1)),u(n,{icon:z(fe),onClick:xs,loading:Ee.value,size:"small",type:"text"},{default:c(()=>[...e[26]||(e[26]=[T(" é‡æ–°è·å– ",-1)])]),_:1},8,["icon","loading"])])]),default:c(()=>[u(d,{type:"textarea",modelValue:t.value.intro.poster,"onUpdate:modelValue":e[12]||(e[12]=r=>t.value.intro.poster=r),rows:2},null,8,["modelValue"])]),_:1})]),a("div",Yt,[a("div",Zt,[e[28]||(e[28]=a("div",{class:"preview-header"},"æµ·æŠ¥é¢„è§ˆ",-1)),a("div",Xt,[Ve.value.length?(m(!0),f(N,{key:0},M(Ve.value,(r,g)=>(m(),f("img",{key:"poster-"+g,src:G(r),alt:"æµ·æŠ¥é¢„è§ˆ",class:"preview-image",onError:C=>X(r,"poster",g)},null,40,Qt))),128)):(m(),f("div",ea,"æš‚æ— æµ·æŠ¥é¢„è§ˆ"))])])])])]),_:1})])]),_:1}),u(y,{label:"è§†é¢‘æˆªå›¾",name:"images"},{default:c(()=>[a("div",sa,[a("div",ta,[u(b,{"label-position":"top",class:"fill-height-form"},{default:c(()=>[u(l,{class:"is-flexible"},{label:c(()=>[a("div",aa,[e[30]||(e[30]=a("span",null,"æˆªå›¾",-1)),u(n,{icon:z(fe),onClick:Bs,loading:Ce.value,size:"small",type:"text"},{default:c(()=>[...e[29]||(e[29]=[T(" é‡æ–°è·å– ",-1)])]),_:1},8,["icon","loading"])])]),default:c(()=>[u(d,{type:"textarea",modelValue:t.value.intro.screenshots,"onUpdate:modelValue":e[13]||(e[13]=r=>t.value.intro.screenshots=r),rows:20},null,8,["modelValue"])]),_:1})]),_:1})]),a("div",la,[a("div",oa,[we.value.length?(m(),V(P,{key:0,interval:5e3,height:"500px","indicator-position":"outside"},{default:c(()=>[(m(!0),f(N,null,M(we.value,(r,g)=>(m(),V(D,{key:"ss-"+g},{default:c(()=>[a("div",na,[a("img",{src:G(r),alt:"æˆªå›¾é¢„è§ˆ",class:"carousel-image",onError:C=>X(r,"screenshot",g)},null,40,ia)])]),_:2},1024))),128))]),_:1})):(m(),f("div",ra,"æˆªå›¾é¢„è§ˆ"))])])])]),_:1}),u(y,{label:"ç®€ä»‹è¯¦æƒ…",name:"intro"},{default:c(()=>[u(b,{"label-position":"top",class:"fill-height-form"},{default:c(()=>[u(l,{class:"is-flexible"},{label:c(()=>[a("div",da,[e[32]||(e[32]=a("span",null,"æ­£æ–‡",-1)),u(n,{icon:z(fe),onClick:Ns,loading:je.value,size:"small",type:"text"},{default:c(()=>[...e[31]||(e[31]=[T(" é‡æ–°è·å– ",-1)])]),_:1},8,["icon","loading"])])]),default:c(()=>[u(d,{type:"textarea",modelValue:t.value.intro.body,"onUpdate:modelValue":e[14]||(e[14]=r=>t.value.intro.body=r),rows:21},null,8,["modelValue"])]),_:1}),u(de,{gutter:20},{default:c(()=>[u(U,{span:8},{default:c(()=>[u(l,{label:"è±†ç“£é“¾æ¥"},{default:c(()=>[u(d,{modelValue:t.value.douban_link,"onUpdate:modelValue":e[15]||(e[15]=r=>t.value.douban_link=r),placeholder:"è¯·è¾“å…¥è±†ç“£ç”µå½±é“¾æ¥"},null,8,["modelValue"])]),_:1})]),_:1}),u(U,{span:8},{default:c(()=>[u(l,{label:"IMDbé“¾æ¥"},{default:c(()=>[u(d,{modelValue:t.value.imdb_link,"onUpdate:modelValue":e[16]||(e[16]=r=>t.value.imdb_link=r),placeholder:"è¯·è¾“å…¥IMDbç”µå½±é“¾æ¥"},null,8,["modelValue"])]),_:1})]),_:1}),u(U,{span:8},{default:c(()=>[u(l,{label:"TMDbé“¾æ¥"},{default:c(()=>[u(d,{modelValue:t.value.tmdb_link,"onUpdate:modelValue":e[17]||(e[17]=r=>t.value.tmdb_link=r),placeholder:"è¯·è¾“å…¥TMDbç”µå½±é“¾æ¥"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),u(y,{label:"åª’ä½“ä¿¡æ¯",name:"mediainfo"},{default:c(()=>[u(b,{"label-position":"top",class:"fill-height-form"},{default:c(()=>[u(l,{class:"is-flexible"},{label:c(()=>[a("div",ua,[e[34]||(e[34]=a("span",null,"Mediainfo",-1)),u(n,{icon:z(fe),onClick:Rs,loading:Te.value,size:"small",type:"text"},{default:c(()=>[...e[33]||(e[33]=[T(" é‡æ–°è·å– ",-1)])]),_:1},8,["icon","loading"])])]),default:c(()=>[a("div",ca,[H.value.visible?(m(),f("div",ma,[u(ie,{class:"bdinfo-progress-card-inline",shadow:"never"},{header:c(()=>[a("div",pa,[e[38]||(e[38]=a("span",null,"BDInfo è·å–ä¸­...",-1)),a("div",va,[e[37]||(e[37]=a("span",{class:"background-hint"},"å¯åœ¨åå°ç»§ç»­è·å–",-1)),u(n,{icon:z(mt),onClick:Ps,size:"small",text:"",type:"primary"},{default:c(()=>[...e[35]||(e[35]=[T(" æ”¾ç½®åå° ",-1)])]),_:1},8,["icon"]),u(n,{icon:z(ws),onClick:Se,size:"small",text:"",type:"info"},{default:c(()=>[...e[36]||(e[36]=[T(" å–æ¶ˆè·å– ",-1)])]),_:1},8,["icon"])])])]),default:c(()=>[u(z(Xe),{percentage:H.value.percent,status:H.value.percent===100?"success":""},null,8,["percentage","status"]),a("div",_a,[a("div",fa,[a("div",ga,"åŸç›˜ä½“ç§¯: "+h(Ds(as.value)),1),a("div",ba,"å·²ç”¨æ—¶: "+h(H.value.elapsedTime),1),a("div",ha," å‰©ä½™æ—¶é—´: "+h(H.value.remainingTime),1)])])]),_:1})])):k("",!0),u(d,{type:"textarea",class:"code-font",modelValue:t.value.mediainfo,"onUpdate:modelValue":e[18]||(e[18]=r=>t.value.mediainfo=r),rows:H.value.visible?18:26},null,8,["modelValue","rows"])])]),_:1})]),_:1})]),_:1}),u(y,{label:"å·²è¿‡æ»¤å£°æ˜",name:"filtered-declarations",class:"filtered-declarations-pane"},{default:c(()=>[a("div",ya,[a("div",ka,[e[39]||(e[39]=a("h3",null,"å·²è‡ªåŠ¨è¿‡æ»¤çš„å£°æ˜å†…å®¹",-1)),u(p,{type:"warning",size:"small"},{default:c(()=>[T("å…± "+h(ns.value)+" æ¡",1)]),_:1})]),a("div",wa,[ns.value>0?(m(!0),f(N,{key:0},M(os.value,(r,g)=>(m(),f("div",{key:g,class:"declaration-item"},[a("div",Sa,[a("span",Ia,"#"+h(g+1),1),u(p,{type:"danger",size:"small"},{default:c(()=>[...e[40]||(e[40]=[T("å·²è¿‡æ»¤",-1)])]),_:1})]),a("pre",$a,h(r),1)]))),128)):(m(),f("div",Ca,[u(hs,{description:"æœªæ£€æµ‹åˆ°éœ€è¦è¿‡æ»¤çš„ ARDTU å£°æ˜å†…å®¹"})]))])])]),_:1})]),_:1},8,["modelValue"])])):k("",!0),I.value===1?(m(),f("div",Ta,[a("div",Ea,[a("div",za,[e[41]||(e[41]=a("div",{class:"row-label"},"ä¸»æ ‡é¢˜ï¼š",-1)),a("div",Da,h(t.value.final_publish_parameters?.["ä¸»æ ‡é¢˜ (é¢„è§ˆ)"]||t.value.original_main_title||"æš‚æ— æ•°æ®"),1)]),a("div",Va,[e[42]||(e[42]=a("div",{class:"row-label"},"å‰¯æ ‡é¢˜ï¼š",-1)),a("div",Na,h(t.value.subtitle||"æš‚æ— æ•°æ®"),1)]),a("div",Ba,[e[56]||(e[56]=a("div",{class:"row-label"},"å‚æ•°ä¿¡æ¯ï¼š",-1)),a("div",Ra,[a("div",Aa,[a("div",Pa,[a("div",xa,[e[43]||(e[43]=a("span",{style:{"letter-spacing":"2.6px"},class:"param-label"},"è±†ç“£é“¾æ¥",-1)),e[44]||(e[44]=a("span",{style:{"font-size":"13px"}},"ï¼š",-1)),a("span",{class:E(["param-value",{empty:!t.value.douban_link||t.value.douban_link==="N/A"}])},h(t.value.douban_link||"N/A"),3)]),a("div",Ma,[e[45]||(e[45]=a("span",{class:"param-label"},"IMDbé“¾æ¥ï¼š",-1)),a("span",{class:E(["param-value",{empty:!t.value.imdb_link||t.value.imdb_link==="N/A"}])},h(t.value.imdb_link||"N/A"),3)]),a("div",La,[e[46]||(e[46]=a("span",{style:{"letter-spacing":"0"},class:"param-label"},"TMDbé“¾æ¥",-1)),e[47]||(e[47]=a("span",{style:{"font-size":"13px"}},"ï¼š",-1)),a("span",{class:E(["param-value",{empty:!t.value.tmdb_link||t.value.tmdb_link==="N/A"}])},h(t.value.tmdb_link||"N/A"),3)])]),a("div",Ua,[e[48]||(e[48]=a("span",{class:"param-label"},"æ ‡ç­¾ï¼š",-1)),a("div",Oa,[a("span",{class:E(["param-value",{empty:!We()||We().length===0}])},h(We().join(", ")||"N/A"),3),_e.value&&_e.value.length>0?(m(),f("span",ja,h(_e.value.join(", ")),1)):k("",!0)])])]),a("div",Fa,[a("div",qa,[e[49]||(e[49]=a("span",{class:"param-label"},"ç±»å‹ï¼š",-1)),a("div",Ga,[a("span",{class:E(["param-value",{empty:!W("type")}])},h(W("type")||"N/A"),3),t.value.standardized_params.type?(m(),f("span",Ha,h(t.value.standardized_params.type),1)):k("",!0)])]),a("div",Ka,[e[50]||(e[50]=a("span",{class:"param-label"},"åª’ä»‹ï¼š",-1)),a("div",Wa,[a("span",{class:E(["param-value",{empty:!W("medium")}])},h(W("medium")||"N/A"),3),t.value.standardized_params.medium?(m(),f("span",Ja,h(t.value.standardized_params.medium),1)):k("",!0)])]),a("div",Ya,[e[51]||(e[51]=a("span",{class:"param-label"},"è§†é¢‘ç¼–ç ï¼š",-1)),a("div",Za,[a("span",{class:E(["param-value",{empty:!W("video_codec")}])},h(W("video_codec")||"N/A"),3),t.value.standardized_params.video_codec?(m(),f("span",Xa,h(t.value.standardized_params.video_codec),1)):k("",!0)])]),a("div",Qa,[e[52]||(e[52]=a("span",{class:"param-label"},"éŸ³é¢‘ç¼–ç ï¼š",-1)),a("div",el,[a("span",{class:E(["param-value",{empty:!W("audio_codec")}])},h(W("audio_codec")||"N/A"),3),t.value.standardized_params.audio_codec?(m(),f("span",sl,h(t.value.standardized_params.audio_codec),1)):k("",!0)])]),a("div",tl,[e[53]||(e[53]=a("span",{class:"param-label"},"åˆ†è¾¨ç‡ï¼š",-1)),a("div",al,[a("span",{class:E(["param-value",{empty:!W("resolution")}])},h(W("resolution")||"N/A"),3),t.value.standardized_params.resolution?(m(),f("span",ll,h(t.value.standardized_params.resolution),1)):k("",!0)])]),a("div",ol,[e[54]||(e[54]=a("span",{class:"param-label"},"åˆ¶ä½œç»„ï¼š",-1)),a("div",nl,[a("span",{class:E(["param-value",{empty:!W("team")}])},h(W("team")||"N/A"),3),t.value.standardized_params.team?(m(),f("span",il,h(t.value.standardized_params.team),1)):k("",!0)])]),a("div",rl,[e[55]||(e[55]=a("span",{class:"param-label"},"äº§åœ°/æ¥æºï¼š",-1)),a("div",dl,[a("span",{class:E(["param-value",{empty:!W("source")}])},h(W("source")||"N/A"),3),t.value.standardized_params.source?(m(),f("span",ul,h(t.value.standardized_params.source),1)):k("",!0)])])])])]),a("div",cl,[e[57]||(e[57]=a("div",{class:"row-label"},"Mediainfoï¼š",-1)),a("div",ml,[a("pre",pl,h(t.value.mediainfo||"æš‚æ— æ•°æ®"),1)])]),a("div",vl,[e[59]||(e[59]=a("div",{class:"row-label"},"ç®€ä»‹å†…å®¹ï¼š",-1)),a("div",_l,[a("div",fl,[a("div",{class:"section-content",innerHTML:ge(t.value.intro?.statement)||"æš‚æ— å£°æ˜"},null,8,gl)]),Ve.value.length>0?(m(),f("div",bl,[a("div",hl,[(m(!0),f(N,null,M(Ve.value,(r,g)=>(m(),f("img",{key:"poster-preview-"+g,src:G(r),alt:"æµ·æŠ¥ "+(g+1),class:"preview-image-inline",style:{width:"300px"},onError:C=>X(r,"poster",g)},null,40,yl))),128))])])):k("",!0),a("div",kl,[e[58]||(e[58]=a("br",null,null,-1)),a("div",{class:"section-content",innerHTML:ge(t.value.intro?.body)||"æš‚æ— æ­£æ–‡"},null,8,wl)]),we.value.length>0?(m(),f("div",Sl,[a("div",Il,[(m(!0),f(N,null,M(we.value,(r,g)=>(m(),f("img",{key:"screenshot-preview-"+g,src:G(r),alt:"æˆªå›¾ "+(g+1),class:"preview-image-inline",onError:C=>X(r,"screenshot",g)},null,40,$l))),128))])])):k("",!0)])])])])):k("",!0),I.value===2?(m(),f("div",Cl,[e[64]||(e[64]=a("h3",{class:"selection-title"},"è¯·é€‰æ‹©è¦å‘å¸ƒçš„ç›®æ ‡ç«™ç‚¹",-1)),e[65]||(e[65]=a("p",{class:"selection-subtitle"},"å·²å­˜åœ¨çš„ç«™ç‚¹å·²è¢«è‡ªåŠ¨ç¦ç”¨ã€‚çº¢è‰²ç«™ç‚¹è¡¨ç¤ºé…ç½®ä¸å®Œæ•´ã€‚",-1)),et.value?(m(),V(Ae,{key:0,type:"error",closable:!1,style:{width:"410px",margin:"0 auto"}},{title:c(()=>[...e[60]||(e[60]=[a("span",{style:{"font-weight":"600"}},"ç¦æ­¢è½¬è½½",-1)])]),default:c(()=>[e[61]||(e[61]=a("div",null,[T(" æ£€æµ‹åˆ°åˆ¶ä½œç»„åŒ…å«ç¦æ­¢è½¬è½½çš„å†…å®¹ï¼Œå·²è‡ªåŠ¨ç¦ç”¨ UBits ç«™ç‚¹ã€‚"),a("br"),T(" ç¦æ­¢è½¬è½½çš„åˆ¶ä½œç»„ï¼šCMCTã€CMCTV ")],-1))]),_:1})):k("",!0),a("div",Tl,[u(pe,null,{default:c(()=>[u(n,{type:"primary",onClick:Ks},{default:c(()=>[...e[62]||(e[62]=[T("å…¨é€‰",-1)])]),_:1}),u(n,{type:"info",onClick:Ws},{default:c(()=>[...e[63]||(e[63]=[T("æ¸…ç©º",-1)])]),_:1})]),_:1})]),a("div",El,[(m(!0),f(N,null,M(me.value.filter(r=>r.is_target),r=>(m(),V(n,{key:r.name,class:"site-button",type:Vs(r),plain:!r.has_cookie,disabled:!qe(r.name),onClick:g=>Hs(r.name)},{default:c(()=>[T(h(r.name)+" ",1),r.name==="ubits"&&!qe(r.name)?(m(),V(z(vt),{key:0,content:"è¯¥åˆ¶ä½œç»„ç¦æ­¢è½¬è½½åˆ° uBits ç«™ç‚¹",placement:"top"},{default:c(()=>[u(i,{style:{"margin-left":"4px",color:"#f56c6c"}},{default:c(()=>[u(z(_t))]),_:1})]),_:1})):k("",!0)]),_:2},1032,["type","plain","disabled","onClick"]))),128))])])):k("",!0),I.value===3?(m(),f("div",zl,[I.value===3?(m(),f("div",Dl,[ue.value.total>0?(m(),f("div",Vl,[e[66]||(e[66]=a("div",{class:"progress-label"},"å‘å¸ƒè¿›åº¦:",-1)),u(z(Xe),{percentage:Math.round(ue.value.current/ue.value.total*100),"show-text":!0,"stroke-width":8},null,8,["percentage"]),a("div",Nl,h(ue.value.current)+" / "+h(ue.value.total),1)])):k("",!0),ce.value.total>0?(m(),f("div",Bl,[e[67]||(e[67]=a("div",{class:"progress-label"},"ä¸‹è½½å™¨æ·»åŠ è¿›åº¦:",-1)),u(z(Xe),{percentage:Math.round(ce.value.current/ce.value.total*100),"show-text":!0,"stroke-width":8},null,8,["percentage"]),a("div",Rl,h(ce.value.current)+" / "+h(ce.value.total),1)])):k("",!0),ye.value.visible?(m(),f("div",Al,[a("div",Pl,[a("div",xl,[a("div",Ml,h(ye.value.title),1),a("div",Ll,h(ye.value.message),1)])])])):k("",!0)])):k("",!0),a("div",Ul,[(m(!0),f(N,null,M(at.value,(r,g)=>(m(),f("div",{key:g,class:"results-row"},[a("div",Ol,[(m(!0),f(N,null,M(r,C=>(m(),f("div",{key:C.siteName,class:E(["result-card",{"is-success":C.success,"is-error":!C.success}])},[a("div",jl,[C.success?(m(),V(i,{key:0,color:"#67C23A",size:32},{default:c(()=>[u(z(Qe))]),_:1})):(m(),V(i,{key:1,color:"#F56C6C",size:32},{default:c(()=>[u(z(Ss))]),_:1}))]),a("h4",Fl,h(C.siteName),1),C.isExisted?(m(),f("div",ql,[u(p,{type:"warning",size:"small"},{default:c(()=>[...e[68]||(e[68]=[T("å·²å­˜åœ¨",-1)])]),_:1})])):k("",!0),C.downloaderStatus?(m(),f("div",Gl,[a("div",Hl,[C.downloaderStatus.success?(m(),V(i,{key:0,color:"#67C23A",size:16},{default:c(()=>[u(z(Qe))]),_:1})):(m(),V(i,{key:1,color:"#F56C6C",size:16},{default:c(()=>[u(z(Ss))]),_:1}))]),a("span",{class:E(["status-text",{success:C.downloaderStatus.success,error:!C.downloaderStatus.success}])},h(C.downloaderStatus.success?`ç§å­å·²æ·»åŠ åˆ°'${C.downloaderStatus.downloaderName}'`:"æ·»åŠ å¤±è´¥"),3)])):k("",!0),a("div",Kl,[u(n,{type:"primary",size:"small",onClick:yo=>tt(C.siteName,C.logs)},{default:c(()=>[...e[69]||(e[69]=[T(" æŸ¥çœ‹æ—¥å¿— ",-1)])]),_:1},8,["onClick"]),C.success&&C.url?(m(),f("a",{key:0,href:bs(C.url),target:"_blank",rel:"noopener noreferrer",style:{transform:"translateY(-1px)"}},[u(n,{type:"success",size:"small"},{default:c(()=>[...e[70]||(e[70]=[T(" æŸ¥çœ‹ç§å­ ",-1)])]),_:1})],8,Wl)):k("",!0)])],2))),128))]),a("div",Jl,[u(n,{type:"warning",icon:z(fe),size:"large",onClick:C=>nt(r),disabled:!lt(r),class:"open-all-button"},{default:c(()=>[a("div",Yl,"æ‰“å¼€"+h(ot(r))+"ä¸ªç«™ç‚¹",1)]),_:2},1032,["icon","onClick","disabled"])])]))),128))])])):k("",!0)]),a("footer",Zl,[I.value===0?(m(),f("div",Xl,[u(Pe,{name:"el-fade-in-linear"},{default:c(()=>[J.showCompleteButton?(m(),f("div",Ql," ä¿®æ”¹å®Œæˆåè¯·é¢„è§ˆä¸€éç§å­ä¿¡æ¯ç¡®ä¿æ— è¯¯åå®Œæˆä¿®æ”¹ï¼ ")):k("",!0)]),_:1}),u(n,{onClick:He},{default:c(()=>[...e[71]||(e[71]=[T("å–æ¶ˆ",-1)])]),_:1}),u(n,{type:"primary",onClick:js,disabled:ps.value},{default:c(()=>[...e[72]||(e[72]=[T(" ä¸‹ä¸€æ­¥ï¼šå‘å¸ƒå‚æ•°é¢„è§ˆ ",-1)])]),_:1},8,["disabled"]),u(Pe,{name:"el-fade-in-linear"},{default:c(()=>[ps.value?(m(),f("div",eo,[u(i,{class:"hint-icon"},{default:c(()=>[u(z(xe))]),_:1}),a("span",null,h(st.value),1)])):k("",!0)]),_:1})])):k("",!0),I.value===1?(m(),f("div",so,[u(n,{onClick:Ys,disabled:F.value},{default:c(()=>[...e[73]||(e[73]=[T("ä¸Šä¸€æ­¥",-1)])]),_:1},8,["disabled"]),J.showCompleteButton?(m(),V(n,{key:0,type:"primary",onClick:us,disabled:F.value||!oe.value,class:E({"scrolled-to-bottom":oe.value})},{default:c(()=>[...e[74]||(e[74]=[T(" ä¿®æ”¹å®Œæˆ ",-1)])]),_:1},8,["disabled","class"])):k("",!0),u(n,{type:"primary",onClick:Gs,disabled:F.value||!oe.value,class:E({"scrolled-to-bottom":oe.value})},{default:c(()=>[...e[75]||(e[75]=[T(" ä¸‹ä¸€æ­¥ï¼šé€‰æ‹©å‘å¸ƒç«™ç‚¹ ",-1)])]),_:1},8,["disabled","class"]),u(Pe,{name:"el-fade-in-linear"},{default:c(()=>[J.showCompleteButton&&!oe.value?(m(),f("div",to,[u(i,{class:"hint-icon"},{default:c(()=>[u(z(xe))]),_:1}),e[76]||(e[76]=a("span",null,"è¯·æ»šåŠ¨åˆ°é¡µé¢åº•éƒ¨æ£€æŸ¥å®Œç§å­ä¿¡æ¯æ— è¯¯å†å‘å¸ƒï¼",-1))])):k("",!0)]),_:1}),u(Pe,{name:"el-fade-in-linear"},{default:c(()=>[!J.showCompleteButton&&!oe.value?(m(),f("div",ao,[u(i,{class:"hint-icon"},{default:c(()=>[u(z(xe))]),_:1}),e[77]||(e[77]=a("span",null,"è¯·å…ˆæ»šåŠ¨åˆ°é¡µé¢åº•éƒ¨æ£€æŸ¥å®Œç§å­ä¿¡æ¯å†å‘å¸ƒï¼",-1))])):k("",!0)]),_:1})])):k("",!0),I.value===2?(m(),f("div",lo,[u(n,{onClick:He,disabled:F.value},{default:c(()=>[...e[78]||(e[78]=[T("å–æ¶ˆ",-1)])]),_:1},8,["disabled"]),u(n,{type:"primary",onClick:Js,loading:F.value,disabled:Z.value.length===0},{default:c(()=>[...e[79]||(e[79]=[T(" ç«‹å³å‘å¸ƒ ",-1)])]),_:1},8,["loading","disabled"])])):k("",!0),I.value===3?(m(),f("div",oo,[u(n,{type:"primary",onClick:us},{default:c(()=>[...e[80]||(e[80]=[T("å®Œæˆ",-1)])]),_:1})])):k("",!0)])]),ze.value?(m(),f("div",{key:0,class:"log-card-overlay",onClick:gs})):k("",!0),ze.value?(m(),V(ie,{key:1,class:"log-card",shadow:"xl"},{header:c(()=>[a("div",no,[e[81]||(e[81]=a("span",null,"æ“ä½œæ—¥å¿—",-1)),u(n,{type:"danger",icon:z(ws),circle:"",onClick:gs},null,8,["icon"])])]),default:c(()=>[a("pre",io,h(ee.value),1)]),_:1})):k("",!0),u(Ct,{visible:De.value,taskId:ls.value,onComplete:it,onClose:e[20]||(e[20]=r=>De.value=!1)},null,8,["visible","taskId"]),u(rt,{modelValue:se.value,"onUpdate:modelValue":e[22]||(e[22]=r=>se.value=r),title:"æŠ“å–å¤±è´¥ - è¯¦ç»†æ—¥å¿—",width:"800px","destroy-on-close":"","append-to-body":"",class:"error-log-dialog"},{footer:c(()=>[a("span",go,[u(n,{onClick:e[21]||(e[21]=r=>se.value=!1)},{default:c(()=>[...e[83]||(e[83]=[T("å…³é—­",-1)])]),_:1})])]),default:c(()=>[a("div",ro,[u(Ae,{title:"è·å–ç§å­ä¿¡æ¯è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯",type:"error",closable:!1,"show-icon":"",style:{"margin-bottom":"15px"}},{default:c(()=>[...e[82]||(e[82]=[a("div",null,"è¯·æŸ¥çœ‹ä¸‹æ–¹è¯¦ç»†æ—¥å¿—ä»¥æ’æŸ¥é—®é¢˜ï¼ˆå¦‚ Python å †æ ˆä¿¡æ¯ï¼‰ã€‚",-1)])]),_:1}),u(Ze,{height:"500px"},{default:c(()=>[a("div",uo,[(m(!0),f(N,null,M(ne.value,r=>(m(),f("div",{key:r.id,class:E(["log-entry",{"is-error":r.isError}])},[a("div",co,[a("span",mo,h(r.time),1),u(p,{type:be(r.level),size:"small",effect:"dark",class:"log-level-tag"},{default:c(()=>[T(h(r.level),1)]),_:2},1032,["type"]),r.site?(m(),f("span",po,"["+h(r.site)+"]",1)):k("",!0),a("span",vo,h(r.message),1)]),r.details?(m(),f("div",_o,[a("pre",fo,h(r.details),1)])):k("",!0)],2))),128))])]),_:1})])]),_:1},8,["modelValue"])],64)}}}),wo=Ts(bo,[["__scopeId","data-v-c311140f"]]);export{wo as C,ft as u};
